/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 09:44:18 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.iWebOffice2015;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.js.util.util.CharacterTool;
import java.io.*;
import java.text.*;
import java.util.*;
import java.sql.*;
import java.text.SimpleDateFormat;
import java.text.DateFormat;
import java.util.Date;
import javax.servlet.*;
import javax.servlet.http.*;
import DBstep.iDBManager2000.*;
import java.net.URLDecoder;

public final class DocumentEdit_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

/**
	 * 功能或作用：格式化日期时间
	 * @param DateValue 输入日期或时间
	 * @param DateType 格式化 EEEE是星期, yyyy是年, MM是月, dd是日, HH是小时, mm是分钟,  ss是秒
	 * @return 输出字符串
	 */

	public String FormatDate(String DateValue, String DateType) {
		String Result;
		SimpleDateFormat formatter = new SimpleDateFormat(DateType);
		try {
			Date mDateTime = formatter.parse(DateValue);
			Result = formatter.format(mDateTime);
		} catch (Exception ex) {
			Result = ex.getMessage();
		}
		if (Result.equalsIgnoreCase("1900-01-01")) {
			Result = "";
		}
		return Result;
	}
  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("java.sql");
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("java.text");
    _jspx_imports_packages.add("java.util");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("java.io");
    _jspx_imports_packages.add("DBstep.iDBManager2000");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.util.util.CharacterTool");
    _jspx_imports_classes.add("java.net.URLDecoder");
    _jspx_imports_classes.add("java.util.Date");
    _jspx_imports_classes.add("java.text.SimpleDateFormat");
    _jspx_imports_classes.add("java.text.DateFormat");
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=gb2312");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n");
      out.write('\r');
      out.write('\n');

	ResultSet result = null;

	String mStatus = null;
	String mAuthor = null;
	String mFileName = null;
	String mFileDate = null;
	String mHTMLPath = "";

	String mDisabled = "";
	String mDisabledSave = "";
	String mWord = "";
	String mExcel = "";

	//自动获取OfficeServer和OCX文件完整URL路径
	String mHttpUrlName = request.getRequestURI();
	String mScriptName = request.getServletPath();
	String mServerName = "OfficeServer";

	String mServerUrl = "http://"
			+ request.getServerName()
			+ ":"
			+ request.getServerPort()
			+ mHttpUrlName.substring(0,
					mHttpUrlName.lastIndexOf(mScriptName)) + "/"
			+ mServerName;//取得OfficeServer文件的完整URL
	String mHttpUrl = "http://"
			+ request.getServerName()
			+ ":"
			+ request.getServerPort()
			+ mHttpUrlName.substring(0,
					mHttpUrlName.lastIndexOf(mScriptName)) + "/";
	String mRecordID = request.getParameter("RecordID");
	String mTemplate = request.getParameter("Template");
	String nowTemplate=mTemplate;// 下面 还会取摸板，此时 取的值 ，如果record 有值 会把 mTemplate 盖掉！
	String mFileType = request.getParameter("FileType");
	String mEditType = request.getParameter("EditType");
	String isReTem = "0";//是否 重新加 模板  0不需要 ，1：需要
	
	String mSubject = "";
	String mUserName = URLDecoder.decode(
			request.getParameter("UserName"), "utf-8"); // new String(request.getParameter("UserName").getBytes("utf-8"));
	boolean isNewDocument = false;
	//设置编号初始值
	if (mRecordID == null) {
		mRecordID = "";
	}

	//设置编辑状态初始值
	if (mEditType == null || mEditType == "") {
		mEditType = "1";
	}

	//设置文档类型初始值
	if (mFileType == null || mFileType == "") {
		mFileType = ".doc";
	}

	//设置用户名初始值
	if (mUserName == null || mUserName == "") {
		mUserName = "金格科技";
	}

	//设置模板初始值
	if (mTemplate == null) {
		mTemplate = "";
	}
	
	String isFirstIn = "-1";// 默认不是第一次进; 当为是第一次进时， isFirstIn:1
	  //第一次， id 为空
	if(mRecordID==null||mRecordID.equals("")||mRecordID.equals("null")){
	  isFirstIn="1";
	}

	//打开数据库
	DBstep.iDBManager2000 DbaObj = new DBstep.iDBManager2000();
	if (DbaObj.OpenConnection()) {
		String mSql = "Select * From Document Where RecordID='"
				+ mRecordID + "'";
		try {
			result = DbaObj.ExecuteQuery(mSql);
			if (result.next()) {
				mRecordID = result.getString("RecordID");
				mTemplate=result.getString("Template");
				mSubject = result.getString("Subject");
				mAuthor = result.getString("Author");
				mFileDate = FormatDate(result.getString("FileDate"),
						"yyyy-MM-dd HH:mm:ss");
				mStatus = result.getString("Status");
				mFileType = result.getString("FileType");
				mHTMLPath = result.getString("HTMLPath");
				isNewDocument = false;
			} else {
				//取得唯一值(mRecordID)
				java.util.Date dt = new java.util.Date();
				long lg = dt.getTime();
				Long ld = new Long(lg);
				//初始化值
				mRecordID = ld.toString();//保存的是文档的编号，通过该编号，可以在里找到所有属于这条纪录的文档
				mTemplate = mTemplate;
				mSubject = "请输入主题";
				mAuthor = mUserName;
				mFileDate = DbaObj.GetDateTime();
				mStatus = "DERF";
				mFileType = mFileType;
				mHTMLPath = "";
				isNewDocument = true;
			}
			result.close();
		} catch (SQLException e) {
			System.out.println(e.toString());
		}
		DbaObj.CloseConnection();
	}
	
	
	if(nowTemplate!=null&&!nowTemplate.equals("")&&!nowTemplate.equals("null")){ 
	
		if(mTemplate==null||mTemplate.equals("")||mTemplate.equals("null")){
			mTemplate=nowTemplate;	
			isReTem="1";
		}else{
			 if(!nowTemplate.equals(mTemplate)){
			  mTemplate=nowTemplate;	
			  isReTem="1";
			 }	
		}
	}
	
	String mWPS = "";
	if (mEditType.equalsIgnoreCase("0")) {
		mDisabled = "disabled";
		mDisabledSave = "disabled";

	} else {
		if (mFileType.equalsIgnoreCase(".doc")
				|| mFileType.equalsIgnoreCase(".docx")) {
			mWPS = "";
			mWord = "";
			mExcel = "disabled";
		} else if (mFileType.equalsIgnoreCase(".wps")) {
			mWPS = "disabled";
			mWord = "";
			mExcel = "disabled";
		} else if (mFileType.equalsIgnoreCase(".xls")
				|| mFileType.equalsIgnoreCase(".xlsx")) {
			mWord = "disabled";
			mWPS = "";
			mExcel = "";
		} else {
			mDisabled = "disabled";
		}
	}
	mFileName = mRecordID + mFileType; //取得完整的文档名称

	String moduleType = request.getParameter("moduleType") == null
			? "information"
			: request.getParameter("moduleType");
	String isSaveHtml = request.getParameter("saveHtml") == null
			? "0"
			: request.getParameter("saveHtml");//是否生成HTML文件
	String isSaveHtmlImage = request.getParameter("saveHtmlImage") == null
			? "0"
			: request.getParameter("saveHtmlImage");//是否生成HTML图片文件
	//String isSaveDocFile=request.getParameter("saveDocFile")==null?"0":request.getParameter("saveDocFile");//是否生成DOC文件

	//手机版是直接指向文件的，所以都生成磁盘文档保存
	String isSaveDocFile = "1";//request.getParameter("saveDocFile")==null?"0":request.getParameter("saveDocFile");//是否生成DOC文件
	String isLoadTemp = request.getParameter("loadTemp") == null
			? "0"
			: request.getParameter("loadTemp");//是否套用模板

	// 是否显示红头和签章
	String showTempSign = request.getParameter("showTempSign") == null
			? "0"
			: request.getParameter("showTempSign");//签章
	String showTempHead = request.getParameter("showTempHead") == null
			? "0"
			: request.getParameter("showTempHead");//红头
	String showSignButton = request.getParameter("showSignButton") == null
			? "0"
			: request.getParameter("showSignButton");//显示痕迹按钮
	String showEditButton = request.getParameter("showEditButton") == null
			? "0"
			: request.getParameter("showEditButton");//显示编辑按钮
	String showCoverPrint = request.getParameter("showCoverPrint") == null
			? "1"
			: request.getParameter("showCoverPrint");//显示套打按钮
	String showTransPDF = request.getParameter("showTransPDF") == null
			? "0"
			: request.getParameter("showTransPDF");//显示转PDF按钮

	String openWordType = request.getParameter("openWordType") == null
			? "0"
			: request.getParameter("openWordType");//1:起草正文 2：批阅正文 3：生成正式文件  0：查看正文
	
	
	String isPrintButton = request.getParameter("printButton") == null
			? "0"
			: request.getParameter("printButton");// 是否 打印按扭
			
if(mEditType.equals("1")){
	mEditType="2";
}

      out.write("\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<title>文档正文</title>\r\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=9\" />\r\n<script src=\"js/jquery-1.4.2.min.js\"></script>\r\n<script src=\"js/WebOffice.js\"></script>\r\n<script type=\"text/javascript\">\r\n $(function(){\r\n    var isNotLoad = true;/**公共方法**/\t\r\n\t$(\".tableAll\").click(function(){\r\n        if(isNotLoad){\r\n            isNotLoad = false;\t \r\n\t\t\t  var noneY = $(this).next().css(\"display\");\r\n\t\t\t  $(\".tableAll\").next().css(\"display\",\"none\");\r\n\t\t\t  $(\".tableAll\").find('td:eq(0)').css({'background-color':'#E6DBEC'});\r\n\t\t\t  $(\".tableAll\").find('span:eq(0)').html('+');\r\n\t\t\t\t  if( noneY== 'none'){\r\n\t\t\t\t\t  var s = $(this).find('td:eq(0)').html();                \r\n\t\t\t\t\t  $(this).find('td:eq(0)').html(s.replace(\"+\", \"-\")) ;                              \r\n\t\t\t\t\t  $(this).find('td:eq(0)').css({'background-color':'#FFFFFF'});\r\n\t\t              $(this).next().slideToggle(function(){isNotLoad = true;});\r\n");
      out.write("\t\t\t\t  }else{\r\n\t\t\t\t\t  isNotLoad = true;\r\n\t\t\t\t  }\r\n            }\r\n\t});\r\n\tvar hide = false;\t//下拉\r\n\t$(\"#disPlayNone\").click(function(){\r\n\t\t if(hide){\r\n\t\t\t $('#showTD').width('204px');\r\n\t\t\t $(this).siblings().css(\"display\", \"\")\r\n\t\t\t hide = false;\r\n\t\t }else{\t\r\n\t\t\t $('#showTD').width('25px');\r\n\t\t\t $(this).siblings().css(\"display\", \"none\")\r\n\t\t\t hide = true;\r\n\t\t }\r\n\t});\t\t\r\n})\r\n</script>\r\n<link rel='stylesheet' type='text/css' href='css/iWebProduct.css' />\r\n\r\n\r\n<!-- 以下为2015主要方法 -->\r\n<script type=\"text/javascript\">\r\n \tvar WebOffice = new WebOffice2015(); //创建WebOffice对象\r\n</script>\r\n<script type=\"text/javascript\">\r\n \tfunction Load(){\r\n \t  try{\t\r\n \t  \t\tWebOffice.WebUrl=\"");
      out.print(mServerUrl);
      out.write("\";             //WebUrl:系统服务器路径，与服务器文件交互操作，如保存、打开文档，重要文件\r\n \t  \t\tWebOffice.Template=\"");
      out.print(mTemplate);
      out.write("\";\r\n\t\t    WebOffice.RecordID=\"");
      out.print(mRecordID);
      out.write("\";            //RecordID:本文档记录编号\r\n\t\t    WebOffice.FileName=\"");
      out.print(mFileName);
      out.write("\";            //FileName:文档名称\r\n\t\t    WebOffice.FileType=\"");
      out.print(mFileType);
      out.write("\";            //FileType:文档类型  .doc  .xls  \r\n\t\t    WebOffice.UserName=\"");
      out.print(mUserName);
      out.write("\";            //UserName:操作用户名，痕迹保留需要\r\n\t\t    WebOffice.AppendMenu(\"1\",\"打开本地文件(&L)\");    //多次给文件菜单添加\r\n\t\t    WebOffice.AppendMenu(\"2\",\"保存本地文件(&S)\");\r\n\t\t\tWebOffice.AppendMenu(\"3\",\"-\");\r\n\t\t\tWebOffice.AppendMenu(\"4\",\"打印预览(&C)\");\r\n\t\t\tWebOffice.AppendMenu(\"5\",\"退出打印预览(&E)\");\r\n\t\t\tWebOffice.AddCustomMenu();                       //一次性多次添加包含二次菜单\r\n\t\t\tWebOffice.Skin('blue');                        //设置皮肤\r\n\t\t    WebOffice.HookEnabled();\r\n\t\t    WebOffice.SetCaption(); \r\n\t\t    WebOffice.SetUser(\"");
      out.print(mUserName);
      out.write("\");\r\n\t\t    \r\n\t\t    if(WebOffice.WebOpen()){                             //打开该文档    交互OfficeServer  调出文档OPTION=\"LOADFILE\"\r\n\t\t    \t\r\n\t\t    \t");
if(isNewDocument){
      out.write("\r\n\t\t   \t\t    WebOffice.VBATrackRevisions(false); //首次加载不记录痕迹\r\n\t\t\t    ");
}else{
      out.write("\r\n\t\t\t\t    //修改的时候记录痕迹标记，但是不显示痕迹\r\n\t\t\t\t    WebOffice.VBATrackRevisions(true); \r\n\t\t\t\t    ShowRevision(false);\r\n\t\t\t    ");
}
      out.write("\r\n\t\t    \t/*\r\n\t\t    \tiWebOffice.EditType = “X,Y”;\r\n\t\t    \t第一位可以为0或1，0表示非锁定，1表示锁定；第二位可以为0或1，0表示锁定且不能复制，1表示锁定可以复制。当第一位为0时，第二位可以不填\r\n\t\t\t\tX含义如下:\r\n\t\t\t\t“0”非锁定模式\r\n\t\t\t\t“1”锁定模式\r\n\t\t\t\tY含义如下:\r\n\t\t\t\t“0”锁定且不能复制\r\n\t\t\t\t“1”锁定可以复制\r\n\t\t\t\t2017-07-20 进过测试以上设置无效，改用以下设置\r\n\t\t\t\t金格的官方的演示实例对editType的设置为：\r\n\t\t\t\t0:只读\r\n\t\t\t\t1:可写，无痕迹\r\n\t\t\t\t2:可写，有痕迹\r\n\t\t\t\t*/\t\t\t\t\r\n\t\t\t    WebOffice.setEditType(\"");
      out.print(mEditType.equals("0,0")?"0":mEditType);
      out.write("\");         //EditType:编辑类型  方式一   WebOpen之后\t\t\t    \r\n\t\t\t    WebOffice.VBASetUserName(WebOffice.UserName);    //设置用户名\r\n\t\t\t\t//getEditVersion();//判断是否是永中office\r\n\t\t\t    WebOffice.AddToolbar();//打开文档时显示手写签批工具栏\r\n\t\t\t    WebOffice.ShowCustomToolbar(false);//隐藏手写签批工具栏\r\n\t\t\t    StatusMsg(WebOffice.Status);\r\n\t\t    }\r\n\t\t    \r\n\t\t    ");
if(isNewDocument){
      out.write("\r\n\t   \t\t    WebOffice.VBATrackRevisions(false); //首次加载不记录痕迹\r\n\t\t    ");
}else{
      out.write("\r\n\t\t\t    //修改的时候记录痕迹标记，但是不显示痕迹\r\n\t\t\t    WebOffice.VBATrackRevisions(true); \r\n\t\t\t    ShowRevision(false);\r\n\t\t    ");
}
      out.write("\r\n\t\t    \r\n\t\t    ");
if (isReTem.equals("1")) {
      out.write("//重新加 模班   套红头时使用 \r\n\t\t    addTemplate();\r\n\t\t    ");
}
      out.write(" \t    \r\n\t    \r\n \t  }catch(e){\r\n \t     console.log(e.description);       \r\n \t  }\r\n \t}\r\n \t\r\n\t//加模板\r\n\tfunction addTemplate(){\r\n\t\tvar currFilePath;\r\n\t    if(WebOffice.WebAcceptAllRevisions()){//清除正文痕迹的目的是为了避免痕迹状态下出现内容异常问题。\r\n\t       currFilePath = WebOffice.getFilePath(); //获取2015特殊路径\r\n\t       WebOffice.WebSaveLocalFile(currFilePath+WebOffice.iWebOfficeTempName);//将当前文档保存下来\r\n\t    }\r\n\t    \r\n\t    //ajax download\r\n\t    var fileName = \"");
      out.print(mTemplate);
      out.write("\";\r\n\t    \r\n\t    $.ajax({\r\n\t    \turl:\"/jsoa/OfficeServer?isAjaxDownloadTemplate=true\",\r\n\t    \ttype:\"post\",\r\n\t    \tdata:{\r\n\t    \t\tfileName:fileName\r\n\t    \t},\r\n\t    \tsuccess:function(data){\r\n   \t\t       if(WebOffice.DownloadToFile(fileName+\".doc\",currFilePath)){//下载服务器指定的文件\r\n   \t\t          WebOffice.OpenLocalFile(currFilePath+fileName+\".doc\");//打开该文件\r\n   \t\t          \r\n   \t\t          //Position：书签名\r\n   \t\t          if(!WebOffice.VBAInsertFile(\"Content\",currFilePath+WebOffice.iWebOfficeTempName)){//插入文档\r\n   \t\t           StatusMsg(\"插入文档失败\"); \r\n   \t\t           return;\r\n   \t\t          }\r\n\t\t\t\t\r\n   \t\t       ");
if(isLoadTemp.equals("1")){
      out.write("\r\n\t\t\t       LoadBookmarks();\r\n\t\t\t    ");
}
      out.write("\r\n\t\t\t    \r\n   \t\t       }\r\n\t    \t},\r\n\t    \terror:function(msg){\r\n\t    \t\tconsole.error(msg)\r\n\t    \t}\r\n\t    })\r\n\t}\r\n\t\r\n\t\r\n\t//作用：填充模板\r\n\tfunction LoadBookmarks(){\r\n\t  StatusMsg(\"正在填充模扳...\");\r\n\t    ");
if(request.getParameter("textContent") != null && !"-1".equals(request.getParameter("textContent"))){
      out.write("\r\n\t      WebOffice.WebSetBookmarks(\"Content\",\"");
      out.print(request.getParameter("textContent"));
      out.write("\");\r\n\t    ");
}
      out.write("\r\n\t\tBookMarkName = \"\";\r\n\t\tBookMarkValue = \"\";\r\n\t  ");

		Enumeration e = (Enumeration)request.getParameterNames(); 
	    while(e.hasMoreElements()){
	    String parName=(String)e.nextElement();
		if(parName.startsWith("$")){
			if(request.getParameter(parName) != null && !"-1".equals(request.getParameter(parName))&&!"".equals(request.getParameter(parName))){
			  String bookMarkAll = request.getParameter(parName);
			  String bookMarkName = bookMarkAll.substring(bookMarkAll.indexOf("[")+1,bookMarkAll.indexOf("]"));
			  String bookMarkValue = bookMarkAll.substring(bookMarkAll.indexOf("]")+1,bookMarkAll.length());
			  if("附件".equals(bookMarkName) || "备用字段13".equals(bookMarkName)){
				  //将回车换行转化为 \r\n 
				  bookMarkValue=CharacterTool.escapeJSTagsRN(bookMarkValue);
			  }
			  
      out.write("\r\n\t\t\t      BookMarkName = \"");
      out.print(bookMarkName);
      out.write("\";\r\n\t\t\t  \t  BookMarkValue = \"");
      out.print(bookMarkValue);
      out.write("\";\r\n\t\t\t\t  WebOffice.WebSetBookmarks();\r\n\t\t\t  ");

			}
		  }
	  }
	  
      out.write("\r\n\t\t\r\n\t//套红头\r\n\t  //WebOffice.ClearRevision();    //清除修改痕迹\r\n\t  ");
if(request.getParameter("wordId") != null && !"-1".equals(request.getParameter("wordId"))&&!"".equals(request.getParameter("wordId"))){
	      com.js.doc.doc.service.SenddocumentBD senddocumentBD = new com.js.doc.doc.service.SenddocumentBD();

	      //根据机关代字 id取  机关代字
	      com.js.doc.doc.po.SendDocumentWordPO  po= senddocumentBD.loadSendDocumentWordPO(request.getParameter("wordId"));

	      
      out.write("\r\n\t      BookMarkName = \"红头\";\r\n\t      BookMarkValue = \"\";\r\n\t      WebOffice.WebSetBookmarks();\r\n\r\n\t      ");

		  //取机关代字对应的红头 
	      if(po.getRedHeadSaveName()!= null &&!po.getRedHeadSaveName().toString().equals("")){
	      
      out.write("\r\n\t      WebOffice.WebInsertImage(\"红头\",\"");
      out.print(po.getRedHeadSaveName());
      out.write("\",true,4);//套红\r\n\t      ");

	      }
	  }

	
      out.write("\r\n\t}\r\n\t\r\n\t\r\n\r\n \t\r\n \t//设置页面中的状态值\r\n \tfunction StatusMsg(mValue){\r\n \t   try{\r\n\t   document.getElementById('state').innerHTML = mValue;\r\n\t   }catch(e){\r\n\t     return false;\r\n\t   }\r\n\t}\r\n\t\r\n\t//作用：获取文档Txt正文\r\n\tfunction WebGetWordContent(){\r\n\t  try{\r\n\t    alert(WebOffice.WebObject.ActiveDocument.Content.Text);\r\n\t  }catch(e){alert(e.description);}\r\n\t}\r\n\t\r\n\t//作用：写Word内容\r\n\tfunction WebSetWordContent(){\r\n\t  var mText=window.prompt(\"请输入内容:\",\"测试内容\");\r\n\t  if (mText==null){\r\n\t     return (false);\r\n\t  }else{\r\n\t     WebOffice.WebObject.ActiveDocument.Application.Selection.Range.Text= mText+\"\\n\";\r\n\t  }\r\n\t}\r\n\r\n\t//作用：获取文档页数\r\n\tfunction WebDocumentPageCount(){\r\n\t    if (WebOffice.FileType==\".doc\"||WebOffice.FileType==\".docx\"){\r\n\t\tvar intPageTotal = WebOffice.WebObject.ActiveDocument.Application.ActiveDocument.BuiltInDocumentProperties(14);\r\n\t\tintPageTotal = WebOffice.blnIE()?intPageTotal:intPageTotal.Value();\r\n\t\talert(\"文档页总数：\"+intPageTotal);\r\n\t    }\r\n\t    if (WebOffice.FileType==\".wps\"){\r\n\t\t\tvar intPageTotal = WebOffice.WebObject.ActiveDocument.PagesCount();\r\n");
      out.write("\t\t\talert(\"文档页总数：\"+intPageTotal);\r\n\t    }\r\n\t}\r\n\t\r\n\t//作用：显示或隐藏痕迹[隐藏痕迹时修改文档没有痕迹保留]  true表示隐藏痕迹  false表示显示痕迹\r\n\tfunction ShowRevision(mValue){\r\n\t  if (mValue){\r\n\t     WebOffice.WebShow(true);\r\n\t     StatusMsg(\"显示痕迹...\");\r\n\t  }else{\r\n\t     WebOffice.WebShow(false);\r\n\t     StatusMsg(\"隐藏痕迹...\");\r\n\t  }\r\n\t}\r\n\t\r\n\t//接受文档中全部痕迹\r\n\tfunction WebAcceptAllRevisions(){\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveDocument.AcceptAllRevisions();\r\n\t  var mCount = WebOffice.WebObject.ActiveDocument.Application.ActiveDocument.Revisions.Count;\r\n\t  if(mCount>0){\r\n\t    return false;\r\n\t  }else{\r\n\t    return true;\r\n\t  }\r\n\t}\r\n\t\r\n\t\t//作用：VBA套红\r\n\tfunction WebInsertVBA(){\r\n\t\t//画线\r\n\t\ttry{\r\n\t\tvar object=WebOffice.WebObject.ActiveDocument;\r\n\t\tvar myl=object.Shapes.AddLine(100,60,305,60);\r\n\t\tvar myl1=object.Shapes.AddLine(326,60,520,60);\r\n\t   \tvar myRange=WebOffice.WebObject.ActiveDocument.Range(0,0);\r\n\t\tmyRange.Select();\r\n\t\tvar mtext=\"★\";\r\n\t\tWebOffice.WebObject.ActiveDocument.Application.Selection.Range.InsertAfter (mtext+\"\\n\");\r\n\t   \tvar myRange=WebOffice.WebObject.ActiveDocument.Paragraphs(1).Range;\r\n");
      out.write("\t   \tmyRange.ParagraphFormat.LineSpacingRule =1.5;\r\n\t   \tmyRange.font.ColorIndex=6;\r\n\t   \tmyRange.ParagraphFormat.Alignment=1;\r\n\t   \tmyRange=WebOffice.WebObject.ActiveDocument.Range(0,0);\r\n\t\tmyRange.Select();\r\n\t\tmtext=\"金格发[２０１２]１５４号\";\r\n\t\tWebOffice.WebObject.ActiveDocument.Application.Selection.Range.InsertAfter (mtext+\"\\n\");\r\n\t\tmyRange=WebOffice.WebObject.ActiveDocument.Paragraphs(1).Range;\r\n\t\tmyRange.ParagraphFormat.LineSpacingRule =1.5;\r\n\t\tmyRange.ParagraphFormat.Alignment=1;\r\n\t\tmyRange.font.ColorIndex=1;\r\n\t\tmtext=\"金格电子政务文件\";\r\n\t\tWebOffice.WebObject.ActiveDocument.Application.Selection.Range.InsertAfter (mtext+\"\\n\");\r\n\t\tmyRange=WebOffice.WebObject.ActiveDocument.Paragraphs(1).Range;\r\n\t\tmyRange.ParagraphFormat.LineSpacingRule =1.5;\r\n\t\tmyRange.Font.ColorIndex=6;\r\n\t\tmyRange.Font.Name=\"仿宋_GB2312\";\r\n\t\tmyRange.font.Bold=true;\r\n\t\tmyRange.Font.Size=50;\r\n\t\tmyRange.ParagraphFormat.Alignment=1;\r\n\t\tWebOffice.WebObject.ActiveDocument.PageSetup.LeftMargin=70;\r\n\t\tWebOffice.WebObject.ActiveDocument.PageSetup.RightMargin=70;\r\n");
      out.write("\t\tWebOffice.WebObject.ActiveDocument.PageSetup.TopMargin=70;\r\n\t\tWebOffice.WebObject.ActiveDocument.PageSetup.BottomMargin=70;\r\n\t\t}catch(e){\r\n\t\t alert(e);\r\n\t\t}\r\n\t}\r\n\r\n\t//作用：设置书签值  vbmName:标签名称，vbmValue:标签值   标签名称注意大小写\r\n\tfunction SetBookmarks(){\r\n\t\ttry{\r\n\t\t\tvar mText=window.prompt(\"请输入书签名称和书签值，以','隔开。\",\"例如：book1,book2\");\r\n\t\t\tvar mValue = mText.split(\",\");\r\n\t\t\tBookMarkName = mValue[0];\r\n\t\t\tBookMarkValue = mValue[1];\r\n\t\t\tWebOffice.WebSetBookmarks(mValue[0],mValue[1]);\r\n\t\t\tStatusMsg(\"设置成功\");\r\n\t\t\treturn true;\r\n\t\t}catch(e){\r\n\t\t\tStatusMsg(\"书签不存在\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t//打开书签窗口\r\n\tfunction WebOpenBookMarks(){\t\r\n\t\t\tWebOffice.WebOpenBookMarks();\r\n\t\t }\r\n\t//添加书签\r\n\tfunction WebAddBookMarks(){//书签名称，书签值\r\n\t\tWebOffice.WebAddBookMarks(\"JK\",\"KingGrid\");\r\n\t}\r\n\t //定位书签\r\n\tfunction WebFindBookMarks(){\r\n\t\tWebOffice.WebFindBookMarks(\"JK\");\r\n\t }\r\n\t //删除书签\r\n\tfunction WebDelBookMarks(){//书签名称，\r\n\t    WebOffice.WebDelBookMarks(\"JK\");//删除书签\r\n\t }\r\n         \r\n\tfunction DelFile(){\r\n\t   var mFileName = WebOffice.FilePath+WebOffice.FileName;\r\n");
      out.write("       WebOffice.Close(); \r\n       WebOffice.WebDelFile(mFileName);\r\n\t}\r\n\t//作用：用Excel求和\r\n\tfunction WebGetExcelContent(){\r\n\t  if(!WebOffice.WebObject.ActiveDocument.Application.Sheets(1).ProtectContents){\r\n\t\t  WebOffice.WebObject.ExitExcelEditMode();\r\n\t\t  WebOffice.WebObject.Activate(true);  \r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.Sheets(1).Select();\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C5\").Select();\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"126\";\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C6\").Select();\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"446\";\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C7\").Select();\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"556\";\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C5:C8\").Select();\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C8\").Activate();\r\n\t\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"=SUM(R[-3]C:R[-1]C)\";\r\n");
      out.write("\t\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"D8\").Select();\r\n\t\t  WebOffice.WebObject.ActiveDocument.application.sendkeys(\"{ESC}\");\r\n\t\t  StatusMsg(WebOffice.WebObject.ActiveDocument.Application.Range(\"C8\").Text);\r\n\t  }\r\n\t\r\n\t}\r\n\t\r\n\t\t//作用：保护工作表单元\r\n\tfunction WebSheetsLock(){\r\n\t\t if(!WebOffice.WebObject.ActiveDocument.Application.Sheets(1).ProtectContents){\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"A1\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"产品\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"B1\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"价格\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C1\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"详细说明\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"D1\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"库存\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"A2\").Select();\r\n");
      out.write("\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"书签\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"A3\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"毛笔\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"A4\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"钢笔\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"A5\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"尺子\";\r\n\t\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"B2\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"0.5\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C2\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"樱花\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"D2\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"300\";\r\n\t\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"B3\").Select();\r\n");
      out.write("\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"2\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C3\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"狼毫\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"D3\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"50\";\r\n\t\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"B4\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"3\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C4\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"蓝色\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"D4\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"90\";\r\n\t\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"B5\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"1\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"C5\").Select();\r\n");
      out.write("\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"20cm\";\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"D5\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveCell.FormulaR1C1 = \"40\";\r\n\t\r\n\t  //保护工作表\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Range(\"B2:D5\").Select();\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Selection.Locked = false;\r\n\t  WebOffice.WebObject.ActiveDocument.Application.Selection.FormulaHidden = false;\r\n\t  WebOffice.WebObject.ActiveDocument.Application.ActiveSheet.Protect(true,true,true);\r\n\t  StatusMsg(\"已经保护工作表，只有B2-D5单元格可以修改。\");\r\n\t\t }\r\n\t}\r\n\t\r\n\t//根据当空打开的文档类型保存文档\r\n\tfunction WebOpenLocal(){\r\n\t   WebOffice.WebOpenLocal();\r\n\t   //WebOffice.WebDelFile(WebOffice.FilePath+WebOffice.FileName);\r\n\t   //WebOffice.FileType = WebOffice.WebGetDocSuffix();\r\n\t   //WebOffice.FileName = WebOffice.FileName.substring(0,WebOffice.FileName.lastIndexOf(\".\"))+WebOffice.FileType;\r\n\t   //document.getElementById('FileType').value = WebOffice.FileType;\r\n\t}\r\n");
      out.write("\t//调用模板\r\n\tfunction WebUseTemplate(fileName){\r\n\t    var currFilePath;\r\n\t    if(WebOffice.WebAcceptAllRevisions()){//清除正文痕迹的目的是为了避免痕迹状态下出现内容异常问题。\r\n\t       currFilePath = WebOffice.getFilePath(); //获取2015特殊路径\r\n\t       WebOffice.WebSaveLocalFile(currFilePath+WebOffice.iWebOfficeTempName);//将当前文档保存下来\r\n\t       if(WebOffice.DownloadToFile(fileName,currFilePath)){//下载服务器指定的文件\r\n\t          WebOffice.OpenLocalFile(currFilePath+fileName);//打开该文件\r\n\t          if(!WebOffice.VBAInsertFile(\"Content\",currFilePath+WebOffice.iWebOfficeTempName)){//插入文档\r\n\t           StatusMsg(\"插入文档失败\"); \r\n\t           return;\r\n\t          }\r\n\t          StatusMsg(\"模板套红成功\"); \r\n\t          return; \r\n\t       }\r\n\t       StatusMsg(\"下载文档失败\"); \r\n\t       return;\r\n\t    }\r\n\t    StatusMsg(\"清除正文痕迹失败，套红中止\"); \r\n\t}\r\n\t//手写签批\r\n\tfunction HandWriting(){\r\n\t \tvar penColor=document.getElementById(\"PenColor\").value;\r\n\t \tvar penWidth=document.getElementById(\"PenWidth\").value;\r\n\t \tWebOffice.HandWriting(penColor,penWidth);\r\n\t}\r\n\tfunction getEditVersion(){\r\n\t\tvar getVersion=WebOffice.getEditVersion(); //获取当前编辑器软件版本\r\n");
      out.write("\t\tif (getVersion == \"YozoWP.exe\" || getVersion == \"YozoSS.exe\")  //如果是永中office,隐藏手写功能等\r\n\t\t{\r\n\t\t    document.getElementById(\"handWriting1\").style.display='none';\r\n\t\t    document.getElementById(\"handWriting2\").style.display='none';\r\n\t\t    document.getElementById(\"expendFunction\").style.display='none';\r\n\t\t    document.getElementById(\"enableCopy1\").style.display='none';\r\n\t\t    document.getElementById(\"enableCopy2\").style.display='none';\r\n\t\t    document.getElementById(\"OpenBookMarks\").style.display='none';\r\n\t\t    document.getElementById(\"areaProtect\").style.display='none';\r\n\t\t    document.getElementById(\"areaUnprotect\").style.display='none';\r\n\t\t    \r\n\t\t}else if(getVersion == \"WINWORD.EXE\" || getVersion == \"wps.exe\") {\r\n\t\t\tWebOffice.ShowWritingUser(true);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t//全屏\r\n\tfunction FullSize(mValue){\r\n\t\tWebOffice.FullSize(mValue);\r\n\t}\r\n\t//添加区域保护\r\n\tfunction WebAreaProtect(){\t\r\n\t\tvar mText = window.prompt(\"请输入书签名称\", \"KingGrid\",\"\");\r\n\t\tif(mText!=null)\tWebOffice.WebAreaProtect(mText);\r\n\t}\r\n\t//取消区域保护\r\n\tfunction WebAreaUnprotect(){\r\n");
      out.write("\t\tvar mText = window.prompt(\"请输入书签名称\", \"KingGrid\",\"\");\r\n\t\tif(mText!=null) WebOffice.WebAreaUnprotect(mText);\r\n\t}\r\n\t//执行宏命令\r\n\tfunction WebRunMacro(){\t\t\r\n\t\twindow.open(\"MacroForm.htm\",'','height=250px,width=450px,top=300,left=350,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no');\r\n\t\t\r\n\t}\r\n</script>\r\n<script language=\"javascript\" for=\"WebOffice2015\" event=\"OnReady()\">\r\n   WebOffice.setObj(document.getElementById('WebOffice2015'));//给2015对象赋值\r\n   Load();//避免页面加载完，控件还没有加载情况\r\n</script>\r\n<script language=\"javascript\" for=\"WebOffice2015\"\r\n\tevent=\"OnRightClickedWhenAnnotate()\">\r\n   WebOffice.ShowToolBars(true);//停止签批时显示工具栏\r\n   WebOffice.ShowMenuBar(true);//停止签批时显示菜单栏\r\n</script>\r\n<script language=\"JavaScript\" for=WebOffice2015\r\n\tevent=\"OnFullSizeBefore(bVal)\">\r\n    if(bVal == true){\r\n    \tvar getVersion=WebOffice.getEditVersion();\r\n    \tif(getVersion == \"WINWORD.EXE\" || getVersion == \"wps.exe\") {\r\n\t\t\tWebOffice.ShowCustomToolbar(true);//显示手写签批工具栏\r\n\t\t}\r\n    }\r\n</script>\r\n<script language=\"JavaScript\" for=WebOffice2015\r\n");
      out.write("\tevent=\"OnFullSizeAfter(bVal)\">\r\n    if(bVal == false){\r\n    \tWebOffice.ShowCustomToolbar(false);\t//隐藏控件的手写签批工具栏\r\n    }\r\n</script>\r\n\r\n<script language=\"javascript\" for=WebOffice2015\r\n\tevent=\"OnRecvStart(nTotleBytes)\">\r\n    nSendTotleBytes = nTotleBytes;\r\n    nSendedSumBytes = 0;\r\n</script>\r\n<script language=\"javascript\" for=WebOffice2015\r\n\tevent=\"OnRecving(nRecvedBytes)\">\r\n    nSendedSumBytes += nRecvedBytes;\r\n</script>\r\n<script language=\"javascript\" for=WebOffice2015\r\n\tevent=\"OnRecvEnd(bSucess)\">\r\n\r\n</script>\r\n<script language=\"javascript\" for=WebOffice2015\r\n\tevent=\"OnSendStart(nTotleBytes)\">\r\n    nSendTotleBytes = nTotleBytes;\r\n    nSendedSumBytes = 0;\r\n</script>\r\n<script language=\"javascript\" for=WebOffice2015\r\n\tevent=\"OnSending(nSendedBytes)\">\r\n    nSendedSumBytes += nSendedBytes;\r\n</script>\r\n<script language=\"javascript\" for=WebOffice2015\r\n\tevent=\"OnSendEnd(bSucess)\">\r\n    if (bSucess){\r\n        if(WebOffice.sendMode == \"LoadImage\"){\r\n          var httpclient = WebOffice.WebObject.Http;\r\n          WebOffice.hiddenSaveLocal(httpclient,WebOffice,false,false,WebOffice.ImageName);\r\n");
      out.write("          WebOffice.InsertImageByBookMark();\r\n          WebOffice.ImageName = null;\r\n          WebOffice.BookMark = null;\r\n          StatusMsg(\"插入图片成功\");\r\n          return\r\n\t     } \r\n\t      StatusMsg(\"插入图片失败\"); \r\n    }\r\n</script>\r\n<script language=\"JavaScript\" for=WebOffice2015\r\n\tevent=\"OnCommand(ID, Caption, bCancel)\">\r\n   switch(ID){\r\n\t    case 1:WebOpenLocal();break;//打开本地文件\r\n\t    case 2:WebOffice.WebSaveLocal();break;//另存本地文件\r\n\t\tcase 4:WebOffice.PrintPreview();break;//启用\r\n\t\tcase 5:WebOffice.PrintPreviewExit();WebOffice.ShowField();break;//启用\r\n\t\tcase 17:WebOffice.SaveEnabled(true);StatusMsg(\"启用保存\");break;//启用保存\r\n\t\tcase 18:WebOffice.SaveEnabled(false);StatusMsg(\"关闭保存\");break;//关闭保存\r\n\t\tcase 19:WebOffice.PrintEnabled(true);StatusMsg(\"启用打印\");break;//启用打印\r\n\t\tcase 20:WebOffice.PrintEnabled(false);StatusMsg(\"关闭打印\");break;//关闭打印\r\n\t\tcase 301:WebOffice.HandWriting(\"255\",\"4\");StatusMsg(\"手写签批\");break;//手写签批\r\n\t\tcase 302:WebOffice.StopHandWriting();StatusMsg(\"停止手写签批\");break;//停止手写签批\r\n\t\tcase 303:WebOffice.TextWriting();StatusMsg(\"文字签名\");break;//文字签名\r\n");
      out.write("\t\tcase 304:WebOffice.ShapeWriting();StatusMsg(\"图形签批\");break;//图形签批\r\n\t\tcase 305:WebOffice.RemoveLastWriting();StatusMsg(\"取消上一次签批\");break;//取消上一次签批\r\n\t\tcase 306:WebOffice.ShowWritingUser(false,WebOffice.UserName);StatusMsg(\"显示签批用户\");break;//显示签批用户\r\n\t\tdefault:;return;  \r\n  }   \r\n</script>\r\n\r\n<script language=\"javascript\" for=WebOffice2015 event=\"OnQuit()\">\r\n//DelFile();\r\n</script>\r\n\r\n\r\n<!--以下是多浏览器的事件方法 -->\r\n<script>\r\nfunction OnReady(){\r\n WebOffice.setObj(document.getElementById('WebOffice2015'));//给2015对象赋值\r\n //Load();//避免页面加载完，控件还没有加载情况\r\n window.onload = function(){Load();} //IE和谷歌可以直接调用Load方法，火狐要在页面加载完后去调用\r\n}\r\n//停止签批时显示工具栏和菜单栏\r\nfunction OnRightClickedWhenAnnotate(){\r\n\tWebOffice.ShowToolBars(true);\r\n    WebOffice.ShowMenuBar(true);\r\n}\r\n//全屏显示控件的手写签批工具栏\r\nfunction OnFullSizeBefore(bVal){\r\n\t if(bVal == true){\r\n    \tvar getVersion=WebOffice.getEditVersion();\r\n    \tif(getVersion == \"WINWORD.EXE\" || getVersion == \"wps.exe\") {\r\n\t\t\tWebOffice.ShowCustomToolbar(true);//显示手写签批工具栏\r\n\t\t}\t\r\n    }\r\n}\r\n//退出全屏隐藏控件的手写签批工具栏\r\nfunction OnFullSizeAfter(bVal){\r\n");
      out.write("\tif(bVal == false){\r\n    \tWebOffice.ShowCustomToolbar(false);\t\r\n    }\r\n}\r\n//上传下载回调用事件\r\nfunction OnSendStart(nTotleBytes){\r\n nSendTotleBytes = nTotleBytes;nSendedSumBytes = 0;\r\n}\r\nfunction OnSending(nSendedBytes){\r\n        nSendedSumBytes += nSendedBytes;\r\n}\r\n//异步上传\r\nfunction OnSendEnd() {\r\n    if(WebOffice.sendMode == \"LoadImage\"){\r\n    \tvar httpclient = WebOffice.WebObject.Http;\r\n    \tWebOffice.hiddenSaveLocal(httpclient,WebOffice,false,false,WebOffice.ImageName);\r\n     \tWebOffice.InsertImageByBookMark();\r\n        WebOffice.ImageName = null;\r\n        WebOffice.BookMark = null;\r\n        StatusMsg(\"插入图片成功\");\r\n        return;\r\n\t} \r\n\tStatusMsg(\"插入图片失败\"); \r\n}\r\nfunction OnRecvStart(nTotleBytes){\r\n    nSendTotleBytes = nTotleBytes;nSendedSumBytes = 0;\r\n}\r\nfunction OnRecving(nRecvedBytes){\r\n   nSendedSumBytes += nRecvedBytes;\r\n}\r\n//异步下载\r\nfunction OnRecvEnd() {\r\n}\r\nfunction OnCommand(ID, Caption, bCancel){\r\n   switch(ID){\r\n\t    case 1:WebOpenLocal();break;//打开本地文件\r\n\t    case 2:WebOffice.WebSaveLocal();break;//另存本地文件\r\n");
      out.write("\t\tcase 4:WebOffice.PrintPreview();break;//启用\r\n\t\tcase 5:WebOffice.PrintPreviewExit();WebOffice.ShowField();break;//启用\r\n\t\tcase 17:WebOffice.SaveEnabled(true);StatusMsg(\"启用保存\");break;//启用保存\r\n\t\tcase 18:WebOffice.SaveEnabled(false);StatusMsg(\"关闭保存\");break;//关闭保存\r\n\t\tcase 19:WebOffice.PrintEnabled(true);StatusMsg(\"启用打印\");break;//启用打印\r\n\t\tcase 20:WebOffice.PrintEnabled(false);StatusMsg(\"关闭打印\");break;//关闭打印\r\n\t\tcase 301:WebOffice.HandWriting(\"255\",\"4\");StatusMsg(\"手写签批\");break;//手写签批\r\n\t\tcase 302:WebOffice.StopHandWriting();StatusMsg(\"停止手写签批\");break;//停止手写签批\r\n\t\tcase 303:WebOffice.TextWriting();StatusMsg(\"文字签名\");break;//文字签名\r\n\t\tcase 304:WebOffice.ShapeWriting();StatusMsg(\"图形签批\");break;//图形签批\r\n\t\tcase 305:WebOffice.RemoveLastWriting();StatusMsg(\"取消上一次签批\");break;//取消上一次签批\r\n\t\tcase 306:WebOffice.ShowWritingUser(false,WebOffice.UserName);StatusMsg(\"显示签批用户\");break;//显示签批用户\r\n\t\tdefault:;return;  \r\n  }   \r\n}\r\n     \r\n</script>\r\n<!--End以下是多浏览器的事件方法 -->\r\n\r\n\r\n\r\n<!--End 为2015主要方法 -->\r\n\r\n<link href=\"/jsoa/skin/");
      out.print(session.getAttribute("skin"));
      out.write("/style-");
      out.print(session.getAttribute("browserVersion"));
      out.write(".css\" rel=\"stylesheet\" type=\"text/css\" />\r\n\r\n</head>\r\n<body onresize=\"init()\" style=\"overflow-y:hidden;overflow-x:hidden\"\tonUnload=\"WebOffice.WebClose()\">\r\n<iframe id=\"targetFrame\" name=\"targetFrame\" style=\"display:none\"></iframe>\r\n\t<form id=\"iWebOfficeForm\" method=\"post\" action=\"DocumentSave.jsp?field=");
      out.print(request.getParameter("field"));
      out.write("\"  target=\"targetFrame\">\r\n\t\t<input type=\"hidden\" name=\"RecordID\" value=\"");
      out.print(mRecordID);
      out.write("\" /> <input\r\n\t\t\ttype=\"hidden\" name=\"Template\" value=\"");
      out.print(mTemplate);
      out.write("\" /> <input\r\n\t\t\ttype=\"hidden\" id=\"FileType\" name=\"FileType\" value=\"");
      out.print(mFileType);
      out.write("\" />\r\n\t\t<input type=\"hidden\" name=\"EditType\" value=\"");
      out.print(mEditType);
      out.write("\" /> <input\r\n\t\t\ttype=\"hidden\" name=\"HTMLPath\" value=\"");
      out.print(mHTMLPath);
      out.write("\" /> <input\r\n\t\t\ttype=\"hidden\" id=\"Subject\" name=\"Subject\" value=\"");
      out.print(mSubject);
      out.write("\" /> <input\r\n\t\t\ttype=\"hidden\" id=\"Author\" name=\"Author\" value=\"");
      out.print(mAuthor);
      out.write("\" /> <input\r\n\t\t\ttype=\"hidden\" name=\"FileDate\" value=\"");
      out.print(mFileDate);
      out.write("\" /> <input\r\n\t\t\ttype=\"hidden\" name=\"FlagCloseWindow\" value=\"0\" /> <input\r\n\t\t\ttype=\"hidden\" name=\"IsOut\" value=\"0\">\r\n\t</form>\r\n\t<table border=0 cellspacing='0' cellpadding='0' width=\"100%\"\r\n\t\talign=\"center\" class=\"TBStyle\">\r\n\t\t<tr>\r\n\t\t\t<!--td align=right valign=top  class=\"TDTitleStyle\" width=64>内容</td-->\r\n\t\t\t<td class=\"TDStyle\">\r\n\t\t\t\t<table valign=top border=0 cellspacing='0' cellpadding='0'\r\n\t\t\t\t\twidth='100%'>\r\n\t\t\t\t\t");

					if (!"0".equals(mEditType) && !"0,0".equals(mEditType)) {
					
      out.write("\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td><input type=button class=\"btnButton2font\" value=\"保存文档\"\r\n\t\t\t\t\t\t\tonclick=\"onlySaveDoc();\"><input type=button\r\n\t\t\t\t\t\t\tclass=\"btnButton2font\" value=\"保存并返回\" onclick=\"saveAndCloseWin()\">\r\n\t\t\t\t\t\t\t");
if (!isFirstIn.equals("1") && !isLoadTemp.equals("1")) { 
      out.write("\r\n\t\t\t\t\t\t\t <input type=button class=\"btnButton2font\" value=\"显示痕迹\" onclick=\"ShowRevision(true)\"> \r\n\t\t\t\t\t\t\t <input type=button\tclass=\"btnButton2font\" value=\"隐藏痕迹\" onclick=\"ShowRevision(false)\">\r\n\t\t\t\t\t\t\t");

							}
							
      out.write("\r\n\t\t\t\t\t\t\t");
if ("shandongguotou".equals(com.js.util.config.SystemCommon.getCustomerName())) {
      out.write("\r\n\t\t\t\t\t\t\t <input type=button id=\"saveMenu\" style=\"display:none\" class=\"btnButton2font\" value=\"生成正式文件\" onclick=\"cmdSavefile()\">\r\n\t\t\t\t\t\t\t");

							}
							
      out.write("\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t");

					}
					
      out.write("\r\n\t\t\t\t</table>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n\t<table id=\"maintable\" cellspacing='0' cellpadding='0'>\r\n\t\t<!-- head -->\r\n\t\t<!-- end head -->\r\n\r\n\t\t<!-- showList -->\r\n\t\t<tr>\r\n\t\t\t<td id=\"showtr\" colspan=\"2\" valign=\"top\">\r\n\t\t\t\t<table id=\"functionBox\" border=\"0\"  cellspacing='0' cellpadding='0'>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td id=\"activeBox\">\r\n\t\t\t\t\t\t\t<table id=\"activeTable\"  cellspacing='0' cellpadding='0'>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td colspan=\"8\" id=\"activeTd\"><script\r\n\t\t\t\t\t\t\t\t\t\t\tsrc=\"js/iWebOffice2015.js\"></script></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<!-- end showList -->\r\n\r\n\t\t<!-- footer -->\r\n\t\t<!-- end footer -->\r\n\t</table>\r\n</body>\r\n</html>\r\n<script language=\"javascript\">\r\n self.moveTo(0,0);\r\n self.resizeTo(screen.availWidth,screen.availHeight);\r\ninit();\r\n function init(){\r\n   document.getElementById('WebOffice2015').height =document.documentElement.clientHeight +\"px\";\r\n   var functionTableLength = getHeight('showTD')-document.getElementById(\"functionTable\").rows.length*32;\r\n");
      out.write("   for(var i =0;i<document.getElementById(\"functionTable\").rows.length-3;i++){\r\n       try{\r\n        var readivLength = document.getElementById(\"readT\"+i).rows.length*30;      \r\n\t    if(readivLength+30 < functionTableLength){\r\n\t      document.getElementById('readT'+i).style.height =  readivLength+ 8 + \"px\";\r\n\t      document.getElementById('read'+i).style.height =  readivLength+ 8 + \"px\";\r\n\t    }else{\r\n\t        document.getElementById('readT'+i).style.height =  functionTableLength-50 + \"px\";\r\n\t        document.getElementById('read'+i).style.height =  functionTableLength -50 + \"px\";\r\n\t    }\r\n\t   }catch(e){\r\n         continue;\r\n        }\r\n    }\r\n    $(\"tr\").remove(\".disabled\");\r\n  }\r\n  //获取id的高度\r\n  function  getHeight(id){\r\n    return document.getElementById(id).offsetHeight; \r\n  }\r\n  \r\n//作用：保存文档（同时生成两份文档，一份为原WORD文档，一份为PGF全文批注文档，用于领导批注使用）\r\n  function SaveDocument(moduleType,isSaveHtmlImage,isSaveDocFile,isSaveHtml){\r\n  \tif(opener.document.all.isChange){// 表 已经修改了\r\n  \t\topener.document.all.isChange.value=\"1\";\t\r\n  \t}\r\n");
      out.write("\r\n  \tif(\".doc\"==(\"");
      out.print(mFileType);
      out.write("\")||\".wps\"==(\"");
      out.print(mFileType);
      out.write("\")){\r\n    //webform.WebOffice.WebSetMsgByName(\"MyDefine1\",\"自定义变量值1\");  //设置变量MyDefine1=\"自定义变量值1\"，变量可以设置多个  在WebSave()时，一起提交到OfficeServer中\r\n\r\n      \r\n  \t\r\n  \tWebOffice.WebSetMsgByName(\"isDoc\",\"false\");//是否保存为DOC文件-\r\n  \tWebOffice.WebSetMsgByName(\"FileType\",\".doc\");\r\n  \tWebOffice.WebSetMsgByName(\"moduleType\",moduleType);\r\n  \t//设置文件最大大小 单位K 不设置默认8M\r\n  \t//webform.WebOffice.MaxFileSize=16*1024; // 设置为16M\r\n  \t\r\n      //保存两次 第一次将文件保存到数据库，如果保存成功在保存到服务器磁盘一份\r\n  \tif (!WebOffice.WebSave()){    //交互OfficeServer的OPTION=\"SAVEFILE\"\t\r\n  \t\t//保存不成功\t\r\n  \t\t StatusMsg(WebOffice.Status);\r\n  \t     alert(WebOffice.Status);\r\n  \t\t return false;\r\n  \t  }else{\r\n  \t\t //保存成功\r\n  \t\t /*if (webform.WebOffice.FileType==\".doc\"||webform.WebOffice.FileType==\".doc\"){\r\n  \t\t \t//交互OfficeServer的OPTION=\"SAVPAGE\"   生成全文批注PGF格式文档，存放服务器目录Document中，文件名RecordID+.pgf 如：3937725762429.pgf\r\n  \t\t    webform.WebOffice.WebSavePage();\r\n  \t\t }*/\r\n  \t\t //alert(moduleType);\r\n\r\n  \t    //在服务器生成doc文件\t   \r\n  \t\t if(isSaveDocFile=='1'){\r\n  \t\t\t \r\n  \t\t\t//传递模块类型\r\n  \t\t\t WebOffice.WebSetMsgByName(\"moduleType\",moduleType);//知识管理:information 公文管理:govdocument\r\n");
      out.write("  \t\t\t //在服务器上生成word文件\r\n  \t\t\t //服务器上的文件都保存痕迹 不接受修订\r\n  \t\t\t //webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions();//接收修订\r\n  \t\t\t \r\n  \t\t\t if(moduleType=='govdocument'){\r\n  \t\t\t\t//webform.WebOffice.WebSetProtect(true,\"\");  //\"\"表示密码为空-\r\n  \t\t\t }\r\n  \t\t\t ");
if (isReTem.equals("1")) {
      out.write("//重新加 模班   套红头时使用\r\n  \t\t\t \tWebOffice.WebSetMsgByName(\"isReTemplate\",\"1\");\r\n  \t\t\t ");
}
      out.write("\r\n  \t\t\t WebOffice.WebSetMsgByName(\"isDoc\",\"true\");//是否保存为DOC文件-\r\n  \t\t\t //webform.WebOffice.WebSetMsgByName(\"docSavePath\",\"//upload//govdocumentmanager\");//doc文件保存路径\r\n  \t\t\t // WebOffice.WebSave(true);\r\n  \t\t\t StatusMsg(WebOffice.Status);\r\n  \t\t\t \r\n  \t\t\t if(moduleType==\"govdocument\"){\r\n  \t\t\t\t var mFileNamess=\"");
      out.print(mFileName.replace(".", "_wh."));
      out.write("\";\r\n  \t\t\t\t  WebOffice.WebSetMsgByName(\"mFileName\",mFileNamess);\r\n  \t\t\t\t  WebOffice.WebSetMsgByName(\"moduleType\",moduleType);\r\n  \t\t\t\t  try{\r\n  \t\t\t\t\t  //2016-12-22 最新版本的金格控件下面一行代码执行导致套红内容不保存\t\t\t\t  \r\n  \t\t\t\t\t  WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions(); \r\n  \t\t\t\t  }catch(ex){\r\n  \t\t\t\t\t  \r\n  \t\t\t\t  }\r\n  \t\t\t\t  WebOffice.WebSetMsgByName(\"moduleType\",moduleType);\r\n  \t\t\t\t  //WebOffice.WebSetProtect(true,\"\"); \r\n  \t\t          //WebOffice.WebUpdateFile();\r\n  \t\t\t }\r\n  \t\t\t //WebOffice.WebSetProtect(false,\"\");  //\"\"表示密码为空,把文档设置为解锁\t\t\t\r\n  \t\t }\r\n  \t\t //恢复修改状态\r\n  \t\t WebOffice.WebObject.Saved = true;\r\n  \t\t return true;\r\n  \t  }\r\n  \t}else if(\".xls\"==(\"");
      out.print(mFileType);
      out.write("\")||\".et\"==(\"");
      out.print(mFileType);
      out.write("\")){\r\n          WebOffice.WebSetMsgByName(\"isDoc\",\"false\");//是否保存为DOC文件\r\n          if (!WebOffice.WebSave()){    //交互OfficeServer的OPTION=\"SAVEFILE\"\r\n              StatusMsg(WebOffice.Status);\r\n              return false;\r\n          }else{\r\n              if(isSaveDocFile=='1'){\r\n\t\t\t//传递模块类型\r\n\t\t\t WebOffice.WebSetMsgByName(\"moduleType\",moduleType);//知识管理:information 公文管理:govdocument\r\n\t\t\t //在服务器上生成word文件\r\n\t\t\t //webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions();//\r\n\t\t\t// webform.WebOffice.WebSetProtect(true,\"\");  //\"\"表示密码为空\r\n\t\t\t WebOffice.WebSetMsgByName(\"isDoc\",\"true\");//是否保存为DOC文件-\r\n\t\t\t //webform.WebOffice.WebSetMsgByName(\"docSavePath\",\"//upload//govdocumentmanager\");//doc文件保存路径\r\n\t\t\t WebOffice.WebSave(true);\r\n\t\t\t StatusMsg(WebOffice.Status);\r\n\t\t }\r\n\r\n\t\t //生成html\r\n\t\t if(isSaveHtml=='1'){\r\n\t\t\tWebOffice.WebSaveAsHtml(); \t//交互OfficeServer的OPTION=\"SAVEASHTML\" \r\n\t\t }\r\n\r\n               return true;\r\n          }\r\n\t\t}\r\n  }\r\n  \r\n  function onlySaveDoc(){\r\n\t\tSaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');\r\n\t\tdocument.all.FlagCloseWindow.value=\"0\";\r\n\t\tdocument.getElementById(\"iWebOfficeForm\").submit();\r\n\t\talert(\"保存成功！\");\r\n\t\tLoad();\r\n\t\t\r\n}\r\nfunction saveAndCloseWin(){\r\n\t\tSaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');\r\n\t\tdocument.all.FlagCloseWindow.value=\"1\";\r\n\t\tdocument.getElementById(\"iWebOfficeForm\").submit();\r\n\t\talert(\"保存成功！\");\r\n}\r\n\r\n </script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
