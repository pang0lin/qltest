/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 10:03:58 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.oacollect.template;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class eform_005fpage_005fbatchAdd_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(1);
    _jspx_dependants.put("/oacollect/template/showform_batchAdd.jsp", Long.valueOf(1499751428000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = null;
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n<html>\r\n<head>\r\n<title>表单</title>\r\n<script language=\"javascript\" src=\"/jsoa/js/js.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/js/openEndow.js\"></script>\r\n<link href=\"/jsoa/skin/");
      out.print(session.getAttribute("skin"));
      out.write("/style-");
      out.print(session.getAttribute("browserVersion"));
      out.write(".css\" rel=\"stylesheet\" type=\"text/css\">\r\n<script language=javascript src=\"/jsoa/eform/datetime/datetime_check.js\"></script>\r\n<script language=javascript src=\"/jsoa/eform/datetime/datetime_select.js\"></script>\r\n<script  src=\"/jsoa/js/checkText.js\"  language=\"javascript\" ></script>\r\n<script  src=\"/jsoa/js/checkForm.js\"  language=\"javascript\" ></script>\r\n");

String fromFlag=null==request.getParameter("fromFlag")?(null==request.getAttribute("fromFlag")?"":request.getAttribute("fromFlag").toString()):request.getParameter("fromFlag");
request.setAttribute("fromFlag",fromFlag);
String fromTabFlag=null==request.getParameter("fromTabFlag")?(null==request.getAttribute("fromTabFlag")?"":request.getAttribute("fromTabFlag").toString()):request.getParameter("fromTabFlag");
request.setAttribute("fromTabFlag",fromTabFlag);

      out.write("\r\n</head>\r\n");


if(request.getParameter("close") != null  ){

      out.write("\r\n<script language=\"javascript\">\r\n\t\r\n\tvar f=\"");
      out.print(fromTabFlag);
      out.write("\";\r\n\tif(f==\"collectList\"){\r\n\t\twindow.close();\r\n\t\topener.location.href=((window.location.href).substring(0,(window.location.href).indexOf(\"/jsoa\")))+\"/jsoa/collectDealwithAction.do?action=getPage&fromFlag=");
      out.print(fromFlag);
      out.write("&fromTabFlag=");
      out.print(fromTabFlag);
      out.write("&collectId=");
      out.print(request.getParameter("collectId"));
      out.write("&pager.offset=");
      out.print(request.getParameter("pager.offset"));
      out.write("\";\r\n\t}else{\r\n\t\twindow.close();\r\n\t\topener.location.reload();   \r\n\t}\r\n   \r\n</script>\r\n");

}else{
String flagg = request.getParameter("flag");
if(request.getParameter("stat")!=null && request.getParameter("stat").equals("1")){

      out.write("\r\n<script language=\"javascript\">\r\n\t//alert(\"数据保存成功！\");\r\n</script>\r\n");
}if(request.getParameter("stat")!=null && request.getParameter("stat").equals("0")){

      out.write("\r\n<script language=\"javascript\">\r\n\talert(\"唯一字段值重复！\");\r\n</script>\r\n");
}
      out.write("\r\n<body   class=\"MainFrameBox Pupwin\" onload=\"init();resizeWin(800,600);\" >\r\n<form name=\"form1\" action=\"/jsoa/collectSkipAction.do?action=save&fromFlag=");
      out.print(fromFlag);
      out.write("&fromTabFlag=");
      out.print(fromTabFlag);
      out.write("&addFlag=batchAdd\" method=\"POST\">\r\n<table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanel\">\r\n\t<input type=hidden name=\"collectId\" id=\"collectId\" value=\"");
      out.print(request.getParameter("collectId"));
      out.write("\">\r\n\t<input type=hidden name=\"pager.offset\" id=\"pager.offset\" value=\"");
      out.print(request.getParameter("pager.offset"));
      out.write("\">\r\n\t<input type=hidden name=\"tableId id=\"tableId\" value=\"");
      out.print(request.getParameter("formId"));
      out.write("\">\r\n\t<input type=hidden name=\"formId\" id=\"formId\" value=\"");
      out.print(request.getParameter("formId"));
      out.write("\">\r\n\t<input type=\"hidden\" id=\"fromFlagFlow\" name=\"fromFlagFlow\" value=\"");
      out.print(request.getAttribute("fromFlagFlow"));
      out.write("\"/>\r\n\t<input type=\"hidden\" id=\"wfWorkId\" name=\"wfWorkId\" value=\"");
      out.print(request.getAttribute("wfWorkId"));
      out.write("\"/>\r\n\t<tr><td>\r\n\t\t ");

			String flag="none";
			String pageId =request.getParameter("formId");//自定义表单ID
			if(request.getParameter("recordId")==null || request.getParameter("recordId").toUpperCase().equals("NULL") 
					|| request.getParameter("recordId").equals("")){
				out.print("<input type=hidden name=operate id=operate value=add>");
				 flag="";

			String code = new com.js.oa.eform.service.CustomFormBD().getCode(pageId);
            if(code==null || code.toUpperCase().equals("NULL") || code.trim().length()<1){
                    String[][] realTable = new com.js.oa.eform.service.CustomFormBD().getTableIDAndName(pageId);
                    out.print( new com.js.oa.jsflow.util.ParseWorkFlowForm().parseForm((realTable==null || realTable.length<1)?"-1":realTable[0][0], request, new java.util.ArrayList()));
                }
			}else{
				out.print("<input type=hidden name=operate id=operate value=modify>");
				out.print("<input type=hidden name=recordId id=recordId value="+request.getParameter("recordId")+">");
				request.setAttribute("infoId",request.getParameter("recordId"));
				
                String code = new com.js.oa.eform.service.CustomFormBD().getCode(pageId);
                if(code==null || code.toUpperCase().equals("NULL") || code.trim().length()<1){
                    String[][] realTable = new com.js.oa.eform.service.CustomFormBD().getTableIDAndName(pageId);
                    out.print( new com.js.oa.jsflow.util.ParseFormWithValue().parseForm((realTable==null || realTable.length<1)?"-1":realTable[0][0], request.getParameter("recordId"), "", true, session.getAttribute("fileServer").toString(), request,pageId));
                }
                
			}
         
      out.write("\r\n\t\t ");
      out.write('\r');
      out.write('\n');

request.setCharacterEncoding("GBK");
com.js.oa.eform.service.CustomFormBD cst = new com.js.oa.eform.service.CustomFormBD();
com.js.oa.userdb.service.CustomDatabaseBD userDB=new com.js.oa.userdb.service.CustomDatabaseBD();
String scriptappend = "";
String domainId = session.getAttribute("domainId")==null?"0":session.getAttribute("domainId").toString();
String parent_fromDraft="draftForm".equals(request.getParameter("action"))?"1":"0";
if("1".equals(request.getParameter("resubmit"))){
	parent_fromDraft="1";
}
String hideTableHTML = "";
String showTableHTML = "";
java.util.List boxFieldList=userDB.getOnchangeMethodInfo(pageId,domainId);

//读取隐藏字段（不可编辑字段）
String hide_Field =request.getAttribute("hideField")==null?"":request.getAttribute("hideField").toString();

      out.write("\r\n\r\n<style type=\"text/css\">\r\n    .flowInput{\r\n    \tbehavior:url(/jsoa/js/validate.htc);\r\n  \t\t/*border:1px solid #E8E8E8;*/\r\n    }\r\n    .flowInputRed{\r\n    \tbehavior:url(/jsoa/js/formvalidate.htc);\r\n  \t\t/*border:1px solid #E8E8E8;*/\r\n    }\r\n\r\n    .flowInputenter{\r\n  \t\tborder:1px solid blue;\r\n    }\r\n\t.mustwrite{\r\n  \t\tborder:1px solid red;\r\n    }\r\n\t.divnowrap\r\n\t{\r\n      meizz:expression(this.noWrap=true);\r\n\t}\r\n</style>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/jsoa/eform/ext/resources/css/ext-all-jiusi.css\"/>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/adapter/ext/ext-base.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/ext-all.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/js/ajax.js\"></script>\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\n  var currentRow = null;\r\n  var tblTR = new Array();\r\n  var tblTRHTML = new Array();\r\n  ");

  //取设置了检索的字段信息
  
  //取设置了提取数据的字段信息
  
      out.write("\r\n  \r\n  Ext.onReady(function(){\r\n\t//Ext.QuickTips.init();\r\n\t");

	String[] fieldObj;
	String hide_field_readonly=","+hide_Field+",";
	for(int fi=0;fi<boxFieldList.size();fi++){
		fieldObj=(String[])boxFieldList.get(fi);
		if("1".equals(fieldObj[2])){
			//需要输入检索
			if (hide_field_readonly.indexOf(","+fieldObj[0]+",") >= 0 || hide_field_readonly.indexOf(fieldObj[1]) >= 0) {
				//如果是只读字段则不使用输入样式
				continue;
			}else{
			
	
      out.write("\r\n\ttry{\r\n\t\tvar cb");
      out.print(fi);
      out.write(" = new Ext.form.ComboBox({\r\n\t\t\ttypeAhead: true,\r\n\t\t\ttriggerAction: 'all',\r\n\t\t\ttransform:'");
      out.print(fieldObj[1]);
      out.write("',\r\n\t\t\twidth:'200',\r\n\t\t\tforceSelection:true,\r\n\t\t\t//listClass:'inputText',\r\n\t\t\tminListWidth:205+2+2,\t\t\t\r\n\t\t\tlisteners:{\r\n\t        \tselect:{\r\n\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t");
if(!"0".equals(fieldObj[3])){
      out.write("\r\n\t\t\t\t\t\t\t");
      out.print(fieldObj[1]);
      out.write("_onchange(combo);\r\n\t\t\t\t\t\t");
}
      out.write("\r\n\t\t\t\t\t}\r\n\t        \t}\r\n\t\t\t}\r\n\t    });\r\n\t\tcb");
      out.print(fi);
      out.write(".el.setStyle({\r\n\t\t\twidth:'252px',\r\n\t\t\ttop:'0.1px'\r\n\t\t});\r\n\t}catch(ee){\r\n\t}\r\n\t\r\n\t");
    }
	   }
	}
      out.write("\r\n});\r\n\r\n//构造字段onchange事件\r\n");

for(int fi=0;fi<boxFieldList.size();fi++){
	fieldObj=(String[])boxFieldList.get(fi);
	if(!"0".equals(fieldObj[3])){
		//onchange fangfa

      out.write("\r\nfunction ");
      out.print(fieldObj[1]);
      out.write("_onchange(obj){\r\n    var curIndex=0;\r\n    var curObj=document.getElementsByName(obj.name);\r\n    for(var i=0;i<curObj.length;i++){\r\n    \tif(curObj[i]==obj){\r\n    \t\tcurIndex=i;\r\n    \t}\r\n    }\r\n    \r\n\t");

	if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		
      out.write("\r\n\t\t//提取数据\r\n\t\tvar selValue=obj.value;\r\n\t\tvar submitPersonObj=document.getElementsByName(\"submitPersonId\");\r\n\t\tvar submitPersonId=\"\";\r\n\t\tif(submitPersonObj.length>0){\r\n\t\t\tsubmitPersonId=submitPersonObj[0].value;\r\n\t\t}\r\n\t\tJSRequest.sendPOST(((window.location.href).substring(0,(window.location.href).indexOf(\"/jsoa\")))+\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&submitPersonId=\"+submitPersonId+\"&selValue=\"+selValue,\"\",showFormSubData);\r\n\t\t");

	}
	if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		out.print(fieldObj[5]);
	}
	
      out.write("\r\n}\r\n");
  }
	//输入检索的回车触发事件
	if("450".equals(fieldObj[7])){
		
      out.write("\r\nfunction ");
      out.print(fieldObj[1]);
      out.write("_enter(obj){\r\n    \t\r\n\tvar curIndex=0;\r\n    var curObj=document.getElementsByName(obj.name);\r\n    for(var i=0;i<curObj.length;i++){\r\n    \tif(curObj[i]==obj){\r\n    \t\tcurIndex=i;\r\n    \t}\r\n    }\r\n    var inputValueObj=document.getElementsByName(\"");
      out.print(fieldObj[1]);
      out.write("_temp\");\r\n    \r\n\tvar inputValue=inputValueObj[curIndex].value;\t\r\n\t\r\n\tvar submitPersonObj=document.getElementsByName(\"submitPersonId\");\r\n\tvar submitPersonId=\"\";\r\n\tif(submitPersonObj.length>0){\r\n\t\tsubmitPersonId=submitPersonObj[0].value;\r\n\t}\r\n\t\r\n\tJSMainWinOpen2(\"/jsoa/FormDataFilterAction.do?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&fieldName=");
      out.print(fieldObj[1]);
      out.write("&submitPersonId=\"+submitPersonId+\"&inputValue=\"+inputValue,\"\",\"\");\r\n}\r\n\t\t");

	}
}
      out.write("\r\n\r\ndocument.onkeydown=listenKeyDown;\r\n\r\nfunction listenKeyDown(){\r\n\tvar event = arguments[0] ||window.event;\r\n\tif(event.keyCode==13){\r\n\t\t//按下了enter\r\n\t\ttry{\r\n\t\t    var obj=event.srcElement;\r\n\t\t\tvar objname=event.srcElement.name;\t\r\n\t\t\t\r\n\t\t\tvar curIndex=0;\r\n\t\t    var curObj=document.getElementsByName(objname);\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n    \r\n\t\t\tobjname=objname.substring(0,objname.length-5);\r\n\t\t\tobjname=objname+\"_btn\";\t\t\t\r\n\t\t\t\r\n\t\t\tobj=document.getElementsByName(objname);\r\n\t\t\tobj[curIndex].click();\r\n\t\t\t\r\n\t\t\t//eval(objname+\"_enter(\"+document.getElementsByName(objname)[0]+\")\");\r\n\t\t}catch(e){\r\n\t\t\t//alert(e);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction showFormSubData(response){\r\n\t//将取回的数据显示在正确的表单中\r\n\t//alert(response.responseText);\r\n    //alert(response.responseXML.documentElement);\r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n    \t\r\n    \t//如是字表多行时需确定本行的位置\r\n");
      out.write("    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n    \t    \t\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,content,fieldTagName;\r\n    \tvar subdatas,datavalue,datatext;\r\n    \tvar oprObj;\r\n    \tfor(var i=0;i<datas.length;i++){\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n    \t\t\r\n    \t\t//alert(formfield);\r\n    \t\t//alert(fetchdata);    \t\t\r\n    \t\t\r\n    \t\t\r\n    \t\tif(fetchdata==\"0\"){\r\n    \t\t    oprObj=document.getElementsByName(formfield)[curIndex]; \r\n    \t\t    oprObj.value=\"\";     \t\t   \r\n    \t\t    if(datas[i].getElementsByTagName(\"content\")[0].firstChild!=null){    \t\t       \t\t    \r\n    \t\t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n    \t\t\t\toprObj.value=content;\r\n    \t\t\t}    \t\t\t    \t\t\t     \t\t\t\t\t\r\n    \t\t\t\r\n    \t\t}else if(fetchdata==\"2\"){\r\n    \t\t\tsubdatas=datas[i].getElementsByTagName(\"content\")[0].getElementsByTagName(\"subdata\");\r\n");
      out.write("    \t\t\t//下拉列表形式    \t\t\t\r\n    \t\t\t//oprObj=eval(\"document.all.\"+formfield);\r\n    \t\t\toprObj=document.getElementsByName(formfield)[curIndex];    \t\t\t\r\n    \t\t\t\r\n    \t\t\tfieldTagName=oprObj.tagName;    \t\t\t\r\n    \t\t\tif(fieldTagName==\"INPUT\" || fieldTagName==\"TEXTAREA\"){\r\n    \t\t\t\t//普通输入 \r\n    \t\t\t\toprObj.value=\"\";   \r\n    \t\t\t\tif(subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild!=null){\t\t\t\t\r\n\t    \t\t\t\tdatavalue=subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue; \r\n\t    \t\t\t\toprObj.value=datavalue;\r\n    \t\t\t\t}\r\n    \t\t\t}else if(fieldTagName==\"SELECT\"){\r\n    \t\t\t\t//删除原来的option    \t\t\t\t\r\n    \t\t\t\tjs_deleteAllOptions(oprObj);    \t\t\t\t\r\n    \t\t\t\t//新增option\r\n    \t\t\t\tfor(var j=0;j<subdatas.length;j++){\r\n    \t\t\t\t    try{\r\n\t    \t\t\t\t\tdatavalue=subdatas[j].getElementsByTagName(\"datavalue\")[0].firstChild.nodeValue;\r\n\t    \t\t\t\t\tdatatext=subdatas[j].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue;\r\n\t    \t\t\t\t\tjs_addOption(oprObj,datavalue,datatext);\r\n    \t\t\t\t\t}catch(e){\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n    \t\t\t\toprObj.onchange();    \t\t\t\t\r\n");
      out.write("    \t\t\t}\r\n    \t\t}\r\n    \t\t\r\n    \t}\r\n    }\r\n}\r\n\r\nfunction js_deleteAllOptions(obj){\r\n\twhile(length!=0){ \r\n　　 \tvar length=obj.options.length;\r\n　　 \tfor(var i=0;i<length;i++)\r\n　　 \t\tobj.options.remove(i);\r\n　　 \tlength=length/2;\r\n　　 }\r\n}\r\nfunction js_addOption(obj,optionValue,optionText){\r\n\tvar newOption=new Option(optionText,optionValue); \r\n\tobj.options[obj.length]=newOption; \r\n} \r\n\r\n//-->\r\n</SCRIPT>\r\n<script language=javascript src=\"/jsoa/eform/js/form.js\"></script>\r\n<input type=\"hidden\" name=\"user_Id\" id=\"user_Id\" value=\"");
      out.print(session.getAttribute("userId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Name\" id=\"user_Name\" value=\"");
      out.print(session.getAttribute("userName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Account\" id=\"user_Account\" value=\"");
      out.print(session.getAttribute("userAccount"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_Name\" id=\"org_Name\" value=\"");
      out.print(session.getAttribute("orgName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_ID\" id=\"org_ID\" value=\"");
      out.print(session.getAttribute("orgId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"group_ID\" id=\"group_ID\" value=\"");
      out.print(session.getAttribute("groupId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Hide_Field\" id=\"Hide_Field\" value=\"");
      out.print(request.getAttribute("hideField"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Page_Id\" id=\"Page_Id\" value=\"");
      out.print(pageId);
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Info_Id\" id=\"Info_Id\" value=\"");
      out.print(request.getAttribute("infoId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"work_Status\" id=\"work_Status\" value=\"");
      out.print(request.getParameter("workStatus"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"parent_fromDraft\" id=\"parent_fromDraft\" value=\"");
      out.print(parent_fromDraft);
      out.write("\">\r\n<input type=\"hidden\" name=\"totalValueSet\" id=\"totalValueSet\" value=\"\" />\r\n<!-- 取 -->\r\n");
      out.print(cst.getComputeFieldHTML(pageId));
      out.write("\r\n<div id=\"formHTML\">\r\n<!-- 读取表单设计模板 -->\r\n");
      out.print(cst.getCodeByBatChAdd(pageId));
      out.write("\r\n</div>\r\n\r\n\r\n<script language=\"javascript\">\r\n");

String allCoumputFieldStr=cst.getMainAndForeignComputeFields(pageId);
String tableName=cst.getTable(pageId);
  //判断当前表单是否新增
	if(request.getAttribute("infoId")==null || request.getAttribute("infoId").toString().toUpperCase().equals("NULL") || request.getAttribute("infoId").toString().trim().length()<1){
		//初始化显示界面(新增)
		//System.out.println("新增表单.........................................................");
		
		// 如果是发起子流程则如果子流程中的表单与主表单相同则将数据继承
		String pareFormId=request.getParameter("pareTableId");
		boolean isNewForm=true;
		if(pareFormId!=null || !"null".equals(pareFormId) || !"".equals(pareFormId)){
		  //取得父表单ID则比较父表单ID是否与当前表单ID相同，如果相同的话，则继承主表单数据
		  isNewForm=cst.isNewForm(pareFormId,pageId);
		}
		
		if(isNewForm){
		   //新表单
		
			//out.println("新增空白表单.........................................................");
		    //取得表单关联的所有字段信息的数据(主表)
			String[][] fieldArr =cst.getPageField(pageId);
			if(fieldArr!=null){
	            //遍历所有字段，获得字段的页面显示脚本
				for(int i=0;i<fieldArr.length;i++){
				//System.out.println("a:"+fieldArr[i][0]+"         b:"+fieldArr[i][1]);
					if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
						out.print(cst.getHTMLBatchAdd(fieldArr[i][0],hide_Field,domainId,fieldArr[i][1],request,allCoumputFieldStr));
					}
				}
 			//将表设置为增加行、删除行图标所在的焦点
 			 
              scriptappend = "currentRow = document.getElementsByName('"+tableName+"TR')[document.getElementsByName('"+tableName+"TR').length-1];setAbsolute(currentRow);";
              String agent= request.getHeader("USER-AGENT");   
              if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
                out.print("document.getElementById('"+tableName+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
              }else{
                out.print("document.getElementById('"+tableName+"DIV').childNodes[1].onclick=setDelRowsValue;");
              }
			}
     }
    
	}

      out.write("\r\n\r\n//alert(WorkFlowFormActionForm.computeField.value);\r\n</script>\r\n\r\n");

	//子表的计算字段设置
  //out.print(cst.getForeignComputeFieldHTML(pageId));
  //out.print(hideTableHTML+showTableHTML);  

      out.write("\r\n\r\n<script language=javascript src=\"/jsoa/eform/datetime/time.js\"></script>\r\n<script language=\"javascript\">\r\n\r\nif(document.all.wf_ua){\r\n    if(document.all.wf_ua.length){\r\n    }else{\r\n        eval(\"document.all.\" + document.all.wf_ua.value + \".value='");
      out.print(session.getAttribute("userAccount"));
      out.write("'\");\r\n    }\r\n}\r\n</script>\r\n\r\n<DIV id=adddelrow_div style=\"BORDER: #0a246a 1px solid; VISIBILITY: hidden; z-index:1000; WIDTH: 30px; POSITION: absolute\">\r\n<TABLE height=\"100%\" cellSpacing=0 cellPadding=0 width=\"100%\" border=0>\r\n  <TBODY>\r\n  <TR>\r\n    <TD onmouseover=\"this.style.borderRiht='1px #0A246A solid'\"\r\n    onmouseout=\"this.style.borderRiht=''\" align=middle><SPAN id=delrow_div\r\n      title=点击删除记录 style=\"CURSOR: pointer\"><IMG height=12\r\n      src=\"/jsoa/eform/images/delarrow.gif\" width=12 onclick='delRow()' align=absMiddle></SPAN> </TD>\r\n    <TD onmouseover=\"this.style.borderLeft='1px #0A246A solid'\"\r\n    onmouseout=\"this.style.borderLeft=''\" align=middle><SPAN id=addrow_div\r\n      title=点击添加记录 style=\"CURSOR: pointer\"><IMG height=12\r\n      src=\"/jsoa/eform/images/addarrow.gif\" width=12 onclick='addRow()' align=absMiddle></SPAN>\r\n  </TD></TR></TBODY></TABLE></DIV>\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\n//document.body.attachEvent(\"onload\",function(){});\r\n//alert(document.body.readyState);\r\nsetNoWrap();\r\ninitRow();\r\n");
      out.write("//-->\r\n</SCRIPT>\r\n<script >\r\n\t");
//=scriptappend
      out.write("\r\n        ");
/*
        	if(scriptappend.length()>0){
                	out.print("document.body.attachEvent('onload',function(){setAbsolute(currentRow);});");
                }*/
        
      out.write("\r\n        //alert(document.body.onload);\r\n\r\n</script>\r\n<!-- <script src=\"/jsoa/js/util.js\"></script>-->");
      out.write("\r\n\t</td></tr>\r\n\t<tr><td>\r\n            ");
 if (flagg == null || flagg.equals("0")) {
      out.write("\r\n\t\t<input type=\"button\" class=\"btnButton4font\" onclick=\"javascript:if(customFormBeforeSubmit()){document.all.form1.submit();}\" value=\"保存退出\" />\r\n\t\t<input type=\"button\" class=\"btnButton4font\" onclick=\"javascript:save();\" style=\"display:'");
      out.print(flag);
      out.write("'\" value=\"保存继续\" />\r\n\t\t<input type=\"button\" class=\"btnButton2font\" onclick=\"javascript:window.location.reload();\" value=\"重置\" />\r\n\t\t<input type=\"button\" class=\"btnButton2font\" onclick=\"javascript:window.close()\" value=\"退出\" />\r\n            ");
}
      out.write("\r\n\t</td></tr>\r\n</table>\r\n</form>\r\n</body>\r\n");
String[] js={"",""};
js=new com.js.oa.eform.service.CustomFormBD().getJSCode(pageId); 
      out.write("\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\nfunction init(){\r\n");
      out.print(js[0] );
      out.write("\r\n}\r\nfunction save(){\r\n\tif(customFormBeforeSubmit()){\r\n\t\tdocument.all.operate.value=\"continue\";\r\n\t\tdocument.all.form1.submit();\r\n\t}\r\n}\r\nfunction checkNum(obj){\r\n    if(isNaN(obj.value)){\r\n        alert(\"请输入数字！\");\r\n        obj.select();\r\n        obj.focus();\r\n    }\r\n}\r\n\r\nfunction textIsEmpty(objText){\r\n\tvar value = objText.value;\r\n\tif(value.length == 0){\r\n        \treturn true;\r\n    }else{\r\n\t\tvar j = 0;\r\n\t\tfor(var i = 0;i <value.length;i ++){\r\n\t\t\tif(value.substring(i,i+1) == ' '){\r\n\t\t\t\tj ++;\r\n\t\t\t}else{\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(j == value.length){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nfunction customFormBeforeSubmit(){\r\n\t\tsetHtmlValue();\r\n    var canSubmit = true;\r\n    if(document.all.mustWrite){\r\n        //如果页面有必填项\r\n        if(document.all.mustWrite.length){\r\n            //如果页面不止一个必填项\r\n            for(var i =0; i < document.all.mustWrite.length; i ++){\r\n                var objs = eval(\"document.all.\" + document.all.mustWrite[i].value);\r\n                for(var x=0;x<objs.length;x++){\r\n");
      out.write("                \tobj = objs[x];\r\n\t                if(obj){\r\n\t                    var objType = \"\";\r\n\t                    if(obj.type){\r\n\t                       objType = obj.type.toUpperCase();\r\n\t                    }else{\r\n\t                        if(obj.length){\r\n\t\t\t\t\t\t\tfor(var k=0;k<obj.length;k++){\r\n\t\t\t\t\t\t\t\t//i++;\r\n\t\t\t\t\t\t\t\tobjType = obj[k].type.toUpperCase();\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar objTemp = obj[k];\r\n\t\t\t\t\t\t\t\tif(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t   \r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HIDDEN\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"CHECKBOX\" || objType==\"RADIO\"){\r\n\t\t\t\t\t\t\t\t    \r\n\t\t\t\t\t\t\t\t    //checkbox 为一组,验证obj 而不是objtemp\r\n\t\t\t\t\t\t\t\t\tif(!checkboxIsChecked(obj)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HTML\"){\r\n\t\t\t\t\t\t\t\t\tif(eval(objTemp.id + \".getHTML()\")==\"\"){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n                        }else{\r\n                            objType = \"HTML\";\r\n                        }\r\n\t                    }\r\n\t                    if(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" ){\r\n\t                        if(textIsEmpty(obj)){\r\n\t                            alert(\"请填写必填项！\");\r\n");
      out.write("\t                            obj.focus();\r\n\t                            canSubmit = false;\r\n\t                            break;\r\n\t                        }\r\n\t                    }else if(objType == \"HIDDEN\"){\r\n\t                        if(textIsEmpty(obj)){\r\n\t                            alert(\"请填写必填项！\");\r\n\t                            //obj.focus();\r\n\t                            canSubmit = false;\r\n\t                            break;\r\n\t                        }\r\n\t                    }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n\t                        if(obj.html.length == 0){\r\n\t                            alert(\"请填写必填项！\");\r\n\t                            obj.focus();\r\n\t                            canSubmit = false;\r\n\t                            break;\r\n\t                        }\r\n\t                    }else if(objType == \"CHECKBOX\" || objType == \"RADIO\"){\r\n\t\t\t\t\t\t\t//alert(objType);\r\n\t                        if(!checkboxIsChecked(obj)){\r\n\t                            alert(\"请填写必填项！\");\r\n\t                            //obj.focus();\r\n");
      out.write("\t                            canSubmit = false;\r\n\t                            break;\r\n\t                        }\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//alert(objType+\" 111\");\r\n\t                    }else if(objType == \"HTML\"){\r\n\t                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n\t                            alert(\"请填写必填项！\");\r\n\t                            canSubmit = false;\r\n\t                        }\r\n\t                    }\r\n\t                }\r\n\t                if(document.all.fieldName && document.all.fieldName.length){\r\n\t                    for(var j = 0; j < document.all.fieldName.length; j ++){\r\n\t                        if(document.all.fieldName[j].value == document.all.mustWrite[i].value + \"_file\"){\r\n\t                            if(!eval(\"document.all.\" + document.all.mustWrite[i].value + \"_fileName\")){\r\n\t                                alert(\"请填写必填项！\");\r\n\t                                canSubmit = false;\r\n\t                                break;\r\n\t                            }\r\n\t                        }\r\n\t                    }\r\n");
      out.write("\t                    if(!canSubmit){\r\n\t                    \tbreak;\r\n\t                    }\r\n\t                }\r\n\t                obj = eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\");\r\n\t                if(obj){\r\n\t                   if(eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\").value==\"\"){\r\n\t                        alert(\"请填写必填项！\");\r\n\t                        canSubmit = false;\r\n\t                        break;\r\n\t                    }\r\n\t                }\r\n\t            }\r\n            }\r\n        }else{\r\n            //页面只有一个必填项\r\n            var obj = eval(\"document.all.\" + document.all.mustWrite.value);\r\n            alert(obj);\r\n            if(obj){\r\n                var objType = \"\";\r\n                if(obj.type){\r\n                    objType = obj.type.toUpperCase();\r\n                }else{\r\n                    if(obj.length){\r\n                        objType = obj[0].type.toUpperCase();\r\n                    }else{\r\n                        objType = \"HTML\";\r\n                    }\r\n");
      out.write("                }\r\n                if(objType == \"TEXT\"  || objType == \"PASSWORD\" || objType == \"TEXTAREA\"){\r\n                    if(textIsEmpty(obj)){\r\n                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n                    if(obj.html.length == 0){\r\n                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"HIDDEN\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                        }\r\n                    }else if(objType == \"CHECKBOX\" || objType == \"RADIO\"){\r\n                    if(!checkboxIsChecked(obj)){\r\n                        alert(\"请填写必填项！\");\r\n                        //obj.focus();\r\n                        canSubmit = false;\r\n");
      out.write("                    }\r\n                }else if(objType == \"HTML\"){\r\n                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n\r\n                }\r\n\r\n            }\r\n\t\t\t\r\n            if(document.all.fieldName && document.all.fieldName.length){\r\n                for(var j = 0; j < document.all.fieldName.length; j ++){\r\n                    if(document.all.fieldName[j].value == document.all.mustWrite.value + \"_file\"){\r\n                        if(!eval(\"document.all.\" + document.all.mustWrite.value + \"_fileName\")){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n\t\t\tobj = eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\");\r\n                if(obj){\r\n                   if(eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\").value==\"\"){\r\n                        alert(\"请填写必填项！\");\r\n");
      out.write("                        canSubmit = false;\r\n                    }\r\n                }\r\n        }\r\n    }\r\n\r\n\r\n    try{\r\n\t var reg = /(f\\d+)/g;\r\n    if(document.all.computeField){\r\n        if(document.all.computeField.length){\r\n\t\t\t//alert(document.all.computeField.length);\r\n            for(var i = 0; i < document.all.computeField.length; i ++){\r\n\t\t\t\t//alert(i);\r\n                var computeField = document.all.computeField[i].value;\r\n                var computeFieldValue = document.all.computeFieldValue[i].value;\r\n                var fieldArray = computeFieldValue.match(reg);\r\n                var isNotTime = true;\r\n                if(fieldArray.length == 2){\r\n                    var testValue1 = \"\";\r\n\r\n                    if(eval(\"document.all.\" + fieldArray[0])){\r\n                        testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n                    }else{\r\n                        testValue1 = \"\";\r\n\t\t\t\t\t\t\r\n                    }\r\n\r\n                    var testValue2 = \"\";\r\n                    if(eval(\"document.all.\" + fieldArray[1])){\r\n");
      out.write("                        testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n                    }else{\r\n                        testValue2 = \"\";\r\n\t\t\t\t\t\t\r\n                    }\r\n\t\t\t\t\t//if(i==1) alert(\"third\");\r\n                    if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"-\") > 0 && testValue2.indexOf(\"-\") > 0){\r\n                        isNotTime = false;\r\n                        var date1,date2;\r\n\t\t\t\t\tif(testValue1.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2].split(\" \")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue1 = testValue1.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//alert(testValue1);\r\n\t\t\t\t\tif(testValue2.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2].split(\" \")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n");
      out.write("\t\t\t\t\t\t//testValue2 = testValue2.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n                   // var day =((new Date(testValue1) - new Date(testValue2))) + \"\";\r\n\t\t\t\t   var day = (date1-date2) / 86400000+\"\";\r\n                        if(day.indexOf(\".\") > 0){\r\n                            if((day.length - day.indexOf(\".\")) > 2){\r\n                            \tday = day.substring(0, day.indexOf(\".\") + 3);\r\n                            }\r\n                        }\r\n\t\t\t\t\t\t//alert(\"day\");\r\n                        document.all.computeFieldValue[i].value=day ;\r\n\t\t\t\t\t\t\r\n                    }\r\n                }\r\n                if(isNotTime){\r\n\t\t\t\t\t//alert(isNotTime);\r\n                    for(var j = 0; j < fieldArray.length; j ++){\r\n                        computeFieldValue = computeFieldValue.replace(fieldArray[j],eval(\"document.all.\" + fieldArray[j] + \".value\"));\r\n                    }\r\n                    try{\r\n                    \tdocument.all.computeFieldValue[i].value= eval(computeFieldValue);\r\n");
      out.write("\t\t\t\t\t\t//alert(document.all.computeField[i].value);\r\n\t\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\")){\r\n\t\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\").value = eval(computeFieldValue);\r\n\t\t\t\t\t\t}\r\n                    }catch(e){}\r\n\r\n                }\r\n            }\r\n        }else{\r\n            var computeField = document.all.computeField.value;\r\n            var computeFieldValue = document.all.computeFieldValue.value;\r\n            var fieldArray = computeFieldValue.match(reg);\r\n            var isNotTime = true;\r\n            if(fieldArray.length == 2){\r\n\t\t\t\t//alert(\"111\");\r\n                var testValue1 = \"\";\r\n                if(eval(\"document.all.\" + fieldArray[0])){\r\n                    testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n                }else{\r\n                    testValue1 = \"\";\r\n                }\r\n                var testValue2 = \"\";\r\n                if(eval(\"document.all.\" + fieldArray[1])){\r\n                    testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n");
      out.write("                }else{\r\n                    testValue2 = \"\";\r\n                }\r\n\t\t\t\t//alert(testValue1);\r\n                if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"-\") > 0 && testValue2.indexOf(\"-\") > 0){\r\n                    isNotTime = false;\r\n                    var date1,date2;\r\n\t\t\t\t\tif(testValue1.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2].split(\" \")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue1 = testValue1.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//alert(testValue1);\r\n\t\t\t\t\tif(testValue2.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2].split(\" \")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n");
      out.write("\t\t\t\t\t\t//testValue2 = testValue2.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n                   // var day =((new Date(testValue1) - new Date(testValue2))) + \"\";\r\n\t\t\t\t   var day = (date1-date2) / 86400000+\"\";\r\n                    if(day.indexOf(\".\") > 0){\r\n                        if((day.length - day.indexOf(\".\")) > 2){\r\n                            day = day.substring(0, day.indexOf(\".\") + 3);\r\n                        }\r\n                    }\r\n                    document.all.computeFieldValue.value = day ;\r\n\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\")){\r\n\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField.value+\"_cmp\").value = day;\r\n\t\t\t\t\t}\r\n                }\r\n            }\r\n            if(isNotTime){\r\n\t\t\t\t//alert(eval(\"document.all.\" + fieldArray[0] + \".value\"));\r\n                for(var j = 0; j < fieldArray.length; j ++){\r\n                    computeFieldValue = computeFieldValue.replace(fieldArray[j],eval(\"document.all.\" + fieldArray[j] + \".value\"));\r\n");
      out.write("                }\r\n                try{\r\n\t\t\t\t\t//alert(computeFieldValue);\r\n                    document.all.computeFieldValue.value = eval(computeFieldValue);\r\n\t\t\t\t\t//alert(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\"));\r\n\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\")){\r\n\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField.value+\"_cmp\").value = eval(computeFieldValue);\r\n\t\t\t\t\t}\r\n                }catch(e){}\r\n\r\n            }\r\n        }\r\n    }\r\n    }catch(e){}\r\n\r\n    if(canSubmit){\r\n        setHtmlValue();\r\n    }\r\n    //执行用户定义Javascript代码\r\n    ");
      out.print((js[1]==null || "null".equals(js[1]))?"":js[1]);
      out.write("\r\n    return canSubmit;\r\n\r\n}\r\n\r\nfunction setHtmlValue(){\r\n    if(document.all.hasHtml){\r\n        //页面中包含有HTML编辑器\r\n        if(document.all.hasHtml.length){\r\n            //页面中包含不止一个HTML编辑器\r\n            var len = document.all.hasHtml.length;\r\n            for(var j = 0; j < len; j ++){\r\n            \tvar htmlEditName = document.all.hasHtml[j].value;\r\n            \tvar o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n            \tdocument.getElementById(htmlEditName).value=o_Editor.getHTML();\r\n                //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n            }\r\n        }else{\r\n            //页面上仅有一个HTML编辑器\r\n            var htmlEditName = document.all.hasHtml.value;\r\n            var o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n            document.getElementById(htmlEditName).value=o_Editor.getHTML();\r\n            //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n        }\r\n");
      out.write("    }\r\n}\r\n\r\n\r\nfunction changeText(){\r\n}\r\nfunction clickRadio(obj){\r\n    changeText();\r\n}\r\nfunction clickCheckbox(){\r\n    changeText();\r\n}\r\nfunction changeSelect(){\r\n    changeText();\r\n}\r\nfunction changeTextarea(){\r\n    changeText();\r\n}\r\n\r\n\r\n//   异步取组合编号\r\nvar xmlHttp = false;\r\n\ttry {\r\n\t\txmlHttp = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n\t} catch (e) {\r\n\t\ttry {\r\n\t\t\txmlHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t} catch (e2) {\r\n\t\t\txmlHttp = false;\r\n\t\t}\r\n\t}\r\n\tif (!xmlHttp && typeof XMLHttpRequest != 'undefined') {\r\n\t\txmlHttp = new XMLHttpRequest();\r\n\t}\r\nvar fieldName;\r\n\r\nfunction getAutoCode(obj,field){\r\n\tfieldName = field;\r\n\txmlHttp.open(\"GET\", ((window.location.href).substring(0,(window.location.href).indexOf(\"/jsoa\")))+\"/jsoa/userdb/getAutoCode.jsp?pageId=");
      out.print(request.getParameter("formId"));
      out.write("&field=\"+field+\"&head=\"+obj.value, true);\r\n\txmlHttp.onreadystatechange = updateAutoCode;\r\n\txmlHttp.send(null);\r\n}\r\n\r\nfunction updateAutoCode(){\r\n\tif (xmlHttp.readyState < 4) {\r\n\t\t//document.all.printNum.innerHTML=\"正在加载\";\r\n\t}\r\n\tif (xmlHttp.readyState == 4) {\r\n\t\tvar response = xmlHttp.responseText;\r\n\t\teval(\"document.all.\"+fieldName).value = response;\r\n\t}\r\n}\r\nfunction editOffices(field,fileType,template,showSign){\r\n\t//alert(\"开始打开\");\r\n\tvar recordId = eval(\"document.all.\"+field+\".value\");\r\n\tvar userName = \"");
      out.print(session.getAttribute("userName"));
      out.write("\";\r\n\t\r\n\twindow.open(\"/jsoa/iWebOfficeSign/DocumentEdit.jsp?RecordID=\"+recordId+\"&EditType=1&UserName=\"+userName+\r\n\t\t\t\"&ShowSign=\"+showSign+\"&CanSave=1&moduleType=information&saveHtmlImage=0&saveDocFile=0&field=\"+field+\r\n\t\t\t\"&FileType=.\"+fileType+\"&showEditButton=1&showSignButton=1&Template=\"+template, \r\n\t\t\t\"\", \"status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,Height=400,left=0,top=0\");\r\n}\r\n//  异步取组合编号\r\n//-->\r\n</SCRIPT>\r\n");
}
      out.write("\r\n\r\n</html>\r\n<script src=\"/jsoa/js/util.js\"></script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
