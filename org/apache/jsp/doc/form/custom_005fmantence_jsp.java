/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 10:04:21 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.doc.form;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class custom_005fmantence_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(1);
    _jspx_dependants.put("/doc/form/showform.jsp", Long.valueOf(1499751404000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = null;
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n<html>\r\n<head>\r\n<title></title>\r\n<script language=\"javascript\" src=\"/jsoa/js/js.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/js/openEndow.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/js/checkForm.js\"></script>\r\n<link href=\"/jsoa/skin/");
      out.print(session.getAttribute("skin"));
      out.write("/style-");
      out.print(session.getAttribute("browserVersion"));
      out.write(".css\" rel=\"stylesheet\" type=\"text/css\">\r\n<script language=javascript src=\"/jsoa/custom_form/datetime/datetime_check.js\"></script>\r\n<script language=javascript src=\"/jsoa/custom_form/datetime/datetime_select.js\"></script>\r\n<script  src=\"/jsoa/js/checkText.js\"  language=\"javascript\" ></script>\r\n<script  src=\"/jsoa/js/checkForm.js\"  language=\"javascript\" ></script>\r\n\r\n</head>\r\n");

if(request.getParameter("close") != null  ){

      out.write("\r\n<script language=\"javascript\">\r\n\twindow.close();\r\n   opener.location.href=\"/jsoa/ModuleDealwithAction.do?action=getPage&menuId=");
      out.print(request.getParameter("menuId"));
      out.write("&pager.offset=");
      out.print(request.getParameter("pager.offset"));
      out.write("\";\r\n</script>\r\n");

}else{
String flagg = request.getParameter("flag");
if(request.getParameter("stat")!=null && request.getParameter("stat").equals("1")){

      out.write("\r\n<script language=\"javascript\">\r\n\t//alert(\"数据保存成功！\");\r\n</script>\r\n");
}if(request.getParameter("stat")!=null && request.getParameter("stat").equals("0")){

      out.write("\r\n<script language=\"javascript\">\r\n\talert(\"唯一字段值重复！\");\r\n</script>\r\n");
}
      out.write("\r\n<body   class=\"MainFrameBox Pupwin\" onload=\"resizeWin(800,600);\" >\r\n<table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanel\">\r\n<form name=\"form1\" action=\"/jsoa/eform/submit.jsp\" method=\"POST\">\r\n\t<input type=hidden name=menuId value=\"");
      out.print(request.getParameter("menuId"));
      out.write("\">\r\n\t<input type=hidden name=pager.offset value=\"");
      out.print(request.getParameter("pager.offset"));
      out.write("\">\r\n\t<input type=hidden name=tableId value=\"");
      out.print(request.getParameter("formId"));
      out.write("\">\r\n\t<tr><td>\r\n\t\t ");

			String flag="none";
			String pageId =request.getParameter("formId");//自定义表单ID
			if(request.getParameter("recordId")==null || request.getParameter("recordId").toUpperCase().equals("NULL") || request.getParameter("recordId").equals("")){
				out.print("<input type=hidden name=operate value=add>");
				 flag="";

			String code = new com.js.oa.eform.service.CustomFormBD().getCode(pageId);
                if(code==null || code.toUpperCase().equals("NULL") || code.trim().length()<1){
                    String[][] realTable = new com.js.oa.eform.service.CustomFormBD().getTableIDAndName(pageId);
                    out.print( new com.js.oa.jsflow.util.ParseWorkFlowForm().parseForm((realTable==null || realTable.length<1)?"-1":realTable[0][0], request, new java.util.ArrayList()));
                }
			}else{
				out.print("<input type=hidden name=operate value=modify>");
				out.print("<input type=hidden name=recordId value="+request.getParameter("recordId")+">");
				request.setAttribute("infoId",request.getParameter("recordId"));

                String code = new com.js.oa.eform.service.CustomFormBD().getCode(pageId);
                if(code==null || code.toUpperCase().equals("NULL") || code.trim().length()<1){
                    String[][] realTable = new com.js.oa.eform.service.CustomFormBD().getTableIDAndName(pageId);
                    out.print( new com.js.oa.jsflow.util.ParseFormWithValue().parseForm((realTable==null || realTable.length<1)?"-1":realTable[0][0], request.getParameter("recordId"), "", true, session.getAttribute("fileServer").toString(), request,pageId));
                }

			}
         
      out.write("\r\n\t\t ");

request.setCharacterEncoding("GBK");
com.js.oa.eform.service.CustomFormBD cst = new com.js.oa.eform.service.CustomFormBD();
String scriptappend = "";
String domainId = session.getAttribute("domainId")==null?"0":session.getAttribute("domainId").toString();
String hideTableHTML = "";
String showTableHTML = "";

      out.write("\r\n\r\n<style type=\"text/css\">\r\n    .flowInput{\r\n  \t\tborder:1px solid #E8E8E8;\r\n    }\r\n\r\n    .flowInputenter{\r\n  \t\tborder:1px solid blue;\r\n    }\r\n\t.mustwrite{\r\n  \t\tborder:1px solid red;\r\n    }\r\n\t.divnowrap\r\n\t{\r\n      meizz:expression(this.noWrap=true);\r\n\t}\r\n</style>\r\n\r\n  <SCRIPT LANGUAGE=\"JavaScript\">\r\n  <!--\r\n  var currentRow = null;\r\n  var tblTR = new Array();\r\n  var tblTRHTML = new Array();\r\n  //-->\r\n  </SCRIPT>\r\n  <script language=javascript src=\"/jsoa/custom_form/js/form.js\"></script>\r\n<input type=\"hidden\" name=\"user_Id\" value=\"");
      out.print(session.getAttribute("userId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Name\" value=\"");
      out.print(session.getAttribute("userName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Account\" value=\"");
      out.print(session.getAttribute("userAccount"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_Name\" value=\"");
      out.print(session.getAttribute("orgName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_ID\" value=\"");
      out.print(session.getAttribute("orgId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"group_ID\" value=\"");
      out.print(session.getAttribute("groupId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Hide_Field\" value=\"");
      out.print(request.getAttribute("hideField"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Page_Id\" value=\"");
      out.print(pageId);
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Info_Id\" value=\"");
      out.print(request.getAttribute("infoId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"work_Status\" value=\"");
      out.print(request.getParameter("workStatus"));
      out.write("\"/>\r\n");

//È¡´Ë±íµ¥µÄÎ¨Ò»×Ö¶Î
String onlyField=cst.getOnlyField(pageId);

      out.write("\r\n<input type=\"hidden\" name=\"page_only_field\" value=\"");
      out.print(onlyField);
      out.write("\"/>\r\n");
      out.print(cst.getComputeFieldHTML(pageId));
      out.write("\r\n\r\n<div id=\"formHTML\">\r\n<!-- ¶ÁÈ¡±íµ¥Éè¼ÆÄ£°å -->\r\n");
      out.print(cst.getCode(pageId));
      out.write("\r\n</div>\r\n\r\n\r\n<script language=\"javascript\">\r\n");

	//¶ÁÈ¡Òþ²Ø×Ö¶Î£¨²»¿É±à¼­×Ö¶Î£©
  String hide_Field =request.getAttribute("hideField")==null?"":request.getAttribute("hideField").toString();
  //ÅÐ¶Ïµ±Ç°±íµ¥ÊÇ·ñÐÂÔö
	if(request.getAttribute("infoId")==null || request.getAttribute("infoId").toString().toUpperCase().equals("NULL") || request.getAttribute("infoId").toString().trim().length()<1){
		//³õÊ¼»¯ÏÔÊ¾½çÃæ(ÐÂÔö)
		//System.out.println("ÐÂÔö±íµ¥.........................................................");

		//2008-08-12 dierzhang Èç¹ûÊÇ·¢Æð×ÓÁ÷³ÌÔòÈç¹û×ÓÁ÷³ÌÖÐµÄ±íµ¥ÓëÖ÷±íµ¥ÏàÍ¬Ôò½«Êý¾Ý¼Ì³Ð
		String pareFormId=request.getParameter("pareTableId");
		boolean isNewForm=true;
		if(pareFormId!=null || !"null".equals(pareFormId) || !"".equals(pareFormId)){
		  //È¡µÃ¸¸±íµ¥IDÔò±È½Ï¸¸±íµ¥IDÊÇ·ñÓëµ±Ç°±íµ¥IDÏàÍ¬£¬Èç¹ûÏàÍ¬µÄ»°£¬Ôò¼Ì³ÐÖ÷±íµ¥Êý¾Ý
		  isNewForm=cst.isNewForm(pareFormId,pageId);
		}

		//if(isNewForm){
		   //ÐÂ±íµ¥

				//String[] fieldArr =cst.getField(pageId);
				//out.println("ÐÂÔö±íµ¥.........................................................");
		    //È¡µÃ±íµ¥¹ØÁªµÄËùÓÐ×Ö¶ÎÐÅÏ¢µÄÊý¾Ý
				String[][] fieldArr =cst.getPageField(pageId);
				if(fieldArr!=null){
		      //±éÀúËùÓÐ×Ö¶Î£¬»ñµÃ×Ö¶ÎµÄÒ³ÃæÏÔÊ¾½Å±¾
					for(int i=0;i<fieldArr.length;i++){
					//System.out.println("a:"+fieldArr[i][0]+"         b:"+fieldArr[i][1]);

						if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
							out.print(cst.getHTML(fieldArr[i][0],hide_Field,domainId,fieldArr[i][1]));
						}
					}
				}

        //»ñµÃ±íµ¥¹ØÁªµÄËùÓÐ×Ó±í×Ö¶Î
        String[][] forFieldArr =cst.getForeignField(pageId);
				if(forFieldArr!=null){
		        //±éÀúËùÓÐ×Ö¶Î£¬»ñµÃ×Ö¶ÎµÄÒ³ÃæÏÔÊ¾½Å±¾
						for(int i=0;i<forFieldArr.length;i++){
							if(forFieldArr[i][2]!=null && (!forFieldArr[i][2].trim().equals(""))){
								out.print(cst.getHTML(forFieldArr[i][2],hide_Field,domainId,forFieldArr[i][3]));
							}
					  }
         }

         //start
         //»ñµÃ±íµ¥¹ØÁªµÄËùÓÐ×Ó±íÊý×é
         String[] tables = cst.getForeignTable(pageId);
         if (tables != null && tables.length > 0) {
              //±éÀúËùÓÐ×Ó±í
              for (int i = 0; i < tables.length; i++) {
                  if (tables[i] == null || tables[i].trim().length() < 1)continue;
                  if(i==0){//½«µÚÒ»¸ö×Ó±íÉèÖÃÎªÔö¼ÓÐÐ¡¢É¾³ýÐÐÍ¼±êËùÔÚµÄ½¹µã
                  	scriptappend = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];setAbsolute(currentRow);";
                  }
                  //ÉèÖÃÍ³¼Æ×Ö¶Î
                  String[][] tlFlds = cst.getTotalFieldByTableName(tables[i],domainId);
                  if(tlFlds !=null && tlFlds.length>0){
                  	out.print("addTotalRow('"+tables[i]+"');");
                          String tlfld = "";
                          for(int p=0;p<tlFlds.length;p++){
                          	  tlfld +=  tlFlds[p][0]+",";
                                    out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label>';");
                          }
                          out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden id=totalField value="+tlfld+">';");
                          out.print("setTotalValue();");
                  }
              }
          }
     //}else{
     	if(!isNewForm){
     	  //×ÓÁ÷³Ì±íµ¥ÓëÖ÷Á÷³Ì±íµ¥ÓÃµÄÊÇÍ¬Ò»ÕÅÊý¾Ý±í£¬È¡Ö÷Á÷³ÌÖÐµÄÊý¾ÝÌî³ä±íµ¥

     	  pageId=pareFormId;

     	  //µ±Ç°±íµ¥Îª±à¼­±íµ¥£¨±íµ¥ÒÑÓÐ¶ÔÓ¦µÄÊý¾Ý£©
		 //System.out.println("ÐÂÔö×ÓÁ÷³ÌµÄ¼Ì³ÐÖ÷Á÷³ÌÊý¾Ý.........................................................");
     String forHideField = "";//×Ö±í²»¿É±à¼­×Ö¶Î

     if("1".equals(request.getParameter("flag"))) hide_Field="ALL";


		 //ËùÓÐ×Ö¶Î²»¿É±à¼­£¬¸ÃÖÖÇé¿ö±íÊ¾ÔÚ×Ô¶¨ÒåÄ£¿éÖÐµã»÷Á´½Ó²é¿´ÐÅÏ¢
     fieldArr = cst.getPageField(pageId);//¶ÁÈ¡±íµ¥ÄÇ¹ØÁªµÄËùÓÐÖ÷±í×Ö¶ÎÐÅÏ¢
     if(fieldArr!=null){
				 for(int i=0;i<fieldArr.length;i++){
				    //±éÀúËùÓÐÖ÷±í×Ö¶Î
				    //System.out.println(fieldArr[i][0]+"   :"+fieldArr[i][1]);
						if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
		            //»ñµÃÖ÷±í×Ö¶ÎµÄÏÔÊ¾½Å±¾
							  out.print(cst.getEditHTML(fieldArr[i][0],request.getParameter("pareRecordId"),pageId,hide_Field,domainId,fieldArr[i][1]));
						}
				 }
		 }


     //start
     //»ñµÃ±íµ¥ÄÇ¹ØÁªµÄËùÓÐ×Ó±í
     tables = cst.getForeignTable(pageId);
     //System.out.println("talbe:"+tables.length);
     if (tables != null && tables.length > 0) {
          for (int i = 0; i < tables.length; i++) {
              //±éÀúËùÓÐ×Ó±í
              if (tables[i] == null || tables[i].trim().length() < 1)continue;
              //ÌáÈ¡×Ö±í¹ØÁªµÄËùÓÐ×Ö¶Î
              String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
              //System.out.println("forFields:"+forFields.length);
              //Æ´×°SQL
              String sql = "";//²éÑ¯×Ó±í¹ØÁªµ½±íµ¥ÖÐµÄËùÓÐ×Ö¶ÎÖµµÄSQLÓï¾ä
              if(forFields!=null && forFields.length>0){
				           boolean hideTable = true;//×Ó±íÊÇ·ñÓÐ¿ÉÐ´×Ö¶Î
                   for(int k=0;k<forFields.length;k++){
                       //±éÀúËùÓÐ×Ö¶Î
                       sql += forFields[k][5]+",";//½«×Ö¶ÎÌí¼Óµ½Êý¾Ý²éÑ¯µÄSQLÖÐ
											 if(forHideField.indexOf(forFields[k][5])<0){
											    //Èç¹û¸Ã×Ó±íÖÐÓÐ¿É±à¼­×Ö¶Î£¬Ôò¸Ã±í¿É±à¼­
													hideTable = false;
											 }
                   }
                   //Éú³É×Ó±íÊÇ·ñ¿É±à¼­µÄHTMLÔªËØ£¬ÓÃÓÚÊý¾Ý¸üÐÂ¡¢Ôö¼ÓÉ¾³ýÐÐµÄ¿ØÖÆ
                   if(hideTable){
                            hideTableHTML += "<input type=hidden name=hideTable id=hideTable value="+tables[i]+">";
                    }else{
                            showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
                    }
                    sql = sql.substring(0,sql.length()-1);
              }
              //System.out.println("sql:"+sql);
              //ÌáÈ¡×Ó±íÊý¾Ý
              String[][] data = null;
              if(sql.length()>1){
                  	sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getParameter("pareRecordId");
              	data = cst.loadDataBySQL(sql,String.valueOf(forFields.length+1));
              }else{
              	continue;
              }
              //ÉèÖÃÒ³Ãæ×Ó±íÐÐÊý
	            if(data!=null && data.length>0){
	                	for(int n=0;n<data.length-1;n++){//±éÀúËùÓÐÊý¾Ý£¬½âÎöÊý¾ÝÐÐ£¬¸ù¾Ý¼ÇÂ¼ÊýÁ¿Ôö¼ÓÐÐ
	                        	String script = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];addRow();";
	                        	out.print(script);
	                    }
	                    for(int n=0;n<data.length;n++){//±éÀúÊý¾Ý£¬½âÎöÊý¾ÝÔÚ±íµ¥ÉÏµÄÕ¹Ê¾
	                            //½âÎöÊý¾Ý
	                            for(int m=0;m<forFields.length;m++){//±éÀú×Ö¶Î£¬Éú³É¸Ã×Ö¶Î¼°ÆäÖµÕ¹Ê¾ÔÚ±íµ¥ÉÏµÄ½Å±¾
	                                out.print(reuquest,cst.getForeignEditHTML(forFields[m][5],data[n][m],forFields,"",m,String.valueOf(n),forFields[m][0]));
	                            }
	                            String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
	                           out.print(script);
	                    }
	            }else{//¸Ã×Ó±íÃ»ÓÐÊý¾Ý£¬Òþ²ØÄ£°åÖÐ³õÊ¼»¯µÄµÚÒ»¸öÊý¾ÝÐÐ
	                for(int m=0;m<forFields.length;m++){
	                        out.print(reuquest,cst.getForeignEditHTML(forFields[m][5],"",forFields,(("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus")))?hide_Field+forHideField:"ALL"),m,"0",forFields[m][0]));
	                }
	                out.print("document.getElementsByName('"+tables[i]+"TR')[0].style.display='none';");

	            }
              //ÉèÖÃÍ³¼Æ×Ö¶Î
              String[][] tlFlds = cst.getTotalFieldByTableName(tables[i],domainId);
              if(tlFlds !=null && tlFlds.length>0){
                  	//Ôö¼ÓÍ³¼Æ×Ö¶ÎÏÔÊ¾ÐÐ
              	    out.print("addTotalRow('"+tables[i]+"');");
                    String tlfld = "";
                    for(int p=0;p<tlFlds.length;p++){//±éÀúÍ³¼Æ×Ö¶Î£¬ÉèÖÃ¶ÔÓ¦µÄÍ³¼Æ×Ö¶Î±íµ¥ÔªËØ
                    	  tlfld +=  tlFlds[p][0]+",";
                              out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label>';");
                    }
                    out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden id=totalField value="+tlfld+">';");
                    out.print("setTotalValue();");
              }
          }
      }//end



     }

	}else{
		 //µ±Ç°±íµ¥Îª±à¼­±íµ¥£¨±íµ¥ÒÑÓÐ¶ÔÓ¦µÄÊý¾Ý£©
		 //System.out.println("±à¼­±íµ¥.........................................................");
     String forHideField = "";//×Ö±í²»¿É±à¼­×Ö¶Î
     if(request.getParameter("processId")!=null){
          //±íµ¥ÔÚÁ÷³ÌÖÐµ÷ÓÃ
          com.js.oa.jsflow.service.WorkFlowBD workFlowBD = new com.js.oa.jsflow.service.WorkFlowBD();
          //È¡¶Á×Ö¶Î
        	String writeFieldString = "";//¿ÉÐ´×Ö¶Î´® $×Ö¶ÎÃû³Æ$$×Ö¶ÎÃû³Æ$
        	if("0".equals(request.getParameter("workStatus"))){
        	    //ÊÇ´ý°ìÎÄ¼þ
        	    //È¡µ±Ç°»î¶¯µÄ¿ÉÐ´×Ö¶ÎList
              java.util.List list = workFlowBD.getRWList(request.getParameter("activity"), request.getParameter("table"), request.getParameter("record"), "1");
              String[] str = null;
              for(int i = 0; i < list.size(); i ++){//±éÀú¿ÉÐ´×Ö¶Î£¬½«¿ÉÐ´×Ö¶Î×ª»¯Îª×Ö·û´®ÐÎÊ½
                	str = (String[]) list.get(i);
                	if(str[0].equals("1")){//¿ÉÐ´×Ö¶Î
                    	writeFieldString += "$" + str[1] + "$";
               	 	}
            	}
              //±íµ¥ÖÐ¹ØÁªµÄËùÓÐ×Ó±í×Ö¶ÎÐÅÏ¢
              String[][] forFieldArr = new com.js.oa.eform.service.CustomFormBD().getForeignField(pageId);
              if(forFieldArr!=null){
              		for(int i=0;i<forFieldArr.length;i++){
              		    //±éÀú×óÓÒ×Ó±í×Ö¶Î£¬Èç¹û×Ö¶Î²»ÔÚ¿ÉÐ´×Ö¶ÎÖÐ£¬Ôò×Ö¶ÎÎª²»¿É±à¼­×Ö¶Î
                  		if(writeFieldString.indexOf(forFieldArr[i][2])<0){
                          		forHideField += forFieldArr[i][2]+",";
                  		}
             		  }
        		  }
        	}

     }

		 if("1".equals(request.getParameter("flag"))) hide_Field="ALL";
		 //ËùÓÐ×Ö¶Î²»¿É±à¼­£¬¸ÃÖÖÇé¿ö±íÊ¾ÔÚ×Ô¶¨ÒåÄ£¿éÖÐµã»÷Á´½Ó²é¿´ÐÅÏ¢
     String[][] fieldArr = cst.getPageField(pageId);//¶ÁÈ¡±íµ¥ÄÇ¹ØÁªµÄËùÓÐÖ÷±í×Ö¶ÎÐÅÏ¢
     if(fieldArr!=null){
				 for(int i=0;i<fieldArr.length;i++){
				    //±éÀúËùÓÐÖ÷±í×Ö¶Î
						if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
		            //»ñµÃÖ÷±í×Ö¶ÎµÄÏÔÊ¾½Å±¾
							  out.print(cst.getEditHTML(fieldArr[i][0],request.getAttribute("infoId").toString(),pageId,hide_Field,domainId,fieldArr[i][1]));
						}
				 }
		 }

     //start
     //»ñµÃ±íµ¥ÄÇ¹ØÁªµÄËùÓÐ×Ó±í
     String[] tables = cst.getForeignTable(pageId);
     if (tables != null && tables.length > 0) {
          for (int i = 0; i < tables.length; i++) {
              //±éÀúËùÓÐ×Ó±í
              if (tables[i] == null || tables[i].trim().length() < 1)continue;
              //ÌáÈ¡×Ö±í¹ØÁªµÄËùÓÐ×Ö¶Î
              String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
              //Æ´×°SQL
              String sql = "";//²éÑ¯×Ó±í¹ØÁªµ½±íµ¥ÖÐµÄËùÓÐ×Ö¶ÎÖµµÄSQLÓï¾ä
              if(forFields!=null && forFields.length>0){
				           boolean hideTable = true;//×Ó±íÊÇ·ñÓÐ¿ÉÐ´×Ö¶Î
                   for(int k=0;k<forFields.length;k++){
                       //±éÀúËùÓÐ×Ö¶Î
                       sql += forFields[k][5]+",";//½«×Ö¶ÎÌí¼Óµ½Êý¾Ý²éÑ¯µÄSQLÖÐ
											 if(forHideField.indexOf(forFields[k][5])<0){
											    //Èç¹û¸Ã×Ó±íÖÐÓÐ¿É±à¼­×Ö¶Î£¬Ôò¸Ã±í¿É±à¼­
													hideTable = false;
											 }
                   }
                   //Éú³É×Ó±íÊÇ·ñ¿É±à¼­µÄHTMLÔªËØ£¬ÓÃÓÚÊý¾Ý¸üÐÂ¡¢Ôö¼ÓÉ¾³ýÐÐµÄ¿ØÖÆ
                   if(hideTable){
                            hideTableHTML += "<input type=hidden name=hideTable id=hideTable value="+tables[i]+">";
                    }else{
                            showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
                    }
                    sql = sql.substring(0,sql.length()-1);
              }
              //ÌáÈ¡×Ó±íÊý¾Ý
              String[][] data = null;
              if(sql.length()>1){
                  	sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getAttribute("infoId").toString();
              	data = cst.loadDataBySQL(sql,String.valueOf(forFields.length+1));
              }else{
              	continue;
              }
              //ÉèÖÃÒ³Ãæ×Ó±íÐÐÊý
	            if(data!=null && data.length>0){
	                	for(int n=0;n<data.length-1;n++){//±éÀúËùÓÐÊý¾Ý£¬½âÎöÊý¾ÝÐÐ£¬¸ù¾Ý¼ÇÂ¼ÊýÁ¿Ôö¼ÓÐÐ
	                        	String script = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];addRow();";
	                        	out.print(script);
	                    }
	                    for(int n=0;n<data.length;n++){//±éÀúÊý¾Ý£¬½âÎöÊý¾ÝÔÚ±íµ¥ÉÏµÄÕ¹Ê¾
	                            //½âÎöÊý¾Ý
	                            for(int m=0;m<forFields.length;m++){//±éÀú×Ö¶Î£¬Éú³É¸Ã×Ö¶Î¼°ÆäÖµÕ¹Ê¾ÔÚ±íµ¥ÉÏµÄ½Å±¾
	                                out.print(reuquest,cst.getForeignEditHTML(reuquest,forFields[m][5],data[n][m],forFields,(("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus")))?hide_Field+forHideField:"ALL"),m,String.valueOf(n),forFields[m][0]));
	                            }
	                            String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
	                           out.print(script);
	                    }
	            }else{//¸Ã×Ó±íÃ»ÓÐÊý¾Ý£¬Òþ²ØÄ£°åÖÐ³õÊ¼»¯µÄµÚÒ»¸öÊý¾ÝÐÐ
	                for(int m=0;m<forFields.length;m++){
	                        out.print(reuquest,cst.getForeignEditHTML(reuquest,forFields[m][5],"",forFields,(("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus")))?hide_Field+forHideField:"ALL"),m,"0",forFields[m][0]));
	                }
	                out.print("document.getElementsByName('"+tables[i]+"TR')[0].style.display='none';");

	            }
              //ÉèÖÃÍ³¼Æ×Ö¶Î
              String[][] tlFlds = cst.getTotalFieldByTableName(tables[i],domainId);
              if(tlFlds !=null && tlFlds.length>0){
                  	//Ôö¼ÓÍ³¼Æ×Ö¶ÎÏÔÊ¾ÐÐ
              	    out.print("addTotalRow('"+tables[i]+"');");
                    String tlfld = "";
                    for(int p=0;p<tlFlds.length;p++){//±éÀúÍ³¼Æ×Ö¶Î£¬ÉèÖÃ¶ÔÓ¦µÄÍ³¼Æ×Ö¶Î±íµ¥ÔªËØ
                    	  tlfld +=  tlFlds[p][0]+",";
                              out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label>';");
                    }
                    out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden id=totalField value="+tlfld+">';");
                    out.print("setTotalValue();");
              }
          }
      }//end
 }

      out.write("\r\n\r\n//alert(WorkFlowFormActionForm.computeField.value);\r\n</script>\r\n\r\n");

	//×Ó±íµÄ¼ÆËã×Ö¶ÎÉèÖÃ
  out.print(cst.getForeignComputeFieldHTML(pageId));
	out.print(hideTableHTML+showTableHTML);

      out.write("\r\n\r\n<script language=javascript src=\"/jsoa/eform/datetime/time.js\"></script>\r\n<script language=\"javascript\">\r\n\r\nif(document.all.wf_ua){\r\n    if(document.all.wf_ua.length){\r\n    }else{\r\n        eval(\"document.all.\" + document.all.wf_ua.value + \".value='");
      out.print(session.getAttribute("userAccount"));
      out.write("'\");\r\n    }\r\n}\r\n</script>\r\n\r\n<DIV id=adddelrow_div\r\nstyle=\"BORDER-RIGHT: #0a246a 1px solid; BORDER-TOP: #0a246a 1px solid; VISIBILITY: hidden; BORDER-LEFT: #0a246a 1px solid; WIDTH: 30px; BORDER-BOTTOM: #0a246a 1px solid; POSITION: absolute\">\r\n<TABLE height=\"100%\" cellSpacing=0 cellPadding=0 width=\"100%\" border=0>\r\n  <TBODY>\r\n  <TR>\r\n    <TD onmouseover=\"this.style.borderRiht='1px #0A246A solid'\"\r\n    onmouseout=\"this.style.borderRiht=''\" align=middle><SPAN id=delrow_div\r\n      title=µã»÷É¾³ý¼ÇÂ¼ style=\"CURSOR: hand\"><IMG height=12\r\n      src=\"/jsoa/custom_form/images/delarrow.gif\" width=12 onclick='delRow()' align=absMiddle></SPAN> </TD>\r\n    <TD onmouseover=\"this.style.borderLeft='1px #0A246A solid'\"\r\n    onmouseout=\"this.style.borderLeft=''\" align=middle><SPAN id=addrow_div\r\n      title=µã»÷Ìí¼Ó¼ÇÂ¼ style=\"CURSOR: hand\"><IMG height=12\r\n      src=\"/jsoa/custom_form/images/addarrow.gif\" width=12 onclick='addRow()' align=absMiddle></SPAN>\r\n  </TD></TR></TBODY></TABLE></DIV>\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\n");
      out.write("//document.body.attachEvent(\"onload\",function(){});\r\n//alert(document.body.readyState);\r\nsetNoWrap();\r\ninitRow();\r\n//-->\r\n</SCRIPT>\r\n<script >\r\n\t");
//=scriptappend
      out.write("\r\n        ");
/*
        	if(scriptappend.length()>0){
                	out.print("document.body.attachEvent('onload',function(){setAbsolute(currentRow);});");
                }*/
        
      out.write("\r\n        //alert(document.body.onload);\r\n\r\nfunction compute_filed_auto(){\r\n\tif(document.all.computeField) {\r\n        //ÓÐ¼ÆËã×Ö¶Î\r\n        if(document.all.computeField.length) {\r\n            //²»Ö¹Ò»¸ö¼ÆËã×Ö¶Î\r\n            for(var i = 0; i < document.all.computeField.length.value; i ++){\r\n                //setCompleteField(document.all.computeFieldValue[i], document.all.computeField[i].value);\r\n\t\t\t\tvar computeField = document.all.computeField[i].value;\r\n                var computeFieldValue = document.all.computeFieldValue[i].value;\r\n\t\t\t\teval(\"document.all.\"+computeField).value = getComputeValue(computeFieldValue);\r\n\t\t\t\tif(eval(\"document.all.\"+computeField+\"_cmp\")){\r\n\t\t\t\t\teval(\"document.all.\"+computeField+\"_cmp\").value = getComputeValue(computeFieldValue);\r\n\t\t\t\t}\r\n            }\r\n        }else{\r\n            //Ö»ÓÐÒ»¸ö¼ÆËã×Ö¶Î\r\n            //setCompleteField(document.all.computeFieldValue, document.all.computeField.value);\r\n\t\t\tvar computeField = document.all.computeField.value;\r\n\t\t\tvar computeFieldValue = document.all.computeFieldValue.value;\r\n");
      out.write("\t\t\teval(\"document.all.\"+computeField).value = getComputeValue(computeFieldValue);\r\n\t\t\tif(eval(\"document.all.\"+computeField+\"_cmp\")){\r\n\t\t\t\teval(\"document.all.\"+computeField+\"_cmp\").value = getComputeValue(computeFieldValue);\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n</script>\r\n");
      out.write("\r\n\t</td></tr>\r\n\t<tr><td>\r\n            ");
 if (flagg == null || flagg.equals("0")) {
      out.write("\r\n\t\t<button class=\"btnButton4font\" onclick=\"javascript:if(customFormBeforeSubmit()){document.all.form1.submit();}\">保存退出</button><button class=\"btnButton4font\" onclick=\"javascript:save();\" style=\"display:'");
      out.print(flag);
      out.write("'\">保存继续</button><button class=\"btnButton2font\" onclick=\"javascript:window.location.reload();\">重置</button><button class=\"btnButton2font\" onclick=\"javascript:window.close()\">退出</button>\r\n            ");
}
      out.write("\r\n\t</td></tr>\r\n</form>\r\n</table>\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\n\r\nfunction save(){\r\n\t//alert(customFormBeforeSubmit());\r\n\tif(customFormBeforeSubmit()){\r\n\t\tdocument.all.operate.value=\"continue\";\r\n\t\tdocument.all.form1.submit();\r\n\t}\r\n}\r\nfunction checkNum(obj){\r\n    if(isNaN(obj.value)){\r\n        alert(\"请输入数字！\");\r\n        obj.select();\r\n        obj.focus();\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction customFormBeforeSubmit(){\r\n\t\tsetHtmlValue();\r\n    var canSubmit = true;\r\n    if(document.all.mustWrite){\r\n        //如果页面有必填项\r\n        if(document.all.mustWrite.length){\r\n\t\t\t\r\n\t\t\t\r\n            //如果页面不止一个必填项\r\n            for(var i =0; i < document.all.mustWrite.length; i ++){\r\n                var obj = eval(\"document.all.\" + document.all.mustWrite[i].value);\r\n                if(obj){\r\n                    var objType = \"\";\r\n                    if(obj.type){\r\n                       objType = obj.type.toUpperCase();\r\n                    }else{\r\n                        if(obj.length){\r\n\t\t\t\t\t\t\tfor(var k=0;k<obj.length;k++){\r\n\t\t\t\t\t\t\t\t//i++;\r\n");
      out.write("\t\t\t\t\t\t\t\tobjType = obj[k].type.toUpperCase();\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar objTemp = obj[k];\r\n\t\t\t\t\t\t\t\tif(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t   \r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HIDDEN\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"CHECKBOX\" || objType==\"RADIO\"){\r\n\t\t\t\t\t\t\t\t    \r\n\t\t\t\t\t\t\t\t    //checkbox 为一组,验证obj 而不是objtemp\r\n\t\t\t\t\t\t\t\t\tif(!checkboxIsChecked(obj)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HTML\"){\r\n\t\t\t\t\t\t\t\t\tif(eval(objTemp.id + \".getHTML()\")==\"\"){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n                        }else{\r\n                            objType = \"HTML\";\r\n                        }\r\n                    }\r\n                    if(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" ){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"HIDDEN\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n");
      out.write("                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n                        if(obj.html.length == 0){\r\n                            alert(\"请填写必填项！\");\r\n                            obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"CHECKBOX\"){\r\n\t\t\t\t\t\t//alert(objType);\r\n                        if(!checkboxIsChecked(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\t\t\t\t\t\t\r\n\t\t\t\t\t\t//alert(objType+\" 111\");\r\n                    }else if(objType == \"HTML\"){\r\n                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n");
      out.write("                    }\r\n                }\r\n                if(document.all.fieldName && document.all.fieldName.length){\r\n                    for(var j = 0; j < document.all.fieldName.length; j ++){\r\n                        if(document.all.fieldName[j].value == document.all.mustWrite[i].value + \"_file\"){\r\n                            if(!eval(\"document.all.\" + document.all.mustWrite[i].value + \"_fileName\")){\r\n                                alert(\"请填写必填项！\");\r\n                                canSubmit = false;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    if(!canSubmit){\r\n                    \tbreak;\r\n                    }\r\n                }\r\n                obj = eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\");\r\n                if(obj){\r\n                   if(eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\").value==\"\"){\r\n                        alert(\"请填写必填项！\");\r\n                        canSubmit = false;\r\n");
      out.write("                        break;\r\n                    }\r\n                }\r\n            }\r\n        }else{\r\n            //页面只有一个必填项\r\n            var obj = eval(\"document.all.\" + document.all.mustWrite.value);\r\n            if(obj){\r\n                var objType = \"\";\r\n                if(obj.type){\r\n                    objType = obj.type.toUpperCase();\r\n                }else{\r\n                    if(obj.length){\r\n                        objType = obj[0].type.toUpperCase();\r\n                    }else{\r\n                        objType = \"HTML\";\r\n                    }\r\n                }\r\n                if(objType == \"TEXT\"  || objType == \"PASSWORD\" || objType == \"TEXTAREA\"){\r\n                    if(textIsEmpty(obj)){\r\n                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n                    if(obj.html.length == 0){\r\n                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n");
      out.write("                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"HIDDEN\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                        }\r\n                    }else if(objType == \"CHECKBOX\"){\r\n                    if(!checkboxIsChecked(obj)){\r\n                        alert(\"请填写必填项！\");\r\n                        //obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"HTML\"){\r\n                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n\r\n                }\r\n\r\n            }\r\n\t\t\t\r\n            if(document.all.fieldName && document.all.fieldName.length){\r\n                for(var j = 0; j < document.all.fieldName.length; j ++){\r\n                    if(document.all.fieldName[j].value == document.all.mustWrite.value + \"_file\"){\r\n");
      out.write("                        if(!eval(\"document.all.\" + document.all.mustWrite.value + \"_fileName\")){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n\t\t\tobj = eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\");\r\n                if(obj){\r\n                   if(eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\").value==\"\"){\r\n                        alert(\"请填写必填项！\");\r\n                        canSubmit = false;\r\n                    }\r\n                }\r\n        }\r\n    }\r\n\r\n\r\n    try{\r\n\t var reg = /(f\\d+)/g;\r\n    if(document.all.computeField){\r\n        if(document.all.computeField.length){\r\n\t\t\t//alert(document.all.computeField.length);\r\n            for(var i = 0; i < document.all.computeField.length; i ++){\r\n\t\t\t\t//alert(i);\r\n                var computeField = document.all.computeField[i].value;\r\n                var computeFieldValue = document.all.computeFieldValue[i].value;\r\n");
      out.write("                var fieldArray = computeFieldValue.match(reg);\r\n                var isNotTime = true;\r\n                if(fieldArray.length == 2){\r\n                    var testValue1 = \"\";\r\n\r\n                    if(eval(\"document.all.\" + fieldArray[0])){\r\n                        testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n                    }else{\r\n                        testValue1 = \"\";\r\n\r\n                    }\r\n\r\n                    var testValue2 = \"\";\r\n                    if(eval(\"document.all.\" + fieldArray[1])){\r\n                        testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n                    }else{\r\n                        testValue2 = \"\";\r\n                    }\r\n\t\t\t\t\t//if(i==1) alert(\"third\");\r\n                    if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"-\") > 0 && testValue2.indexOf(\"-\") > 0){\r\n                        isNotTime = false;\r\n                        var date1,date2;\r\n\t\t\t\t\tif(testValue1.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2].split(\" \")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n");
      out.write("\t\t\t\t\t\t//testValue1 = testValue1.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//alert(testValue1);\r\n\t\t\t\t\tif(testValue2.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2].split(\" \")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue2 = testValue2.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n                   // var day =((new Date(testValue1) - new Date(testValue2))) + \"\";\r\n\t\t\t\t   var day = (date1-date2) / 86400000+\"\";\r\n                        if(day.indexOf(\".\") > 0){\r\n                            if((day.length - day.indexOf(\".\")) > 2){\r\n                            \tday = day.substring(0, day.indexOf(\".\") + 3);\r\n                            }\r\n                        }\r\n                        document.all.computeFieldValue[i].value=day ;\r\n");
      out.write("\r\n                    }\r\n                }\r\n                if(isNotTime){\r\n\t\t\t\t\t//alert(isNotTime);\r\n                    for(var j = 0; j < fieldArray.length; j ++){\r\n                        computeFieldValue = computeFieldValue.replace(fieldArray[j],eval(\"document.all.\" + fieldArray[j] + \".value\"));\r\n                    }\r\n                    try{\r\n                    \tdocument.all.computeFieldValue[i].value= eval(computeFieldValue);\r\n\t\t\t\t\t\t//alert(document.all.computeField[i].value);\r\n\t\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\")){\r\n\t\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\").value = eval(computeFieldValue);\r\n\t\t\t\t\t\t}\r\n                    }catch(e){}\r\n\r\n                }\r\n            }\r\n        }else{\r\n            var computeField = document.all.computeField.value;\r\n            var computeFieldValue = document.all.computeFieldValue.value;\r\n            var fieldArray = computeFieldValue.match(reg);\r\n            var isNotTime = true;\r\n            if(fieldArray.length == 2){\r\n");
      out.write("\t\t\t\t//alert(\"111\");\r\n                var testValue1 = \"\";\r\n                if(eval(\"document.all.\" + fieldArray[0])){\r\n                    testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n                }else{\r\n                    testValue1 = \"\";\r\n                }\r\n                var testValue2 = \"\";\r\n                if(eval(\"document.all.\" + fieldArray[1])){\r\n                    testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n                }else{\r\n                    testValue2 = \"\";\r\n                }\r\n\t\t\t\t//alert(testValue1);\r\n                if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"-\") > 0 && testValue2.indexOf(\"-\") > 0){\r\n                    isNotTime = false;\r\n                    var date1,date2;\r\n\t\t\t\t\tif(testValue1.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2].split(\" \")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n");
      out.write("\t\t\t\t\t\t//testValue1 = testValue1.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//alert(testValue1);\r\n\t\t\t\t\tif(testValue2.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2].split(\" \")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue2 = testValue2.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n                   // var day =((new Date(testValue1) - new Date(testValue2))) + \"\";\r\n\t\t\t\t   var day = (date1-date2) / 86400000+\"\";\r\n                    if(day.indexOf(\".\") > 0){\r\n                        if((day.length - day.indexOf(\".\")) > 2){\r\n                            day = day.substring(0, day.indexOf(\".\") + 3);\r\n                        }\r\n                    }\r\n                    document.all.computeFieldValue.value = day ;\r\n");
      out.write("\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\")){\r\n\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField.value+\"_cmp\").value = day;\r\n\t\t\t\t\t}\r\n                }\r\n            }\r\n            if(isNotTime){\r\n\t\t\t\t//alert(eval(\"document.all.\" + fieldArray[0] + \".value\"));\r\n                for(var j = 0; j < fieldArray.length; j ++){\r\n                    computeFieldValue = computeFieldValue.replace(fieldArray[j],eval(\"document.all.\" + fieldArray[j] + \".value\"));\r\n                }\r\n                try{\r\n\t\t\t\t\t//alert(computeFieldValue);\r\n                    document.all.computeFieldValue.value = eval(computeFieldValue);\r\n\t\t\t\t\t//alert(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\"));\r\n\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\")){\r\n\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField.value+\"_cmp\").value = eval(computeFieldValue);\r\n\t\t\t\t\t}\r\n                }catch(e){}\r\n\r\n            }\r\n        }\r\n    }\r\n    }catch(e){}\r\n\r\n    if(canSubmit){\r\n        setHtmlValue();\r\n");
      out.write("    }\r\n    return canSubmit;\r\n\r\n}\r\n\r\nfunction setHtmlValue(){\r\n    if(document.all.hasHtml){\r\n        //页面中包含有HTML编辑器\r\n        if(document.all.hasHtml.length){\r\n            //页面中包含不止一个HTML编辑器\r\n            var len = document.all.hasHtml.length;\r\n            for(var j = 0; j < len; j ++){\r\n            \tvar htmlEditName = document.all.hasHtml[j].value;\r\n                eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n            }\r\n        }else{\r\n            //页面上仅有一个HTML编辑器\r\n            var htmlEditName = document.all.hasHtml.value;\r\n            eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n        }\r\n    }\r\n}\r\n\r\n\r\nfunction changeText(){\r\n}\r\nfunction clickRadio(obj){\r\n    changeText();\r\n}\r\nfunction clickCheckbox(){\r\n    changeText();\r\n}\r\nfunction changeSelect(){\r\n    changeText();\r\n}\r\nfunction changeTextarea(){\r\n    changeText();\r\n}\r\n\r\n\r\n//  likun 20070323  异步取组合编号\r\nvar xmlHttp = false;\r\n\ttry {\r\n\t\txmlHttp = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n");
      out.write("\t} catch (e) {\r\n\t\ttry {\r\n\t\t\txmlHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t} catch (e2) {\r\n\t\t\txmlHttp = false;\r\n\t\t}\r\n\t}\r\n\tif (!xmlHttp && typeof XMLHttpRequest != 'undefined') {\r\n\t\txmlHttp = new XMLHttpRequest();\r\n\t}\r\nvar fieldName;\r\n\r\nfunction getAutoCode(obj,field){\r\n\tfieldName = field;\r\n\txmlHttp.open(\"GET\", \"/jsoa/custom_database/getAutoCode.jsp?pageId=");
      out.print(request.getParameter("formId"));
      out.write("&field=\"+field+\"&head=\"+obj.value, true);\r\n\txmlHttp.onreadystatechange = updateAutoCode;\r\n\txmlHttp.send(null);\r\n}\r\n\r\nfunction updateAutoCode(){\r\n\tif (xmlHttp.readyState < 4) {\r\n\t\t//document.all.printNum.innerHTML=\"正在加载\";\r\n\t}\r\n\tif (xmlHttp.readyState == 4) {\r\n\t\tvar response = xmlHttp.responseText;\r\n\t\teval(\"document.all.\"+fieldName).value = response;\r\n\t}\r\n}\r\nfunction editOffices(field,fileType,template,showSign){\r\n\t//alert(\"开始打开\");\r\n\tvar recordId = eval(\"document.all.\"+field+\".value\");\r\n\tvar userName = \"");
      out.print(session.getAttribute("userName"));
      out.write("\";\r\n\t\r\n\twindow.open(\"/jsoa/iWebOfficeSign/DocumentEdit.jsp?RecordID=\"+recordId+\"&EditType=1&UserName=\"+userName+\r\n\t\t\t\"&ShowSign=\"+showSign+\"&CanSave=1&moduleType=information&saveHtmlImage=0&saveDocFile=0&field=\"+field+\r\n\t\t\t\"&FileType=.\"+fileType+\"&showEditButton=1&showSignButton=1&Template=\"+template, \r\n\t\t\t\"\", \"status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,Height=400,left=0,top=0\");\r\n}\r\n//  end  likun 20070323  异步取组合编号\r\n//-->\r\n</SCRIPT>\r\n");
}
      out.write('\r');
      out.write('\n');
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
