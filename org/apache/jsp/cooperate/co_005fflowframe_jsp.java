/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 10:09:22 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.cooperate;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.util.*;
import java.sql.*;

public final class co_005fflowframe_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("java.sql");
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("java.util");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = null;
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n");

response.setHeader("Cache-Control","no-store");
response.setHeader("Pragma","no-cache");
response.setDateHeader ("Expires", 0);

String modiflow=request.getParameter("modiflow");
String bodyId=request.getParameter("bodyId");
String initUserId=request.getParameter("initUserId");
String initUserName=request.getParameter("initUserName");
String nodeId=request.getParameter("nodeId");
String userId=session.getAttribute("userId").toString();

StringBuffer nodes=new StringBuffer();
if("1".equals(modiflow) || !"0".equals(bodyId)){
   Connection conn=null;
   try{
       conn=new com.js.util.util.DataSourceBase().getDataSource().getConnection();
       PreparedStatement pstmt=conn.prepareStatement("select id,node_title,nickname,parentnick,status,isend,node_right,chuan from co_node where body_id=?");
       pstmt.setString(1, bodyId);
       ResultSet rs=pstmt.executeQuery();
       
       String nodeName,nickName,parentNick,status,isend,chuan,right,id;
       while(rs.next()){
           nodeName=rs.getString("node_title");           
           nickName=rs.getString("nickname");
           if("root".equals(nickName)){
              continue;
           }
           parentNick=rs.getString("parentnick");
           status=rs.getString("status");
           isend=rs.getString("isend");
           if(rs.getString("chuan")==null||"".equals(rs.getString("chuan"))){
           		chuan = "1";
           }else{
           		chuan = rs.getString("chuan");
           }
           if(rs.getString("node_right")==null){
           		right = "";
           }else{
           		right = rs.getString("node_right");
           }
           id = rs.getString("id");
           
           nodes.append(nickName).append(",").append(nodeName).append(",").append(parentNick).append(",")
                .append(status).append(",,").append(isend).append(","+right+",").append(chuan)
                .append(",").append(id).append(";");           
       }
       //System.out.println(nodes.toString());
       rs.close();
       pstmt.close();      
       conn.close();
   }catch(Exception ex){
       if(conn!=null){
          conn.close();
       }
       ex.printStackTrace();
   } 
}
String range = session.getAttribute("browseRange")+"";

if("".equals(range)){
range="*0*";
}

 
      out.write("\r\n<html>\r\n<head>\r\n<title></title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=GBK\">\r\n<link type=\"text/css\" rel=\"stylesheet\" href=\"/jsoa/css/DocMgr.css\" id=\"menuStyleSheet\">\r\n<link type=\"text/css\" rel=\"stylesheet\" href=\"/jsoa/css/cooperateclassic.css\" >\r\n<SCRIPT type=\"text/javascript\" src=\"/jsoa/js/stringBuffer.js\"></SCRIPT>\r\n<SCRIPT type=\"text/javascript\" src=\"/jsoa/js/cooperate/workflow.js\"></SCRIPT>\r\n<script type=\"text/javascript\" src=\"/jsoa/js/cooperate/poslib.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/js/cooperate/scrollbutton.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/js/cooperate/menu4.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/js/openEndow.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/js/util.js\"></script>\r\n<style type=\"text/css\">\r\n<!--\r\n#noteDiv {\r\n\tposition:absolute;\r\n\twidth:99px;\r\n\theight:81px;\r\n\tz-index:1;\r\n\tvertical-align:middle;\r\n\toverflow:no;\r\n\tborder:1px solid #829FBB;\r\n\tdisplay:none;\r\n\tbackground-color:#F0F0F0;\r\n\tborder-color:\tThreeDHighLight ThreeDShadow\r\n");
      out.write("\t\t\t\t\tThreeDShadow ThreeDHighLight;\r\n\tpadding:\t\t1px;\r\n\tfilter:\t\t\tprogid:DXImageTransform.Microsoft.Chroma(Color=#010101)\r\n\t\t\t\t\tDropShadow(color=ButtonHighlight, offx=1, offy=1);\r\n}\r\n\r\n#noteDiv1 {\r\n\tcolor:\t\tGrayText;\r\n\tborder:\t\t0 ;\r\n\tpadding:\t3px 7px 3px 7px;\r\n}\r\n\r\n-->\r\n</style>\r\n<script>\r\n//888888888888888888888888888888888\r\nvar noteTimer=null;\r\nfunction getNote(wh,ifShowModi){\r\n\tif(wh == null || wh == \"\"){\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t// 获取协同的当前节点的编号\r\n\tvar nodes = \"");
      out.print(nodes.toString());
      out.write("\";\r\n\t// 声明变量\r\n\tvar nodeIdStr = \"\";\r\n\tvar isSubNode = false;\r\n\tif(nodes.indexOf(wh) != -1){\r\n\t\t// 获取当前用户的节点信息字符串\r\n\t\tvar nodeId = \"");
      out.print(nodeId);
      out.write("\";\r\n\t\tvar nodeIdIndex = nodes.indexOf(nodeId);\r\n\t\tvar nodeSelfStr = nodes.substring(nodes.lastIndexOf(\";\", nodeIdIndex) + 1, nodes.indexOf(\";\", nodeIdIndex));\r\n\t\tvar nodeCurrStr = nodes.substring(nodes.indexOf(wh), nodes.indexOf(\";\", nodes.indexOf(wh)));\r\n\t\t// 如果查看节点已办理完毕或点击节点已办理完毕就不显示点击后的菜单\r\n\t\tif(nodeSelfStr.split(\",\")[3] == 20 || nodeCurrStr.split(\",\")[3] == 20 || nodeCurrStr.split(\",\")[6].indexOf(\"appendNode\") == -1) return;\r\n        // 获取协同的当前节点的别名，编号\r\n        var nikeCurrStr = nodeCurrStr.split(\",\")[0];\r\n        nodeIdStr = nodeCurrStr.split(\",\")[8];\r\n        \r\n\t\t// 如果当前用户的节点编号不等于他所点击的节点，就判断所点击节点的父节点是否有当前节点\r\n\t\tif( nodeIdStr != ");
      out.print(nodeId);
      out.write("){\r\n\t        // 获取用户节点的别名\r\n\t        var nikeNameSelf = nodeSelfStr.split(\",\")[0];\r\n\r\n\t        // 获取树中的所有数据，用二维数组表示自己以及指向\r\n\t        var nikeTree = [];\r\n\t        var nodeStrArr = nodes.split(\";\");\r\n\t        for(var i = 0; i < nodeStrArr.length; ++i) {\r\n\t            var nodeStr = nodeStrArr[i].split(\",\");\r\n\t            nikeTree[i] = [];\r\n\t            nikeTree[i][0] = nodeStr[0];\r\n\t            nikeTree[i][1] = nodeStr[2];\r\n\t        }\r\n\t        // 如果当前节点的别名与用户的别名不相同，就查找点击节点的父节点\r\n\t        // alert(\"nikeCurrStr = \" + nikeCurrStr + \"\\nnikeNameSelf = \" + nikeNameSelf);\r\n\t        while(nikeCurrStr != nikeNameSelf && nikeCurrStr != \"root\" && nikeCurrStr != \"\"){\r\n\t            for(var i = 0; i < nikeTree.length; ++i){\r\n\t                if(nikeCurrStr == nikeTree[i][0]){\r\n\t                    nikeCurrStr = nikeTree[i][1];\r\n\t                    break;\r\n\t                }\r\n\t            }\r\n\t            // alert(\"nikeCurrStr = \" + nikeCurrStr);\r\n\t        }\r\n\t        isSubNode = nikeCurrStr == nikeNameSelf;\r\n\t\t\t// alert(\"isSubNode= \" + isSubNode);\r\n");
      out.write("\t\t}\r\n        \r\n    }\r\n\t// 如果协同在新建中，它的特征是(modiflow为1或bodyId为0)是否为假\r\n\t// 可能有同时发送给两个协同给相同的人，那么用户只能修改他锁打开的节点，与用户编号和节点状态无关\r\n\t// 协同的工作的流程图，中间节点的办理人可以增加自己节点后的办理人，可以新增办理人\r\n\t// 如果wh不为空且在字符串nodes中找不到，说明它是新添加的节点\r\n\tif( ");
      out.print("1".equals(modiflow) || !"0".equals(bodyId));
      out.write(" == false || nodes.indexOf(wh) == -1 ||nodeIdStr == ");
      out.print(nodeId);
      out.write(" || isSubNode ){\r\n\t\tmodifyNode(wh,ifShowModi);\r\n\t\t// 如果是IE11或其它浏览器\r\n\t\tif(navigator.userAgent.indexOf(\"MSIE\") == -1){\r\n\t\t\tvar d=document.getElementById(\"noteDiv\");\r\n\t\t\t\r\n\t\t\tvar s_top=0;\r\n\t\t\tif(document.getElementById(\"mainFrame\"))s_top=document.getElementById(\"mainFrame\").scrollTop;\r\n\t\t\td.style.left=getEvent().x-113;\r\n\t\t\t//d.style.top=s_top+event.y-30;\r\n\t\t\td.style.top=getEvent().y;\r\n\t\t\td.style.display=\"inline\";\r\n\t\t}\r\n\t}\r\n}\r\nfunction hiddenNote(){\r\n  noteTimer=window.setTimeout(\"closeNote()\",300);\r\n}\r\nfunction closeNote(){\r\n  var d=document.getElementById(\"noteDiv\");\r\n  d.style.display=\"none\";\r\n}\r\nfunction lockedNote(){\r\n  window.clearTimeout(noteTimer);\r\n}\r\nfunction setNote(obj){\r\n\tdocument.getElementById(\"flowNote\").innerText+=obj.innerText;\r\n}\r\n\r\n\r\nfunction changeColor(id){\r\n\tvar d=document.getElementById(id);\r\n\td.style.background=\"url(/jsoa/imges/menu3.gif)\";\r\n}\r\nfunction recoverColor(id){\r\n\tvar d=document.getElementById(id);\r\n\td.style.background=\"#F0F0F0\";\r\n}\r\n\r\n\r\n//8888888888888888888888888888888888\r\n\r\n<!--\r\n");
      out.write("/*\r\nvar SelectTemplate=parent.window.dialogArguments.myform2.SelectTemplate.value;\r\nvar sysORper=parent.window.dialogArguments.myform2.sysORper.value;\r\nvar infostate = parent.window.dialogArguments.myform2.status\r\n*/\r\n\r\n/** start 流程节点**/\r\nvar oldNode;\r\nvar curNode;\r\nvar maxId = 1;\r\n\r\n/** end  流程节点**/\r\n\r\nvar jsInitPeople  = new People('P");
      out.print(initUserId);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(initUserName);
      out.write("','root','no','0','','','1','0','','1'); //起始节点\r\n\r\nvar jsOldNodeStr=\"");
      out.print(nodes.toString());
      out.write("\";\r\n\r\n/*var who=\"selectedPersonDivTD\";\r\nvar whoOpen =  parent.window.dialogArguments;\r\nvar whereopener = parent.window.dialogArguments;\r\n\r\nvar contentType=\"\";\r\nvar who_url = \"../../\";\r\n\r\nvar isForm=false   //内容是否为表单\r\nvar docType=\"\";    //在newinfo.jsp页面中有可能是整形\r\ndocType=docType+whereopener.Doc.DocTypeid;\r\nif(docType.substring(0,1)==\"f\") isForm=true;\r\n\r\n*/\r\n\r\nvar isForm=false;\r\n//var parentPeoples = new Peoples(0);\r\n\r\nfunction showNode(){\r\n\tfor(var i=0;i<whoOpen.myPeoples.length;i++){\r\n\t\talert(whoOpen.myPeoples[i].thisid);\r\n\t}\r\n}\r\n\r\nfunction init(){\r\n     initFirstFlow();  \r\n\r\n     ");
if("1".equals(modiflow) || !"0".equals(bodyId)){
      out.write("\r\n     //显示第一个节点后的所有节点\r\n          \r\n     var parentSelPeoples=parent.opener.document.all.selPeoples.value;\r\n     document.all.selPeoples.value=parentSelPeoples;\r\n     if(parentSelPeoples!=\"\"){\r\n    \tselectTable(addOldNodesToPeoples(myPeoples,parentSelPeoples));\r\n     }else{    \r\n     \tselectTable(addOldNodesToPeoples(myPeoples,jsOldNodeStr));\r\n     }\r\n     \r\n     ");
}else{
      out.write("\r\n     //将已经选择的第一个节点后的所有后续节点显示出来\r\n     var parentSelPeoples=parent.opener.document.all.selPeoples.value;\r\n     document.all.selPeoples.value=parentSelPeoples;\r\n     //alert(parentSelPeoples);\r\n     if(parentSelPeoples!=\"\"){\r\n          selectTable(addOldNodesToPeoples(myPeoples,parentSelPeoples));\r\n     }\r\n     ");
}
      out.write("     \r\n     \r\n     //myPeoples=new Peoples(1);\r\n     //initPeople(jsInitPeople);\r\n    \r\n    //显示第一个节点\r\n    \r\n\t/*myPeoples = whoOpen.myPeoples;\t\r\n\tcontentType=whereopener.contentType;\r\n\tif(contentType==null){\r\n\t\tcontentType=\"\";\r\n\t}\r\n\r\n\tif(whoOpen.status==\"reply\"){\r\n\t\tinitShowOfReplay(whoOpen.myPeoples[0]);\r\n\t\tdocument.all.myFlow.innerHTML = tempInit;\r\n\t\tselectTableByShow(whoOpen.myPeoples);\r\n\t\t//selectTable(whoOpen.myPeoples);\r\n\t}else{\r\n\t\tdocument.all.myFlow.innerHTML = whoOpen.tempInit;\r\n\t\tselectTable(whoOpen.myPeoples);\r\n\t}\r\n\t//var newWin = window.open( \"\" );\r\n\t//newWin.document.write( document.all.myFlow.innerHTML );\r\n\tif(infostate.value==\"reply\"){\r\n\t\tdocument.getElementById(\"setbutton\").style.display=\"none\";\r\n\t}\r\n\tif(SelectTemplate==0 || sysORper==\"per\"){\t\r\n\t}else{\r\n\t\tdocument.getElementById(\"setbutton\").style.display=\"none\";\r\n\t}\r\n\t\r\n\tif(contentType==\"FORM\")\r\n\t{\r\n\t\tdocument.getElementById(\"setbutton\").style.display=\"none\";\r\n\t}*/\r\n\t\r\n}\r\n\r\nfunction FlowNode(who,whoid){\r\n\tparent.flowNodeFrameset.cols=\"84%,*\";\r\n");
      out.write("\tparent.flowNode.whichNode.innerText=who;\r\n\tparent.flowNode.whoid=whoid\r\n\t\r\n\t\r\n\ttempTactics=whoOpen.PeoplefindById(whoid).Tactics;\r\n\tparent.flowNoderight.checkedWhich(tempTactics);\r\n\r\n}\r\n\r\n\r\n\r\nfunction mydel(p,index){\r\n  for(var i=index;i<p.length;i++){\r\n     p[i]=p[i+1];\r\n  }\r\n  p.length--;\r\n}\r\n\r\nfunction myDelPeople(pid){\r\n  for(var i=1;i<=whoOpen.myPeoples.length;i++){\r\n    if(whoOpen.myPeoples[i].parentid==pid){\r\n\t  \tmydel(whoOpen.myPeoples,pid);\r\n\t  \tmyDelPeople(whoOpen.myPeoples[i].parentid);\r\n  \t}\r\n  }\r\n}\r\n\r\n\r\nfunction delNode(parentId,id){\r\n\r\n\t//alert(parentId);\r\n\t//alert(id);\r\n\t//eval(\"document.all.\"+id+\".innerHTML='';\");\r\n\r\n\tfor(var i=1;i<=whoOpen.myPeoples.length;i++){\r\n\r\n\t  if(whoOpen.myPeoples[i].thisid ==id){\r\n\t  mydel(whoOpen.myPeoples,i);\r\n\t  myDelPeople(id);\r\n\t  //alert(whoOpen.myPeoples[i].name);\r\n\t  }\r\n\t}\r\n\r\n\tparent.location.reload(parent.location.href);\r\n\t//mytr = eval(\"document.all.\"+id);\r\n\t//mytable =\r\n\t//eval(\"document.all.\"+id+\".innerHTML\")=\"\";\r\n\t//alert(eval(\"document.all.\"+id+\".innerHTML\"));\r\n");
      out.write("}\r\n\r\nfunction showSystemTemplate(){\r\n\t if(parent.document.all.flowNodeFrameset.rows==\"50%,50%\"){\r\n\t    parent.document.all.flowNodeFrameset.rows=\"100%,0%\";\r\n\t    document.all.showSt.value=\"参考规则\";\r\n\t\r\n\t }else{\r\n\t\r\n\t    //alert(\"systemTemplateList.jsp?docType=\"+parent.flowNoderight.documentType);\r\n\t    parent.flowNoderight.templateLeft.location.href = \"systemTemplateList.jsp?docType=\"+parent.flowNoderight.documentType;\r\n\t    parent.document.all.flowNodeFrameset.rows=\"50%,50%\";\r\n\t    document.all.showSt.value=\"取消参考\";\r\n\t }\r\n}\r\n\r\nvar beginState=\"1\";//初始化为高级状态\r\n\r\nfunction setState(){\r\n\r\n  //20060612caow_001 区域2 *******************开始\r\n  if(beginState==\"1\"){\r\n     setUpdButton(\"1\");\r\n     //document.getElementById(\"setbutton\").innerHTML=\"<font color=red style='cursor:pointer'>《普通》</font>\";\r\n     document.all.setbutton.src=\"../images/icon/gaojidown.gif\"\r\n     beginState=\"0\";\r\n  }else{\r\n     setUpdButton(\"0\");\r\n     //document.getElementById(\"setbutton\").innerHTML=\"<font color=red style='cursor:pointer'>《高级》</font>\";\r\n     document.all.setbutton.src=\"../images/icon/gaojiup.gif\"\r\n");
      out.write("     beginState=\"1\";\r\n  }\r\n//20060612caow_001 区域2 *******************结束\r\n} \r\n\r\nfunction Mover(obj){\r\n\tif(beginState!=\"0\"){\r\n\t\tobj.src='../images/icon/gaojiup.gif'\r\n\t}\r\n}\r\n\r\nfunction Mout(obj)\r\n{\r\n\tif(beginState!=\"0\"){\r\n\t    obj.src='../images/icon/gaoji1.gif';\r\n\t}\r\n}\r\nfunction setUpdButton(state)\r\n{\r\n\t  var i;\r\n\t  var strState=\"none\";\r\n\t  if(state==\"1\"){strState=\"block\";}\r\n\t  var ps=whoOpen.myPeoples;\r\n\t  for(i=0;i<=ps.length;i++){\r\n\t     try{\r\n\t     \tdocument.getElementById(\"updbutton\"+ps[i].thisid).style.display=strState;\r\n\t     }catch(e){\r\n\t     }\r\n\t  }\r\n}\r\n\r\n/** 以下为流程修改的方法  **/\r\n\r\nfunction modifyNode( pid,ifShowModi ) {\r\n   // 获得当前用户选择的节点\r\n  // alert(pid);\r\n   modifyNodeCan(pid,ifShowModi);\r\n}\r\nvar userId=\"");
      out.print(userId);
      out.write("\";\r\nfunction modifyNodeCan( pid,ifShowModi) {\r\n   // 获得当前用户选择的节点\r\n   curNode = PeoplefindById( pid );\r\n   //alert(curNode);\r\n   //forwardItem.disabled = false;\r\n   refreshItem.disabled = false;\r\n   deleteItem.disabled = false;\r\n   backItem.disabled = false;\r\n   \r\n   if ( curNode.parentid == \"root\" ) {\r\n     //forwardItem.disabled = true;\r\n     deleteItem.disabled = true;\r\n     backItem.disabled = true;\r\n     if (!isForm) {\r\n        //backItem.disabled = true;\r\n     }\r\n   } else if ( myPeoples.length <= 1 ) {\r\n     deleteItem.disabled = true;\r\n     backItem.disabled = true;\r\n   }\r\n   if(navigator.userAgent.indexOf(\"MSIE\")>0)\r\n   {\r\n\t   ");

	   if("1".equals(modiflow) || "0".equals(bodyId)){
	   
      out.write("\r\n\t     showContextMenu();\r\n\t   ");
}
      out.write("\r\n\t   if(\"1\"==ifShowModi){\r\n\t\t  showContextMenu();  \r\n\t   }\r\n   }\r\n  \r\n}\r\n\r\nfunction modifyPopedom() {\r\n   editOtherProperty(curNode.thisid,curNode.info);\r\n}\r\n\r\nfunction deleteNode() {\r\n\r\n   if ( myPeoples.length <= 1 || curNode.status != \"0\" || curNode.parentid == \"root\" ) {\r\n      alert( \"不能删除该流程节点!\" );\r\n      return;\r\n   }\r\n   if ( !confirm( \"该操作将不能恢复,是否删除该节点?\" ) ) { \r\n      return; \r\n   }\r\n   selectTable( deleteNodeById( myPeoples, curNode ) );\r\n   recordNode(myPeoples);\r\n}\r\n\r\nfunction replaceNode() {\r\n  //var returnValue = winopenWhoNew('../../common/SelectPerson/SelectInNewInfo_ViewMenuModify.jsp?modifyType=replace',330,430,'false',curNode.thisid ,whereopener.teamId);\r\n  var returnValue  = showNewInfoDialog_view(false,1);\r\n  if ( !(null == returnValue ) ) {\r\n  \t if ( returnValue.childs.length == 1 ) {\r\n        selectTable( replaceNodeInPeoples( myPeoples, curNode, returnValue.childs[ 0 ] ) );\r\n     }\r\n  }\r\n}\r\n\r\nfunction addNode() {\r\n  //增加后续节点  \r\n  document.getElementById(\"tempSelectedId\").value=\"\";\r\n  document.getElementById(\"tempSelectedName\").value=\"\";\r\n");
      out.write("  \r\n  \r\n  openJSSelectUser('tempSelectedId','tempSelectedName','','','user','no','userorggroup','");
      out.print(range );
      out.write("','jsAddNode');\r\n\r\n  //var returnValue = winopenWhoNew('../../common/SelectPerson/SelectInNewInfo_ViewMenuModify.jsp',330,430,'false',curNode.thisid ,whereopener.teamId);\r\n  /*var returnValue  = showNewInfoDialog_view(true,1);\r\n  if ( !(null == returnValue || \"undefine\" == returnValue.isChuanFa || null == returnValue.isChuanFa) ) {\r\n  \t if ( returnValue.childs.length > 0 ) {\r\n        selectTable( addToPeoples( myPeoples, curNode, returnValue.childs, returnValue.isChuanFa ) );\r\n     }\r\n  }*/\r\n}\r\n\r\nfunction openJSSelectUser(allowId,allowName,selectedId,selectedName,type,single,show,range,parentMethod){\r\n    var wleft=window.screenLeft-2;\r\n\tvar wtop=window.screenTop;\r\n\tselectExeFunc('',allowId,allowName,selectedId,selectedName,'orgPerson','no','_coop_select',range,'yes','userorggroup',parentMethod);\r\n\t\r\n\t//window.open(\"/jsoa/public/select_user/select_organduser.jsp?allowId=\"+allowId+\"&allowName=\"+allowName+\"&select=\"+type+\"&single=\"+single+\"&show=\"+show+\"&range=\"+range+\"&selectedId=\"+selectedId+\"&selectedName=\"+selectedName+\"&parentMethod=\"+parentMethod,\"rights\",\"status=no,menubar=no,scrollbars=yes,resizable=yes,width=660,Height=460,left=\"+wleft+\",top=\"+wtop);\r\n");
      out.write("}\r\n\r\nfunction jsAddNode(){\r\n // var userIds=document.all.tempSelectedId.value;\r\n var userIds=document.getElementById(\"tempSelectedId\").value;\r\n  //var userNames=document.all.tempSelectedName.value;\r\n  var userNames=document.getElementById(\"tempSelectedName\").value;\r\n \r\n  var jsChuanFa=true;\r\n  //串发还是并发，1为并发\r\n  if(document.getElementById(\"_coop_select\").value==\"1\"){\r\n  \tjsChuanFa=false;\r\n  }\r\n  \r\n  document.getElementById(\"selPeoples\").value=\"\";\r\n  //myPeoples  数组\r\n  //addToPeoples()返回新增后的myPeoples\r\n  selectTable(addToPeoples( myPeoples, curNode, splitExePersons(userIds,userNames), jsChuanFa ));\r\n  //alert(11);\r\n  recordNode(myPeoples);\r\n}\r\n\r\n//将选择的节点回传给父页面\r\nfunction setFlowNode(){   \r\n       parent.opener.document.all.selPeoples.value=document.all.selPeoples.value;\r\n       //alert(document.all.selPeoples.value);\r\n       if(document.all.selPeoples.value!=\"\" && document.all.selPeoples.value!=null){\r\n       var curID='P");
      out.print(initUserId);
      out.write("';\r\n       var name=\"\";\r\n       var id=\"\";\r\n       var nodestr=document.all.selPeoples.value;\r\n       var nodes=new Array();\r\n\t   var nodeArr=nodestr.split(\";\");\r\n\t   var node=new Array();\r\n\t   var PID=\"\";\r\n\t   for(var i=0;i<nodeArr.length;i++){ \r\n\t\t   if(nodeArr[i]!=null && nodeArr[i]!=''){\t\t\t   \r\n\t\t\t   node=nodeArr[i].split(\",\");\t\r\n\t\t\t   if(\"P\"==node[0].charAt(0) && node[2]!=\"root\" ){\r\n\t\t           if(node[2]==curID){\r\n\t\t              var singleId=\"$\"+node[0].substring(1,node[0].indexOf(\"_\"))+\"$\";\r\n\t\t              if(id.indexOf(singleId)<0){\r\n\t\t                  id+=\"$\"+node[0].substring(1,node[0].indexOf(\"_\"))+\"$\";\r\n\t\t                  name+=node[1]+\",\";\r\n\t\t                  PID+=\"$\"+node[0].substring(1,node[0].indexOf(\"_\"))+\"$\";\r\n\t\t              }else{\r\n\t\t                alert(\"[\"+node[1]+\"]发送人重复！\");\r\n\t\t                parent.opener.document.all.sendToNamessss.value=false;\r\n\t\t                return; \r\n\t\t              } \r\n\t\t             \r\n\t\t           } \r\n\t\t\t      \r\n\t\t\t   }else if(\"D\"==node[0].charAt(0)){\r\n");
      out.write("\t\t\t       var singleId=\"*\"+node[0].substring(1,node[0].indexOf(\"_\"))+\"*\";\r\n\t\t           if(node[2]==curID){\r\n\t\t              if(id.indexOf(singleId)<0){\r\n\t\t               id+=\"*\"+node[0].substring(1,node[0].indexOf(\"_\"))+\"*\";\r\n\t\t               name+=node[1]+\",\";\r\n\t\t              }else{\r\n\t\t                 alert(\"[\"+node[1]+\"]发送部门重复！\");\r\n\t\t                 parent.opener.document.all.sendToNamessss.value=name;\r\n\t\t                 return; \r\n\t\t              } \r\n\t\t            } \r\n\t\t            \r\n\t\t\t   }else if(\"G\"==node[0].charAt(0)){\r\n\t\t\t        var singleId=\"@\"+node[0].substring(1,node[0].indexOf(\"_\"))+\"@\";\r\n\t\t            if(node[2]==curID){\r\n\t\t               if(id.indexOf(singleId)<0){\r\n\t\t                   id+=\"@\"+node[0].substring(1,node[0].indexOf(\"_\"))+\"@\";\r\n\t\t                   name+=node[1]+\",\";\r\n\t\t               }else{\r\n\t\t                   alert(\"[\"+node[1]+\"]发送群组重复！\");\r\n\t\t                   parent.opener.document.all.sendToNamessss.value=name;\r\n\t\t                   return; \r\n\t\t               }\r\n\t\t            } \r\n");
      out.write("\t\t\t   }\r\n\t\t   } \r\n\t   }\r\n\t      \r\n\t\t   if(parent.opener.document.all.sendToName){\r\n\t\t      parent.opener.document.all.sendToName.value=name;\r\n\t\t      parent.opener.document.all.sendToId.value=id;\r\n\t\t   }\r\n   }\r\n}\r\n\r\n\r\n/* //验证发送节点重复\r\nfunction getCheckNode(name,id,PID){\r\n\r\n     if(window.XMLHttpRequest){\r\n        xmlhttp = new XMLHttpRequest();\r\n        if(xmlhttp.overrideMimeType){\r\n            xmlhttp.overrideMimeType(\"text/xml\");\r\n        }\r\n    }else if(window.ActiveXObject){\r\n    \tvar activexName = [\"MSXML2.XMLHTTP\",\"Microsoft.XMLHTTP\"];\r\n        for(var i = 0; i < activexName.length; i++) {\r\n            try{\r\n                xmlhttp = new ActiveXObject(activexName[i]);\r\n                break;\r\n            }catch(e){\r\n            }\r\n        }\r\n    }\r\n    xmlhttp.onreadystatechange = callback;\r\n\tif(null==name||\"\"==name){\r\n\t\treturn;\r\n\t}\r\n\txmlhttp.open(\"GET\",\"/jsoa/cooperate/co_flowframeajax.jsp?name=name&id=id&PID=\"+PID+\"&date=\"+new Date(),false);\r\n    xmlhttp.send(null);  \r\n}\r\n\r\nfunction callback(){\r\n    if (xmlhttp.readyState == 4) {\r\n");
      out.write("        if (xmlhttp.status == 200) {\r\n             var responseText = xmlhttp.responseText;\r\n\t\t\t alert(responseText); \r\n      } \r\n   }\r\n}\r\n */\r\n\r\n\r\n\r\n\r\n\r\nfunction submitt(obj){\r\n  \tvar toList=obj.myform.toList;\r\n    var idAry = new Array();\r\n    for ( var i = 0; i < toList.length; i++ ) {\r\n    \tvar obj1 = new Object();\r\n    \tobj1.id = obj.getType(toList.options[i].type)+toList.options[i].value;\r\n    \tobj1.info =\"\";\r\n    \tobj1.text = toList.options[i].text;\r\n      \tidAry[ i ] = obj1;\r\n    }\r\n    var isChuanFa = obj.myform.flowType.value == 2;\r\n    obj.returnValue = new NodeOfAdd(isChuanFa, idAry );\r\n    obj.close();\r\n}\r\n\r\nfunction NodeOfAdd( isChuanFa, childs ) {\r\n\tthis.isChuanFa = isChuanFa;\r\n\tthis.childs = childs;\r\n}\r\n\r\n\r\nvar ie55 = /MSIE ((5\\.[56789])|([6789]))/.test( navigator.userAgent ) &&\r\n\t\t\tnavigator.platform == \"Win32\";\r\n\r\nif ( !ie55 ) {\r\n\twindow.onerror = function () {\r\n\t\treturn true;\r\n\t};\r\n}\r\n\r\nfunction writeNotSupported() {\r\n\tif ( !ie55 ) {\r\n\t\tdocument.write( \"<p class=\\\"warning\\\">\" +\r\n\t\t\t\"This script only works in Internet Explorer 5.5\" +\r\n");
      out.write("\t\t\t\" or greater for Windows</p>\" );\r\n\t}\r\n}\r\n\r\nfunction getQueryString( sProp ) {\r\n\tvar re = new RegExp( sProp + \"=([^\\\\&]*)\", \"i\" );\r\n\tvar a = re.exec( document.location.search );\r\n\tif ( a == null )\r\n\t\treturn \"\";\r\n\treturn a[1];\r\n};\r\n\r\nfunction changeCssFile( sCssFile ) {\r\n\tvar loc = String(document.location);\r\n\tvar search = document.location.search;\r\n\tif ( search != \"\" )\r\n\t\tloc = loc.replace( search, \"\" );\r\n\tloc = loc + \"?css=\" + sCssFile;\r\n\tdocument.location.replace( loc );\r\n}\r\n\r\nvar cssFile = getQueryString( \"css\" );\r\nif ( cssFile == \"\" ){\r\n\tcssFile = \"/jsoa/css/cooperateclassic.css\";\r\n}\r\n\r\ndocument.write(\"<link type='text/css' rel='StyleSheet' href='\" + cssFile + \"' />\" );\r\n\r\nMenu.prototype.cssFile = cssFile;\r\n\r\nvar tmp;\r\n\r\n////////////////////////////////////////////// Build context menu\r\n\r\nvar cMenu = new Menu();\r\nvar backItem, forwardItem, refreshItem, deleteItem;\r\n\r\n\r\n//cMenu.add( forwardItem = new MenuItem( \"替换(R)\", function () { replaceNode(); }, \"/jsoa/images/menu/relace.gif\" ) );\r\n//forwardItem.mnemonic = \"r\";\r\n");
      out.write("//cMenu.add( new MenuSeparator() );\r\n\r\ncMenu.add( refreshItem = new MenuItem( \"添加(A)\", function () { addNode(); }, \"/jsoa/images/menu/add.gif\" ) );\r\nrefreshItem.mnemonic = \"a\";\r\n\r\ncMenu.add( new MenuSeparator() );\r\ncMenu.add( backItem = new MenuItem( \"修改(M)\", function () { modifyPopedom(); }, \"/jsoa/images/menu/modify.gif\" ) );\r\nbackItem.mnemonic = \"m\";\r\n\r\ncMenu.add( new MenuSeparator() );\r\ncMenu.add( deleteItem = new MenuItem( \"删除(D)\", function() { deleteNode(); }, \"/jsoa/images/menu/delete.small.gif\" ) );\r\ndeleteItem.mnemonic = \"d\";\r\n\r\n\r\n\r\nvar oldOpenState = null;\t// used to only change when needed\r\nvar lastKeyCode = 0;\r\n\r\nfunction rememberKeyCode() {\r\n\tlastKeyCode = window.event.keyCode;\r\n}\r\n\r\nfunction getEvent()\r\n {\r\n         if(document.all)return window.event;        \r\n         func=getEvent.caller;            \r\n         while(func!=null){    \r\n             var arg0=func.arguments[0];\r\n              if(arg0){\r\n                  if((arg0.constructor==Event || arg0.constructor ==MouseEvent)\r\n                      || (typeof(arg0)==\"object\" && arg0.preventDefault && arg0.stopPropagation)){   \r\n");
      out.write("                      arg0.x = arg0.pageX;\r\n                      arg0.y = arg0.pageY ;\r\n                      arg0.srcElement = arg0.target;\r\n                     return arg0;\r\n                  }\r\n              }\r\n              func=func.caller;\r\n          }\r\n          return null;\r\n\r\n } \r\n \r\nfunction showContextMenu() {\r\n\tvar el =getEvent().srcElement;\r\n\t// check for edit\r\n\tvar showEditMenu = el != null && (el.tagName == \"INPUT\" || el.tagName == \"TEXTAREA\");\r\n\t// check for anchor\r\n\t\r\n\twhile ( el != null && el.tagName != \"A\" ){\r\n\t\tel = el.parentNode;\r\n\t}\r\n\t\r\n\tvar showOpenItems = el != null && el.tagName == \"A\";\r\n\r\n\tshowOpenItems  = false;\r\n\t\t\r\n\tif ( showOpenItems != oldOpenState ) {\r\n\t\t//backItem.visible\t\t= !showOpenItems;\r\n\t\t//forwardItem.visible\t\t= !showOpenItems;\r\n\t\trefreshItem.visible\t\t= !showOpenItems;\r\n\t\toldOpenState = showOpenItems;\r\n\t}\t\r\n\r\n\t// find left and top\r\n\tvar left, top;\r\n\r\n\tif ( showEditMenu )\r\n\t\tel = getEvent().srcElement;\r\n\telse if ( !showOpenItems )\r\n\t\tel = document.documentElement;\r\n\t\t\r\n\tif ( lastKeyCode == 93 ) {\t// context menu key\r\n");
      out.write("\t\tleft = posLib.getScreenLeft( el );\r\n\t\ttop = posLib.getScreenTop( el );\r\n\t}\r\n\telse {\r\n\t\tleft = getEvent().screenX;\r\n\t\ttop = getEvent().screenY;\r\n\t}\r\n\tcMenu.invalidate();\t\r\n\tcMenu.show( left, top,0,0);\r\n\tevent.returnValue = false;\r\n\tlastKeyCode = 0\r\n};\r\n\r\n//document.attachEvent( \"oncontextmenu\", showContextMenu );\r\ndocument.attachEvent( \"onkeyup\", rememberKeyCode );\r\n\r\n-->\r\n</script>\r\n\r\n\r\n</head>\r\n<body style=\"background-color:#FFF;\"  onkeydown=return(!(event.keyCode==78&&event.ctrlKey)) oncontextmenu=self.event.returnValue=false bgcolor=\"#F0F8FF\" onload=\"init()\">\r\n<table width=\"100%\" border=\"0\">\r\n  <tr align=\"center\">\r\n    <td colspan=\"2\">&nbsp;\r\n      <div id=\"myFlow\"></div></td>\r\n  </tr>\r\n  <tr>\r\n    <td>&nbsp;</td>\r\n    <td>　</td>\r\n    <td>\r\n\t\t<div id=\"noteDiv\" style=\"vertical-align:top; font-weight:bold;\" value=\"comment\" onmouseout=\"hiddenNote();\" onmouseover=\"lockedNote();\">\r\n\t\t <div id=\"noteDiv_add\" align=\"left\"    onmouseover=\"changeColor(this.id);\" onmouseout=\"recoverColor(this.id);\"  style=\"padding-top:5px;padding-bottom:5px;vertical-align:middle;font-style:inherit;cursor: pointer;\"><a  style=\"vertical-align:middle; font-weight:bold;text-decoration:none;\"  onclick=\"addNode();\">&nbsp;<img src='/jsoa/images/menu/add.gif' style=\"vertical-align:middle; font-weight:bold;\" width='17' height='17' align='absmiddle'/>&nbsp;&nbsp;<font face=宋体 color=black size=7>添加(A)</font></a></div>\r\n");
      out.write("\t\t <div id=\"noteDiv_del\" align=\"left\"   onmouseover=\"changeColor(this.id);\" onmouseout=\"recoverColor(this.id);\"  style=\"padding-top:5px;padding-bottom:5px;vertical-align:middle;font-style:inherit;cursor: pointer;\"><a  style=\"vertical-align:middle; font-weight:bold;text-decoration:none;\" onclick=\"modifyPopedom();\">&nbsp;<img src='/jsoa/images/menu/modify.gif' style=\"vertical-align:middle;font-weight:bold;\"  width='17' height='17' align='absmiddle'/>&nbsp;&nbsp;<font face=宋体 color=black size=7>修改(m)</font></a></div>\r\n\t\t <div id=\"noteDiv_mod\" align=\"left\"   onmouseover=\"changeColor(this.id);\" onmouseout=\"recoverColor(this.id);\"  style=\"padding-top:5px;padding-bottom:5px;vertical-align:middle;font-style:inherit;cursor: pointer;\"><a  style=\"vertical-align:middle; font-weight:bold;text-decoration:none;\"  onclick=\"deleteNode();\">&nbsp;<img src='/jsoa/images/menu/delete.small.gif' style=\"vertical-align:middle;font-weight:bold;\" width='17' height='17' align='absmiddle'/>&nbsp;&nbsp;<font face=宋体 color=black size=7>删除(d)</font></a></div>\r\n");
      out.write("\t\t</div>\r\n   </td>\r\n  </tr>\r\n  <tr>\r\n    <td>&nbsp;</td>\r\n    <td>&nbsp;</td>\r\n </tr>\r\n  <tr align=\"center\">\r\n    <td colspan=\"2\" valign='bottom'>\r\n    ");
if("1".equals(modiflow) || "0".equals(bodyId)){
      out.write("\r\n\t<input  style=\"WIDTH:70 \"name=\"setbutton1\" type=\"button\" value=\"确认\"  onClick='setFlowNode();parent.close();'>\r\n\t");
}else{
      out.write("\r\n\t<input  style=\"WIDTH:70 \"name=\"setbutton1\" type=\"button\" value=\"确认\"  onClick='setFlowNode();parent.close();'>\r\n\t");
} 
      out.write("\r\n\t</td>\r\n  </tr>\r\n  <tr style=\"display:none\">\r\n     <td>&nbsp;\r\n       <input type=\"hidden\" name=\"tempSelectedId\" id=\"tempSelectedId\">\r\n       <input type=\"hidden\" name=\"tempSelectedName\" id=\"tempSelectedName\">\r\n       <input type=\"hidden\" name=\"selPeoples\" id=\"selPeoples\" >\r\n       <input type=\"hidden\" name=\"_coop_select\" id=\"_coop_select\" value=\"1\">\r\n     <br><br></td>\r\n  </tr>\r\n  <tr style=\"display:none\">\r\n       <td>\r\n       <input type=\"hidden\" name=\"addDivContent\" id=\"addDivContent\" value=\"\"> <!-- 在  常用语中用到-->\r\n       </td>\r\n    </tr>\r\n</table>\r\n\r\n</body>\r\n</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
