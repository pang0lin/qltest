/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 09:48:27 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.routine.boardroom;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.text.SimpleDateFormat;
import java.util.*;

public final class boardRoomApply_005ffinish_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(6);
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-nested.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-tiles.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-logic.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-html.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-template.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-bean.tld", Long.valueOf(1499751390000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("java.util");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("java.text.SimpleDateFormat");
  }

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fhtml_005fhtml;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fhtml_005fhtml = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fhtml_005fhtml.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<script language=\"javascript\">\r\n");

if("exit".equals(request.getAttribute("saveType"))){

      out.write("\r\nwindow.close();\r\nopener.location.reload();\r\n");
}
      out.write("\r\n</script>\r\n");

response.setHeader("Cache-Control","no-store");
response.setHeader("Pragma","no-cache");
response.setDateHeader ("Expires", 0);

String userId = session.getAttribute("userId").toString();
String userName = session.getAttribute("userName").toString();

String boardroomApplyId = request.getParameter("boardroomApplyId");
String meetingId = request.getParameter("meetingId");
String name = request.getParameter("name");
String meetingDate = request.getParameter("meetingDate");
String[] destineDtate1 = new String[3];
//destineDtate1 = meetingDate==null?null:meetingDate.split("-");
if(meetingDate == null){
}else{
	destineDtate1=meetingDate.split("-");
}
String startTime = request.getParameter("startTime");
String endTime = request.getParameter("endTime");
Long boardroomId = Long.parseLong(request.getParameter("boardroomId"));
int emproomtype=Integer.parseInt(request.getParameter("emproomtype"));
String formaction = "/jsoa/BoardRoomAction.do?action=finishMeeting&saveType=exit&emproomtype="+emproomtype;

int endH = endTime!=null?Integer.parseInt(endTime.substring(0, endTime.indexOf(":"))):0;
int endM = endTime!=null?Integer.parseInt(endTime.substring(endTime.indexOf(":")+1)):0;

Long beginDate = request.getParameter("beginDateL")==null?0L:Long.valueOf(request.getParameter("beginDateL"));
Long endDate = request.getParameter("endDateL")==null?0L:Long.valueOf(request.getParameter("endDateL"));
SimpleDateFormat ymdFormat = new SimpleDateFormat("yyyy/MM/dd");
String endDateStr = ymdFormat.format(new Date(endDate));
try{

      out.write('\r');
      out.write('\n');
      //  html:html
      org.apache.struts.taglib.html.HtmlTag _jspx_th_html_005fhtml_005f0 = (org.apache.struts.taglib.html.HtmlTag) _005fjspx_005ftagPool_005fhtml_005fhtml.get(org.apache.struts.taglib.html.HtmlTag.class);
      boolean _jspx_th_html_005fhtml_005f0_reused = false;
      try {
        _jspx_th_html_005fhtml_005f0.setPageContext(_jspx_page_context);
        _jspx_th_html_005fhtml_005f0.setParent(null);
        int _jspx_eval_html_005fhtml_005f0 = _jspx_th_html_005fhtml_005f0.doStartTag();
        if (_jspx_eval_html_005fhtml_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
          do {
            out.write("\r\n<head>\r\n<title>结束会议时间</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=GBK\">\r\n<link href=\"/jsoa/skin/");
            out.print(session.getAttribute("skin"));
            out.write("/style-");
            out.print(session.getAttribute("browserVersion"));
            out.write(".css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link rel=stylesheet type=\"text/css\" href=\"/jsoa/style/cssmain.css\">\r\n<link rel=stylesheet type=\"text/css\" href=\"/jsoa/public/date_picker/DateObject1.css\">\r\n<SCRIPT language=javascript src=\"/jsoa/public/date_picker/DateObject.js\"></SCRIPT>\r\n<SCRIPT language=javascript src=\"/jsoa/public/date_picker/DatePicker.js\"></SCRIPT>\r\n<SCRIPT language=javascript src=\"/jsoa/public/date_picker/editlib.js\"></SCRIPT>\r\n<SCRIPT language=javascript src=\"/jsoa/public/date_picker/tree.js\"></SCRIPT>\r\n<script src=\"/jsoa/js/js.js\" language=\"javascript\"></script>\r\n<SCRIPT language=\"javascript\" src=\"/jsoa/js/checkForm.js\"></SCRIPT>\r\n<SCRIPT language=javascript src=\"/jsoa/js/openEndow.js\"></SCRIPT>\r\n<script language=javascript src=\"/jsoa/js/util.js\"></script>\r\n<script language=javascript src=\"/jsoa/js/imenu.js\"></script>\r\n</head>\r\n\r\n<body leftmargin=\"0\" topmargin=\"0\" onload=\"resizeWin(450,250);\"  class=\"MainFrameBox Pupwin\">\r\n\r\n<table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanel\">\r\n");
            out.write("\t<tr>\r\n\t\t<td valign=\"top\">\r\n\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"2\" cellspacing=\"1\">\r\n\t\t\t\t<form name=\"form1\" action=\"");
            out.print(formaction );
            out.write("\" method=\"post\">\r\n\t\t\t\t<input type=\"hidden\" name=\"boardroomApplyId\" value=\"");
            out.print(boardroomApplyId);
            out.write("\">\r\n\t\t\t\t<input type=\"hidden\" name=\"meetingId\" id=\"meetingId\" value=\"");
            out.print(meetingId);
            out.write("\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td width=\"12%\" nowrap>会议名称：</td>\r\n\t\t\t\t\t<td colspan=\"3\" style=\"word-break:break-all\">");
            out.print(name);
            out.write("</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td nowrap>会议时间：</td>\r\n\t\t\t\t\t<div style=\"display:none\">\r\n\t\t\t\t\t<script language=javascript>\r\n\t\t\t\t\t\tvar dtpDate = createDatePicker(\"destineDate\",");
            out.print(destineDtate1[0]);
            out.write(',');
            out.print(destineDtate1[1] );
            out.write(',');
            out.print(destineDtate1[2] );
            out.write(");\r\n\t\t\t\t\t</script>\r\n\t\t\t\t\t<input type=\"hidden\" name=\"beginTime\" value=\"");
            out.print(endTime );
            out.write("\">\r\n\t\t\t\t\t<input type=\"hidden\" name=\"boardroomId\" value=\"");
            out.print(boardroomId);
            out.write("\">\r\n\t\t\t\t\t<input type=\"hidden\" name=\"destineDateBeginTime\" value=\"0\">\r\n\t\t\t\t\t<input type=\"hidden\" name=\"destineDateEndTime\" value=\"0\">\r\n\t\t\t\t\t<input type=\"hidden\" name=\"endDate\" id=\"endDate\" value=\"");
            out.print(endDateStr );
            out.write("\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<td colspan=\"3\">\r\n\t\t\t\t\t");
if(beginDate/(1000*3600*24)==endDate/(1000*3600*24)){
            out.write("\r\n\t\t\t\t\t\t");
            out.print(meetingDate);
            out.write("&nbsp;");
            out.print(startTime);
            out.write(' ');
            out.write('-');
            out.write(' ');
            out.print(endTime);
            out.write("\r\n\t\t\t\t\t");
}else{ 
						SimpleDateFormat dFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm");
            out.write("\r\n\t\t\t\t\t\t");
            out.print(dFormat.format(new Date(beginDate)) );
            out.write(' ');
            out.write('-');
            out.write(' ');
            out.print(dFormat.format(new Date(endDate)) );
            out.write("\r\n\t\t\t\t\t");
} 
            out.write("\t\t\t\t\t\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td nowrap>结束时间：</td>\r\n\t\t\t\t\t<td colspan=\"3\">\r\n\t\t\t\t\t\t<select name=\"endHour\" id=\"endHour\" style=\"font-size:9pt\">\r\n\t\t\t\t\t\t");
for(int hi=0;hi<24;hi++) {
							String selected = hi==endH ? "selected":"";
            out.write("\r\n\t\t\t\t\t\t\t<option value=\"");
            out.print(String.valueOf(hi));
            out.write('"');
            out.write(' ');
            out.print(selected);
            out.write('>');
            out.print(String.valueOf(hi));
            out.write("</option>\r\n\t\t\t\t\t\t");
}
            out.write("\r\n\t\t\t\t\t\t</select>&nbsp;时&nbsp;<select name=\"endMinutes\" id=\"endMinutes\" style=\"font-size:9pt\">\r\n\t\t\t\t\t\t");
for(int mi=0;mi<60;mi=mi+5) {
							String selected = mi==endM ? "selected":"";
            out.write("\r\n\t\t\t\t\t\t\t<option value=\"");
            out.print(String.valueOf(mi));
            out.write('"');
            out.write(' ');
            out.print(selected);
            out.write('>');
            out.print(String.valueOf(mi));
            out.write("</option>\r\n\t\t\t\t\t\t");
}
            out.write("\r\n\t\t\t\t\t\t</select>&nbsp;分\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t</form>\r\n\t\t\t</table>\r\n\t\t</td>\r\n\t</tr>\r\n\t<tr>\r\n\t\t<td colspan=\"2\">\r\n\t\t\t<input type=\"button\" class=\"btnButton4font\" style=\"cursor:pointer\" onclick=\"saveAndExit()\" value=\"保存退出\" />\r\n\t\t\t<input type=\"button\" class=\"btnButton2font\" style=\"cursor:pointer\" onclick=\"javascript:resetMe()\" value=\"重置\" />\r\n\t\t\t<input type=\"button\" class=\"btnButton2font\" style=\"cursor:pointer\" onclick=\"javascript:window.close();\" value=\"退出\" />\r\n\t\t</td>\r\n\t</tr>\r\n\r\n</table>\r\n\r\n</body>\r\n");
            int evalDoAfterBody = _jspx_th_html_005fhtml_005f0.doAfterBody();
            if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
              break;
          } while (true);
        }
        if (_jspx_th_html_005fhtml_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
          return;
        }
        _005fjspx_005ftagPool_005fhtml_005fhtml.reuse(_jspx_th_html_005fhtml_005f0);
        _jspx_th_html_005fhtml_005f0_reused = true;
      } finally {
        org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_html_005fhtml_005f0, _jsp_getInstanceManager(), _jspx_th_html_005fhtml_005f0_reused);
      }
      out.write('\r');
      out.write('\n');
}catch(Throwable e){e.printStackTrace();}
      out.write("\r\n<script language=\"JavaScript\">\r\nfunction init(){\r\n}\r\nfunction resetMe(){\r\n\tdocument.form1.reset();\r\n}\r\nfunction saveAndExit(){\r\n\t\r\n\tvar endMinutes = parseInt(document.getElementById(\"endMinutes\").value)\r\n\tvar endHour = parseInt(document.getElementById(\"endHour\").value)\r\n\tvar shouldendHour = ");
      out.print(endH);
      out.write(";\r\n\tvar shouldendMinutes = ");
      out.print(endM);
      out.write(";\r\n\tvar emproomtype = ");
      out.print(emproomtype );
      out.write("\r\n\tvar shouldend = shouldendHour*3600+shouldendMinutes*60;\r\n\tvar end = endHour*3600+endMinutes*60;\t\r\n\tvar endDate = document.getElementById(\"endDate\").value;\r\n\t\r\n\tvar http_request = false;\r\n    /*开始初始化XMLHttpRequest对象*/\r\n\tif(window.XMLHttpRequest) { /*Mozilla 浏览器*/\r\n\t\thttp_request = new XMLHttpRequest();\r\n\t\tif (http_request.overrideMimeType) {/*设置MiME类别*/\r\n\t\t\thttp_request.overrideMimeType('text/xml');\r\n\t\t}\r\n\t} else if (window.ActiveXObject) { /* IE浏览器*/\r\n\t\ttry {\r\n\t\t\thttp_request = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n\t\t} catch (e) {\r\n\t\t\ttry {\r\n\t\t\t\thttp_request = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t\t} catch (e) {}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tvar meetingId = document.getElementById(\"meetingId\").value; \r\n\tif(shouldend<end){\r\n\t\tdocument.form1.destineDateBeginTime.value = shouldend;\r\n\t\tdocument.form1.destineDateEndTime.value = end;\r\n\t\t\r\n\t\tvar destineDate = document.form1.destineDate.value;\r\n\t\tvar boardroomId = document.form1.boardroomId.value;\r\n\t\tvar beginTime = document.form1.destineDateBeginTime.value;\r\n\t\tvar endTime = document.form1.destineDateEndTime.value;\r\n");
      out.write("\t\tvar boardroomApplyId = document.form1.boardroomApplyId.value;\r\n\t\t\r\n\t\t//alert(destineDate+\" \"+beginTime+\" \"+endTime+\" \"+boardroomId);\r\n\t\t\r\n\t\tvar xmlhttprequest = http_request;\r\n\t\tif (!http_request) { /* 异常，创建对象实例失败*/\r\n\t\t\twindow.alert(\"不能创建XMLHttpRequest对象实例.\");\r\n\t\t\treturn;\r\n\t\t}else{\r\n\t\t\tvar url = \"/jsoa/routine/boardroom/selectImpropriateTime.jsp?meetingId=\"+meetingId+\"&destineDate=\" + destineDate + \"&destineDateBeginTime=\" \r\n\t\t\t\t\t+ beginTime+\"&destineDateEndTime=\"+endTime+\"&boardroomId=\"+boardroomId+\"&boardroomApplyId=\"+boardroomApplyId+\"&endDate=\"+endDate ;\r\n\t        /* 确定发送请求的方式和URL以及是否同步执行下段代码*/;\r\n\t        http_request.open(\"GET\", url, false);/*此处需同步执行*/\r\n\t        http_request.send(null);\r\n\t\t}\r\n\t\tif (http_request.readyState == 4) { /* 判断对象状态*/\r\n\t\t\t/*readyState的状态值 \r\n\t\t\t0 (未初始化) 对象已建立，但是尚未初始化（尚未调用open方法）  \r\n\t\t\t1 (初始化) 对象已建立，尚未调用send方法  \r\n\t\t\t2 (发送数据) send方法已调用，但是当前的状态及http头未知  \r\n\t\t\t3 (数据传送中) 已接收部分数据，因为响应及http头不全，这时通过responseBody和responseText获取部分数据会出现错误，  \r\n\t\t\t4 (完成) 数据接收完毕,此时可以通过通过responseBody和responseText获取完整的回应数据 \r\n");
      out.write("\t\t\t*/\t\t\r\n\t\t\tif (http_request.status == 200) { /*信息已经成功返回，开始处理信息*/\r\n\t\t\t\tvar result = http_request.responseText;\r\n\t\t\t\tif(result == -1){\r\n\t\t\t\t\talert(\"此时间段已定出，会议不能推迟到此时间。\");\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(0==emproomtype){\r\n\t\t\t\t\t\tvar path = \"/jsoa/routine/boardroom/selectImpropriateTime.jsp?meetingId=\"+meetingId+\"&destineDateEndTime=\"+endTime ;\t\t\r\n\t\t\t\t\t\txmlhttprequest.open(\"GET\", path, false);\t\r\n\t\t        \t\txmlhttprequest.send(null);\r\n\t\t        \t\tif(xmlhttprequest.readyState == 4){\r\n\t\t        \t\t\tif (xmlhttprequest.status == 200){\r\n\t\t        \t\t\tvar result2 = xmlhttprequest.responseText;\r\n\t\t        \t\t\tif(result2 == 0){\r\n\t\t        \t\t\t\talert(\"新的结束时间已申请。\");\r\n\t\t        \t\t\t\t//opener.location.href=\"/jsoa/BoardRoomAction.do?action=useBoardroomView\";\r\n\t\t        \t\t\t\topener.location.reload();\r\n\t\t        \t\t\t\twindow.close(); \r\n\t\t        \t\t\t\t}else{\r\n\t\t        \t\t\t\t\talert(\"新结束时间申请失败。\");\r\n\t\t        \t\t\t\t}\r\n\t\t        \t\t\t}\r\n\t\t        \t\t}else{\r\n\t\t        \t\t\talert(\"新结束时间未申请成功。\");\r\n\t\t        \t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\talert(\"您不是会议管理员，没有修改权限。\");\r\n");
      out.write("\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else { /*页面不正常*/\r\n\t\t\t\talert(\"您所请求的页面有异常。\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t}\r\n\t}else{\r\n\t\tvar boardroomApplyId = document.form1.boardroomApplyId.value;\r\n\t\tvar endTime = end;\r\n\t\tif (!http_request) { /* 异常，创建对象实例失败*/\r\n\t\t\twindow.alert(\"不能创建XMLHttpRequest对象实例.\");\r\n\t\t\treturn;\r\n\t\t}else{\r\n\t\t\tvar path = \"/jsoa/routine/boardroom/selectImpropriateTime.jsp?meetingId=\"+meetingId+\"&destineDateEndTime=\"+endTime ;\t\t\r\n\t\t\thttp_request.open(\"GET\", path, false);\t\r\n        \thttp_request.send(null);\r\n        \tif(http_request.readyState == 4){\r\n\t        \tif (http_request.status == 200){\r\n\t        \t\tvar result2 = http_request.responseText;\r\n\t        \t\tif(result2 == 0){\r\n\t        \t\t\talert(\"会议结束。\");\r\n\t        \t\t\tdocument.form1.submit();\r\n\t        \t\t}\r\n\t        \t}\r\n\t        }\r\n\t\t}\r\n\t}\r\n}\r\n\r\n</script>\r\n<script src=\"/jsoa/js/util.js\"></script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
