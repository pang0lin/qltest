/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 10:08:37 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.iWebOfficeSign;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.net.URLEncoder;
import com.js.util.util.CharacterTool;
import java.io.*;
import java.text.*;
import java.util.*;
import java.sql.*;
import java.text.SimpleDateFormat;
import java.text.DateFormat;
import java.util.Date;
import javax.servlet.*;
import javax.servlet.http.*;
import DBstep.iDBManager2000.*;
import com.js.util.util.BrowserJudge;
import com.js.util.config.SystemCommon;

public final class DocumentEdit_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {


  /**
   * 功能或作用：格式化日期时间
   * @param DateValue 输入日期或时间
   * @param DateType 格式化 EEEE是星期, yyyy是年, MM是月, dd是日, HH是小时, mm是分钟,  ss是秒
   * @return 输出字符串
   */
  public String FormatDate(String DateValue,String DateType)
  {
    String Result;
    SimpleDateFormat formatter = new SimpleDateFormat(DateType);
    try{
      Date mDateTime = formatter.parse(DateValue);
      Result = formatter.format(mDateTime);
    }catch(Exception ex){
      Result = ex.getMessage();
    }
    if (Result.equalsIgnoreCase("1900-01-01")){
      Result = "";
    }
    return Result;
  }

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("java.sql");
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("java.text");
    _jspx_imports_packages.add("java.util");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("java.io");
    _jspx_imports_packages.add("DBstep.iDBManager2000");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.util.util.CharacterTool");
    _jspx_imports_classes.add("java.net.URLEncoder");
    _jspx_imports_classes.add("java.util.Date");
    _jspx_imports_classes.add("com.js.util.config.SystemCommon");
    _jspx_imports_classes.add("java.text.SimpleDateFormat");
    _jspx_imports_classes.add("com.js.util.util.BrowserJudge");
    _jspx_imports_classes.add("java.text.DateFormat");
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n\r\n\r\n");
      out.write("\r\n\r\n");


//
if(SystemCommon.getiWebOfficeVersion().equals("2015")) {
	StringBuffer url = new StringBuffer("/jsoa/iWebOffice2015/DocumentEdit.jsp?1=1");
	Map<String, String[]> map = request.getParameterMap();  
	for(Map.Entry<String, String[]> entry:map.entrySet()){
		String key = entry.getKey();
		String []values = entry.getValue();
		for(int i = 0;i<values.length;i++){
			url.append("&"+key+"="+URLEncoder.encode(values[i]));
		}
	}
	response.sendRedirect(url.toString());
}


request.setCharacterEncoding("GBK");
response.setHeader("Cache-Control","no-store");
response.setHeader("Pragma","no-cache");
response.setDateHeader ("Expires", 0);

  ResultSet result=null;
  String mSubject=null;
  String mStatus=null;
  String mAuthor=null;
  String mFileName=null;
  String mFileDate=null;
  String mHTMLPath="";

  String mDisabled="";
  String mWord="";
  String mExcel="";

   String mUpdateSign="0";// 记录现在的状态 。是否有人正在打开 查看！ 0 ：没人  1： 有人。
  String mUpdateEidit="1"; // 1 表 有权 修改 ，
  String haveDocument="0"; //0: 没有！1


  //自动获取OfficeServer和OCX文件完整URL路径
  String mHttpUrlName=request.getRequestURI();
  String mScriptName=request.getServletPath();
  String mServerName="iWebOfficeSign/OfficeServer.jsp";
  String mClientName="iWebOfficeSign/iWebOffice2003.ocx#version=8,2,4,0";
  String objClassId="23739A7E-5741-4D1C-88D5-D50B18F7C347";
  
  if("2009".equals(SystemCommon.getiWebOfficeVersion())){
	  mClientName="iWebOfficeSign/iWebOffice2009.cab#version=10,8,6,2";
	  objClassId="8B23EA28-2009-402F-92C4-59BE0E063499";
  }
  
  String appScheme=request.getScheme();

  String mServerUrl=appScheme+"://"+request.getServerName()+":"+request.getServerPort()+mHttpUrlName.substring(0,mHttpUrlName.lastIndexOf(mScriptName))+"/"+mServerName;//取得OfficeServer文件的完整URL
  String mClientUrl=appScheme+"://"+request.getServerName()+":"+request.getServerPort()+mHttpUrlName.substring(0,mHttpUrlName.lastIndexOf(mScriptName))+"/"+mClientName;//取得OCX下载的完整URL
  String mHttpUrl=appScheme+"://"+request.getServerName()+":"+request.getServerPort()+mHttpUrlName.substring(0,mHttpUrlName.lastIndexOf(mScriptName))+"/";

  String mRecordID=request.getParameter("RecordID");
  String mTemplate=request.getParameter("Template");
  String nowTemplate=mTemplate;// 下面 还会取摸板，此时 取的值 ，如果record 有值 会把 mTemplate 盖掉！
  String mFileType=request.getParameter("FileType");
  String mEditType=request.getParameter("EditType");
  String mUserName=request.getParameter("UserName");
  if(0==SystemCommon.getOffice()){//如果 办公软件 使用的是wps
	  if(".doc".equals(mFileType)){
		  mFileType=".wps";
	  }else{
		  mFileType=".et";
	  }
  	  
	  
  }
 

  // 判断模块类型(知识管理,公文)
  //String moduleType=request.getParameter("moduleType")==null?"default":request.getParameter("moduleType");
  String moduleType=request.getParameter("moduleType")==null?"information":request.getParameter("moduleType");
  String isSaveHtml=request.getParameter("saveHtml")==null?"0":request.getParameter("saveHtml");//是否生成HTML文件
  String isSaveHtmlImage=request.getParameter("saveHtmlImage")==null?"0":request.getParameter("saveHtmlImage");//是否生成HTML图片文件
  //String isSaveDocFile=request.getParameter("saveDocFile")==null?"0":request.getParameter("saveDocFile");//是否生成DOC文件
  
  //手机版是直接指向文件的，所以都生成磁盘文档保存
  String isSaveDocFile="1";//request.getParameter("saveDocFile")==null?"0":request.getParameter("saveDocFile");//是否生成DOC文件
  String isLoadTemp=request.getParameter("loadTemp")==null?"0":request.getParameter("loadTemp");//是否套用模板

  // 是否显示红头和签章
  String showTempSign = request.getParameter("showTempSign")==null?"0":request.getParameter("showTempSign");//签章
  String showTempHead=request.getParameter("showTempHead")==null?"0":request.getParameter("showTempHead");//红头
  String showSignButton=request.getParameter("showSignButton")==null?"0":request.getParameter("showSignButton");//显示痕迹按钮
  String showEditButton=request.getParameter("showEditButton")==null?"0":request.getParameter("showEditButton");//显示编辑按钮
  String showCoverPrint=request.getParameter("showCoverPrint")==null?"1":request.getParameter("showCoverPrint");//显示套打按钮
  String showTransPDF=request.getParameter("showTransPDF")==null?"0":request.getParameter("showTransPDF");//显示转PDF按钮

  String openWordType=request.getParameter("openWordType")==null?"0":request.getParameter("openWordType");//1:起草正文 2：批阅正文 3：生成正式文件  0：查看正文

	String isFirstIn="-1";// 默认不是第一次进; 当为是第一次进时， isFirstIn:1
	String isPrintButton=request.getParameter("printButton")==null?"0":request.getParameter("printButton");// 是否 打印按扭



 String isReTem="0";//是否 重新加 模板  0不需要 ，1：需要

  //取得编号
  if ( mRecordID==null)
  {
     mRecordID="";	//编号为空
  }

  //第一次， id 为空
  if(mRecordID==null||mRecordID.equals("")||mRecordID.equals("null")){
  isFirstIn="1";
  }

  //取得模式
  if ( mEditType==null)
  {
    mEditType="1,1";		// 0 显示  1 起草 2 批改 3 审核
  }
  //取得类型
  if ( mFileType==null)
  {
    mFileType=".doc";	// 默认为.doc文档
  }
  //取得用户名
  if (mUserName==null)
  {
    mUserName="金格科技";
  }

  //取得模板
  if ( mTemplate==null)
  {
    mTemplate="";	// 默认没有模板
  }

  //打开数据库
  DBstep.iDBManager2000 DbaObj=new DBstep.iDBManager2000();
  //DbaObj.OpenConnection();

  if ( DbaObj.OpenConnection())
  {
    String mSql="Select * From Document Where RecordID='"+ mRecordID + "'";
    try
    {
      result=DbaObj.ExecuteQuery(mSql);
      if (result.next())
      {
        mRecordID=result.getString("RecordID");
        mTemplate=result.getString("Template");
        mSubject=result.getString("Subject");
        mAuthor=result.getString("Author");
        mFileDate=result.getString("FileDate");
        mStatus=result.getString("Status");
        mFileType=result.getString("FileType");
        mHTMLPath=result.getString("HTMLPath");

		
		mUpdateSign=result.getString("updateSign");
		haveDocument="1";

	

      }
      else
      {
	//取得唯一值(mRecordID)
        java.util.Date dt=new java.util.Date();
        long lg=dt.getTime();
        Long ld=new Long(lg);
	//初始化值
        mRecordID=ld.toString();//保存的是文档的编号，通过该编号，可以在里找到所有属于这条纪录的文档
        mTemplate=mTemplate;
        mSubject="请输入主题";
        mAuthor=mUserName;
        mFileDate=DbaObj.GetDateTime();
        mStatus="DERF";
        mFileType=mFileType;
        mHTMLPath="";
      }
      result.close();
    }
    catch(SQLException e)
    {
      System.out.println(e.toString());
    }
    DbaObj.CloseConnection() ;
  }

 
 	//如果现在 套进 摸板id  ,而原来的正文摸板
		if(nowTemplate!=null&&!nowTemplate.equals("")&&!nowTemplate.equals("null")){ 

		if(mTemplate==null||mTemplate.equals("")||mTemplate.equals("null")){
		mTemplate=nowTemplate;	
		isReTem="1";
		}else{
		 if(!nowTemplate.equals(mTemplate)){
		  mTemplate=nowTemplate;	
		  isReTem="1";
		 }	
		}
		}


  if ( mEditType.compareTo("0,0")==0)
  {
     mDisabled="disabled";
  }
  else
  {
     mDisabled="";
  }
  if("1".equals(request.getParameter("viewDocHistorySecond"))){
	  mRecordID=mRecordID+"_2";
  }
  mFileName=mRecordID + mFileType;  //取得完整的文档名称
  if (mFileType.compareTo(".doc")==0){
     mWord="";
     mExcel="disabled";
  }
  else
  {
     mWord="disabled";
     mExcel="";
  }

if("0".equals(request.getParameter("CanSave"))){
   mEditType="0";
}
if("1".equals(mEditType)){
	   mEditType="-1,0,1,1,1,1,1";
	}

      out.write("\r\n<html>\r\n<head>\r\n<title>编辑正文</title>\r\n<link rel='stylesheet' type='text/css' href='test.css'>\r\n<link href=\"/jsoa/skin/");
      out.print(session.getAttribute("skin"));
      out.write("/style-");
      out.print(session.getAttribute("browserVersion"));
      out.write(".css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
if(!BrowserJudge.isIE(request) && !BrowserJudge.isMSIE11(request)){//if(!BrowserJudge.isMSIE(request)){ 
      out.write("\r\n<script type=\"text/javascript\">\r\nalert(\"此插件不支持");
      out.print(BrowserJudge.Browser(session) );
      out.write("!\\n如果要查看相关内容请使用IE浏览器\");\r\n//window.close();\r\n</script>\r\n");
} 
      out.write("\r\n<script language=\"javascript\" for=WebOffice event=\"OnMenuClick(vIndex,vCaption)\">\r\n\t//作用：套用模版定稿\r\nfunction WebInsertFile(){\r\n  var mDialogUrl = \"Template/TemplateForm.jsp\";\r\n  var mObject = {};\r\n  mObject.Template = \"\";\r\n  window.showModalDialog(mDialogUrl, mObject, \"dialogHeight:200px; dialogWidth:360px;center:yes;scroll:no;status:no;\");\r\n\r\n  //判断用户是否选择模板\r\n  if (mObject.Template==\"\"){\r\n    StatusMsg(\"取消套用模\");\r\n    return false;\r\n  }else{\r\n    SaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');    //保存当前编辑的文档\r\n    webform.WebOffice.WebSetMsgByName(\"COMMAND\",\"INSERTFILE\");   //设置变量COMMAND=\"INSERTFILE\"，在WebLoadTemplate()时，一起提交到OfficeServer中     <参考技术文档>\r\n    webform.WebOffice.Template=mObject.Template;       \t//全局变量Template赋值，此示例读取服务器目录中模板，如读取数据库中模板，Template值为数据库中的模板编号，则上句代码不需要，如Template=\"1050560363767\"，模板名称为“Word公文模板”，注：模板中有要标签Content，区分大小写，可以自行修改\r\n    if (webform.WebOffice.WebLoadTemplate()){                    //交互OfficeServer的OPTION=\"LOADTEMPLATE\"\r\n       //SetBookmarks(\"Title\",\"关于中间件研发工作会议通知\");     //填充模板其它基本信息，如标题，主题词，文号，主送机关等\r\n       if (webform.WebOffice.WebInsertFile()){                   //填充公文正文   交互OfficeServer的OPTION=\"INSERTFILE\"\r\n         StatusMsg(webform.WebOffice.Status);\r\n       }else{\r\n         StatusMsg(webform.WebOffice.Status);\r\n       }\r\n    }else{\r\n       StatusMsg(webform.WebOffice.Status);\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\n   if (vIndex==1){  //打开本地文件\r\n      WebOpenLocal();\r\n   }\r\n   if (vIndex==2){  //保存本地文件\r\n      ");
if("1".equals(SystemCommon.getWorkflowWordisLock())){
      out.write("\r\n        webform.WebOffice.WebSetProtect(false,\"\");  //\"\"表示密码为空,把文档设置为解锁\r\n      ");
}
      out.write("\r\n      ");
if("1".equals(SystemCommon.getWorkflowWordisWuhen())){
      out.write("\r\n         webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions(); \r\n      ");
}
      out.write("\r\n      WebSaveLocal();\r\n   }\r\n   if (vIndex==3){  //保存到服务器上\r\n   ");
if("1".equals(request.getParameter("CanSave"))){
      out.write("\r\n      SaveDocument();    //保存正文\r\n   ");
}
      out.write("\r\n   }\r\n   if (vIndex==5){  //签名印章\r\n      WebOpenSignature();\r\n   }\r\n   if (vIndex==6){  //验证签章\r\n      WebShowSignature();\r\n   }\r\n   if (vIndex==8){  //保存版本\r\n      WebSaveVersion();\r\n   }\r\n   if (vIndex==9){  //打开版本\r\n      WebOpenVersion();\r\n   }\r\n   if (vIndex==11){  //测试菜单一\r\n     alert('菜单编号:'+vIndex+'\\n\\r'+'菜单条目:'+vCaption+'\\n\\r'+'请根据这些信息编写菜单具体功能');\r\n   }\r\n   if (vIndex==12){  //测试菜单二\r\n     alert('菜单编号:'+vIndex+'\\n\\r'+'菜单条目:'+vCaption+'\\n\\r'+'请根据这些信息编写菜单具体功能');\r\n   }\r\n   if (vIndex==14){  //保存并退出\r\n     SaveDocument();    //保存正文\r\n     webform.submit();\r\n   }\r\n   if (vIndex==16){  //打印文档\r\n      WebOpenPrint();\r\n   }\r\n   if (vIndex==17){  //套用模版\r\n       WebInsertFile();\r\n   }\r\n   if (vIndex==18){  //填充模板\r\n       LoadBookmarks();\r\n   }\r\n   //if (vIndex==17){  //显示痕迹\r\n   //    ShowRevision(true);\r\n   //}\r\n   //if (vIndex==18){  //隐藏痕迹\r\n   //    ShowRevision(false);\r\n   //}\r\n   if(vIndex==19){  //获取痕迹\r\n       WebGetRevisions();\r\n   }\r\n   if(vIndex==20){  //解除锁定\r\n       WebProtect(false);\r\n   }\r\n\r\n</script>\r\n\r\n<script language=javascript>\r\n");
      out.write("/*\r\nform表单名称:webform\r\niWebOffice名称:WebOffice\r\nWebObject文档对象接口，相当于：\r\n如果是Word  文件，WebObject 是Word  VBA的ActiveDocument对象\r\n如果是Excel 文件，WebObject 是Excel VBA的ActiveSheet对象\r\n\r\n如：webform.WebOffice.WebObject\r\n*/\r\n\r\n\r\n//作用：显示操作状态\r\nfunction StatusMsg(mString){\r\n  StatusBar.innerText=mString;\r\n}\r\n\r\n//加模板\r\nfunction addTemplate(){\r\n\r\n    //SaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');    //保存当前编辑的文档\r\n    webform.WebOffice.WebSetMsgByName(\"COMMAND\",\"INSERTFILE\");   //设置变量COMMAND=\"INSERTFILE\"，在WebLoadTemplate()时，一起提交到OfficeServer中     <参考技术文档>\r\n    webform.WebOffice.Template=\"");
      out.print(mTemplate);
      out.write("\";    \t//全局变量Template赋值，此示例读取服务器目录中模板，如读取数据库中模板，Template值为数据库中的模板编号，则上句代码不需要，如Template=\"1050560363767\"，模板名称为“Word公文模板”，注：模板中有要标签Content，区分大小写，可以自行修改\r\n    \r\n    if (webform.WebOffice.WebLoadTemplate()){                    //交互OfficeServer的OPTION=\"LOADTEMPLATE\"\r\n       \r\n       //SetBookmarks(\"Title\",\"关于中间件研发工作会议通知\");     //填充模板其它基本信息，如标题，主题词，文号，主送机关等\r\n       if (webform.WebOffice.WebInsertFile()){                   //填充公文正文   交互OfficeServer的OPTION=\"INSERTFILE\"\r\n         StatusMsg(webform.WebOffice.Status);\r\n       }else{\r\n         StatusMsg(webform.WebOffice.Status);\r\n       }\r\n    }else{   \r\n       StatusMsg(webform.WebOffice.Status);\r\n    }    \r\n}\r\n\r\n//作用：载入iWebOffice\r\nfunction Load(){\r\n\r\n  //以下属性必须设置，实始化iWebOffice\r\n  webform.WebOffice.WebUrl=\"");
      out.print(mServerUrl);
      out.write("\";    //WebUrl:系统服务器路径，与服务器文件交互操作，如保存、打开文档，重要文件\r\n  webform.WebOffice.RecordID=\"");
      out.print(mRecordID);
      out.write("\";   //RecordID:本文档记录编号\r\n  webform.WebOffice.Template=\"");
      out.print(mTemplate);
      out.write("\";   //Template:模板编号\r\n  webform.WebOffice.FileName=\"");
      out.print(mFileName);
      out.write("\";   //FileName:文档名称\r\n  webform.WebOffice.FileType=\"");
      out.print(mFileType);
      out.write("\";   //FileType:文档类型  .doc  .xls  .wps\r\n  webform.WebOffice.UserName=\"");
      out.print(mUserName);
      out.write("\";   //UserName:操作用户名，痕迹保留需要\r\n  \r\n  /**\r\n  EditType\r\n  调用格式：WebOffice.EditType=\"X\";\r\n  X的含义如下：\r\n  “0” 只读、且不能拷贝，\r\n  “1” 起草编辑[可写无痕迹保留]，\r\n  “2” 编辑[有痕迹保留，不可以修订]，\r\n  “3” 审核[有修订菜单]，\r\n  “4” 只读、可以复制文档内容。\r\n  \r\n  调用格式：WebOffice.EditType=\"A,B,C,D,E,F,G\";\r\n  他们的含义如下：\r\n  A  必须为“-1”\r\n  B  “1” 是否保护文档\t\t “0” 不保护文档， “1” 保护文档， “2” 特殊保护\r\n  C  “1” 是否显示痕迹\t\t “0” 不显示痕迹， “1” 显示痕迹\r\n  D  “1” 是否保留痕迹\t \t “0” 不保留痕迹， “1” 保留痕迹\r\n  E  “1” 是否打印痕迹\t \t “0” 不打印痕迹， “1” 打印痕迹\r\n  F  “1” 是否显示审阅工具  “0” 不显示工具， “1” 显示工具\r\n  G  “1” 是否允许拷贝操作  “0” 不允许拷贝， “1” 允许拷贝\r\n  如：需要不保护文档，有显示痕迹，有痕迹保留，不打印痕迹，不显示审阅工具，允许拷贝，允许手写批注操作，\r\n  就可以设置为 WebOffice.EditType=\"-1,0,1,1,0,0,0\";。\r\n  \r\n  **/\r\n  \r\n  ");
if("1".equals(request.getParameter("viewDocHistory"))){
	  showEditButton="1";	  
  
      out.write("  \r\n  webform.WebOffice.WebSetMsgByName(\"viewDocHistory\",\"1\");//是否打开留痕文件 从磁盘文件打开\r\n  webform.WebOffice.EditType=\"-1,1,1,1,1,1,0\";\r\n  ");
}else{
      out.write("\r\n  \t");
if(isFirstIn.equals("1")){
      out.write("\r\n  \t\twebform.WebOffice.EditType=\"1\";\r\n  \t");
}else{
      out.write("\r\n   \t\twebform.WebOffice.EditType=\"");
      out.print(mEditType);
      out.write("\";   //EditType:编辑类型  方式一、方式二  <参考技术文档>\r\n    ");
}
      out.write("\r\n  ");
}
      out.write("\r\n \r\n  \r\n  ");
if(!"1".equals(isPrintButton)){
      out.write("\r\n  webform.WebOffice.AppendMenu(\"1\",\"打开本地文件(&L)\");\r\n  webform.WebOffice.AppendMenu(\"2\",\"保存本地文件(&S)\");\r\n  //webform.WebOffice.AppendMenu(\"3\",\"保存远程文件(&U)\");\r\n  webform.WebOffice.AppendMenu(\"4\",\"-\");\r\n  webform.WebOffice.AppendMenu(\"5\",\"签名印章(&Q)\");\r\n  webform.WebOffice.AppendMenu(\"6\",\"验证签章(&Y)\");\r\n  webform.WebOffice.AppendMenu(\"7\",\"-\");\r\n  webform.WebOffice.AppendMenu(\"8\",\"保存版本(&B)\");\r\n  webform.WebOffice.AppendMenu(\"9\",\"打开版本(&D)\");\r\n  webform.WebOffice.AppendMenu(\"20\",\"解除锁定\");//解除锁定\r\n  webform.WebOffice.AppendMenu(\"10\",\"-\");\r\n  ");
}
      out.write("\r\n  \r\n  //webform.WebOffice.AppendMenu(\"11\",\"测试菜单一(&X)\");\r\n  //webform.WebOffice.AppendMenu(\"12\",\"测试菜单二(&Z)\");\r\n  //webform.WebOffice.AppendMenu(\"13\",\"-\");\r\n // webform.WebOffice.AppendMenu(\"14\",\"保存并退出(&E)\");\r\n  //webform.WebOffice.AppendMenu(\"15\",\"-\");\r\n  webform.WebOffice.AppendMenu(\"16\",\"打印文档(&P)\");\r\n  ");
if(!"1".equals(isPrintButton)){
      out.write("\r\n // webform.WebOffice.AppendMenu(\"17\",\"套用模版\");\r\n  //webform.WebOffice.AppendMenu(\"18\",\"填充模板\");\r\n  ");
}
      out.write("\r\n  ");
if(false){
      out.write("\r\n  webform.WebOffice.AppendMenu(\"19\",\"获取痕迹\");\r\n  ");
}
      out.write("\r\n  webform.WebOffice.DisableMenu(\"宏;选项;帮助\");  //禁止菜单\r\n\r\n\r\n\r\n\r\n\r\n  //增加按钮\r\n  //webform.WebOffice.AppendTools(\"100\",\"返回办公系统\",7);\r\n  ");
if("1".equals(showEditButton)){
      out.write("\r\n\r\n     //webform.WebOffice.AppendTools(\"102\",\"保存正文\",2);\r\n\r\n   ");
if(".doc".equals(mFileType)||".wps".equals(mFileType)){
      out.write("\r\n\t//webform.WebOffice.AppendTools(\"103\",\"显示/隐藏红头\",21);\r\n\t//webform.WebOffice.AppendTools(\"101\",\"引入文章\",16);\r\n   ");
}
      out.write("\r\n\r\n\r\n\r\n  ");
}
    
  if("1".equals(showSignButton)){
      out.write("\r\n\r\n    ");
if(".doc".equals(mFileType)||".wps".equals(mFileType)){
      out.write("\r\n      //webform.WebOffice.AppendTools(\"104\",\"显示/隐藏痕迹\",3);\r\n   ");
}
      out.write("\r\n\r\n ");
}
 
 
 if("1".equals(showCoverPrint)&&!"information".equals(moduleType)){
      out.write("\r\n  //webform.WebOffice.AppendTools(\"105\",\"套打\",4);\r\n  //webform.WebOffice.AppendTools(\"106\",\"正式打印\",5);\r\n  ");
}
      out.write("\r\n\r\n  //转pdf\r\n  ");
if("1".equals(showTransPDF)){
      out.write("\r\n  //webform.WebOffice.AppendTools(\"107\",\"转换PDF\",5);\r\n\r\n   ");
}else{
      out.write(" \r\n\t   \r\n    ");
if(".doc".equals(mFileType)||".wps".equals(mFileType)){
      out.write("\r\n\t//webform.WebOffice.AppendTools(\"101\",\"引入文章\",16);\r\n   ");
}
      out.write("\r\n\r\n  ");
}
      out.write("\r\n\r\n //webform.WebOffice.AppendTools(\"108\",\"导出TEXT\",5);\r\n \r\n ");

  if("1".equals(SystemCommon.getOfficeopen()) && "0".equals(mEditType)){
  
      out.write("\r\n   webform.WebOffice.DisableMenu(\"打开本地文件(&L)\");\r\n   webform.WebOffice.AppendMenu(\"2\",\"保存本地文件(&S)\");\r\n   webform.WebOffice.AppendMenu(\"4\",\"-\");\r\n   webform.WebOffice.DisableMenu(\"签名印章(&Q)\");\r\n   webform.WebOffice.DisableMenu(\"验证签章(&Y)\");\r\n   webform.WebOffice.AppendMenu(\"7\",\"-\");\r\n   webform.WebOffice.DisableMenu(\"保存版本(&B)\");\r\n   webform.WebOffice.DisableMenu(\"打开版本(&D)\");\r\n   webform.WebOffice.DisableMenu(\"解除锁定\");//解除锁定\r\n   webform.WebOffice.AppendMenu(\"10\",\"-\");\r\n   webform.WebOffice.DisableMenu(\"获取痕迹\");\r\n   ");
if(!"shandongguotou".equals(com.js.util.config.SystemCommon.getCustomerName())){
      out.write("\r\n   webform.WebOffice.DisableMenu(\"打印文档(&P)\");\r\n   ");
}
      out.write("\r\n   webform.WebOffice.DisableMenu(\"页面设置(&U)...\");\r\n  ");
}
      out.write("\r\n \r\n  ");
if("1".equals(showEditButton) || "1".equals(SystemCommon.getOfficeopen())){
      out.write("\r\n\t//webform.WebOffice.ShowMenu=\"1\";\r\n\t//WebToolsVisible('Standard',true);\r\n\t//WebToolsVisible('Formatting',true);\r\n\t webform.WebOffice.VisibleTools(\"新建文件;打开文件;保存文件;文字批注;手写批注;文档清稿;重新批注;全屏\",false); //隐藏“新建文件”等功能按钮\r\n\t//webform.WebOffice.ShowToolBar=\"0\"; //ShowToolBar:是否显示工具栏:1显示,0不显示\t\r\n  ");
} else{
      out.write("\r\n\twebform.WebOffice.ShowMenu=\"0\";\r\n\t//WebToolsVisible('Standard',false);\r\n\t//WebToolsVisible('Formatting',false);\r\n\t//webform.WebOffice.VisibleTools(\"新建文件;打开文件;保存文件;文字批注;手写批注;文档清稿;重新批注;全屏\",false); //隐藏“新建文件”等功能按钮\r\n\twebform.WebOffice.ShowToolBar=\"1\"; //ShowToolBar:是否显示工具栏:1显示,0不显示\t\r\n  ");
}
      out.write(" \r\n\r\n  webform.WebOffice.WebOpen();  \t //打开该文档    交互OfficeServer  调出文档OPTION=\"LOADFILE\"    调出模板OPTION=\"LOADTEMPLATE\"     <参考技术文档>\r\n\r\n\r\n \r\n  \r\n  \r\n  //隐藏按钮\r\n  /*webform.WebOffice.VisibleTools(\"新建文件\",false); //隐藏“新建文件”功能按钮\r\n  webform.WebOffice.VisibleTools(\"打开文件\",false); //隐藏“打开文件”功能按钮\r\n  webform.WebOffice.VisibleTools(\"保存文件\",false);\r\n  webform.WebOffice.VisibleTools(\"文字批注\",false);\r\n  webform.WebOffice.VisibleTools(\"手写批注\",false);\r\n  webform.WebOffice.VisibleTools(\"文档清稿\",false);\r\n  webform.WebOffice.VisibleTools(\"重新批注\",false);*/\r\n  //webform.WebOffice.VisibleTools(\"全屏\",false);\r\n\r\n  //StatusMsg(webform.WebOffice.Status);   //状态信息\r\n\r\n  \r\n  //加载时保存修改状态\r\n//  webform.WebOffice.WebObject.Saved = true;\r\n  \r\n\r\n\r\n  ");

    if(isReTem.equals("1")){
      out.write("//重新加 模班   套红头时使用 \r\n     addTemplate();\r\n  ");
}
      out.write("\r\n\r\n\r\n    ");
if("1".equals(isPrintButton)){
      out.write("\r\n\twebform.WebOffice.ShowMenu=\"1\";\r\n\tWebToolsVisible('Standard',false);\r\n\tWebToolsVisible('Formatting',false);\t\r\n\t\r\n\t");
}
      out.write("\r\n\t\r\n\t\r\n\r\n\r\n\r\n  //自动填衬板\r\n  ");
if(isLoadTemp.equals("1")){
      out.write("\r\n     LoadBookmarks();//自动填衬板\r\n  ");
}
      out.write("\r\n\r\n  ");
if("0".equals(showTempSign)){
      out.write("\r\n\r\n\t");
if(".doc".equals(mFileType)||".wps".equals(mFileType)){
      out.write("\r\n\thidePicture('TempSign');\r\n\t");
}
      out.write("\r\n\r\n  ");
}else if("1".equals(showTempSign)){
      out.write("\r\n\r\n\t");
if(".doc".equals(mFileType)||".wps".equals(mFileType)){
      out.write("\r\n\tshowPicture('TempSign');\r\n\t");
}
      out.write("\r\n\r\n  ");
}
      out.write("\r\n   ");
if("-1".equals(showTempHead)){
      out.write("\r\n\r\n  ");
}else if("0".equals(showTempHead)){
	 
	if(".doc".equals(mFileType)||".wps".equals(mFileType)){
      out.write("\r\n\t  hidePicture('TempHead');\r\n\t");
}}else{
      out.write('\r');
      out.write('\n');
      out.write('	');
if(".doc".equals(mFileType)||".wps".equals(mFileType)){
      out.write("\r\n\tshowPicture('TempHead');\r\n\t");
}
      out.write("\r\n  ");
}
      out.write("\r\n\r\n\r\n\t");
if("1".equals(isPrintButton)){
      out.write("// 如是打印正文进来的 因为 不能保存 ，所以 隐藏 印章后不会 保存下来\r\n\thidePicture('TempSign');\r\n\t");
}else{
      out.write("\r\n\r\n\t");
}
      out.write("\r\n\r\n\t//加载时保存修改状态\r\n\twebform.WebOffice.WebObject.Saved = true; \r\n    document.all.panel3.style.display=\"\";\r\n\r\n    var savefileMenuSpan = opener.window.document.all.SavefileMenuSpan;\r\n    if(savefileMenuSpan){\r\n    \tdocument.getElementById(\"saveMenu\").style.display='';\r\n    }\r\n\r\n}\r\n\r\nfunction cmdSavefile(){\r\n\tif(opener.window.document.all.sendFileDepartWord.value==\"\"){\r\n\t\t   alert(\"机关代字不能为空！\");\r\n\t\t   return ;\r\n\t\t  }\r\n\tif(opener.window.document.all.documentSendFileTitle.value==\"\"){\r\n\t\t   alert(\"标题不能为空！\");\r\n\t\t   return ;\r\n\t}\r\n\twindow.opener.cmdSavefile();\r\n}\r\n\r\n//-----编辑页面中调转换PDF文档的接口--------------------------------------------------//\r\nfunction TestWebSavePDF(){\r\n\ttry{\r\n\tif(webform.WebOffice.WebSavePDF()){\r\n\t\talert(\"转换并保存成功\");\r\n\t\topener.document.all.contentAccName.value = opener.document.all.documentSendFileTitle.value+\".pdf\";\r\n\t\topener.document.all.contentAccSaveName.value = webform.WebOffice.RecordID+\".pdf\";\r\n\t\t window.opener.updateContent();//保存\r\n\t}\r\n\telse{\r\n\t\talert(\"转换并保存失败\");\r\n\t}\r\n\t}\r\n\tcatch(e){\r\n\talert(e.description); //出现异常时提示错误信息\r\n");
      out.write("\t}\r\n}\r\n\r\n\r\n\r\n//隐藏签章 picType='TempSign' 签章, picType='TempHead' 红头\r\nfunction hidePicture(picType){\r\n  var PicObj;\r\n  // var count = webform.WebOffice.WebObject.InlineShapes.Count;\t//嵌入式图片\r\n  var count = webform.WebOffice.WebObject.Shapes.Count;\t\t//沉浮式图片 \r\n  try{\r\n    for(var i=1;i < count+1;i++){\r\n      if(webform.WebOffice.WebObject.Shapes(i).AlternativeText == picType){\r\n        PicObj = webform.WebOffice.WebObject.Shapes(i);\r\n\t\t//隐藏\r\n\t\tPicObj.PictureFormat.IncrementBrightness(1);\r\n      }    \r\n    }\r\n  }catch(e){\r\n    alert(e.description);\r\n  }\r\n}\r\n\r\n//显示签章 picType='TempSign' 签章, picType='TempHead' 红头\r\nfunction showPicture(picType){\r\n  var PicObj;\r\n  // var count = webform.WebOffice.WebObject.InlineShapes.Count;\t//嵌入式图片\r\n  var count = webform.WebOffice.WebObject.Shapes.Count;\t\t//沉浮式图片\r\n  try{\r\n    for(var i=1;i < count+1;i++){\r\n      if(webform.WebOffice.WebObject.Shapes(i).AlternativeText == picType){\r\n        PicObj = webform.WebOffice.WebObject.Shapes(i);\r\n\t\t//显示\r\n\t\tPicObj.PictureFormat.ColorType=1;\r\n      }    \r\n");
      out.write("    }\r\n  }catch(e){\r\n    alert(e.description);\r\n  }\r\n}\r\n\r\n//切换显示签章\r\nfunction alterPicture(picType){\r\n  var PicObj;\r\n  // var count = webform.WebOffice.WebObject.InlineShapes.Count;\t//嵌入式图片\r\n  var count = webform.WebOffice.WebObject.Shapes.Count;\t\t//沉浮式图片\r\n  try{\r\n    for(var i=1;i < count+1;i++){\r\n      if(webform.WebOffice.WebObject.Shapes(i).AlternativeText == picType){\r\n        PicObj = webform.WebOffice.WebObject.Shapes(i);\r\n\t\t//显示\r\n\t\tif(PicObj.PictureFormat.ColorType==1){\r\n\t\t\tPicObj.PictureFormat.IncrementBrightness(1);\r\n\t\t} else{\r\n\t\t\tPicObj.PictureFormat.ColorType=1;\r\n\t\t}\r\n      }    \r\n    }\r\n  }catch(e){\r\n    alert(e.description);\r\n  }\r\n}\r\n\r\n//引入文档\r\nfunction insertDoc(){\r\n\t//-----跳到书签位置----------\r\n\t//webform.WebOffice.WebObject.Application.Selection.GoTo(-1,0,0,\"conent\");//\"conent\"为标签名称\r\n\tvar mFilePath = webform.WebOffice.WebOpenLocalDialog();\r\n\tif(mFilePath){\r\n\t\twebform.WebOffice.WebObject.Application.Selection.InsertFile(mFilePath);\r\n\t} \r\n}\r\n\r\n\r\n//作用：退出iWebOffice\r\nfunction UnLoad(){\r\n\r\n  /*document.all.ifrm.src = \"/jsoa/iWebOfficeSign/DocumentIframe.jsp?haveDocument=");
      out.print(haveDocument);
      out.write("&mUpdateEidit=");
      out.print(mUpdateEidit);
      out.write("&mRecordID=");
      out.print(mRecordID);
      out.write("\";*/\r\n\r\n  try{\r\n  if (!webform.WebOffice.WebClose()){\r\n     StatusMsg(webform.WebOffice.Status);\r\n  }else{\r\n     StatusMsg(\"关闭文档...\");\r\n  }\r\n\r\n\t");
if(isFirstIn.equals("1")){
      out.write("\r\n\t\t\r\n    if(opener.document.all.sendSectNum){//\r\n     \r\n    window.opener.managerDueWord();\r\n\twindow.opener.updateGold();\r\n\t}\r\n\t");
}
      out.write("\r\n\r\n  }catch(e){}\r\n}\r\n\r\n//作用：打开文档\r\nfunction LoadDocument(){\r\n  StatusMsg(\"正在打开文档...\");\r\n  if (!webform.WebOffice.WebOpen()){  \t//打开该文档    交互OfficeServer的OPTION=\"LOADFILE\"\r\n     StatusMsg(webform.WebOffice.Status);\r\n  }else{\r\n     StatusMsg(webform.WebOffice.Status);\r\n  }\r\n}\r\n\r\n\r\n//作用：保存文档（同时生成两份文档，一份为原WORD文档，一份为PGF全文批注文档，用于领导批注使用）\r\nfunction SaveDocument(moduleType,isSaveHtmlImage,isSaveDocFile,isSaveHtml){\r\n\tif(opener.document.all.isChange){// 表 已经修改了\r\n\topener.document.all.isChange.value=\"1\";\t\r\n\t}\r\n\t\t\r\n\t//WebSaveVersionByText(\"");
      out.print(mUserName);
      out.write("修改\"); //保存版本\r\n\t\r\n\tif(\".doc\"==(\"");
      out.print(mFileType);
      out.write("\")||\".wps\"==(\"");
      out.print(mFileType);
      out.write("\")){\r\n  //webform.WebOffice.WebSetMsgByName(\"MyDefine1\",\"自定义变量值1\");  //设置变量MyDefine1=\"自定义变量值1\"，变量可以设置多个  在WebSave()时，一起提交到OfficeServer中\r\n\r\n    //判断文档是否锁定，是则解锁保存\r\n    if (webform.WebOffice.WebObject.ProtectionType != -1){\r\n\t  //alert(\"已经保护\");\r\n\t\twebform.WebOffice.WebSetProtect(false,\"\");  //\"\"表示密码为空,把文档设置为解锁\r\n\t}\r\n\t\r\n\twebform.WebOffice.WebSetMsgByName(\"isDoc\",\"false\");//是否保存为DOC文件-\r\n\t\r\n\t//设置文件最大大小 单位K 不设置默认8M\r\n\t//webform.WebOffice.MaxFileSize=16*1024; // 设置为16M\r\n\t\r\n    //保存两次 第一次将文件保存到数据库，如果保存成功在保存到服务器磁盘一份\r\n\tif (!webform.WebOffice.WebSave()){    //交互OfficeServer的OPTION=\"SAVEFILE\"\t\r\n\t\t//保存不成功\t\r\n\t\t StatusMsg(webform.WebOffice.Status);\r\n\t     alert(webform.WebOffice.Status);\r\n\t\t return false;\r\n\t  }else{\r\n\t\t //保存成功\r\n\t\t /*if (webform.WebOffice.FileType==\".doc\"||webform.WebOffice.FileType==\".doc\"){\r\n\t\t \t//交互OfficeServer的OPTION=\"SAVPAGE\"   生成全文批注PGF格式文档，存放服务器目录Document中，文件名RecordID+.pgf 如：3937725762429.pgf\r\n\t\t    webform.WebOffice.WebSavePage();\r\n\t\t }*/\r\n\t\t //alert(moduleType);\t\t \r\n\t\t\r\n\t\t //生成html图片\r\n\t\t if(isSaveHtmlImage=='1'){\r\n");
      out.write("\t\t\twebform.WebOffice.ExtParam=moduleType;//全局变量传递模块类型\r\n\t\t\twebform.WebOffice.WebSaveImage();\r\n\t\t\tStatusMsg(webform.WebOffice.Status);\r\n\t\t }\r\n\t\t//生成html\r\n\t\t if(isSaveHtml=='1'){\r\n\t\t\twebform.WebOffice.WebSaveAsHtml(); \t//交互OfficeServer的OPTION=\"SAVEASHTML\" \r\n\t\t }\r\n\r\n\t    //在服务器生成doc文件\t   \r\n\t\t if(isSaveDocFile=='1'){\r\n\t\t\t//传递模块类型\r\n\t\t\t webform.WebOffice.WebSetMsgByName(\"moduleType\",moduleType);//知识管理:information 公文管理:govdocument\r\n\t\t\t //在服务器上生成word文件\r\n\t\t\t //服务器上的文件都保存痕迹 不接受修订\r\n\t\t\t //webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions();//接收修订\r\n\t\t\t \r\n\t\t\t if(moduleType=='govdocument'){\r\n\t\t\t\t//webform.WebOffice.WebSetProtect(true,\"\");  //\"\"表示密码为空-\r\n\t\t\t }\r\n\t\t\t ");
if(isReTem.equals("1")){
      out.write("//重新加 模班   套红头时使用\r\n\t\t\t \twebform.WebOffice.WebSetMsgByName(\"isReTemplate\",\"1\");\r\n\t\t\t ");
}
      out.write("\r\n\t\t\t webform.WebOffice.WebSetMsgByName(\"isDoc\",\"true\");//是否保存为DOC文件-\r\n\t\t\t //webform.WebOffice.WebSetMsgByName(\"docSavePath\",\"//upload//govdocumentmanager\");//doc文件保存路径\r\n\t\t\t webform.WebOffice.WebSave(true);\r\n\t\t\t StatusMsg(webform.WebOffice.Status);\r\n\t\t\t \r\n\t\t\t if(moduleType==\"govdocument\"){\r\n\t\t\t\t var mFileNamess=\"");
      out.print(mFileName.replace(".","_wh."));
      out.write("\";\r\n\t\t\t\t  webform.WebOffice.WebSetMsgByName(\"mFileName\",mFileNamess);\r\n\t\t\t\t  webform.WebOffice.WebSetMsgByName(\"moduleType\",moduleType);\r\n\t\t\t\t  try{\r\n\t\t\t\t\t  //2016-12-22 最新版本的金格控件下面一行代码执行导致套红内容不保存\t\t\t\t  \r\n\t\t\t\t\t  webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions(); \r\n\t\t\t\t  }catch(ex){\r\n\t\t\t\t\t  \r\n\t\t\t\t  }\r\n\t\t\t\t  webform.WebOffice.WebSetMsgByName(\"moduleType\",moduleType);\r\n\t\t\t\t  webform.WebOffice.WebSetProtect(true,\"\"); \r\n\t\t          webform.WebOffice.WebUpdateFile();\r\n\t\t\t }\r\n\t\t\t webform.WebOffice.WebSetProtect(false,\"\");  //\"\"表示密码为空,把文档设置为解锁\t\t\t\r\n\t\t }\r\n\t\t //恢复修改状态\r\n\t\t webform.WebOffice.WebObject.Saved = true;\r\n\t\t return true;\r\n\t  }\r\n\t}else if(\".xls\"==(\"");
      out.print(mFileType);
      out.write("\")||\".et\"==(\"");
      out.print(mFileType);
      out.write("\")){\r\n            webform.WebOffice.WebSetMsgByName(\"isDoc\",\"false\");//是否保存为DOC文件\r\n            if (!webform.WebOffice.WebSave()){    //交互OfficeServer的OPTION=\"SAVEFILE\"\r\n                StatusMsg(webform.WebOffice.Status);\r\n                return false;\r\n            }else{\r\n                if(isSaveDocFile=='1'){\r\n\t\t\t\t\t//传递模块类型\r\n\t\t\t\t\t webform.WebOffice.WebSetMsgByName(\"moduleType\",moduleType);//知识管理:information 公文管理:govdocument\r\n\t\t\t\t\t //在服务器上生成word文件\r\n\t\t\t\t\t //webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions();//\r\n\t\t\t\t\t// webform.WebOffice.WebSetProtect(true,\"\");  //\"\"表示密码为空\r\n\t\t\t\t\t webform.WebOffice.WebSetMsgByName(\"isDoc\",\"true\");//是否保存为DOC文件-\r\n\t\t\t\t\t //webform.WebOffice.WebSetMsgByName(\"docSavePath\",\"//upload//govdocumentmanager\");//doc文件保存路径\r\n\t\t\t\t\t webform.WebOffice.WebSave(true);\r\n\t\t\t\t\t StatusMsg(webform.WebOffice.Status);\r\n\t\t\t\t }\r\n\r\n\t\t\t\t //生成html\r\n\t\t\t\t if(isSaveHtml=='1'){\r\n\t\t\t\t\twebform.WebOffice.WebSaveAsHtml(); \t//交互OfficeServer的OPTION=\"SAVEASHTML\" \r\n\t\t\t\t }\r\n\r\n                 return true;\r\n");
      out.write("            }\r\n\t}\r\n}\r\n\r\n//作用：显示或隐藏痕迹  true表示隐藏痕迹  false表示显示痕迹\r\nfunction ShowRevision(mValue){\r\n  //判断文档是否锁定\r\n  if (webform.WebOffice.WebObject.ProtectionType != -1){\r\n\t  alert(\"该文档已经被锁定！\");\r\n\t}\r\n  else{\r\n\t  if (mValue){\r\n\t\t webform.WebOffice.WebShow(true);\r\n\t\t StatusMsg(\"显示痕迹...\");\r\n\t  }else{\r\n\t\t webform.WebOffice.WebShow(false);\r\n\t\t StatusMsg(\"隐藏痕迹...\");\r\n\t  }\r\n  }\r\n}\r\n\r\n\r\n//作用：获取痕迹\r\nfunction WebGetRevisions(){\r\n  var i;\r\n  var Text=\"\";\r\n  for (i = 1;i <= webform.WebOffice.WebObject.Revisions.Count;i++){\r\n    Text=Text + webform.WebOffice.WebObject.Revisions.Item(i).Author;\r\n    if (webform.WebOffice.WebObject.Revisions.Item(i).Type==\"1\"){\r\n    Text=Text + '插入:'+webform.WebOffice.WebObject.Revisions.Item(i).Range.Text+\"\\r\\n\";\r\n    }else{\r\n    Text=Text + '删除:'+webform.WebOffice.WebObject.Revisions.Item(i).Range.Text+\"\\r\\n\";\r\n    }\r\n  }\r\n  alert(\"痕迹内容：\\r\\n\"+Text);\r\n}\r\n\r\n//作用：刷新文档\r\nfunction WebReFresh(){\r\n  webform.WebOffice.WebReFresh();\r\n  StatusMsg(\"文档已刷新...\");\r\n}\r\n\r\n//作用：打开版本\r\nfunction WebOpenVersion(){\r\n  webform.WebOffice.WebOpenVersion();  \t//交互OfficeServer  列出版本OPTION=\"LISTVERSION\"     调出版本OPTION=\"LOADVERSION\"   <参考技术文档>\r\n");
      out.write("  StatusMsg(webform.WebOffice.Status);\r\n}\r\n\r\n//作用：保存版本\r\nfunction WebSaveVersion(){\r\n  webform.WebOffice.WebSaveVersion();  \t//交互OfficeServer的OPTION=\"SAVEVERSION\"\r\n  StatusMsg(webform.WebOffice.Status);\r\n\r\n}\r\n\r\n//作用：保存当前版本\r\nfunction WebSaveVersionByFileID(){\r\n  var mText=window.prompt(\"请输入版本说明:\",\"版本号:V\");\r\n  if (mText==null){\r\n     mText=\"已修改版本.\";\r\n  }\r\n  webform.WebOffice.WebSaveVersionByFileID(mText);  \t//交互OfficeServer的OPTION=\"SAVEVERSION\"  同时带FileID值   <参考技术文档>\r\n  StatusMsg(webform.WebOffice.Status);\r\n}\r\n//作用：保存当前版本\r\nfunction WebSaveVersionByText(text){  \r\n  webform.WebOffice.WebSaveVersionByFileID(text);  \t//交互OfficeServer的OPTION=\"SAVEVERSION\"  同时带FileID值   <参考技术文档>\r\n  StatusMsg(webform.WebOffice.Status);\r\n}\r\n\r\n\r\n//作用：填充模板\r\nfunction LoadBookmarks(){\r\n  StatusMsg(\"正在填充模扳...\");\r\n\r\n    ");
if(request.getParameter("textContent") != null && !"-1".equals(request.getParameter("textContent"))){
      out.write("\r\n      webform.WebOffice.WebSetBookMarks(\"Content\",\"");
      out.print(request.getParameter("textContent"));
      out.write("\");\r\n  ");
}
      out.write("\r\n\r\n  ");

	Enumeration e = (Enumeration)request.getParameterNames(); 
    while(e.hasMoreElements()){
    String parName=(String)e.nextElement();
	if(parName.startsWith("$")){
		if(request.getParameter(parName) != null && !"-1".equals(request.getParameter(parName))&&!"".equals(request.getParameter(parName))){
		  String bookMarkAll = request.getParameter(parName);
		  String bookMarkName = bookMarkAll.substring(bookMarkAll.indexOf("[")+1,bookMarkAll.indexOf("]"));
		  String bookMarkValue = bookMarkAll.substring(bookMarkAll.indexOf("]")+1,bookMarkAll.length());
		  if("附件".equals(bookMarkName) || "备用字段13".equals(bookMarkName)){
			  //将回车换行转化为 \r\n 
			  bookMarkValue=CharacterTool.escapeJSTagsRN(bookMarkValue);
		  }
		  
      out.write("\r\n\t\t\twebform.WebOffice.WebSetBookMarks(\"");
      out.print(bookMarkName);
      out.write('"');
      out.write(',');
      out.write('"');
      out.print(bookMarkValue);
      out.write("\");\r\n\t\t  ");

		}
	  }
  }
  
      out.write("\r\n\t\r\n//套红头\r\n  webform.WebOffice.ClearRevision();    //清除修改痕迹\r\n  ");
if(request.getParameter("wordId") != null && !"-1".equals(request.getParameter("wordId"))&&!"".equals(request.getParameter("wordId"))){
      com.js.doc.doc.service.SenddocumentBD senddocumentBD = new com.js.doc.doc.service.SenddocumentBD();

      //根据机关代字 id取  机关代字
      com.js.doc.doc.po.SendDocumentWordPO  po= senddocumentBD.loadSendDocumentWordPO(request.getParameter("wordId"));

      
      out.write("\r\n      webform.WebOffice.WebSetBookMarks(\"红头\",\"\");\r\n\r\n      ");

	  //取机关代字对应的红头 
      if(po.getRedHeadSaveName()!= null &&!po.getRedHeadSaveName().toString().equals("")){
      
      out.write("\r\n      webform.WebOffice.WebInsertImage(\"红头\",\"");
      out.print(po.getRedHeadSaveName());
      out.write("\",true,4);//套红\r\n      ");

      }
  }


      out.write("\r\n\r\n\r\n\r\n//  if (!webform.WebOffice.WebLoadBookmarks()){  \t//交互OfficeServer的OPTION=\"LOADBOOKMARKS\"\r\n//     StatusMsg(webform.WebOffice.Status);\r\n//  }else{\r\n//     StatusMsg(webform.WebOffice.Status);\r\n//  }\r\n}\r\n\r\n\r\n\r\n//作用：标签管理\r\nfunction WebOpenBookMarks(){\r\n  try{\r\n    webform.WebOffice.WebOpenBookmarks();  \t//交互OfficeServer的OPTION=\"LISTBOOKMARKS\"\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：设置书签值  vbmName:标签名称，vbmValue:标签值   标签名称注意大小写\r\nfunction SetBookmarks(vbmName,vbmValue){\r\n  if (!webform.WebOffice.WebSetBookmarks(vbmName,vbmValue)){\r\n     StatusMsg(webform.WebOffice.Status);\r\n  }else{\r\n     StatusMsg(webform.WebOffice.Status);\r\n  }\r\n}\r\n\r\n//作用：根据标签名称获取标签值  vbmName:标签名称\r\nfunction GetBookmarks(vbmName){\r\n  var vbmValue;\r\n  vbmValue=webform.WebOffice.WebGetBookmarks(vbmName);\r\n  return vbmValue;\r\n}\r\n\r\n//作用：打印文档\r\nfunction WebOpenPrint(){\r\n  try{\r\n    webform.WebOffice.WebOpenPrint();\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：套打印文档\r\nfunction WebOpenPrintOfCover(){\r\n");
      out.write("  try{\r\n\t // var SignStatus = isShowPicture('TempSign');\r\n\t  var HeadStatus = isShowPicture('TempHead');\r\n\t//hidePicture('TempSign');\r\n\thidePicture('TempHead');\r\n    webform.WebOffice.WebOpenPrint();\r\n\tif(SignStatus){\r\n\t//showPicture('TempSign');\r\n\t}\r\n\tif(HeadStatus){\r\n\tshowPicture('TempHead');\r\n\t}\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：正式打印文档\r\nfunction WebOpenPrintOfFormal(){\r\n  try{\r\n\t  var SignStatus = isShowPicture('TempSign');\r\n\t//hidePicture('TempSign');\r\n    webform.WebOffice.WebOpenPrint();\r\n\tif(SignStatus){\r\n\t//showPicture('TempSign');\r\n\t}\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n\r\n//判断红头和印张显示状态\r\nfunction isShowPicture(picType){\r\n  var PicObj;\r\n  // var count = webform.WebOffice.WebObject.InlineShapes.Count;\t//嵌入式图片\r\n  var count = webform.WebOffice.WebObject.Shapes.Count;\t\t//沉浮式图片\r\n  try{\r\n    for(var i=1;i < count+1;i++){\r\n      if(webform.WebOffice.WebObject.Shapes(i).AlternativeText == picType){\r\n\t\t  PicObj = webform.WebOffice.WebObject.Shapes(i);\r\n");
      out.write("        if(PicObj.PictureFormat.ColorType==1){\r\n\t\t\treturn true;\r\n\t\t} else{\r\n\t\t\treturn false;\r\n\t\t}\r\n      }    \r\n    }\r\n  }catch(e){\r\n    alert(e.description);\r\n  }\r\n}\r\n\r\n\r\n//作用：页面设置\r\nfunction WebOpenPageSetup(){\r\n   try{\r\n\tif (webform.WebOffice.FileType==\".doc\"){\r\n\twebform.WebOffice.WebObject.Application.Dialogs(178).Show();\r\n\t}\r\n\tif(webform.WebOffice.FileType==\".xls\"){\r\n\twebform.WebOffice.WebObject.Application.Dialogs(7).Show();\r\n\t}\r\n   }catch(e){}\r\n}\r\n\r\n//作用：插入图片\r\nfunction WebOpenPicture(){\r\n  try{\r\n    webform.WebOffice.WebOpenPicture();\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：签名印章\r\nfunction WebOpenSignature(){\r\n  alert(\"如果您要签章,建议采用iSignature电子签章软件进行签章:\\r\\n下载地址http://www.goldgrid.com/iSignature/Download.asp\\r\\n该软件是支持CA证书和数字签名技术的,\\r\\n是通过了国家公安部认证的电子签章产品!\");\r\n  try{\r\n    webform.WebOffice.WebOpenSignature();  \t//交互OfficeServer的 A签章列表OPTION=\"LOADMARKLIST\"    B签章调出OPTION=\"LOADMARKIMAGE\"    C确定签章OPTION=\"SAVESIGNATURE\"    <参考技术文档>\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n");
      out.write("}\r\n\r\n//作用：验证印章A\r\nfunction WebShowSignature(){\r\n  try{\r\n    webform.WebOffice.WebShowSignature();  \t//交互OfficeServer的OPTION=\"LOADSIGNATURE\"\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：验证印章B\r\nfunction WebCheckSignature(){\r\n  try{\r\n    var i=webform.WebOffice.WebCheckSignature();  \t//交互OfficeServer的OPTION=\"LOADSIGNATURE\"\r\n    alert(\"检测结果：\"+i+\"\\r\\n 注释: (=-1 有非法印章) (=0 没有任何印章) (>=1 有多个合法印章)\");\r\n    StatusMsg(i);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：存为本地文件\r\nfunction WebSaveLocal(){\r\n  try{\r\n    webform.WebOffice.WebSaveLocal();\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：打开本地文件\r\nfunction WebOpenLocal(){\r\n  try{\r\n    webform.WebOffice.WebOpenLocal();\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：保存为HTML文档\r\nfunction WebSaveAsHtml(){\r\n  try{\r\n    if (webform.WebOffice.WebSaveAsHtml())  \t//交互OfficeServer的OPTION=\"SAVEASHTML\"\r\n    {\r\n      webform.HTMLPath.value=\"HTML/");
      out.print(mRecordID);
      out.write(".htm\";\r\n      //JSMainWinOpen(\"");
      out.print(mHttpUrl);
      out.write("\"+ webform.HTMLPath.value);\r\n    }\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n\r\n//作用：保存为文档图片\r\nfunction WebSaveAsPage(){\r\n  try{\r\n    if (webform.WebOffice.WebSaveImage())  \t//交互OfficeServer的OPTION=\"SAVEIMAGE\"\r\n    {\r\n      webform.HTMLPath.value=\"HTMLIMAGE/");
      out.print(mRecordID);
      out.write(".htm\";\r\n      //JSMainWinOpen(\"");
      out.print(mHttpUrl);
      out.write("\"+ webform.HTMLPath.value);\r\n    }\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n\r\n//作用：关闭或显示工具 参数1表示工具条名称  参数2为false时，表示关闭  （名称均可查找VBA帮助）\r\n//参数2为true时，表示显示\r\nfunction WebToolsVisible(ToolName,Visible){\r\n  try{\r\n    webform.WebOffice.WebToolsVisible(ToolName,Visible);\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n\r\n//作用：禁止或启用工具 参数1表示工具条名称  参数2表示工具条铵钮的编号  （名称和编号均可查找VBA帮助）\r\n//参数3为false时，表示禁止  参数3为true时，表示启用\r\nfunction WebToolsEnable(ToolName,ToolIndex,Enable){\r\n  try{\r\n    webform.WebOffice.WebToolsEnable(ToolName,ToolIndex,Enable);\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：保护与解除  参数1为true表示保护文档  false表示解除保护\r\nfunction WebProtect(value){\r\n  try{\r\n    webform.WebOffice.WebSetProtect(value,\"\");  //\"\"表示密码为空\r\n  }catch(e){}\r\n}\r\n\r\n//作用：允许与禁止拷贝功能  参数1为true表示允许拷贝  false表示禁止拷贝\r\nfunction WebEnableCopy(value){\r\n  try{\r\n    webform.WebOffice.CopyType=value;\r\n  }catch(e){}\r\n}\r\n\r\n\r\n//作用：插入远程服务器图片\r\nfunction WebInsertImage(){\r\n  try{\r\n    webform.WebOffice.WebInsertImage('Image','GoldgridLogo.jpg',true,4);   //交互OfficeServer的OPTION=\"INSERTIMAGE\"  参数1表示标签名称  参数2表示图片文件名  参数3为true透明  false表示不透明  参数4为4表示浮于文字上方  5表示衬于文字下方\r\n");
      out.write("    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n}\r\n\r\n\r\n//作用：下载服务器文件到本地\r\nfunction WebGetFile(){\r\n  if (webform.WebOffice.WebGetFile(\"c:\\\\WebGetFile.doc\",\"DownLoad.doc\")){   //交互OfficeServer的OPTION=\"GETFILE\"  参数1表示本地路径  参数2表示服务器文件名称\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }else{\r\n    StatusMsg(webform.WebOffice.Status);\r\n  }\r\n  alert(webform.WebOffice.Status+\"\\r\\n\"+\"文件放在c:\\\\WebGetFile.doc\");\r\n}\r\n\r\n\r\n//作用：上传本地文件到服务器\r\nfunction WebPutFile(){\r\n  var mLocalFile=webform.WebOffice.WebOpenLocalDialog();\r\n  if (mLocalFile!=\"\"){\r\n    alert(mLocalFile);\r\n    if (webform.WebOffice.WebPutFile(mLocalFile,\"Test.doc\")){   //交互OfficeServer的OPTION=\"PUTFILE\"  参数1表示本地路径，可以任何格式文件  参数2表示服务器文件名称\r\n      StatusMsg(webform.WebOffice.Status);\r\n    }else{\r\n      StatusMsg(webform.WebOffice.Status);\r\n    }\r\n    alert(webform.WebOffice.Status);\r\n  }\r\n}\r\n\r\n\r\n//作用：打开远程文件\r\nfunction WebDownLoadFile(){\r\n  mResult=webform.WebOffice.WebDownLoadFile(\"http://www.goldgrid.com/Images/abc.doc\",\"c:\\\\abc.doc\");\r\n  if (mResult){\r\n    webform.WebOffice.WebOpenLocalFile(\"c:\\\\abc.doc\");\r\n");
      out.write("    alert(\"成功\");\r\n  }else{\r\n    alert(\"失败\");\r\n  }\r\n}\r\n\r\n//作用：表格生成及填充\r\nfunction WebSetWordTable(){\r\n  var mText=\"\",mName=\"\",iColumns,iCells,iTable;\r\n  //设置COMMAND为WORDTABLE\r\n  webform.WebOffice.WebSetMsgByName(\"COMMAND\",\"WORDTABLE\");   //设置变量COMMAND=\"WORDTABLE\"，在WebSendMessage()时，一起提交到OfficeServer中\r\n  //发送到服务器上\r\n  //如果没有错误\r\n  if (webform.WebOffice.WebSendMessage()){                //交互OfficeServer的OPTION=\"SENDMESSAGE\"\r\n\tiColumns = webform.WebOffice.WebGetMsgByName(\"COLUMNS\");  //取得列\r\n\tiCells = webform.WebOffice.WebGetMsgByName(\"CELLS\");      //取得行\r\n\tiTable=webform.WebOffice.WebObject.Tables.Add(webform.WebOffice.WebObject.Application.Selection.Range,iCells,iColumns);   //生成表格\r\n\tfor (var i=1; i<=iColumns; i++)\r\n\t{\r\n   \t  for (var j=1; j<=iCells; j++)\r\n\t  {\r\n\t\tmName=i.toString()+j.toString();\r\n\t\tmText=webform.WebOffice.WebGetMsgByName(mName);\t //取得OfficeServer中的表格内容\r\n\t\tiTable.Columns(i).Cells(j).Range.Text=mText;   \t//填充单元值\r\n\t   }\r\n\t}\r\n   }\r\n   StatusMsg(webform.WebOffice.Status);\r\n}\r\n\r\n\r\n//作用：获取文档Txt正文\r\nfunction WebGetWordContent(){\r\n");
      out.write("  try{\r\n    alert(webform.WebOffice.WebObject.Content.Text);\r\n  }catch(e){}\r\n}\r\n\r\n//作用：写Word内容\r\nfunction WebSetWordContent(){\r\n  var mText=window.prompt(\"请输入内容:\",\"测试内容\");\r\n  if (mText==null){\r\n     return (false);\r\n  }\r\n  else\r\n  {\r\n     //下面为显示选中的文本\r\n     //alert(webform.WebOffice.WebObject.Application.Selection.Range.Text);\r\n     //下面为在当前光标出插入文本\r\n     webform.WebOffice.WebObject.Application.Selection.Range.Text= mText+\"\\n\";\r\n     //下面为在第一段后插入文本\r\n     //webform.WebOffice.WebObject.Application.ActiveDocument.Range(1).Text=(mText);\r\n  }\r\n}\r\n\r\n\r\n//作用：打印黑白文档\r\nfunction WebWordPrintBlackAndWhile(){\r\n   var i,n;\r\n\r\n   //图片变黑白\r\n   i=0;\r\n   n=webform.WebOffice.WebObject.Shapes.Count;\r\n   for (var i=1; i<=n; i++)\r\n   {\r\n      webform.WebOffice.WebObject.Shapes.Item(i).PictureFormat.ColorType=3;\r\n   }\r\n   i=0;\r\n   n=webform.WebOffice.WebObject.InlineShapes.Count;\r\n   for (var i=1; i<=n; i++)\r\n   {\r\n      webform.WebOffice.WebObject.InlineShapes.Item(i).PictureFormat.ColorType=3;\r\n   }\r\n\r\n   //文字变黑白\r\n   webform.WebOffice.WebObject.Application.Selection.WholeStory();\r\n");
      out.write("   webform.WebOffice.WebObject.Application.Selection.Range.Font.Color = 0;\r\n}\r\n\r\n//作用：用Excel求和\r\nfunction WebGetExcelContent(){\r\n    webform.WebOffice.WebObject.Application.Sheets(1).Select;\r\n    webform.WebOffice.WebObject.Application.Range(\"C5\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"126\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C6\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"446\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C7\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"556\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C5:C8\").Select;\r\n    webform.WebOffice.WebObject.Application.Range(\"C8\").Activate;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"=SUM(R[-3]C:R[-1]C)\";\r\n    webform.WebOffice.WebObject.Application.Range(\"D8\").Select;\r\n    alert(webform.WebOffice.WebObject.Application.Range(\"C8\").Text);\r\n}\r\n\r\n\r\n//作用：保护工作表单元\r\nfunction WebSheetsLock(){\r\n");
      out.write("    webform.WebOffice.WebObject.Application.Sheets(1).Select;\r\n\r\n    webform.WebOffice.WebObject.Application.Range(\"A1\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"产品\";\r\n    webform.WebOffice.WebObject.Application.Range(\"B1\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"价格\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C1\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"详细说明\";\r\n    webform.WebOffice.WebObject.Application.Range(\"D1\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"库存\";\r\n    webform.WebOffice.WebObject.Application.Range(\"A2\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"书签\";\r\n    webform.WebOffice.WebObject.Application.Range(\"A3\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"毛笔\";\r\n    webform.WebOffice.WebObject.Application.Range(\"A4\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"钢笔\";\r\n");
      out.write("    webform.WebOffice.WebObject.Application.Range(\"A5\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"尺子\";\r\n\r\n    webform.WebOffice.WebObject.Application.Range(\"B2\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"0.5\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C2\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"樱花\";\r\n    webform.WebOffice.WebObject.Application.Range(\"D2\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"300\";\r\n\r\n    webform.WebOffice.WebObject.Application.Range(\"B3\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"2\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C3\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"狼毫\";\r\n    webform.WebOffice.WebObject.Application.Range(\"D3\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"50\";\r\n\r\n    webform.WebOffice.WebObject.Application.Range(\"B4\").Select;\r\n");
      out.write("    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"3\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C4\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"蓝色\";\r\n    webform.WebOffice.WebObject.Application.Range(\"D4\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"90\";\r\n\r\n    webform.WebOffice.WebObject.Application.Range(\"B5\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"1\";\r\n    webform.WebOffice.WebObject.Application.Range(\"C5\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"20cm\";\r\n    webform.WebOffice.WebObject.Application.Range(\"D5\").Select;\r\n    webform.WebOffice.WebObject.Application.ActiveCell.FormulaR1C1 = \"40\";\r\n\r\n    //保护工作表\r\n    webform.WebOffice.WebObject.Application.Range(\"B2:D5\").Select;\r\n    webform.WebOffice.WebObject.Application.Selection.Locked = false;\r\n    webform.WebOffice.WebObject.Application.Selection.FormulaHidden = false;\r\n    webform.WebOffice.WebObject.Application.ActiveSheet.Protect(true,true,true);\r\n");
      out.write("\r\n    alert(\"已经保护工作表，只有B2-D5单元格可以修改。\");\r\n}\r\n\r\n//作用：VBA套红\r\nfunction WebInsertVBA(){\r\n\r\n\t//画线\r\n\tvar object=webform.WebOffice.WebObject;\r\n\tvar myl=object.Shapes.AddLine(100,60,305,60)\r\n\tmyl.Line.ForeColor=255;\r\n\tmyl.Line.Weight=2;\r\n\tvar myl1=object.Shapes.AddLine(326,60,520,60)\r\n\tmyl1.Line.ForeColor=255;\r\n\tmyl1.Line.Weight=2;\r\n\r\n\t//object.Shapes.AddLine(200,200,450,200).Line.ForeColor=6;\r\n   \tvar myRange=webform.WebOffice.WebObject.Range(0,0);\r\n\tmyRange.Select();\r\n\r\n\tvar mtext=\"★\";\r\n\twebform.WebOffice.WebObject.Application.Selection.Range.InsertAfter (mtext+\"\\n\");\r\n   \tvar myRange=webform.WebOffice.WebObject.Paragraphs(1).Range;\r\n   \tmyRange.ParagraphFormat.LineSpacingRule =1.5;\r\n   \tmyRange.font.ColorIndex=6;\r\n   \tmyRange.ParagraphFormat.Alignment=1;\r\n   \tmyRange=webform.WebOffice.WebObject.Range(0,0);\r\n\tmyRange.Select();\r\n\tmtext=\"金格发[２００３]１５４号\";\r\n\twebform.WebOffice.WebObject.Application.Selection.Range.InsertAfter (mtext+\"\\n\");\r\n\tmyRange=webform.WebOffice.WebObject.Paragraphs(1).Range;\r\n\tmyRange.ParagraphFormat.LineSpacingRule =1.5;\r\n");
      out.write("\tmyRange.ParagraphFormat.Alignment=1;\r\n\tmyRange.font.ColorIndex=1;\r\n\r\n\tmtext=\"金格电子政务文件\";\r\n\twebform.WebOffice.WebObject.Application.Selection.Range.InsertAfter (mtext+\"\\n\");\r\n\tmyRange=webform.WebOffice.WebObject.Paragraphs(1).Range;\r\n\tmyRange.ParagraphFormat.LineSpacingRule =1.5;\r\n\r\n\t//myRange.Select();\r\n\tmyRange.Font.ColorIndex=6;\r\n\tmyRange.Font.Name=\"仿宋_GB2312\";\r\n\tmyRange.font.Bold=true;\r\n\tmyRange.Font.Size=50;\r\n\tmyRange.ParagraphFormat.Alignment=1;\r\n\r\n\t//myRange=myRange=webform.WebOffice.WebObject.Paragraphs(1).Range;\r\n\twebform.WebOffice.WebObject.PageSetup.LeftMargin=70;\r\n\twebform.WebOffice.WebObject.PageSetup.RightMargin=70;\r\n\twebform.WebOffice.WebObject.PageSetup.TopMargin=70;\r\n\twebform.WebOffice.WebObject.PageSetup.BottomMargin=70;\r\n}\r\n\r\n\r\n\r\n//作用：保存定稿文件\r\nfunction WebUpdateFile(){\r\n  if (webform.WebOffice.WebUpdateFile()){                //交互OfficeServer的OPTION=\"UPDATEFILE\"，类似WebSave()或WebSaveVersion()方法\r\n     StatusMsg(webform.WebOffice.Status);\r\n  }else{\r\n     StatusMsg(webform.WebOffice.Status);\r\n  }\r\n");
      out.write("}\r\n\r\n//作用：导入Text\r\nfunction WebInportText(){\r\n    var mText;\r\n    webform.WebOffice.WebSetMsgByName(\"COMMAND\",\"INPORTTEXT\");  //设置变量COMMAND=\"INPORTTEXT\"，在WebSendMessage()时，一起提交到OfficeServer中\r\n    if (webform.WebOffice.WebSendMessage()){                    //交互OfficeServer的OPTION=\"SENDMESSAGE\"\r\n      mText=webform.WebOffice.WebGetMsgByName(\"CONTENT\");       //取得OfficeServer传递的变量CONTENT值\r\n      webform.WebOffice.WebObject.Application.Selection.Range.Text=mText;\r\n      alert(\"导入文本成功\");\r\n    }\r\n    StatusMsg(webform.WebOffice.Status);\r\n}\r\n\r\n\r\n//作用：导出Text\r\nfunction WebExportText(){\r\n    var mText=webform.WebOffice.WebObject.Content.Text;\r\n    webform.WebOffice.WebSetMsgByName(\"COMMAND\",\"EXPORTTEXT\");  //设置变量COMMAND=\"EXPORTTEXT\"，在WebSendMessage()时，一起提交到OfficeServer中\r\n    webform.WebOffice.WebSetMsgByName(\"CONTENT\",mText);         //设置变量CONTENT=\"mText\"，在WebSendMessage()时，一起提交到OfficeServer中，可用于实现全文检索功能，对WORD的TEXT内容进行检索\r\n    if (webform.WebOffice.WebSendMessage()){                    //交互OfficeServer的OPTION=\"SENDMESSAGE\"\r\n");
      out.write("      alert(\"导出文本成功\");\r\n\t  JSMainWinOpen(\"/jsoa/download.jsp?FileName=");
      out.print(mRecordID);
      out.write(".txt&name=");
      out.print(mRecordID);
      out.write(".txt&path=govdocumentmanager\", \"send\", 'menubar=0,scrollbars=0,locations=0,width=500,height=400,resizable=no,location=no,status=no');    }\r\n    StatusMsg(webform.WebOffice.Status);\r\n}\r\n\r\n\r\n//作用：获取文档页数\r\nfunction WebDocumentPageCount(){\r\n    if (webform.WebOffice.FileType==\".doc\"){\r\n\tvar intPageTotal;\r\n\tintPageTotal = webform.WebOffice.WebObject.Application.ActiveDocument.BuiltInDocumentProperties(14);\r\n\talert(\"文档页总数：\"+intPageTotal);\r\n    }\r\n    if (webform.WebOffice.FileType==\".wps\"){\r\n\tvar intPageTotal;\r\n\tintPageTotal = webform.WebOffice.WebObject.PagesCount();\r\n\talert(\"文档页总数：\"+intPageTotal);\r\n    }\r\n}\r\n\r\n//作用：签章锁定文件功能\r\nfunction WebSignatureAtReadonly(){\r\n  webform.WebOffice.WebSetProtect(false,\"\");                  //解除文档保护\r\n  webform.WebOffice.WebSetRevision(false,false,false,false);  //设置文档痕迹保留的状态  参数1:不显示痕迹  参数2:不保留痕迹  参数3:不打印时有痕迹  参数4:不显痕迹处理工具\r\n  try{\r\n    webform.WebOffice.WebOpenSignature();                     //交互OfficeServer的 A签章列表OPTION=\"LOADMARKLIST\"    B签章调出OPTION=\"LOADMARKIMAGE\"    C确定签章OPTION=\"SAVESIGNATURE\"    <参考技术文档>    文档中要定义标签Manager，可以自行修改标签名称\r\n");
      out.write("    StatusMsg(webform.WebOffice.Status);\r\n  }catch(e){}\r\n  webform.WebOffice.WebSetProtect(true,\"\");                   //锁定文档\r\n\r\n}\r\n\r\n\r\nvar click = 0;\r\n//是否显示痕迹\r\nfunction showTrack(){\r\n\tif(click%2==0){\r\n\t\twebform.WebOffice.WebSetRevision(true,true,false,true); \r\n\t} else{\r\n\t\twebform.WebOffice.WebSetRevision(false,true,false,true); \r\n\t}\r\n\tclick ++;\r\n}\r\n\r\n//self.moveTo(0,0);\r\n//self.resizeTo(screen.availWidth,screen.availHeight);\r\n\r\n</script>\r\n<script language=javascript for=WebOffice event=OnToolsClick(vIndex,vCaption)>\r\nif (vIndex==100){\r\n\tif(!webform.WebOffice.WebObject.Saved){\r\n\t\t");
if("1".equals(showEditButton)){
      out.write("\r\n\t\t\tif(confirm(\"是否保存对文档的修改？\")){\r\n\t\t\t\tSaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');\r\n\t\t\t\tdocument.all.webform.IsOut.value=\"1\";\r\n\t\t\t\tdocument.all.webform.submit();\r\n\t\t\t} else {\r\n\t\t\t\twindow.close();\r\n\t\t\t}\r\n\t\t");
} else{
      out.write("\r\n\t\t\twindow.close();\r\n\t\t");
}
      out.write("\r\n\t} else{\r\n\t\twindow.close();\r\n\t}\r\n}\r\n\r\nif (vIndex==101){insertDoc();}\r\nif (vIndex==102){SaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');document.all.webform.submit(); alert('保存成功！');\r\n // webform.WebOffice.WebOpen(); \r\n}\r\nif (vIndex==103){alterPicture('TempHead');}\r\nif (vIndex==104){showTrack();}\r\nif (vIndex==105){WebOpenPrintOfCover();}\r\nif (vIndex==106){WebOpenPrintOfFormal();}\r\n\r\n\tif(vIndex==-1&&vCaption=='全屏'){\r\n\tdocument.all.panel3.style.display=\"\";\r\n\t}\r\n\tif (vIndex==-1 && vCaption=='返回'){\r\n\twebform.WebOffice.WebObject.Saved = true;\r\n\tdocument.all.panel3.style.display=\"none\";\r\n\t}\r\n\r\n//if (vIndex==11){alert('编号:'+vIndex+'\\n\\r'+'标题:'+vCaption+'\\n\\r'+'请根据这些信息编写具体功能'+'\\n\\r\\n\\r'+'窗口状态:'+webform.WebOffice.WindowStatus);} \r\n//if (vIndex==12){webform.WebOffice.Alert('自定义工具栏测试');}  \r\n//if (vIndex==-1){webform.WebOffice.Alert(vCaption);}             //在完成相应操作后响应iWebOffice标准工具栏操作铵钮事件，如\"手写批注\",vCaption=\"手写批注\"\r\n\r\nif (vIndex==107){TestWebSavePDF();}\r\nif (vIndex==108){WebExportText();}\r\n\r\n</script>\r\n</head>\r\n<script language=\"javascript\">\r\nfunction showSign(){\r\n    ");

    String ShowSign = request.getParameter("ShowSign")==null?"0":request.getParameter("ShowSign");
	if(!ShowSign.equals("-1") && !mFileType.equals(".xls")){//判断是不是在已批文件的锁定状态，是锁定则不控制痕迹
		if(ShowSign.equals("1")){
      out.write("\r\n\t\t//ShowRevision(true);\r\n\t\twebform.WebOffice.WebSetRevision(true,true,false,true); \r\n\t\t");
}else if(!mEditType.equals("0")){
      out.write("\r\n\t\t//ShowRevision(false);\r\n\t\twebform.WebOffice.WebSetRevision(false,true,false,true); \r\n\t\t//webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions();\r\n\t\t");

		 }
	}
	
      out.write("\r\n    if(opener.document.all.htmlContent){\r\n        document.all.htmlContent.value = opener.document.all.htmlContent.value;\r\n    }\r\n\t //加载时保存修改状态\r\n     webform.WebOffice.WebObject.Saved = true;\r\n}\r\nfunction initFullWin(){\r\n\t");
if(!"ynnt".equals(com.js.util.config.SystemCommon.getCustomerName())){
      out.write("\r\n\t\twindow.resizeTo(screen.width-300,screen.height-1);\r\n\t");
}
      out.write("\r\n}\r\n\r\n</script>\r\n<body bgcolor=\"#ffffff\" onload=\"Load();showSign();initFullWin();\" onunload=\"UnLoad()\">  <!--引导和退出iWebOffice-->\r\n\t<iframe id=\"targetFrame\" name=\"targetFrame\" style=\"display:none\"></iframe>\r\n  <form name=\"webform\" method=\"post\" action=\"DocumentSave.jsp?field=");
      out.print(request.getParameter("field"));
      out.write("\" target=\"targetFrame\">  <!--保存iWebOffice后提交表单信息-->\r\n    <input type=\"hidden\" name=\"RecordID\" value=\"");
      out.print(mRecordID);
      out.write("\">\r\n    <input type=\"hidden\" name=\"Template\" value=\"");
      out.print(mTemplate);
      out.write("\">\r\n    <input type=\"hidden\" name=\"FileType\" value=\"");
      out.print(mFileType);
      out.write("\">\r\n    <input type=\"hidden\" name=\"EditType\" value=\"");
      out.print(mEditType);
      out.write("\">\r\n    <input type=\"hidden\" name=\"HTMLPath\" value=\"");
      out.print(mHTMLPath);
      out.write("\">\r\n\t\t<input type=\"hidden\" name=\"IsOut\"    value=\"0\">\r\n\t\t<input type=\"hidden\" name=\"FlagCloseWindow\"    value=\"0\">\r\n\t\t\r\n    <table border=0  cellspacing='0' cellpadding='0' width=\"100%\" height=\"100%\" align=\"center\" class=\"TBStyle\">\r\n      <tr>\r\n        <!--td align=right valign=top  class=\"TDTitleStyle\" width=64>内容</td-->\r\n        <td align=right valign=top style=\"display:none\" class=\"TDTitleStyle\" width=\"79\" hegith=\"100%\">\r\n\t   <b>HTML按钮</b><br><font color=\"red\"><b>功能列表</b></font>\r\n           <input type=button class=button value=\"显示痕迹\" ");
      out.print(mDisabled);
      out.write(" onclick=\"ShowRevision(true)\">\r\n           <input type=button class=button value=\"隐藏痕迹\" ");
      out.print(mDisabled);
      out.write(" onclick=\"ShowRevision(false)\">\r\n           <input type=button class=button value=\"获取痕迹\" ");
      out.print(mDisabled);
      out.write(" onclick=\"WebGetRevisions()\">\r\n           <input type=button class=button value=\"清除痕迹\" ");
      out.print(mDisabled);
      out.write(" onclick=\"webform.WebOffice.WebObject.Application.ActiveDocument.AcceptAllRevisions();\">\r\n           <input type=button class=button value=\"保护文档\" onclick=\"WebProtect(true)\">\r\n           <input type=button class=button value=\"解除保护\" onclick=\"WebProtect(false)\">\r\n           <input type=button class=button value=\"允许拷贝\" onclick=\"WebEnableCopy(true)\">\r\n           <input type=button class=button value=\"禁止拷贝\" onclick=\"WebEnableCopy(false)\">\r\n           <input type=button class=button value=\"页面设置\" ");
      out.print(mDisabled);
      out.write(" onclick=\"WebOpenPageSetup()\">\r\n           <input type=button class=button value=\"打印文档\" ");
      out.print(mDisabled);
      out.write(" onclick=\"WebOpenPrint()\">\r\n           <input type=button class=button value=\"插入图片\" ");
      out.print(mDisabled);
      out.write(" onclick=\"WebOpenPicture()\">\r\n           <input type=button class=button value=\"重调文档\" ");
      out.print(mDisabled);
      out.write(" onclick=\"LoadDocument()\">\r\n           <input type=button class=button value=\"打开本地文件\" ");
      out.print(mDisabled);
      out.write(" onclick=\"WebOpenLocal()\">\r\n           <input type=button class=button value=\"存为本地文件\" ");
      out.print(mDisabled);
      out.write(" onclick=\"WebSaveLocal()\">\r\n\t\t<font color=\"red\"><b>与服务器交互</b></font>\r\n           <input type=button class=button value=\"签名印章\" ");
      out.print(mDisabled);
      out.write(" onclick=\"WebOpenSignature()\">\r\n           <input type=button class=button value=\"验证签章[A]\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebShowSignature()\">\r\n           <input type=button class=button value=\"验证签章[B]\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebCheckSignature()\">\r\n           <input type=button class=button value=\"打开标签\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebOpenBookMarks()\">\r\n           <input type=button class=button value=\"填充模版\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"LoadBookmarks()\">\r\n           <input type=button class=button value=\"保存版本\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebSaveVersion()\">\r\n           <input type=button class=button value=\"打开版本\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebOpenVersion()\">\r\n           <input type=button class=button value=\"保存当前版本\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebSaveVersionByFileID()\">\r\n           <input type=button class=button value=\"保存定稿版本\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebUpdateFile()\">\r\n           <input type=button class=button value=\"存为HTML\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebSaveAsHtml()\">\r\n           <input type=button class=button value=\"存为HTML图片\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebSaveAsPage()\">\r\n           <input type=button class=button value=\"套用模版定稿\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write(" onclick=\"WebInsertFile()\">\r\n           <input type=button class=button value=\"VBA套红定稿\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebInsertVBA();\">\r\n           <input type=button class=button value=\"导入数据内容\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebInportText();\">\r\n           <input type=button class=button value=\"导出文档内容\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebExportText();\">\r\n           <input type=button class=button value=\"插入远程表格\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebSetWordTable()\">\r\n           <input type=button class=button value=\"插入远程图片\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebInsertImage()\">\r\n           <input type=button class=button value=\"下载服务器文件\" ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mWord);
      out.write(" onclick=\"WebGetFile()\">\r\n           <input type=button class=button value=\"上传文件到服务器\" ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mWord);
      out.write(" onclick=\"WebPutFile()\">\r\n           <input type=button class=button value=\"打开远程文件\"  ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebDownLoadFile()\">\r\n           <font color=\"red\"><b>VBA调用</b></font>\r\n           <input type=button class=button value=\"取Word内容\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebGetWordContent()\">\r\n           <input type=button class=button value=\"写Word内容\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebSetWordContent()\">\r\n           <input type=button class=button value=\"WORD禁止拖动\" ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mWord);
      out.write(" onclick=\"webform.WebOffice.WebObject.Application.Options.AllowDragAndDrop=false;\">  <!--false禁止拖动  true允许拖动-->\r\n           <input type=button class=button value=\"打印黑白\" ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mWord);
      out.write(" onclick=\"WebWordPrintBlackAndWhile();\">\r\n           <input type=button class=button value=\"插入页眉\" ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mWord);
      out.write(" onclick=\"webform.WebOffice.WebObject.ActiveWindow.ActivePane.View.SeekView=9;\">\r\n           <input type=button class=button value=\"插入页码\" ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mWord);
      out.write(" onclick=\"webform.WebOffice.WebObject.Application.Dialogs(294).Show();\">\r\n           <input type=button class=button value=\"用Excel求和\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mExcel);
      out.write(" onclick=\"WebGetExcelContent()\">\r\n           <input type=button class=button value=\"锁定工作表\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.write(' ');
      out.print(mExcel);
      out.write(" onclick=\"WebSheetsLock()\">\r\n           <input type=button class=button value=\"EXCEL禁止拖动\" ");
      out.print(mDisabled);
      out.write(' ');
      out.print(mExcel);
      out.write(" onclick=\"webform.WebOffice.WebObject.Application.CellDragAndDrop=false;\">  <!--false禁止拖动  true允许拖动-->\r\n           <input type=button class=button value=\"文档页数\" ");
      out.print(mDisabled);
      out.write(' ');
      out.write(' ');
      out.print(mWord);
      out.write("  onclick=\"WebDocumentPageCount()\">\r\n\t\t<font color=\"red\"><b>工具栏</b></font>\r\n           <input type=button class=button value=\"关闭常用工具\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebToolsVisible('Standard',false)\">\r\n           <input type=button class=button value=\"打开常用工具\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebToolsVisible('Standard',true)\">\r\n           <input type=button class=button value=\"关闭格式工具\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebToolsVisible('Formatting',false)\">\r\n           <input type=button class=button value=\"打开格式工具\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebToolsVisible('Formatting',true)\">\r\n           <input type=button class=button value=\"关闭打印按钮\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebToolsEnable('Standard',2521,false);\">\r\n           <input type=button class=button value=\"打开打印按钮\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebToolsEnable('Standard',2521,true);\">\r\n                <font color=\"red\"><b>其他调用</b></font>\r\n           <input type=button class=button value=\"签章锁定文件\" ");
      out.print(mDisabled);
      out.write("  onclick=\"WebSignatureAtReadonly();\">\r\n        </td>\r\n        <td class=\"TDStyle\" height=\"100%\">\r\n           <table valign=top border=0 cellspacing='0' cellpadding='0' width='100%' height='100%' >\r\n            ");
if(!"0".equals(mEditType) && !"0,0".equals(mEditType)){
      out.write("\r\n             <tr>\r\n               <td height=20>\r\n               <input type=button class=\"btnButton2font\" value=\"保存文档\" onclick=\"onlySaveDoc();\">\r\n               <input type=button class=\"btnButton2font\" value=\"保存并返回\" onclick=\"saveAndCloseWin()\">\r\n               ");
//if("shandongguotou".equals(com.js.util.config.SystemCommon.getCustomerName())&&(mTemplate==null||"".equals(mTemplate))){
      out.write("\r\n               ");
if(!isFirstIn.equals("1") && !isLoadTemp.equals("1")){
      out.write("\r\n               <input type=button class=\"btnButton2font\" value=\"显示痕迹\" onclick=\"webform.WebOffice.WebSetRevision(true,true,false,false)\">\r\n              <input type=button class=\"btnButton2font\" value=\"隐藏痕迹\" onclick=\"webform.WebOffice.WebSetRevision(false,true,false,false)\">\r\n               ");
}
      out.write("\r\n               ");
if("shandongguotou".equals(com.js.util.config.SystemCommon.getCustomerName())){
            	   
      out.write("\r\n            \t   <input type=button id =\"saveMenu\" style=\"display:none\" class=\"btnButton2font\" value=\"生成正式文件\" onclick=\"cmdSavefile()\">\r\n            \t   ");

               }
               
      out.write("\r\n               </td>\r\n             </tr>\r\n             ");
}
      out.write("\r\n             <tr>\r\n                <td bgcolor=menu>\t\t\t\t\r\n\t\t\t\t  <div style=\"width:100%;height:100%;\"  id=\"panel3\"  name=\"panel3\">\r\n\t\t\t\t\t<object id=\"WebOffice\" width=\"100%\" height=\"100%\" classid=\"clsid:");
      out.print(objClassId);
      out.write("\" codebase=\"");
      out.print(mClientUrl);
      out.write("\"></object>     \r\n\t\t\t\t\t</div>\r\n                </td>\r\n             </tr>\r\n             <tr style=\"display:none\">\r\n                <td bgcolor=menu height='20'><div id=StatusBar>状态栏</div></td>\r\n             </tr>\r\n           </table>\r\n        </td>\r\n      </tr>\r\n    </table>\r\n    <div align=\"center\" style=\"display:none\">\r\n    ");
if("1".equals(request.getParameter("CanSave"))){
      out.write("\r\n    <input id=\"input1\" type=\"submit\" value=\"  保存  \" ");
      out.print(mDisabled);
      out.write(" onclick=\"saveHTML();WebSaveAsHtml(); alert('保存成功！');\">\r\n    <script language=\"javascript\">\r\n    <!--\r\n    document.all.input1.style.color = \"red\";\r\n    document.all.input1.style.fontSize = \"20px\";\r\n    //-->\r\n    </script>\r\n    ");
}
      out.write("\r\n    <input id=\"input2\" type=\"button\" value=\"  返回  \" onclick=\"window.close();\">\r\n    <input id=\"input3\" type=\"button\" value=\" 显示痕迹 \" onclick=\"javascript:ShowRevision(true);\">\r\n\t<input id=\"input4\" type=\"button\" value=\" 隐藏痕迹 \" onclick=\"javascript:ShowRevision(false);\">\r\n    <script language=\"javascript\">\r\n    <!--\r\n    document.all.input2.style.color = \"red\";\r\n    document.all.input2.style.fontSize = \"20px\";\r\n    //-->\r\n    </script>\r\n    <script language=\"javascript\">\r\n    <!--\r\n    document.all.input3.style.color = \"red\";\r\n    document.all.input3.style.fontSize = \"20px\";\r\n    //-->\r\n    </script>\r\n    <script language=\"javascript\">\r\n    <!--\r\n    document.all.input4.style.color = \"red\";\r\n    document.all.input4.style.fontSize = \"20px\";\r\n    //-->\r\n    </script>\r\n    ");
if(request.getParameter("clear") != null){
      out.write("\r\n<!--     <input id=\"input3\" type=\"button\" value=\"  清稿  \" onclick=\"JSMainWinOpen('/jsoa/doc/doc/doc_sendfile_htmlEdit.jsp', '', 'status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,Height=400,left=0,top=0')\"> -->\r\n    <script language=\"javascript\">\r\n    <!--\r\n    document.all.input3.style.color = \"red\";\r\n    document.all.input3.style.fontSize = \"20px\";\r\n    //-->\r\n    </script>\r\n    ");
}
      out.write("\r\n    </div>\r\n    <input type=\"hidden\" name=\"htmlContent\">\r\n    <!--注意：只有选择《保存》后，所做的操作才有效！-->\r\n    ");
if(request.getParameter("fieldName") != null){
      out.write("\r\n    <input type=\"hidden\" name=\"fieldName\" value=\"");
      out.print(request.getParameter("fieldName"));
      out.write("\">\r\n    ");
}
      out.write('\r');
      out.write('\n');
      out.write('	');
if(request.getParameter("field") != null){
      out.write("\r\n    <input type=\"hidden\" name=\"fieldName\" value=\"");
      out.print(request.getParameter("field"));
      out.write("\">\r\n    ");
}
      out.write("\r\n  </form>\r\n</body>\r\n<script language=\"javascript\">\r\nfunction saveHTML(){\r\n    if(opener.document.all.htmlContent){\r\n        opener.document.all.htmlContent.value = document.all.htmlContent.value;\r\n    }\r\n}\r\nfunction onlySaveDoc(){\r\n\tSaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');\r\n\tdocument.all.FlagCloseWindow.value=\"0\";\r\n\twebform.submit();\r\n\talert(\"保存成功！\");\r\n}\r\nfunction saveAndCloseWin(){\r\n\tSaveDocument('");
      out.print(moduleType);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtmlImage);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveDocFile);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(isSaveHtml);
      out.write("');\r\n\tdocument.all.FlagCloseWindow.value=\"1\";\r\n\twebform.submit();\r\n\talert(\"保存成功！\");\r\n}\r\n</script>\r\n\r\n <iframe id=\"ifrm\" name=\"ifrm\" src=\"\" style=\"display:none;\"></iframe>\r\n</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
