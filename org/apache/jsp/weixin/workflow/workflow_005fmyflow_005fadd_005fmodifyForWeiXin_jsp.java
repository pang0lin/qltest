/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 09:59:03 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.weixin.workflow;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.util.ArrayList;
import java.util.List;
import com.js.oa.jsflow.service.WorkFlowBD;
import com.js.oa.jsflow.service.WorkFlowButtonBD;
import java.net.URLDecoder;
import com.js.util.util.BrowserJudge;
import com.js.oa.relproject.bean.RelProjectBean;
import com.js.system.util.StaticParam;
import com.js.oa.jsflow.service.WorkFlowBD;
import com.js.oa.jsflow.util.NewWorkflowUtil;
import java.util.List;
import com.js.oa.userdb.service.CustomDatabaseBD;
import com.js.oa.eform.service.CustomFormBD;
import com.js.util.config.SystemCommon;
import com.js.util.util.BrowserJudge;
import com.js.oa.weixin.common.util.WorkflowForWeiXinUtil;
import com.js.util.util.DataSourceBase;
import java.util.Random;
import com.js.lang.Resource;
import com.js.util.config.SystemCommon;
import com.js.util.util.BrowserJudge;
import java.util.*;

public final class workflow_005fmyflow_005fadd_005fmodifyForWeiXin_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {


private String dealWithColorCode(String html){
	int s = -1, e = -1;
	String temp = html, bgcolor = "", color = "";
	String[] colors = null;
	s = temp.indexOf("rgb(");
	while(s > -1){
		// 截取img标签
		temp = temp.substring(s + 4);
		e = temp.indexOf(")");
		bgcolor = temp.substring(0, e);
		colors = bgcolor.split(",");
		for(int i=0; i<colors.length; i++){
			color += Integer.toHexString(Integer.parseInt(colors[i].trim()));
		}
		
		if(!"".equals(color)){
			html = html.replace("rgb(" + bgcolor + ")", "#" + color);
			color = "";
		}
		s = temp.indexOf("rgb(");
	}
	return html;
}

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(9);
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-nested.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/weixin/workflow/workflow_include_middleHiddenForWeiXin.jsp", Long.valueOf(1499751476000L));
    _jspx_dependants.put("/weixin/workflow/eform/showform.jsp", Long.valueOf(1499751476000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-tiles.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-logic.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/weixin/workflow/workflow_include_commentForWeiXin.jsp", Long.valueOf(1499751476000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-html.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-template.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-bean.tld", Long.valueOf(1499751390000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("java.util");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.oa.jsflow.util.NewWorkflowUtil");
    _jspx_imports_classes.add("com.js.oa.eform.service.CustomFormBD");
    _jspx_imports_classes.add("com.js.oa.weixin.common.util.WorkflowForWeiXinUtil");
    _jspx_imports_classes.add("java.net.URLDecoder");
    _jspx_imports_classes.add("com.js.util.config.SystemCommon");
    _jspx_imports_classes.add("java.util.Random");
    _jspx_imports_classes.add("com.js.oa.jsflow.service.WorkFlowButtonBD");
    _jspx_imports_classes.add("com.js.util.util.BrowserJudge");
    _jspx_imports_classes.add("java.util.ArrayList");
    _jspx_imports_classes.add("java.util.List");
    _jspx_imports_classes.add("com.js.lang.Resource");
    _jspx_imports_classes.add("com.js.system.util.StaticParam");
    _jspx_imports_classes.add("com.js.oa.userdb.service.CustomDatabaseBD");
    _jspx_imports_classes.add("com.js.util.util.DataSourceBase");
    _jspx_imports_classes.add("com.js.oa.relproject.bean.RelProjectBean");
    _jspx_imports_classes.add("com.js.oa.jsflow.service.WorkFlowBD");
  }

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=utf-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n \r\n\r\n\r\n");

request.setCharacterEncoding("utf-8");
response.setHeader("Cache-Control","no-store");
response.setHeader("Pragma","no-cache");
response.setDateHeader ("Expires", 0);
String backto = (String) request.getAttribute("backto");

//办理查阅按钮
String modiButton = "none";

Boolean printRight = new com.js.oa.jsflow.service.WorkFlowBD().hasPrintRight(request.getParameter("processId"), 
		session.getAttribute("userId")==null ? "000" : session.getAttribute("userId").toString(), 
		session.getAttribute("orgId")==null ? "000" : session.getAttribute("orgId").toString(), 
		session.getAttribute("groupId")==null ? "000" : session.getAttribute("groupId").toString());


String workStatustr = request.getParameter("workStatus");
String resubmit = request.getParameter("resubmit");
String loginType = null!=session.getAttribute("loginType") ? session.getAttribute("loginType").toString() : "";

      out.write('\r');
      out.write('\n');
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/wap2/commonImport.jsp", out, false);
      out.write("\r\n<!DOCTYPE html>\r\n<html>\r\n\t");

	// 使用用户上传JSP文件
	if(request.getAttribute("formType")!=null && "1".equals(request.getAttribute("formType").toString().trim())){
		if(request.getAttribute("jspFile")!=null && !"NULL".equals(request.getAttribute("jspFile").toString().toUpperCase())){
        	response.sendRedirect("/jsoa/jsflow/" + request.getAttribute("jspFile").toString() 
        			+ "?search=&workTitle=" + "&activityName=" + request.getParameter("activityName") 
        			+ "&submitPersonId=" + request.getParameter("submitPersonId") + "&submitPerson=" 
        			+ request.getParameter("submitPerson") + "&work=" + request.getParameter("work") 
        			+ "&workType=" + request.getParameter("workType") + "&activity=" + request.getParameter("activity") 
        			+ "&table=" + request.getParameter("table") + "&record=" + request.getParameter("record") 
        			+ "&processName=" + request.getParameter("processName") + "&workStatus=" 
        			+ request.getParameter("workStatus") + "&submitTime=" + request.getParameter("submitTime") 
        			+ "&processId=" + request.getParameter("processId") + "&stepCount=" 
        			+ request.getParameter("stepCount") + "&isStandForWork=" + request.getParameter("isStandForWork") 
        			+ "&standForUserId=" + request.getParameter("standForUserId") + "&standForUserName=" 
        			+ request.getParameter("standForUserName"));
    	}else{
        	out.print("<SCRIPT LANGUAGE=\"JavaScript\">alert(\"请先设置流程使用JSP文件\");window.close();</SCRIPT>");
    	}
	}else{	// 使用自定义表单
		if(request.getParameter("close") != null){
			
      out.write("\r\n\t\t\t<script language=\"javascript\">\r\n\t\t\ttry{\r\n\t\t\t\t");

				if(request.getAttribute("search") == null || request.getAttribute("search").toString().equals("null")){
					
      out.write("opener.location.reload();");

				}else{
					
      out.write("\r\n\t\t\t\t\topener.location.href = \"/jsoa/FileDealWithAction.do?workStatus=0&search=");
      out.print(request.getAttribute("search") );
      out.write("&workTitle=");
      out.print(request.getAttribute("workTitle") );
      out.write("\";\r\n\t\t\t\t\t");

				}
				
      out.write("\r\n\t\t\t} catch(e){ }\r\n\t\t\twindow.close();\r\n\t\t\t</script>\r\n\t\t\t");

		}else{
			String processName = (String) request.getAttribute("processName");
			// 相关流程
			List listRelationWork = new ArrayList();
			if(request.getParameter("record") != null){
				listRelationWork = new com.js.oa.jsflow.service.WorkFlowButtonBD().getAllRelationWork(request.getParameter("processId"), 
						request.getParameter("table"), request.getParameter("record"), request.getParameter("work"));
			}
			String pageTitle = "";
			if("banli".equals(request.getParameter("option"))){
				pageTitle = request.getParameter("fileName")==null ? "" : request.getParameter("fileName");
			} else{
				pageTitle = processName;
			}
			
      out.write("\r\n\t\t\t<head>\r\n\t\t\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n\t\t\t\t");
      out.write("\r\n\t\t\t\t<title>");
      out.print(pageTitle );
      out.write("</title>\r\n\t\t\t\t<SCRIPT language=\"javascript\" src=\"public/date_picker/DateObject.js\"></SCRIPT>\r\n\t\t\t\t<SCRIPT language=\"javascript\" src=\"public/date_picker/DatePicker.js\"></SCRIPT>\r\n\t\t\t\t<SCRIPT language=\"javascript\" src=\"public/date_picker/editlib.js\"></SCRIPT>\r\n\t\t\t\t<SCRIPT language=\"javascript\" src=\"public/date_picker/tree.js\"></SCRIPT>\r\n\t\t\t\t<script language=\"javascript\" src=\"js/checkForm.js\"></script>\r\n\r\n\t\t\t\t<script src=\"/jsoa/js/weixin/standardModiForWeiXin.js\" language=\"javascript\"></script>\r\n\t\t\t\t<script type=\"text/javascript\" src=\"/jsoa/js/weixin/mobiscroll/js/jquery.mobile-1.3.0.min.js\"></script>\r\n\t\t\t\t<script type=\"text/javascript\" src=\"/jsoa/js/weixin/mobiscroll/js/mobiscroll.js\" ></script>\r\n\t\t\t\t<!-- 日期控件使用的js -->\r\n\t\t\t\t<script language=javascript src=\"/jsoa/eform/datetime/datetime_check.js\"></script>\r\n\t\t\t\t<script language=javascript src=\"/jsoa/eform/datetime/datetime_select.js\"></script>\r\n\t\t\t\t<!-- 日期控件使用的css -->\r\n\t\t\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/jsoa/public/date_picker/DateObject2.css\">\r\n\t\t\t\t<link href=\"/jsoa/js/weixin/mobiscroll/css/mobiscroll.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("\t \t\t\t\r\n\t \t\t\t<style type=\"text/css\">\r\n\t \t\t\t.nextStep{\r\n\t       \t \t\tdisplay: none;\r\n\t        \t\twidth: 100%;\r\n\t\t\t\t\theight: 100%;\r\n\t\t\t\t\tposition: fixed;\r\n\t\t\t\t\ttop: 0;\r\n\t\t\t\t\tleft: 0;\r\n\t\t\t\t\tz-index: 10000;\r\n\t\t\t\t\toverflow-y: auto;\r\n\t\t\t\t}\r\n\t\t\t\t</style>\r\n\t\t\t\t\r\n\t\t\t\t<script type=\"text/javascript\">\r\n\t\t\t    function a1() {\r\n\t\t\t        //opt1.dayText = 'day';\r\n\t\t\t        setCss(opt1);\r\n\t\t\t    }\r\n\t\t\t    function setCss(o) {\r\n\t\t\t        $('input:jqmData(role=\"datebox\")').mobiscroll(o);\r\n\t\t\t    }\r\n\t\t\t    function setDateInput(){\r\n\t\t\t    \topt1 = {\r\n\t\t\t\t            preset: 'date', \t\t\t// 日期\r\n\t\t\t\t            theme: 'jqm', \t\t\t\t// 皮肤样式\r\n\t\t\t\t            display: 'modal', \t\t\t// 显示方式 \r\n\t\t\t\t            mode: 'mixed', \t\t\t\t// 日期选择模式\r\n\t\t\t\t            dateFormat: 'yy-mm-dd', \t// 日期输出格式\r\n\t\t\t\t            dateOrder: 'yymmdd', \t\t// 面板中日期排列格式\r\n\t\t\t\t            setText: '确定', \t\t\t// 确认按钮名称\r\n\t\t\t\t            cancelText: '取消',\t\t\t// 取消按钮名籍我\r\n\t\t\t\t            dayText: '日', \t\t\t\t// 面板中日文字\r\n\t\t\t\t            monthText: '月', \t\t\t// 面板中月文字\r\n\t\t\t\t            yearText: '年', \t\t\t\t// 面板中年文字\r\n");
      out.write("\t\t\t\t            endYear: 2050, \t\t\t\t// 结束年份\r\n\t\t\t\t            hourText: '时',\r\n\t\t\t\t            minuteText: '分',\r\n\t\t\t\t            secText: '秒'\r\n\t\t\t\t        };\r\n\t\t\t\t        $('input:jqmData(role=\"datebox\")').mobiscroll(opt1);\r\n\t\t\t\t        //-----------------------\r\n\t\t\t\t        var curr = new Date().getFullYear();\r\n\t\t\t\t        var opt = {};\r\n\t\t\t\t        opt.date = { preset: 'date' };\r\n\t\t\t\t        opt.datetime = { preset: 'datetime', minDate: new Date(2012, 3, 10, 9, 22), maxDate: new Date(2014, 7, 30, 15, 44), stepMinute: 5 };\r\n\t\t\t\t        opt.time = { preset: 'time' };\r\n\t\t\t\t        $('select.changes').bind('change', function () {\r\n\t\t\t\t            var demo = $('#demo').val();\r\n\t\t\t\t            $(\".demos\").hide();\r\n\t\t\t\t            if (!($(\"#demo_\" + demo).length))\r\n\t\t\t\t                demo = 'default';\r\n\t\t\t\t            $(\"#demo_\" + demo).show();\r\n\t\t\t\t            $('#test_' + demo).val('').scroller('destroy').scroller($.extend(opt[$('#demo').val()], { dateOrder: 'yymmdd', theme: $('#theme').val(), mode: $('#mode').val(), display: $('#display').val(), lang: $('#language').val() }));\r\n");
      out.write("\t\t\t\t        });\r\n\t\t\t\t        $('#demo').trigger('change');\r\n\t\t\t    }\r\n\t\t\t    $(function () {\r\n\t\t\t    \tsetDateInput();\r\n\t\t\t    });\r\n\t\t\t\t</script>\r\n\t\t\t</head>\r\n\t\t\t");

			String backUrl = "closeWindow();";
			if(null != request.getParameter("fromAppMessage")){
				backUrl = "loadURL();";
			}
			
      out.write("\r\n\t\t\t<body onload=\"loadToolbar('weixin_butsDiv');init();\" class=\"MainFrameBox PupwinForFlow paddingTop\" style=\"background: #fff;\">\r\n\t\t\t\t");

				if("wap".equals(loginType)){
					
      out.write("\r\n\t\t\t\t\t<div id=\"mainpage_navdiv\" class=\"top\">\r\n\t\t\t\t    \t");
      out.write("\r\n\t\t\t\t    \t<a id=\"mainpage_backurl\" href=\"javascript:");
      out.print(backUrl );
      out.write("\">\t\r\n\t\t\t\t    \t\t<img width=\"20\" height=\"15\" src=\"wap2/images/topfh.png\">\r\n\t\t\t\t    \t</a>\r\n\t\t\t\t    \t<p id=\"mainpage_title\">");
      out.print(pageTitle );
      out.write("</p>\r\n\t\t\t    \t</div>\r\n\t\t\t\t\t");

				}
				
      out.write("\r\n\t\t\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/common/weixin_messageReminders.jsp", out, false);
      out.write("\r\n\t\t\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/common/weixin_buttons.jsp", out, false);
      out.write("\r\n\t\t\t\t<div class=\"weixin_buttonsBar\">\r\n\t\t\t\t\t<div id=\"weixin_butsDiv\"></div>\r\n\t\t\t\t\t<div id=\"weixinDealwithBut\" class=\"weixin_button weixin_gray\" onclick=\"weixin_showButs(this)\">处&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;理</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<form name=\"frm\" id=\"frm\" method=\"post\">\r\n\t\t\t\t\t<div id=\"panleAll\" style=\"padding: 1%; width: 98%;\">\r\n\t\t\t\t\t\t");

		               	if(!"banli".equals(request.getParameter("option"))){
		               		
      out.write("\r\n\t\t              \t\t<span id=\"Panle0\" onclick=\"changePanle(0);\" style=\"color:red; font-size: 12px; padding-left: 15px;\">表单信息</span>\r\n\t\t\t\t\t  \t\t");

					  		// 流程类型 0随机流程,1业务流程
					   		int inWorkType = (request.getParameter("workType")==null || "null".equals(request.getParameter("workType"))) ? 
					   				-1 : Integer.parseInt(request.getParameter("workType"));
					   		if(!BrowserJudge.isMSIE(request)){
					   			inWorkType = 0;
					   		}
					   		
      out.write("\r\n\t\t              \t\t| <span id=\"Panle1\" onclick=\"changePanle(1);\" style=\"color:black; font-size: 12px;\">\r\n\t\t              \t\t\t");
      if (_jspx_meth_bean_005fmessage_005f0(_jspx_page_context))
        return;
      out.write("\r\n\t\t              \t\t</span>\r\n\t\t              \t\t");

						}
						
      out.write("\r\n\t\t\t\t\t \t| <span id=\"Panle6\" onclick=\"changePanle(6);\" style=\"color:black; font-size: 12px;\">流程描述</span>\r\n\t\t\t\t\t\t");

						if(printRight.booleanValue() && !"banli".equals(request.getParameter("option"))){
							
      out.write("\r\n\t\t\t\t\t\t\t<!--\r\n\t\t\t\t\t\t\t<span id=\"Panle2\" onclick=\"changePanle(2);\" style=\"color: black;\">打印预览</span>\r\n\t\t              \t\t<span id=\"Panle3\" onclick=\"changePanle(3);\" style=\"color: black;\">导出WORD</span>\r\n\t\t \t\t\t\t\t-->\r\n\t\t \t\t\t\t\t");

		 				}
		 				
      out.write("\r\n\t\t\t\t\t \t<span id=\"Panle4\" onclick=\"changePanle(4);\" style=\"color: black; font-size: 12px;\">\r\n\t\t\t\t\t \t\t| ");
      if (_jspx_meth_bean_005fmessage_005f1(_jspx_page_context))
        return;
      out.write("\r\n\t\t\t\t\t \t</span>\r\n\t\t\t\t\t \t");

			           	String activityDescription = request.getAttribute("activitydescription")==null ? 
			           			"" : (request.getAttribute("activitydescription").toString());
		               	if(activityDescription!=null && !"".equals(activityDescription) 
		               			&& !"null".equals(activityDescription) && !"NULL".equals(activityDescription)){
		             		
      out.write("\r\n\t\t\t\t\t \t\t<span id=\"Panle5\" onclick=\"changePanle(5);\" style=\"color: black; font-size: 12px;\">\r\n\t\t\t\t\t \t\t\t| ");
      if (_jspx_meth_bean_005fmessage_005f2(_jspx_page_context))
        return;
      out.write("\r\n\t\t\t\t\t \t\t</span>\r\n\t\t\t\t\t \t\t");

					 	} else{
					 		
      out.write("\r\n\t\t\t\t\t   \t\t<span id=\"Panle5\" onclick=\"changePanle(5);\" style=\"color:black; display:none; font-size: 12px;\">\r\n\t\t\t\t\t   \t\t\t| ");
      if (_jspx_meth_bean_005fmessage_005f3(_jspx_page_context))
        return;
      out.write("\r\n\t\t\t\t\t   \t\t</span>\r\n\t\t\t\t\t \t\t");

					 	}
					  	if(listRelationWork!=null && listRelationWork.size()>0){
					 		
      out.write("\r\n\t\t\t\t\t \t\t| <span id=\"Panle7\" onclick=\"changePanle(7);\" style=\"color: black; display: none; font-size: 12px;\">相关流程</span>\r\n\t\t\t\t\t \t\t");

					 	}else{
					 		
      out.write("\r\n\t\t\t\t\t   \t\t<span id=\"Panle7\" onclick=\"changePanle(7);\" style=\"color:black; display:none; font-size: 12px;\">相关流程</span>\r\n\t\t\t\t\t \t\t");

					 	}
					 	
      out.write(" \r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<div id=\"formBody\" style=\"padding: 1%; width: 98%; overflow: auto; margin: 0 auto; text-align: center; padding-bottom: 60px;\">\r\n\t\t\t\t\t\t<div id=\"showHtmlDiv\" class=\"scrollBox\">\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"myaction\">\r\n           \t\t\t\t\t<!--搜索参数-->\r\n           \t\t\t\t\t");

           					String search = request.getParameter("search");
           					String workTitle = request.getParameter("workTitle");
           					String work = request.getParameter("work");
           					String submitTime = request.getParameter("submitTime");
           					if(null!=search && !"".equals(search)) search = URLDecoder.decode(search, "utf-8");
           					if(null!=workTitle && !"".equals(workTitle)) workTitle = URLDecoder.decode(workTitle, "utf-8");
           					if(null!=work && !"".equals(work)) work = URLDecoder.decode(work, "utf-8");
           					if(null!=submitTime && !"".equals(submitTime)) submitTime = URLDecoder.decode(submitTime, "utf-8");
           					
      out.write("\r\n\t\t                   \t<input type=\"hidden\" name=\"search\" value=\"");
      out.print(search );
      out.write("\">\r\n\t\t                   \t<input type=\"hidden\" name=\"workTitle\" value=\"");
      out.print(workTitle );
      out.write("\">\r\n\t\t                   \t<input type=\"hidden\" name=\"work\" value=\"");
      out.print(work );
      out.write("\">\r\n\t\t                   \t<input type=\"hidden\" name=\"submitTime\" value=\"");
      out.print(submitTime );
      out.write("\">\r\n\t\t                   \t<input type=\"hidden\" id=\"backto\" value=\"");
      out.print(backto);
      out.write("\"/>\r\n\t\t                   \t");

		                   	String pageId = "";	// 自定义表单ID
		                   	if(request.getAttribute("formId")!=null && request.getAttribute("formId").toString().length()>0 
		                   		&& !request.getAttribute("formId").toString().toUpperCase().equals("NULL")){
		                       	pageId = request.getAttribute("formId").toString();
		                   	}else{
		                       	pageId = request.getAttribute("tableId").toString();
		                   	}
		                   	
		                  	//获取移动端的pageId
		                   	String mobilePageId=new com.js.oa.jsflow.service.WorkFlowButtonBD().getMobilePageId(pageId);
		                   	if(!"".equals(mobilePageId) && mobilePageId!=null && !"null".equals(mobilePageId)){
		                   		pageId=mobilePageId;
		                   	}
		                   	request.setAttribute("infoId", request.getParameter("record"));	// 修改信息的ID
		                   	//request.setAttribute("hideField",request.getAttribute("hideField"));	// 设置所有字段不可编辑
		                  	
      out.write("\r\n\t\t                  \t<div name=\"printNum\" id=\"printNum\" style=\"display:none\"></div>\r\n\t\t\t\t\t\t\t<div name=\"printNum\" id=\"printNum\"></div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div id=\"docinfo0\">\r\n\t\t\t\t\t\t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"2\" cellspacing=\"1\">\r\n\t\t\t\t\t\t\t\t\t");

									if(request.getAttribute("formContent")!=null 
										&& request.getAttribute("formContent").toString().length()>0){
										
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t<tr style=\"display:");
      out.print("banli".equals(request.getParameter("option")) ? "none" : "" );
      out.write("\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td id=\"formTable\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t");
      out.print(request.getAttribute("formContent"));
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t");

									}else{
										
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t<tr style=\"display:");
      out.print("banli".equals(request.getParameter("option"))?"none":"");
      out.write("\">\r\n\t\t\t\t\t\t\t\t\t\t\t<td id=\"formTable\">\r\n\t\t\t\t\t\t\t           \t\t\t<div name=\"printNum\" id=\"printNum\" align=\"right\" style=\"display:none\"></div>\r\n\t\t\t\t\t\t\t            \t\t");
      out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n");
      out.write("\r\n\r\n");

request.setCharacterEncoding("utf-8");
CustomFormBD cst = new CustomFormBD();
CustomDatabaseBD userDB = new CustomDatabaseBD();
String scriptappend = "";
String domainId = session.getAttribute("domainId")==null?"0":session.getAttribute("domainId").toString();
String parent_fromDraft="draftForm".equals(request.getParameter("action"))?"1":"0";
if("1".equals(request.getParameter("resubmit"))){
	parent_fromDraft="1";
}
String hideTableHTML = "";
String showTableHTML = "";
List boxFieldList = userDB.getOnchangeMethodInfo(pageId,domainId);

//读取隐藏字段（不可编辑字段）
String hide_Field = request.getAttribute("hideField")==null ? "" : request.getAttribute("hideField").toString();
String noDisplayFields="";
if(request.getAttribute("initActivity")!=null){
	noDisplayFields=new NewWorkflowUtil().getNoDisplayField(request.getAttribute("initActivity").toString(),request.getParameter("work"));
}else{
	if(request.getParameter("initActivity")!=null){
		noDisplayFields=new NewWorkflowUtil().getNoDisplayField(request.getParameter("initActivity").toString(),request.getParameter("work"));
	}else{
		//发起时去掉隐藏的字段
		noDisplayFields=new NewWorkflowUtil().getFirstActivityNoDisplayField(request.getParameter("processId"));
	}
	
}

      out.write("\r\n\r\n<style type=\"text/css\">\r\n.flowInput { behavior: url(/jsoa/js/validate.htc); /*border:1px solid #E8E8E8;*/}\r\n.flowInputRed { behavior: url(/jsoa/js/formvalidate.htc); /*border:1px solid #E8E8E8;*/}\r\n.flowInputenter { border: 1px solid blue;}\r\n.mustwrite { border: 1px solid red;}\r\n.divnowrap { meizz: expression(this.noWrap=true);}\r\n/*必填提醒颜色*/\r\n.mustFillcolor, .mustFillcolo:link, .mustFillcolo:hover { color:#FF0000; font-size:12px;}\r\n</style>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/jsoa/eform/ext/resources/css/ext-all-jiusi.css\"/>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/adapter/ext/ext-base.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/ext-all.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/js/ajax.js\"></script>\r\n<SCRIPT type=\"text/javascript\">\r\n// 必填的word和excel控件，添加默认的空白文档\r\nfunction getDocModel(field, fileType){\r\n\t$.ajax({\r\n\t\ttype : \"post\",\r\n\t\turl : \"/jsoa/weiXinCommonAction.do?action=fileModel&fileType=\" + fileType,\r\n\t\tasync : false,\r\n\t\tdataType : \"text\",\r\n");
      out.write("\t\tsuccess : function(returnData){ $(\"#\" + field).val(returnData);},\r\n\t\terror : function(XMLHttpRequest, textStatus, errorThrown){ },\r\n\t\tcomplete : function(XHR, TS){ XHR = null;}\r\n\t});\r\n}\r\nvar currentRow = null;\t\r\nvar tblTR = new Array();\r\nvar tblTRHTML = new Array();\r\n");

//取设置了检索的字段信息
  
//取设置了提取数据的字段信息

      out.write("\r\nvar tempComboBoxStore = new Array();\r\nvar tempSelectHtml = new Array();\r\nvar tempCombofieldObjArr=new Array();\r\nvar tempComboBoxCntArr=new Array();\r\nExt.onReady(function(){\r\n\t//Ext.QuickTips.init();\r\n\t");

	String[] fieldObj;
	String hide_field_readonly = "," + hide_Field + ",";
	for(int fi=0; fi<boxFieldList.size(); fi++){
		fieldObj = (String[]) boxFieldList.get(fi);
		if("1".equals(fieldObj[2])){
			//需要输入检索
			if (hide_field_readonly.indexOf(","+fieldObj[0]+",") >= 0 || hide_field_readonly.indexOf(fieldObj[1]) >= 0) {
				//如果是只读字段则不使用输入样式
				continue;
			} else{
				
      out.write("\r\n\t\t\t\t//记录字段值\r\n\t\t\t\tvar tempCombofieldObj={};\r\n\t\t\t\ttempCombofieldObj.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\t\t\t\ttempCombofieldObj.val=");
      out.print(net.sf.json.JSONArray.fromObject(fieldObj));
      out.write(";\r\n\t\t\t\ttempCombofieldObjArr[tempCombofieldObjArr.length]=tempCombofieldObj;\r\n\t\t\t\t//记录html\r\n\t\t\t\tvar tempSelectHtmlObj={};\r\n\t\t\t\ttempSelectHtmlObj.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\t\t\t\ttempSelectHtmlObj.val=document.getElementById(\"");
      out.print(fieldObj[1]);
      out.write("\").parentNode.parentNode.innerHTML;\r\n\t\t\t\ttempSelectHtml[tempSelectHtml.length]=tempSelectHtmlObj;\r\n\t\t\t\textWidth = document.getElementById(\"");
      out.print(fieldObj[1]);
      out.write("\")==null?extWidth:document.getElementById(\"");
      out.print(fieldObj[1]);
      out.write("\").offsetWidth+\"px\";\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar cb");
      out.print(fi);
      out.write(" = new Ext.form.ComboBox({\r\n\t\t\t\t\t\ttypeAhead: true,\r\n\t\t\t\t\t\ttriggerAction: 'all',\r\n\t\t\t\t\t\ttransform:'");
      out.print(fieldObj[1]);
      out.write("',\r\n\t\t\t\t\t\twidth:'200',\r\n\t\t\t\t\t\tforceSelection:true,\r\n\t\t\t\t\t\t//listClass:'inputText',\r\n\t\t\t\t\t\tminListWidth:205+2+2,\t\t\t\r\n\t\t\t\t\t\tlisteners:{\r\n\t\t\t\t        \tselect:{\r\n\t\t\t\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t\t\t\t");
if(!"0".equals(fieldObj[3])){
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t");
      out.print(fieldObj[1]);
      out.write("_onchange(combo);\r\n\t\t\t\t\t\t\t\t\t");
}
      out.write("\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t        \t},\r\n\t\t\t\t\t\t\t'beforequery':function(e){         \r\n\t\t\t\t\t\t \t\tvar combo = e.combo;    \r\n\t\t\t\t\t\t \t\tif(!e.forceAll){    \r\n\t\t\t\t\t\t  \t\t\tvar input = e.query;    \r\n\t\t\t\t\t\t  \t\t\t// 检索的正则  \r\n\t\t\t\t\t\t\t\t\t var regExp = new RegExp(\".*\" + input + \".*\");  \r\n\t\t\t\t\t\t\t\t\t// 执行检索  \r\n\t\t\t\t\t\t\t\t\t combo.store.filterBy(function(record,id){    \r\n\t\t\t\t\t\t \t\t\t\t// 得到每个record的项目名称值  \r\n\t\t\t\t\t\t\t\t\t\tvar text = record.get(combo.displayField);    \r\n\t\t\t\t\t\t\t\t\t\treturn regExp.test(text);   \r\n\t\t\t\t\t\t\t\t\t });  \r\n\t\t\t\t\t\t\t\t\t combo.expand();    \r\n\t\t\t\t\t\t\t\t\treturn false;  \r\n\t\t\t\t\t\t     }  \r\n\t\t\t\t\t\t   }  \r\n\t\t\t\t\t\t}\r\n\t\t\t\t    });\r\n\t\t\t\t\tcb");
      out.print(fi);
      out.write(".el.setStyle({\r\n\t\t\t\t\t\twidth:'152px',\r\n\t\t\t\t\t\ttop:'0.1px'\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//记录数据源\r\n\t\t\t\t\tvar tempComboBoxStoreObj={};\r\n\t\t\t\t\ttempComboBoxStoreObj.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\t\t\t\t\ttempComboBoxStoreObj.val=cb");
      out.print(fi);
      out.write(".store;\r\n\t\t\t\t\ttempComboBoxStore[tempComboBoxStore.length]=tempComboBoxStoreObj;\r\n\t\t\t\t\t//记录个数\r\n\t\t\t\t\tvar tempComboBoxCnt={};\r\n\t\t\t\t\ttempComboBoxCnt.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\t\t\t\t\ttempComboBoxCnt.val=1;\r\n\t\t\t\t\ttempComboBoxCntArr[tempComboBoxCntArr.length]=tempComboBoxCnt;\r\n\t\t\t\t}catch(ee){ }\r\n\t\t\t\t");

			}
		}
	}
	
      out.write("\r\n\ttempComboBoxCreateFun();\r\n});\r\nfunction tempComboBoxCreateFun1(vid){\r\n\tvar r=-1;\r\n\tfor(var j=0;j<tempComboBoxStore.length;j++){\r\n\t\t if(vid.indexOf(tempComboBoxStore[j].id)>=0){\r\n\t\t\t r=j;\r\n\t\t\t break;\r\n\t\t }\r\n\t }\r\n\treturn r;\r\n}\r\n  function tempComboBoxCreateFun(){\r\n\t  if(tempComboBoxStore.length>0){\r\n\t\t  \r\n\t\t  var oobj=document.getElementsByName(tempComboBoxStore[0].id)[0];\r\n\t\t  while(oobj.nodeName!=\"TBODY\"){\r\n\t\t\t  oobj=oobj.parentNode;\r\n\t\t  }\r\n\t\t  var tempSelect=oobj.getElementsByTagName(\"select\");\r\n\t\t if(tempSelect.length==0){\r\n\t\t\t return;\r\n\t\t }\r\n\t\t for(var i=tempSelect.length-1;i>=0;i--){\r\n\t\t\t var tempXh=tempComboBoxCreateFun1(tempSelect[i].id);\r\n\t\t\t if(tempXh != -1){\r\n\t\t\t\t//判断当id重复时增加后缀\r\n\t\t\t\t if(tempComboBoxCntArr[tempXh].id==tempSelect[i].id){\r\n\t\t\t\t\t var tt=parseInt(tempComboBoxCntArr[tempXh].val);\r\n\t\t\t\t\t tempSelect[i].id=tempSelect[i].id+\"_\"+tt;\r\n\t\t\t\t\t tempComboBoxCntArr[tempXh].val=tt++;\r\n\t\t\t\t }\r\n\t\t\t\t extWidth = document.getElementById(tempSelect[i].id)==null?extWidth:document.getElementById(tempSelect[i].id).offsetWidth+\"px\";\r\n");
      out.write("\t\t\t\t\tnew Ext.form.ComboBox({\r\n\t\t\t\t\t\ttypeAhead: true,\r\n\t\t\t\t\t\ttriggerAction: 'all',\r\n\t\t\t\t\t\ttransform:tempSelect[i].id,\r\n\t\t\t\t\t\tforceSelection:true,\t\t\r\n\t\t\t\t\t\tlisteners:{\r\n\t\t\t\t        \tselect:{\r\n\t\t\t\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tvar tempTransform = tempComboBoxCreateFun1(combo.transform);\r\n\t\t\t\t\t\t\t\t\tvar tempf=tempCombofieldObjArr[tempTransform].val;\r\n\t\t\t\t\t\t\t\t\tif(tempf[3]!=0){\r\n\t\t\t\t\t\t\t\t\t\t//tempComboBox_onchange(combo,tempf);\r\n\t\t\t\t\t\t\t\t\t\ttempComboBox_onchange1(combo);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t        \t},\r\n\t\t\t\t\t\t\t'beforequery':function(e){         \r\n\t\t\t\t\t\t \t\tvar combo = e.combo;    \r\n\t\t\t\t\t\t \t\tif(!e.forceAll){    \r\n\t\t\t\t\t\t  \t\t\tvar input = e.query;    \r\n\t\t\t\t\t\t  \t\t\t// 检索的正则  \r\n\t\t\t\t\t\t\t\t\t var regExp = new RegExp(\".*\" + input + \".*\");  \r\n\t\t\t\t\t\t\t\t\t// 执行检索  \r\n\t\t\t\t\t\t\t\t\t combo.store.filterBy(function(record,id){    \r\n\t\t\t\t\t\t \t\t\t\t// 得到每个record的项目名称值  \r\n\t\t\t\t\t\t\t\t\t\tvar text = record.get(combo.displayField);    \r\n\t\t\t\t\t\t\t\t\t\treturn regExp.test(text);   \r\n\t\t\t\t\t\t\t\t\t });  \r\n\t\t\t\t\t\t\t\t\t combo.expand();    \r\n");
      out.write("\t\t\t\t\t\t\t\t\treturn false;  \r\n\t\t\t\t\t\t     }  \r\n\t\t\t\t\t\t   }  \r\n\t\t\t\t\t\t}\r\n\t\t\t\t    });\r\n\t\t\t }\r\n\t\t\t \r\n\t\t }\r\n\t\t \r\n      }\r\n\t\t\r\n\t}\r\n//构造字段onchange事件\r\n");

for(int fi=0; fi<boxFieldList.size(); fi++){
	fieldObj = (String[]) boxFieldList.get(fi);
	if(!"0".equals(fieldObj[3]) || "1".equals(fieldObj[12])){
		//onchange fangfa
		
      out.write("\t\r\n\t\tfunction ");
      out.print(fieldObj[1]);
      out.write("_onchange(obj){\r\n\t\t\tvar curIndex = 0;\r\n\t\t\tvar curObj;\r\n\t\t    if(obj.name!=undefined){\r\n\t\t    \tcurObj=document.getElementsByName(obj.name);\r\n\t\t    }else{\r\n\t\t    \tcurObj=document.getElementsByName(obj.hiddenName);\r\n\t\t    \tobj = obj.wrap.dom.childNodes[0];\r\n\t\t    }\r\n\t\t\tfor(var i=0; i<curObj.length; i++){\r\n\t\t\t\tif(curObj[i] == obj){\r\n\t\t\t\t\tcurIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t");

			if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				out.print(fieldObj[5]);
			}
			
      out.write("\r\n\t\t\tvar selValue=obj.value;\r\n\t\t\tselValue=escape(escape(selValue));\r\n\t\t\t\r\n\t\t\t//获取sql语句中的参数\r\n\t\t    var _postData=\"\";\r\n\t\t    ");

		    String _fetchSQL=fieldObj[4]==null?"":fieldObj[4];
		    String[] _fetchSQLArr=_fetchSQL.split("\\@\\@");
		    for(int si=0;si<_fetchSQLArr.length;si++){
		    	if(!"".equals(_fetchSQLArr[si]) && _fetchSQLArr[si].indexOf(" ")<0 && !"curYear".equals(_fetchSQLArr[si]) && !"curMonth".equals(_fetchSQLArr[si])){
		    		
      out.write("\r\n\t\t    \t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")){\r\n\t\t    \t\t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\").length==1){\r\n\t\t    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[0].value;\r\n\t\t    \t\t\t}else{\r\n\t\t    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[curIndex].value;\r\n\t\t    \t\t\t}\r\n\t\t    \t\t}\r\n\t\t    \t\t");

		    	}
		    }    
		    
      out.write(" \r\n\t\t    \r\n\t\t\t");

			if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				
      out.write("\r\n\t\t\t\t// 提取数据\r\n\t\t\t\tvar selValue = obj.value;\r\n\t\t\t\tvar submitPersonObj = document.getElementsByName(\"submitPersonId\");\r\n\t\t\t\tvar submitPersonId = \"\";\r\n\t\t\t\tif(submitPersonObj.length > 0){\r\n\t\t\t\t\tsubmitPersonId = submitPersonObj[0].value;\r\n\t\t\t\t}\r\n\t\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&submitPersonId=\"+submitPersonId+\"&selValue=\"+selValue+_postData,\"\",showFormSubData);\r\n\t\t\t\t");

			}
			if(fieldObj[12]!=null && "1".equals(fieldObj[12])){
				if(fieldObj[9]!=null && fieldObj[10]!=null){
					
      out.write("\r\n\t\t\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata_inteface.jsp?transValue=\"+obj.value+\"&curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("\",\"\",showInteface_Data);\r\n\t\t\t\t\t");

				}
			}
			
			
      out.write("\r\n\t\t}\r\n\t\tfunction tempComboBox_onchange1(obj){\r\n\t\t    var curIndex=0;\r\n\t\t    var curObj;\r\n\t\t    if(obj.name!=undefined){\r\n\t\t    \tcurObj=document.getElementsByName(obj.name);\r\n\t\t    }else{\r\n\t\t    \tcurObj=document.getElementsByName(obj.hiddenName);\r\n\t\t    \tobj = obj.wrap.dom.childNodes[0];\r\n\t\t    }\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n\t\t    ");

		    if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				out.print(fieldObj[5]);
			}
		    
      out.write("\r\n\t\t    var selValue=obj.value;\r\n\t\t    selValue=escape(escape(selValue));\r\n\t\t    \r\n\t\t    var _postData=\"\";\r\n\t\t    ");

		    for(int si=0;si<_fetchSQLArr.length;si++){
		    	if(!"".equals(_fetchSQLArr[si]) && _fetchSQLArr[si].indexOf(" ")<0 && !"curYear".equals(_fetchSQLArr[si]) && !"curMonth".equals(_fetchSQLArr[si])){
		    		
      out.write("\r\n\t\t    \t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")){\r\n\t\t    \t\t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\").length==1){\r\n\t\t    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[0].value;\r\n\t\t    \t\t\t}else{\r\n\t\t    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[curIndex].value;\r\n\t\t    \t\t\t}\r\n\t\t    \t\t}\r\n\t\t    \t\t");

		    	}
		    }    
		    
      out.write(" \r\n\t\t   \r\n\t\t\t");

			if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				
      out.write("\r\n\t\t\t\t//提取数据\t\t\r\n\t\t\t\tvar submitPersonIdObj=document.getElementsByName(\"submitPersonId\");\r\n\t\t\t\tvar submitPersonObj=document.getElementsByName(\"submitPerson\");\r\n\t\t\t\tvar submitPersonId=\"\",submitPerson=\"\";\r\n\t\t\t\tif(submitPersonIdObj.length>0){\r\n\t\t\t\t\tsubmitPersonId=submitPersonIdObj[0].value;\r\n\t\t\t\t}\r\n\t\t\t\tif(submitPersonObj.length>0){\r\n\t\t\t\t\tsubmitPerson=submitPersonObj[0].value;\r\n\t\t\t\t}\r\n\t\t\t\tsubmitPerson=escape(escape(submitPerson));\r\n\t\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&submitPersonId=\"+submitPersonId+\"&submitPerson=\"+submitPerson+\"&selValue=\"+selValue+_postData,\"\",showFormSubData);\r\n\t\t\t\t");

			}
			if(fieldObj[12]!=null&&"1".equals(fieldObj[12])){
				if(fieldObj[9]!=null && fieldObj[10]!=null){
			
      out.write("\r\n\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata_inteface.jsp?transValue=\"+selValue+\"&curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("\",\"\",showInteface_Data);\r\n\t\t\t");

			}}
			
      out.write("\r\n\t\t}\r\n\t\t");

	}
	// 输入检索的回车触发事件
	if("450".equals(fieldObj[7])){
		
      out.write("\r\n\t\tfunction ");
      out.print(fieldObj[1]);
      out.write("_enter(obj){\r\n\t\t\tvar curIndex = 0;\r\n\t\t\tvar curObj = document.getElementsByName(obj.name);\r\n\t\t\tfor(var i=0; i<curObj.length; i++){\r\n\t\t\t\tif(curObj[i]==obj){\r\n\t\t\t\t\tcurIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar inputValueObj = document.getElementsByName(\"");
      out.print(fieldObj[1]);
      out.write("_temp\");\r\n\t\t\tvar inputValue = inputValueObj[curIndex].value;\t\r\n\t\t\tvar submitPersonObj = document.getElementsByName(\"submitPersonId\");\r\n\t\t\tvar submitPersonId = \"\";\r\n\t\t\tif(submitPersonObj.length > 0){\r\n\t\t\t\tsubmitPersonId = submitPersonObj[0].value;\r\n\t\t\t}\r\n\t\t\t// 如果是程序调用需解析参数\r\n\t\t\tvar interfacePara = \"\";\r\n\t\t\t");

			if(fieldObj[8]!=null && fieldObj[8].startsWith("$[interface")){
				
      out.write("\r\n\t\t\t\tinterfacePara = \"&getDataFlag=1\";\r\n\t\t\t\t");
		
				if(fieldObj[8].indexOf(";;;;") > 0){			
					//有设置参数 @@ 表示表单中字段  @$@ 表示默认字段
					String interfaceParaStr = fieldObj[8].substring(fieldObj[8].indexOf(";;;;")+4,fieldObj[8].length()-1);			
					String[] interfaceParaArr = interfaceParaStr.split(",");			
					String interfaceParaTemp;
					for(int interi=0; interi<interfaceParaArr.length; interi++){				
						if(interfaceParaArr[interi].startsWith("@@")){					
							//表单中的值组织参数
							interfaceParaTemp = interfaceParaArr[interi].substring(2,interfaceParaArr[interi].length()-2);
							if(interfaceParaTemp.equals(fieldObj[1])){
								
      out.write("\r\n\t\t\t\t\t\t\t\tvar fieldText = \"\";\r\n\t\t\t\t\t\t\t\tif(curIndex > 0){\r\n\t\t\t\t\t\t\t\t\tvar objTemp = document.getElementsByName(\"");
      out.print(interfaceParaTemp);
      out.write("_temp\");\r\n\t\t\t\t\t\t\t\t\tfieldText = objTemp[curIndex].value;\r\n\t\t\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\t\t\tfieldText = document.getElementById(\"");
      out.print(interfaceParaTemp);
      out.write("_temp\").value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinterfacePara += \"&");
      out.print(interfaceParaTemp);
      out.write("=\"+fieldText;\r\n\t\t\t\t\t\t\t\t");

							} else{
								
      out.write("\r\n\t\t\t\t\t\t\t\tvar fieldText = \"\";\r\n\t\t\t\t\t\t\t\tif(curIndex > 0){\r\n\t\t\t\t\t\t\t\t\tvar objTemp = document.getElementsByName(\"");
      out.print(interfaceParaTemp);
      out.write("\");\r\n\t\t\t\t\t\t\t\t\tfieldText = objTemp[curIndex].value;\r\n\t\t\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\t\t\tfieldText = document.getElementById(\"");
      out.print(interfaceParaTemp);
      out.write("\").value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinterfacePara+=\"&");
      out.print(interfaceParaTemp);
      out.write("=\"+fieldText;\r\n\t\t\t\t\t\t\t\t");

							}
						}
					}
				}
			}
			
      out.write("\r\n\t    \r\n\t\t\tdocument.getElementById(\"messageBodyFilter\").style.display = \"block\";\r\n\t\t\tdocument.getElementById(\"curIndex\").value=curIndex;\r\n\t\t\tdocument.getElementById(\"fieldName\").value=\"");
      out.print(fieldObj[1]+"");
      out.write("\";\r\n\t\t\tvar url = \"/jsoa/weiXinFormDataFilterAction.do?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&fieldName=");
      out.print(fieldObj[1]);
      out.write("&submitPersonId=\"+submitPersonId+\"&inputValue=\"+encodeURI(encodeURI(inputValue+interfacePara)); \r\n\t\t\t$.post(url, {}, function(returnHTML){\r\n\t\t\t\tcallbackCorp(returnHTML)\r\n\t\t\t}, \"JSON\");\r\n     \r\n\t\t\t");

			if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				out.print(fieldObj[5]);
			}
			
      out.write("\r\n\t\t}\r\n\t\tfunction callbackCorp(data){\r\n   \r\n\t\t\tvar i = 0, index = 0, dataIndex = 0, listClass; \r\n\t\t\tvar aryHead = new Array();\r\n\t\t\tvar ss = eval(data);\r\n\t\t\taryHead = ss[0].filterListField;\r\n\t\t\tvar aryList = new Array();    \r\n\t\t\taryList = ss[0].list;   \r\n\t\t\tvar str = \"\";\r\n\t\t\tvar fileTitle = \"\";\r\n\t\t\tstr += \"<table  width=\\\"100%\\\" border=\\\"0\\\" cellpadding=\\\"0\\\" cellspacing=\\\"0\\\" >\";\r\n\t\t\tstr += \"<tr align='center'>\";\r\n\t\t\tfor(var i=0; i<aryHead.length; i++){\r\n\t\t\t\tstr += \"<td align='center' height=\\\"30px\\\" style='border-right:1px solid #acacac;' >\"+aryHead[i][0]+\"</td>\";\r\n\t\t\t}\r\n\t\t\tstr += \"<td align='center' height=\\\"30px\\\" style='border-right:1px solid #acacac;'>操作</td>\";\r\n\t\t\tstr += \"</tr>\";\r\n\t\t\tfor(var s=0; s<aryList.length; s++){\r\n\t\t\t    str += \"<tr align='center'>\";\r\n\t\t\t    index ++;\r\n\t\t\t\tif(index%2 != 0){\r\n\t\t\t\t     listClass=\"listTableLine2\";\r\n\t\t\t\t} else{\r\n\t\t\t\t     listClass=\"listTableLine1\";\r\n\t\t\t\t}\r\n\t\t\t    for(var j=0; j<aryHead.length; j++){\r\n\t\t\t\t\tif(aryHead[j][2]!=null){\r\n\t\t\t\t\t\tdataIndex = Number(aryHead[j][2]);\r\n");
      out.write("\t\t\t\t\t} else{\r\n\t\t\t\t\t\tdataIndex = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstr += \"<td height=\\\"30px\\\" style='border-right:1px solid #acacac;' class=\"+listClass+\">&nbsp;\"+aryList[s][dataIndex]+\"</td>\";\r\n\t\t\t\t}\r\n\t\t\t\tstr += \"<td height=\\\"30px\\\" style='border-right:1px solid #acacac;' class=\"+listClass+\">\";\r\n\t\t\t\tstr += \"<input type=\\\"button\\\" id=\\\"buttonOK\\\" name=\\\"buttonOK\\\"  onClick=dataOK('\"+aryList[s][0]+\"','\"+aryList[s][1]+\"')  value=\\\"选择\\\" >\" ;\r\n\t\t\t\tstr += \"<input type=\\\"hidden\\\" name=\\\"turnValue\\\" value=\"+aryList[s][0]+\">\";\r\n\t\t\t\tstr += \"<input type=\\\"hidden\\\" name=\\\"turnText\\\" value=\"+aryList[s][1]+\">\";\r\n\t\t\t\tstr += \"</td>\";\r\n\t\t\t\tstr+=\" </tr>\";\r\n\t\t\t}\r\n\t\t\tstr += \"</table>\";\r\n\t\t\tstr += \"<div id=\\\"messageButtonFilter\\\" class=\\\"messageButtons\\\"></div>\";\r\n\r\n\t\t\tdocument.getElementById(\"messageBodyFilter\").innerHTML = str;\r\n\t\t\tvar buts = document.getElementById(\"messageButtonFilter\");\r\n\t\t\tvar butString = \"\";\r\n\t\t\tbutString += \"<div class='messageButton' onclick='hiddenMessageBodyFilter()'>取消</div>\";\r\n\t\t\tbuts.innerHTML = butString;\r\n\t\t}\r\n\t\tfunction dataOK(dataId,dataText){\r\n");
      out.write("\t\t\tvar curIndex=document.getElementById(\"curIndex\").value;\r\n\t\t    var fieldName=document.getElementById(\"fieldName\").value;\r\n\t\t\tvar obj=document.getElementsByName(fieldName);\r\n\t\t\tvar objTemp=document.getElementsByName(fieldName+\"_temp\");\r\n\t\t\tvar objbtn=document.getElementsByName(fieldName+\"_btn\");\r\n\t\t\tobj[curIndex].value=dataId+\"@@$@@\"+dataText;\r\n\t\t\tobjTemp[curIndex].value=dataText;\r\n\t\t\ttry{\r\n\t\t\t\t");
      out.print(fieldObj[1]);
      out.write("_onchange(obj[curIndex]);\r\n\t\t\t}catch(e){\r\n\t\t\t}\r\n\t\t\thiddenMessageBodyFilter();\r\n\t\t}\r\n\t\t");

	}
}

      out.write("\r\n\r\ndocument.onkeydown = listenKeyDown;\r\n\r\nfunction listenKeyDown(){\r\n\tvar event = arguments[0] ||window.event;\r\n\tif(event.keyCode==13){\r\n\t\t//按下了enter\r\n\t\ttry{\r\n\t\t    var obj=event.srcElement;\r\n\t\t\tvar objname=event.srcElement.name;\t\r\n\t\t\t\r\n\t\t\tvar curIndex=0;\r\n\t\t    var curObj=document.getElementsByName(objname);\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n    \r\n\t\t\tobjname=objname.substring(0,objname.length-5);\r\n\t\t\tobjname=objname+\"_btn\";\t\t\t\r\n\t\t\t\r\n\t\t\tobj=document.getElementsByName(objname);\r\n\t\t\tobj[curIndex].click();\r\n\t\t\t\r\n\t\t\t//eval(objname+\"_enter(\"+document.getElementsByName(objname)[0]+\")\");\r\n\t\t}catch(e){\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction showIntefaceData(response){\r\n\r\n\tvar context = response.responseText;\r\n\t\r\n\tcontext=context.substring(context.indexOf(\"{\"));\r\n\t\r\n\tif(context.length>2){\r\n\t\tcontext=context.substring(2,context.length-3);\r\n\t\t\r\n\t\tvar contextValue=context.split(\"];[\");\r\n\t\t\r\n\t\tfor(var i=0;i<contextValue.length;i++){\r\n\t\t\t\r\n\t\t\tif(contextValue[i].indexOf(\":{\")>0 &&contextValue[i].substring(contextValue[i].length-1)==\"}\" ){\r\n");
      out.write("\t\t\t\tvar kValue = contextValue[i].split(\":{\");\r\n\t\t\t\treturn_Value(\"{\"+kValue[1],kValue[0]) ;\r\n\t\t\t}else{\r\n\t\t\t\tvar kValue=contextValue[i].split(\":\");\r\n\t\t\t\treturn_Value(kValue[1],kValue[0]) ;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t  \r\n\r\n}\r\n\r\n\r\nfunction return_Value(showValue,fieldName){\r\n\tif(document.getElementById(fieldName)){\r\n\t\tvar fieldObj =document.getElementById(fieldName);\r\n\t\tif(fieldObj.nodeName==\"SELECT\"&&(showValue.substring(0,2)==\"{[\" && showValue.substring(showValue.length-2,showValue.length)==\"]}\")){//下拉框形式\r\n\t\t\tvar showValues =  showValue.substring(2,showValue.length-2).split(\"],[\");\r\n\t \t\tfieldObj.options.length=0;\r\n\t \t\t\r\n\t \t\tvar option =document.createElement(\"option\");\r\n\t \t\tfieldObj.appendChild(option);\r\n\t\t\toption.value = \"\";\r\n\t\t\toption.text = \"--请选择--\";\r\n\t\t\t\r\n\t \t\tfor(var i=0;i<showValues.length;i++){\r\n\t \t\t\tvar option2 = document.createElement(\"option\");\r\n\t \t \t\tfieldObj.appendChild(option2);\r\n\t \t \t\t\r\n\t \t\t\tvar optionShow = showValues[i].split(\":\");\r\n\t \t\t\toption2.value = optionShow[0]+\"@#@\"+optionShow[1];\r\n\t \t\t\toption2.text = optionShow[1];\r\n");
      out.write("\t \t\t}\r\n\t \t}else{\r\n\t \t\tdocument.getElementById(fieldName).value=showValue;\r\n\t \t}\r\n\t}\r\n}\r\n\r\nfunction showInteface_Data(response){\r\n\t \r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n    \t\r\n    \t//如是字表多行时需确定本行的位置\r\n    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,content;\r\n    \t//alert(\"11222\"+datas);\r\n    \tfor(var i=0;i<datas.length;i++){\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n    \t\tif(formfield==\"error\"){\r\n    \t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n    \t\t\tweixinMessageReminder(\"alert\", \"提示：\", content, \"\");\r\n    \t\t}else{\r\n\t    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n\t    \t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n\t    \t\t//if(fetchdata==\"0\"){\r\n");
      out.write("\t    \t\treturn_Value(content,formfield);\r\n\t    \t\t//}\r\n\t\t\t}\t\r\n    \t}\r\n    \t\r\n\t}\t\t\r\n}\t\r\nfunction showFormSubData(response){\r\n\t//将取回的数据显示在正确的表单中\r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n    \t\r\n    \t//如是字表多行时需确定本行的位置\r\n    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n    \t    \t\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,content,fieldTagName;\r\n    \tvar subdatas,datavalue,datatext;\r\n    \tvar oprObj;\r\n    \tfor(var i=0;i<datas.length;i++){\r\n     \t\t// 控件名称\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n    \t\t// 控件类型\r\n    \t\tfieldtype=datas[i].getElementsByTagName(\"fieldtype\")[0].firstChild.nodeValue;\r\n    \t\t\r\n    \t\tif(fetchdata==\"0\"){\t// 检索赋值\r\n\t    \t\t// 控件的值\r\n\t    \t\tif(null != datas[i].getElementsByTagName(\"content\")[0].firstChild){\r\n");
      out.write("\t    \t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n\t    \t\t} else{\r\n\t    \t\t\tcontent = \"\";\r\n\t    \t\t}\r\n\t    \t\t\r\n\t\t\t\t//alert(formfield + \"---\" + fetchdata);\r\n\t    \t\t// 根据控件名称和下标索引获取控件对象\r\n\t    \t\toprObj = document.getElementsByName(formfield);\r\n\t    \t\t\r\n\t    \t\t// 判断要赋值的控件的类型\r\n\t    \t\tif(\"103\" == fieldtype){\t// 单选\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t\t    \t\t\tvar index = 0;\r\n\t\t    \t\t\tfor(var j=0; j<oprObj.length; j++){\t// 遍历所有的radio选项\r\n\t\t    \t\t\t\tif(oprObj[j].value == content){\t// 判断值为选择值的radio选择\r\n\t\t    \t\t\t\t\tif(index == curIndex){\t// 选中值跟选择值相同，且下标相同的radio选项\r\n\t\t    \t\t\t\t\t\toprObj[j].checked = \"checked\";\r\n\t\t    \t\t\t\t\t} else{\r\n\t\t    \t\t\t\t\t\toprObj[j].checked = \"\";\r\n\t\t    \t\t\t\t\t}\r\n\t\t    \t\t\t\t\tindex++;\r\n\t\t    \t\t\t\t}\r\n\t\t    \t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t} else if(\"104\" == fieldtype){\t// 多选\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t    \t\t\t\t// 统计页面上出现同名同值复选框的个数\r\n\t    \t\t\t\tvar sum = 0;\r\n\t    \t\t\t\tfor(var j=0; j<oprObj.length; j++){\r\n\t    \t\t\t\t\tif(oprObj[0].value == oprObj[j].value){\r\n\t    \t\t\t\t\t\tsum++;\r\n");
      out.write("\t    \t\t\t\t\t}\r\n\t    \t\t\t\t}\r\n\t    \t\t\t\t// 页面上设置的同名多选控件中选项的个数\r\n\t    \t\t\t\tvar count = oprObj.length / sum;\r\n\t    \t\t\t\t// 循环开始下标\r\n\t    \t\t\t\tvar index = curIndex * count;\r\n\t    \t\t\t\tcontent = \",\" + content;\r\n\t    \t\t\t\tfor(var j=index; j<(index+count); j++){\r\n\t    \t\t\t\t\tif(content.indexOf(\",\"+oprObj[j].value+\",\") > -1){\t// 多选值中包含当前选项的值\r\n\t    \t\t\t\t\t\toprObj[j].checked = \"checked\";\r\n\t    \t\t\t\t\t} else{\r\n\t    \t\t\t\t\t\toprObj[j].checked = \"\";\r\n\t    \t\t\t\t\t}\r\n\t    \t\t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t} else if(\"105\" == fieldtype){\t// 下拉框\r\n\t    \t\t\tvar opts = oprObj[curIndex].options;\t// 获取所有选项\r\n\t    \t\t\tfor(var j=0; j<opts.length; j++){\r\n\t\t\t\t\t\tif(content == opts[j].value){\t// 选项值等于选择值时，选项选中\r\n\t\t\t\t\t\t\topts[j].selected = \"selected\";\r\n\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\topts[j].selected = \"\";\r\n\t\t\t\t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t}else if(\"210\"==fieldtype||\"211\"==fieldtype){//单选人/多选人\r\n\t    \t\t\toprObj = document.getElementsByName(formfield+\"_Name\");\r\n\t    \t\t\toprObjId = document.getElementById(formfield+\"_Id\");\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t    \t\t\tvar name=content.substring(0,content.indexOf(\";\"));\r\n");
      out.write("\t    \t\t\tvar id=content.substring(content.indexOf(\";\")+1);\r\n\t    \t\t\t\toprObj[curIndex].value = name;\r\n\t    \t\t\t\toprObjId.value=id;\r\n\t    \t\t\t}\r\n\t    \t\t}else{\t// 其他类型控件，直接赋值，需要特殊处理时在之前加if判断\r\n\t    \t\t\t");

	    			if(com.js.util.config.SystemCommon.getSYWorkflowHR() == 1){
	    				
      out.write("\r\n\t\t\t\t\t\tif(content.indexOf(\"00:00:00.0\") > 0){\r\n\t\t\t\t\t\t\tcontent = content.replace(\"00:00:00.0\",\"\");\r\n\t\t\t\t\t\t}\r\n\t    \t\t\t\t");

	    			}
	    			
      out.write("\r\n\t    \t\t\toprObj[curIndex].value = content;\r\n\t    \t\t}\r\n    \t\t} else if(fetchdata == \"2\"){\t// 级联\r\n    \t\t\tsubdatas=datas[i].getElementsByTagName(\"content\")[0].getElementsByTagName(\"subdata\");\r\n    \t\t\t//下拉列表形式    \t\t\t\r\n    \t\t\t//oprObj=eval(\"document.all.\"+formfield);\r\n    \t\t\toprObj=document.getElementsByName(formfield)[curIndex];    \t\t\t\r\n    \t\t\t\r\n    \t\t\tfieldTagName=oprObj.tagName;    \t\t\t\r\n    \t\t\tif(fieldTagName==\"INPUT\" || fieldTagName==\"TEXTAREA\"){\r\n    \t\t\t\t//普通输入 \r\n    \t\t\t\toprObj.value=\"\";   \r\n    \t\t\t\tif(subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild!=null){\t\t\t\t\r\n\t    \t\t\t\tdatavalue=subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue; \r\n\t    \t\t\t\toprObj.value=datavalue;\r\n    \t\t\t\t}\r\n    \t\t\t}else if(fieldTagName==\"SELECT\"){\r\n    \t\t\t\t//删除原来的option    \t\t\t\t\r\n    \t\t\t\tjs_deleteAllOptions(oprObj);    \t\t\t\t\r\n    \t\t\t\t//新增option\r\n    \t\t\t\tfor(var j=0;j<subdatas.length;j++){\r\n    \t\t\t\t    try{\r\n\t    \t\t\t\t\tdatavalue=subdatas[j].getElementsByTagName(\"datavalue\")[0].firstChild.nodeValue;\r\n\t    \t\t\t\t\tdatatext=subdatas[j].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue;\r\n");
      out.write("\t    \t\t\t\t\tjs_addOption(oprObj,datavalue,datatext);\r\n    \t\t\t\t\t}catch(e){\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n    \t\t\t\toprObj.onchange();    \t\t\t\t\r\n    \t\t\t}\r\n    \t\t}\r\n    \t\t\r\n    \t}\r\n    }\r\n}\r\n\r\nfunction js_deleteAllOptions(obj){\r\n\twhile(length!=0){ \r\n　　 \tvar length=obj.options.length;\r\n　　 \tfor(var i=0;i<length;i++)\r\n　　 \t\tobj.options.remove(i);\r\n　　 \tlength=length/2;\r\n　　 }\r\n}\r\nfunction js_addOption(obj,optionValue,optionText){\r\n\tvar newOption=new Option(optionText,optionValue); \r\n\tobj.options[obj.length]=newOption; \r\n} \r\n\r\nsetInterval(\"updateOnlineTime()\",30000);\r\nfunction updateOnlineTime(){\r\n   var workId=\"\";\r\n   var processId=\"\";\r\n   var recordId=\"\";\r\n   var tableId=\"\";\r\n   if(document.getElementById(\"workId\")){\r\n\t   workId=document.getElementById(\"workId\").value;\r\n\t}\r\n\tif(document.getElementById(\"processId\")){\r\n\t   processId=document.getElementById(\"processId\").value;\r\n\t}\r\n\tif(document.getElementById(\"recordId\")){\r\n\t  recordId=document.getElementById(\"recordId\").value;\r\n\t}\r\n    if(document.getElementById(\"tableId\")){\r\n\t   tableId=document.getElementById(\"tableId\").value;\r\n");
      out.write("\t}\r\n\tJSRequest.sendPOST(\"/jsoa/jsflow/jsflow_updateonlineTime.jsp?processId=\"+processId+\"&recordId=\"+recordId+\"&wfWorkId=\"+workId+\"&tableId=\"+tableId,\"\",doTime);\r\n}\r\nfunction  doTime(){\r\n\r\n}\r\n</SCRIPT>\r\n<script language=javascript src=\"/jsoa/weixin/workflow/eform/js/form.js\"></script>\r\n<input type=\"hidden\" name=\"user_Id\" id=\"user_Id\" value=\"");
      out.print(session.getAttribute("userId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Name\" id=\"user_Name\" value=\"");
      out.print(session.getAttribute("userName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Account\" id=\"user_Account\" value=\"");
      out.print(session.getAttribute("userAccount"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_Name\" id=\"org_Name\" value=\"");
      out.print(session.getAttribute("orgName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_ID\" id=\"org_ID\" value=\"");
      out.print(session.getAttribute("orgId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"group_ID\" id=\"group_ID\" value=\"");
      out.print(session.getAttribute("groupId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Hide_Field\" id=\"Hide_Field\" value=\"");
      out.print(request.getAttribute("hideField"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Page_Id\" id=\"Page_Id\" value=\"");
      out.print(pageId);
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Info_Id\" id=\"Info_Id\" value=\"");
      out.print(null==request.getAttribute("infoId") ? "" : request.getAttribute("infoId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"work_Status\" id=\"work_Status\" value=\"");
      out.print(request.getParameter("workStatus"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"parent_fromDraft\" id=\"parent_fromDraft\" value=\"");
      out.print(parent_fromDraft);
      out.write("\">\r\n<input type=\"hidden\" name=\"totalValueSet\" id=\"totalValueSet\" value=\"\" />\r\n<input type=\"hidden\" name=\"dateCompare\" id=\"dateCompare\" value=\"\" />\r\n<input type=\"hidden\" id=\"fieldName\" name=\"fieldName\" />\r\n<input type=\"hidden\" id=\"curIndex\" name=\"curIndex\" />\r\n<input type=\"hidden\" name=\"sendSMS\" id=\"sendSMS\" value=\"");
      out.print(SystemCommon.getSendSMS() );
      out.write("\" />\r\n<!-- 取 -->\r\n");
      out.print(cst.getComputeFieldHTML(pageId));
      out.write("\r\n<div id=\"formHTML\">\r\n<!-- 读取表单设计模板 begin -->\r\n");

String tempHtml = cst.getCode(pageId).replace("window.open","showSearchInfo");
tempHtml = this.dealWithColorCode(tempHtml);

      out.write('\r');
      out.write('\n');
      out.print(tempHtml );
      out.write("\r\n<!-- 读取表单设计模板 end -->\r\n</div>\r\n\r\n<script type=\"text/javascript\">\r\n");

String allCoumputFieldStr = cst.getMainAndForeignComputeFields(pageId);
//判断当前表单是否新增
if(request.getAttribute("infoId")==null || request.getAttribute("infoId").toString().toUpperCase().equals("NULL") 
		|| request.getAttribute("infoId").toString().trim().length()<1){
	//初始化显示界面(新增)
	// 如果是发起子流程则如果子流程中的表单与主表单相同则将数据继承
	String pareFormId = request.getParameter("pareTableId");
	boolean isNewForm = true;
	if(pareFormId!=null || !"null".equals(pareFormId) || !"".equals(pareFormId)){
		//取得父表单ID则比较父表单ID是否与当前表单ID相同，如果相同的话，则继承主表单数据
		isNewForm = cst.isNewForm(pareFormId,pageId);
	}
	if(isNewForm){
		//新表单
		//取得表单关联的所有字段信息的数据(主表)
		String[][] fieldArr = cst.getPageField(pageId);
		String forHideField = "";	// 可写字段
		if(fieldArr != null){
			//遍历所有字段，获得字段的页面显示脚本
			for(int i=0; i<fieldArr.length; i++){
				if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
					
					//2016-12-26 首节点隐藏 
					if(noDisplayFields.indexOf(","+fieldArr[i][0]+",")>=0){
						String noDisplayHTML="if(document.getElementById('" + fieldArr[i][1] + "-" + fieldArr[i][0] + "'))\n{document.getElementById('" +
								fieldArr[i][1] + "-" + fieldArr[i][0] + "').innerHTML='';}";
						out.print(noDisplayHTML);
					}else{			
						out.print(dealWithColorCode(cst.getHTMLForWeiXin(fieldArr[i][0],hide_Field,domainId,fieldArr[i][1],request,allCoumputFieldStr)));
					}
					if(hide_field_readonly.indexOf(fieldArr[i][1])>-1){
						//roTempString+=fieldArr[i][0]+"@@";
					}else{
						//rwTempString+=fieldArr[i][0]+"@@";
					}
				}
			}
		}

		//获得表单关联的所有子表字段
		String[][] forFieldArr = cst.getForeignField(pageId);
		if(forFieldArr != null){
			String tempHideField = "," + hide_Field + ",";
			//遍历所有字段，获得字段的页面显示脚本
			for(int i=0; i<forFieldArr.length; i++){
				if(forFieldArr[i][2]!=null && (!forFieldArr[i][2].trim().equals(""))){
					out.print(cst.getHTMLForWeiXin(forFieldArr[i][2], hide_Field, domainId, forFieldArr[i][3], request, allCoumputFieldStr));
				}
				if(tempHideField.indexOf("," + forFieldArr[i][3] + ",") < 0){	// 不可写字段中不包含当前字段
					// 字段名称追加到可写字段
					forHideField += "," + forFieldArr[i][2] + ",";
				}
			}
		}		
         
		//start
		//获得表单关联的所有子表数组
		String[] tables = cst.getForeignTable(pageId);
		if (tables != null && tables.length > 0) {
			//遍历所有子表
			for(int i = 0; i < tables.length; i++) {
				if (tables[i] == null || tables[i].trim().length() < 1){
					continue;
				}
				
				//提取字表关联的所有字段
				String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
				if(forFields!=null && forFields.length>0){
					boolean hideTable = true;//子表是否有可写字段
					for(int k=0; k<forFields.length; k++){
						//遍历所有字段
						if(forHideField.indexOf(forFields[k][5]) > -1){
							//如果该子表中有可编辑字段，则该表可编辑
							hideTable = false;
						}
					}
				   
					//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
					if(hideTable){
						hideTableHTML += "<input type=hidden name=hideTable id=hideTable value=" + tables[i] + ">";
					} else{
						showTableHTML += "<input type=hidden name=showTable id=showTable value=" + tables[i] + ">";
					}
				}
				
				// 二维表添加增删行按钮列
				//out.print("creatTabButs('tab" + tables[i] + "');");
                  
				//if(i == 0){//将第一个子表设置为增加行、删除行图标所在的焦点
				//	scriptappend = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];setAbsolute(currentRow);";
				//}
				String agent = request.getHeader("USER-AGENT");   
				if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
					if(-1 != agent.indexOf("MSIE 10")){
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
					} else{
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
					}
				} else{
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
				}

				//设置统计字段
				String[][] tlFlds = cst.getTotalFieldByTableName(pageId,tables[i],domainId);
				if(tlFlds !=null && tlFlds.length>0){
					String tlfld = "";
					String duiying = "";
					int show = 0;

					for(int p=0; p<tlFlds.length; p++){
						String totalValue = tlFlds[p][3];
						if(totalValue.startsWith("1;")){
							show = 1;
							break;
						}
					}
					out.print("addTotalRow('" + tables[i] + "'," + show + ");");
					for(int p=0; p<tlFlds.length; p++){
						tlfld +=  tlFlds[p][0] + ",";
						String totalValue = tlFlds[p][3];
						if(totalValue.endsWith(";yes")){
							duiying += tlFlds[p][0] + ":";
							String[] toValue = totalValue.split(";");
							for(int to=1; to<toValue.length-1; to++){
								String[] tValue = toValue[to].split("@");
								duiying += tValue[0] + ",";
							}
							while(duiying.endsWith(",")){
								duiying = duiying.substring(0, duiying.length()-1);
							}
							duiying += ";";
						}
						if(totalValue.startsWith("1;")){
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						} else{
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						}
					}
					out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
					out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
					out.print("setTotalValue();");
					while(duiying.endsWith(";")){
						duiying = duiying.substring(0, duiying.length()-1);
					}
				}
			}
		}
	} else{
		//子流程表单与主流程表单用的是同一张数据表，取主流程中的数据填充表单
		pageId = pareFormId;
		//当前表单为编辑表单（表单已有对应的数据）
		String forHideField = "";//字表不可编辑字段
		if("1".equals(request.getParameter("flag"))){
			hide_Field="ALL";
		}
     
		//所有字段不可编辑，该种情况表示在自定义模块中点击链接查看信息
		String[][] fieldArr = cst.getPageField(pageId);//读取表单那关联的所有主表字段信息
		if(fieldArr != null){
			for(int i=0; i<fieldArr.length; i++){
				//遍历所有主表字段
				if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
					//获得主表字段的显示脚本
					out.print(cst.getEditHTMLForWeiXin(fieldArr[i][0],request.getParameter("pareRecordId"),pageId,hide_Field,domainId,fieldArr[i][1],parent_fromDraft,allCoumputFieldStr,request));
				}
			}
		}
 		 
		//start
		//获得表单那关联的所有子表
		String[] tables = cst.getForeignTable(pageId);
		if (tables != null && tables.length > 0) {
			for (int i = 0; i < tables.length; i++) {
				//遍历所有子表
				if (tables[i] == null || tables[i].trim().length() < 1)continue;
				//提取字表关联的所有字段
				String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
				//拼装SQL
				String sql = "";//查询子表关联到表单中的所有字段值的SQL语句
				if(forFields!=null && forFields.length>0){
					boolean hideTable = true;//子表是否有可写字段
					for(int k=0; k<forFields.length; k++){
						//遍历所有字段
						sql += forFields[k][5]+",";//将字段添加到数据查询的SQL中
						if(forHideField.indexOf(forFields[k][5])<0){
							//如果该子表中有可编辑字段，则该表可编辑
							hideTable = false;
						}
					}
				   
					//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
					if(hideTable){
						hideTableHTML += "<input type=hidden name=showTable id=hideTable value="+tables[i]+">";
					} else{
						showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
					}
                    sql = sql.substring(0,sql.length()-1);
				}
				//提取子表数据
				String[][] data = null;
				if(sql.length() > 1){
					sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getParameter("pareRecordId")+ " order by "+ tables[i] +"_id";
					data = cst.loadDataBySQL(sql,String.valueOf(forFields.length+1));
				} else{
					continue;
				}
				//设置页面子表行数
				if(data!=null && data.length>0){
					for(int n=0; n<data.length-1; n++){//遍历所有数据，解析数据行，根据记录数量增加行
						String script = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];addRow();";
						out.print(script);
					}
					for(int n=0; n<data.length; n++){//遍历数据，解析数据在表单上的展示
						//解析数据
						for(int m=0; m<forFields.length; m++){//遍历字段，生成该字段及其值展示在表单上的脚本
							out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],data[n][m],forFields,"",m,String.valueOf(n),forFields[m][0],parent_fromDraft,tables[i],request.getParameter("pareRecordId"),data[n][forFields.length],forFields[m][10],allCoumputFieldStr));
						}
						String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
						out.print(script);
					}
				} else{//该子表没有数据，隐藏模板中初始化的第一个数据行
					for(int m=0; m<forFields.length; m++){
						out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],"",forFields,(("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus")))?hide_Field+forHideField:"ALL"),m,"0",forFields[m][0],parent_fromDraft,tables[i],request.getParameter("pareRecordId"),"-100",forFields[m][10],allCoumputFieldStr));
					}
					out.print("document.getElementsByName('"+tables[i]+"TR')[0].style.display='none';");
				}
				String agent = request.getHeader("USER-AGENT");   
                if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
					if(-1 != agent.indexOf("MSIE 10")){
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
					} else{
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
					}
				} else{
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
				}
				//设置统计字段
				String[][] tlFlds = cst.getTotalFieldByTableName(pageId,tables[i],domainId);             
				if(tlFlds !=null && tlFlds.length>0){
                  	//增加统计字段显示行
              	    /*out.print("addTotalRow('"+tables[i]+"');");
                    String tlfld = "";
                    for(int p=0;p<tlFlds.length;p++){//遍历统计字段，设置对应的统计字段表单元素
                    	  tlfld +=  tlFlds[p][0]+",";
                    	  String totalValue = tlFlds[p][3];
                    	  if(totalValue.startsWith("1;")){
                          	  out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
                          }else{
                          	  out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
                          }     
                    }
                    out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField  id=totalField value="+tlfld+">';");
                    out.print("setTotalValue();");*/
					String tlfld = "";
					String duiying = "";
					int show = 0;
					for(int p=0; p<tlFlds.length; p++){
						String totalValue = tlFlds[p][3];
						if(totalValue.startsWith("1;")){
							show = 1;
							break;
						}
					}
					out.print("addTotalRow('" + tables[i] + "'," + show + ");");
					for(int p=0; p<tlFlds.length; p++){
						tlfld +=  tlFlds[p][0] + ",";
						String totalValue = tlFlds[p][3];
						if(totalValue.endsWith(";yes")){
							duiying += tlFlds[p][0]+":";
							String[] toValue = totalValue.split(";");
							for(int to=1; to<toValue.length-1; to++){
								String[] tValue = toValue[to].split("@");
								duiying += tValue[0] + ",";
							}
							while(duiying.endsWith(",")){
								duiying = duiying.substring(0, duiying.length()-1);
							}
							duiying += ";";
						}
						if(totalValue.startsWith("1;")){
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						} else{
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						}
					}
					out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
					out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
					out.print("setTotalValue();");
					while(duiying.endsWith(";")){
						duiying = duiying.substring(0, duiying.length()-1);
					}
				}
			}
		}//end
	}
} else{
	//当前表单为编辑表单（表单已有对应的数据）
	String forHideField = "";//字表不可编辑字段
	String writeFieldString = "";//可写字段串 $字段名称$$字段名称$
	if(request.getParameter("processId")!=null){
		//表单在流程中调用
		WorkFlowBD workFlowBD = new WorkFlowBD();
		//取读字段
		
		if("0".equals(request.getParameter("workStatus"))){
			//是待办文件
			//取当前节点的可写字段List
			List list = (List) request.getAttribute("RWFieldList");
			String[] str = null;
			for(int i = 0; list!=null && i < list.size(); i ++){//遍历可写字段，将可写字段转化为字符串形式
				str = (String[]) list.get(i);
				if(str[0].equals("1")){//可写字段
					writeFieldString += "$" + str[1] + "$";
				}
			}
			//表单中关联的所有子表字段信息
			String[][] forFieldArr = new CustomFormBD().getForeignField(pageId);
			if(forFieldArr != null){
				for(int i=0; i<forFieldArr.length; i++){
					//遍历所有子表字段，如果字段不在可写字段中，则字段为不可编辑字段
					if(writeFieldString.indexOf("$"+forFieldArr[i][2]+"$")<0){
						forHideField += forFieldArr[i][2]+",";
					}
				}
			}
		}
	}

	if("1".equals(request.getParameter("flag")) || (!"0".equals(request.getParameter("workStatus")) 
			&& !"-2".equals(request.getParameter("workStatus")) && !"-1".equals(request.getParameter("workStatus")))){
		hide_Field="ALL";
	}
	//草稿箱或扩展模块中使用表单
	if(request.getAttribute("fromEFormFlag")!=null && "1".equals(request.getAttribute("fromEFormFlag").toString())){
		hide_Field = "";
	}
		 
	//所有字段不可编辑，该种情况表示在自定义模块中点击链接查看信息
	String[][] fieldArr = cst.getPageField(pageId);//读取表单那关联的所有主表字段信息
	if(fieldArr != null){
		for(int i=0; i<fieldArr.length; i++){
			//遍历所有主表字段
			if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
				//获得主表字段的显示脚本
				//2016-12-26 隐藏表单字段
				if(noDisplayFields.indexOf(","+fieldArr[i][0]+",")>=0){
					String noDisplayHTML="if(document.getElementById('" + fieldArr[i][1] + "-" + fieldArr[i][0] + "'))\n{document.getElementById('" +
							fieldArr[i][1] + "-" + fieldArr[i][0] + "').innerHTML='';}";				
					out.println(noDisplayHTML);
				}else{
					out.print(cst.getEditHTMLForWeiXin(fieldArr[i][0],request.getAttribute("infoId").toString(),pageId,hide_Field,domainId,fieldArr[i][1],parent_fromDraft,allCoumputFieldStr,request));
				}
			}
		}
	}

	//start
	//获得表单那关联的所有子表
	String[] tables = cst.getForeignTable(pageId);
	if (tables != null && tables.length > 0) {
		for (int i = 0; i < tables.length; i++) {
			//遍历所有子表
			if (tables[i] == null || tables[i].trim().length() < 1){
				continue;
			}
			//提取字表关联的所有字段
			String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
			//拼装SQL
			String sql = "";//查询子表关联到表单中的所有字段值的SQL语句
			if(forFields!=null && forFields.length>0){
				int wrLenTemp=0;//可写字段个数
				boolean hideTable = true;//子表是否有可写字段
				for(int k=0; k<forFields.length; k++){
					//遍历所有字段
					sql += forFields[k][5]+",";//将字段添加到数据查询的SQL中
					if(forHideField.indexOf(forFields[k][5])>0){
						//如果该子表中有可编辑字段，则该表可编辑
						hideTable = false;
					}
					if(writeFieldString.indexOf(forFields[k][5])>-1 || "111".equals(forFields[k][1]) || "302".equals(forFields[k][1])){
						//当可写或为自动编号、序号时不验证
						wrLenTemp++;
					}
				}
				if(wrLenTemp==forFields.length||request.getParameter("processId")==null){//子表字段全部可写时该表可增加删除行或者非流程
					hideTable=false;
				}else{
					hideTable=true;
				}
				//如果是待发流程默认为可写表单
				if("1".equals(parent_fromDraft)){
					hideTable=false;
				}
				//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
				if(hideTable){
					hideTableHTML += "<input type=hidden name=hideTable id=hideTable value="+tables[i]+">";
				} else{
					showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
				}
				sql = sql.substring(0,sql.length()-1);
			}
             
			//提取子表数据
			String foreignHideField = "";
			if("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus"))){
				foreignHideField = hide_Field + forHideField;
			} else{
				foreignHideField = "ALL";
			}
			if(request.getAttribute("fromEFormFlag")!=null && "1".equals(request.getAttribute("fromEFormFlag").toString())){
				foreignHideField = "";
			}
			String[][] data = null;
			if(sql.length() > 1){
				sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getAttribute("infoId").toString()+ " order by "+ tables[i] +"_id";
				data = cst.loadDataBySQL(sql,String.valueOf(forFields.length+1));
			} else{
				continue;
			}
			//设置页面子表行数
			if(data!=null && data.length>0){
				for(int n=0; n<data.length-1; n++){//遍历所有数据，解析数据行，根据记录数量增加行
					String script = "currentRow = document.getElementById('"+tables[i]+"TR');addRow();";
					out.print(script);
				}
				for(int n=0; n<data.length; n++){//遍历数据，解析数据在表单上的展示
					//解析数据
					for(int m=0; m<forFields.length; m++){//遍历字段，生成该字段及其值展示在表单上的脚本
						//System.out.println("----------------------:"+data[n][m]);
						String valueString = "";
						if(data[n][m]!=null && data[n][m].toString().startsWith(".")){
							valueString = "0" + data[n][m];
						} else{
							valueString = data[n][m];
						}
						out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],valueString,forFields,foreignHideField,m,String.valueOf(n),forFields[m][0],parent_fromDraft,tables[i],request.getAttribute("infoId").toString(),data[n][forFields.length],forFields[m][10],allCoumputFieldStr));
					}
					String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
					out.print(script);
				}
			} else{//该子表没有数据，隐藏模板中初始化的第一个数据行
				for(int m=0; m<forFields.length; m++){
					out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],"",forFields,foreignHideField,m,"0",forFields[m][0],parent_fromDraft,tables[i],request.getAttribute("infoId").toString(),"-100",forFields[m][10],allCoumputFieldStr));
				}
				//	吴凯20130205修改为不隐藏
			}
			String agent = request.getHeader("USER-AGENT");   
			if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
				if(-1 != agent.indexOf("MSIE 10")){
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
				} else{
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
				}
			} else{
				out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
			}
			//设置统计字段
			String[][] tlFlds = cst.getTotalFieldByTableName(pageId,tables[i],domainId);
			if(tlFlds !=null && tlFlds.length>0){
				//增加统计字段显示行
				/*out.print("addTotalRow('"+tables[i]+"');");
				String tlfld = "";
				for(int p=0;p<tlFlds.length;p++){//遍历统计字段，设置对应的统计字段表单元素
					tlfld +=  tlFlds[p][0]+",";
					String totalValue = tlFlds[p][3];
					if(totalValue.startsWith("1;")){
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}else{
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}  
				}
				out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
				out.print("setTotalValue();");*/
		                    
				String tlfld = "";
				String duiying = "";
				int show = 0;
		
				for(int p=0; p<tlFlds.length; p++){
					String totalValue = tlFlds[p][3];
					if(totalValue.startsWith("1;")){
						show = 1;
						break;
					}
				}
				out.print("addTotalRow('"+tables[i]+"',"+show+");");
				for(int p=0; p<tlFlds.length; p++){
					tlfld +=  tlFlds[p][0]+",";
					String totalValue = tlFlds[p][3];
					if(totalValue.endsWith(";yes")){
						duiying += tlFlds[p][0] + ":";
						String[] toValue = totalValue.split(";");
						for(int to=1; to<toValue.length-1; to++){
							String[] tValue = toValue[to].split("@");
							duiying += tValue[0] + ",";
						}
						while(duiying.endsWith(",")){
							duiying = duiying.substring(0, duiying.length()-1);
						}
						duiying += ";";
					}
					if(totalValue.startsWith("1;")){
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}else{
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}
				}
				out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
				out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
				out.print("setTotalValue();");
				while(duiying.endsWith(";")){
					duiying = duiying.substring(0, duiying.length()-1);
				}
			}
		}
	}//end
}

      out.write("\r\n</script>\r\n");

//子表的计算字段设置
out.print(cst.getForeignComputeFieldHTML(pageId));
out.print(hideTableHTML+showTableHTML);  

      out.write("\r\n\r\n<script language=javascript src=\"/jsoa/weixin/workflow/eform/datetime/time.js\"></script>\r\n<script language=\"javascript\">\r\n\r\nif(document.all.wf_ua){\r\n    if(document.all.wf_ua.length){\r\n    \t\r\n    } else{\r\n        eval(\"document.all.\" + document.all.wf_ua.value + \".value='");
      out.print(session.getAttribute("userAccount"));
      out.write("'\");\r\n    }\r\n}\r\n//document.body.attachEvent(\"onload\",function(){});\r\nsetNoWrap();\r\ninitRow();\r\n</script>\r\n<script src=\"/jsoa/js/util.js\"></script>");
      out.write("\r\n\t\t\t\t\t\t\t        \t\t</td>\r\n\t\t\t\t\t\t\t        \t</tr>\r\n\t\t\t\t\t\t\t  \t\t\t");

							  		}
							  		
      out.write("\r\n\t\t\t\t\t\t\t\t\t<tr name=\"commentRow\" id=\"commentRow\" >\r\n                      \t\t\t\t\t<td height=\"22\" colspan=\"2\">\r\n                      \t\t\t\t\t\t");
      out.write(" \r\n\r\n\r\n<style type=\"text/css\">\r\n<!--\r\n#noteDiv {\r\n\tposition:absolute;\r\n\twidth:220px;\r\n\theight:126px;\r\n\tz-index:1;\r\n\toverflow:auto;\r\n\tborder:1px solid #829FBB;\r\n\tdisplay:none;\r\n\tbackground-color:#ffffff;\r\n}\r\n\r\n#noteDiv1 {\r\n\tposition:absolute;\r\n\twidth:220px;\r\n\theight:126px;\r\n\tz-index:1;\r\n\toverflow:auto;\r\n\tborder:1px solid #829FBB;\r\n\tdisplay:none;\r\n}\r\n.divOver{\r\n    background-color:#003399;\r\n\tcolor:#FFFFFF;\r\n\tborder-bottom:1px dashed #cccccc;\r\n    width:100%;\r\n\theight:20px;\r\n\tline-height:20px;\r\n\tcursor:default;\r\n\tpadding-left:5px;\r\n}\r\n.divOut{\r\n    background-color:#ffffff;\r\n\tcolor:#000000;\r\n\tborder-bottom:1px dashed #cccccc;\r\n    width:100%;\r\n\theight:20px;\r\n\tline-height:20px;\r\n\tcursor:default;\r\n\tpadding-left:5px;\r\n\ttext-align:left;\r\n}\r\n.table_border { border:1px solid #dce0e1;}\r\n.border_bottom_background{ border-bottom:1px solid #dce0e1; background:#f5f5f5;}\r\n.border_bottom{border-bottom:1px dashed #dce0e1;}\r\n.td_top{padding-top:8px;}\r\n-->\r\n</style>\r\n\r\n<script>\r\n\r\n//获取事件对象\r\n\r\nfunction getEvent()\r\n {\r\n         if(document.all)return window.event;        \r\n");
      out.write("         func=getEvent.caller;            \r\n         while(func!=null){    \r\n             var arg0=func.arguments[0];\r\n              if(arg0){\r\n                  if((arg0.constructor==Event || arg0.constructor ==MouseEvent)\r\n                      || (typeof(arg0)==\"object\" && arg0.preventDefault && arg0.stopPropagation)){   \r\n                      arg0.x = arg0.pageX;\r\n                      arg0.y = arg0.pageY ;\r\n                      arg0.srcElement = arg0.target;\r\n                     return arg0;\r\n                  }\r\n              }\r\n              func=func.caller;\r\n          }\r\n          return null;\r\n\r\n } \r\n \r\nvar noteTimer=null;\r\nfunction getNote(");
if(BrowserJudge.isFirefox(request)){
      out.write("event");
}
      out.write("){\r\n\r\n\tvar event = event || window.event;\r\n\tvar x = event.clientX+document.body.scrollLeft||event.pageX;\r\n\tvar y = event.clientY+document.body.scrollTop||event.pageY;\r\n\tvar d=document.getElementById(\"noteDiv\");\r\n\tvar s_top=0;\r\n\t\t\r\n\tif(document.getElementById(\"showHtmlDiv\")) {\r\n\t   s_top=document.getElementById(\"showHtmlDiv\").scrollTop;\r\n\t}else if(document.getElementById(\"mainFrame\")) {\r\n\t   s_top=document.getElementById(\"mainFrame\").scrollTop;\r\n\t}\r\n\t");
if(BrowserJudge.isMSIE(request)){
      out.write("\r\n\t  d.style.left=x-220;\r\n\t  d.style.top=s_top+y-20;\r\n\t");
}else{
      out.write("\r\n\t d.style.left=x-220;\r\n\t d.style.top=y+15;\r\n\t");
}
      out.write("\r\n\t\r\n\td.style.display=\"inline\";\r\n}\r\nfunction hiddenNote(){\r\n  noteTimer=window.setTimeout(\"closeNote()\",200);\r\n}\r\nfunction closeNote(){\r\n  var d=document.getElementById(\"noteDiv\");\r\n  d.style.display=\"none\";\r\n}\r\nfunction lockedNote(){\r\n  window.clearTimeout(noteTimer);\r\n}\r\nfunction setNote(obj){\r\n\tdocument.getElementById(\"flowNote\").innerText+=obj.innerText;\r\n}\r\n</script>\r\n<input type=\"hidden\" name=\"addDivContent\" value=\"\"> <!-- 在  常用语中用到-->\r\n\r\n");

int handSignInUse = 0;//是否使用了手写签名
int signatureInUse = 0;//是否使用了电子签章
java.util.Map include_sysMap = com.js.system.util.SysSetupReader.getInstance().getSysSetupMap(session.getAttribute("domainId").toString());
if(include_sysMap != null && include_sysMap.get("使用手写意见") != null && "1".equals(include_sysMap.get("使用手写意见").toString())){
    handSignInUse = 1;//手写签名
}
if(include_sysMap != null && include_sysMap.get("电子签章") != null && "1".equals(include_sysMap.get("电子签章").toString())){
	signatureInUse = 1;//电子签章
}

int maxHandSignIndex=-1;
String publicSignHeight=com.js.util.config.SystemCommon.getPublicSignHeight();
String userSignHeight=com.js.util.config.SystemCommon.getUserSignHeight();
String realSignHeight;


//当前审批人和日期
String writeUser = session.getAttribute("userName").toString();
String writeUserId = session.getAttribute("userId").toString();
com.js.system.service.usermanager.UserBD ub = new com.js.system.service.usermanager.UserBD();
String writeUserSignature = ub.getSignature(writeUserId);
String src="0000";
if(writeUserSignature!=null && writeUserSignature.length()>6 && writeUserSignature.substring(4,5).equals("_")){
	src=writeUserSignature.substring(0,4);
}else{
	src="0000";
}


if(!"".equals(writeUserSignature)){
	writeUserSignature = "<IMG SRC='/jsoa/upload/"+src+"/peopleinfo/"+writeUserSignature+"'>";
}else{
	writeUserSignature = writeUser;
}
//System.out.println("手写签名："+writeUserSignature);
java.text.DateFormat df = new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm");
String nowTime = df.format(new java.util.Date());


//保护字段
com.js.oa.jsflow.service.WorkFlowCommonBD workFlowCommonBD2 = new com.js.oa.jsflow.service.WorkFlowCommonBD();
String protectField = "";
/*
String moduleId2 = workFlowCommonBD2.getModuleId(request.getParameter("table"));//模块ID
java.util.List protectList = new com.js.oa.jsflow.service.WorkFlowBD().getProtectList(request.getParameter("activity"),request.getParameter("table"),request.getParameter("record"),moduleId2);

for(int i=0;i<protectList.size();i++){
	Object[] objP = (Object[])protectList.get(i);
	protectField += objP[1].toString()+"="+objP[2].toString()+";";
}*/
if("".equals(protectField)){
	protectField = "none";
}
//电子签章div的位置
String inc_divId = java.util.Calendar.getInstance().getTimeInMillis() + "";

java.util.List officelist = new com.js.oa.jsflow.service.WorkFlowBD().getOffiDict(session.getAttribute("userId").toString(), session.getAttribute("domainId").toString());

int curIndex = 0;//批示意见对应字段的序号
//java.util.List commentList = new com.js.oa.jsflow.service.WorkFlowBD().getDealWithCommentNotBack(request.getParameter("table"),request.getParameter("record"),request.getParameter("workType"));
java.util.List commentList = null;
if(com.js.util.config.SystemCommon.getShowBackComment()==1){
	commentList= new com.js.oa.jsflow.service.WorkFlowBD().getDealWithComment(request.getParameter("table"),request.getParameter("record"),request.getParameter("workType"));
}else{
	commentList = new com.js.oa.jsflow.service.WorkFlowBD().getDealWithCommentNotBack(request.getParameter("table"),request.getParameter("record"),request.getParameter("workType"));
}

com.js.oa.jsflow.service.WorkFlowCommonBD include_comment_wfcBD = new com.js.oa.jsflow.service.WorkFlowCommonBD();
if("0".equals(request.getParameter("workType"))){
    //随机流程 
}else{
	int commentSize=0;
	
    //业务流程
    java.util.List tmpList = new java.util.ArrayList();
    String disActivityId = "";
    String disCurStepCount = "";
    String hasDisplayCommentId="";
    /**
    str2[0]:节点ID
    str2[1]:节点名称
    str2[2]:办理人姓名
    str2[3]:办理人处理意见
    str2[4]:处理意见时间
    str2[5]:当前意见是流程第几步骤
    str2[6]:
    str2[7]:意见查看范围
    str2[8]:意见对应字段
    str2[9]:  批示意见类型
    str2[10]: 阅件意见类型
    str2[11]: commtype
    str2[12]: emp_id
    str2[13]: wf_dealwithcomment_id
    str2[14]: signcomment
    	
    str3[0]:节点ID
    str3[1]:节点名称
    str3[2]:当前意见是流程第几步骤
    str3[3]:意见查看范围
    str3[4]:意见对应字段
    str3[5]:11
    str3[6]:批示意见类型
    str3[7]:阅件意见类型
    str3[8]:13
    
    **/
    
    for(int j = 0; j < commentList.size(); j ++){
        String[] str2 = (String[]) commentList.get(j);
        if(!disActivityId.equals(str2[0]) && !disCurStepCount.equals(str2[5]) && (!"-1".equals(str2[9]) || (!"-1".equals(str2[10]) && "2".equals( str2[11])))){
            //disActivityId = str2[0];
            //disCurStepCount = str2[5];           
            String[] str3 = {str2[0],str2[1],str2[5],str2[7],str2[8],str2[11],str2[9],str2[10],str2[13]};
            tmpList.add(str3);
            
        }
    }    
    if(tmpList.size()>0){
    
      out.write("   \r\n    \r\n    <table id=\"commentListTableTemp\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\" class=\"table_border\">\r\n    ");

    //开始循环显示意见........
    String[] str2 = null, str3 = null;
    boolean showComment;
    for(int j = 0; j < tmpList.size(); j ++){
        str2 = (String[]) tmpList.get(j);
		//判断是否显示意见，如果是无批示意见字段，则不显示
		String actiCommFieldType = str2[6];
		String passRoundCommFieldType = str2[7];
		showComment=false;
		
		if((str2[4]==null || "-1".equals(str2[4]) || str2[4].trim().length()<1 || str2[4].trim().toUpperCase().equals("NULL"))){
		     showComment=true;
		     commentSize++;
		}

    
      out.write("\r\n   <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n      <td height=\"24\" class=\"border_bottom_background\"><b>");
      out.print(str2[1]);
      out.write("</b></td>\r\n   </tr>\r\n   <!--显示意见Title结束,开始循环显示意见-->\r\n   ");

    if(request.getParameter("gd") != null || include_comment_wfcBD.inCommentRange(session.getAttribute("userId").toString(), session.getAttribute("orgIdString").toString(), str2[3]).booleanValue()){
    for(int k = 0; k < commentList.size(); k ++){
         str3 = (String[]) commentList.get(k);
         //判断是否显示意见，如果是无批示意见字段，则不显示
		 String commtype = str3[11];
		 if(("2".equals(commtype) && "-1".equals(passRoundCommFieldType)) || (!"2".equals(commtype) && "-1".equals(actiCommFieldType)) || !str2[8].equals(str3[13]) || hasDisplayCommentId.indexOf(","+str3[13]+",")>=0){
			continue;
		 }
		 hasDisplayCommentId+=","+str3[13]+",";		
					
		 if(str2[0].equals(str3[0]) && (str2[2]==null?"0":str2[2]).equals((str3[5]==null?"0":str3[5]))){
			//显示意见
			
			//设置时间格式
			if(str3[4].indexOf(".")>0){
				str3[4]=str3[4].substring(0,str3[4].indexOf("."));
			}
			if(str3[4].indexOf(":")>0){
				str3[4]=str3[4].substring(0,str3[4].lastIndexOf(":"));
			}
			 
		    boolean sx = false;
	        try{
	        	String contextLong = (str3[3]!=null&&str3[3].indexOf(":::")>0)?str3[3].split(":::")[0]:str3[3];
	        	if((contextLong.startsWith("1")||contextLong.startsWith("2"))&&contextLong.length()>=13
	        			&&contextLong.length()<=16){
					long longT = Long.parseLong(contextLong);
					sx = true;
	        	}
	        	//Long.parseLong((str3[3]!=null&&str3[3].indexOf(":::")>0)?str3[3].split(":::")[0]:str3[3]);
	        	//sx = true;
	        }catch(Exception e){
	        }
	        
	       if(sx){
           //手写批注
    	   if("0".equals(str3[15])){
       		   realSignHeight=userSignHeight;
       	   }else{
       		   realSignHeight=publicSignHeight;
       	   }
           if(str3[8]==null || "-1".equals(str3[8]) || str3[8].trim().length()<1 || str3[8].trim().toUpperCase().equals("NULL")){
        	   maxHandSignIndex=k;  
        	   
             //手写控件
        
      out.write("  \r\n        <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">    \r\n        <td height=\"");
      out.print(realSignHeight);
      out.write("\">\r\n            <OBJECT name=\"incSig");
      out.print(k);
      out.write("\" classid=\"clsid:2294689C-9EDF-40BC-86AE-0438112CA439\" codebase=\"/jsoa/iWebRevision.jsp/iWebRevision.cab#version=6,0,0,0\" width=\"100%\" height=\"");
      out.print(realSignHeight);
      out.write("\">\r\n                <param name=\"weburl\" value=\"http://");
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iWebRevision.jsp/iWebServer.jsp\">\r\n                <param name=\"recordid\" value=\"");
      out.print(str3[3]);
      out.write("\">\r\n                <param name=\"fieldname\" value=\"incSig");
      out.print(k);
      out.write("\">\r\n                <param name=\"username\" value=\"\">\r\n                <param name=\"Enabled\" value=\"0\">\r\n                <param name=\"PenColor\" value=\"00000000\">\r\n                <param name=\"BorderStyle\" value=\"0\">\r\n                <param name=\"SignatureType\" value=\"0\">\r\n                <param name=\"wmode\" value=\"opaque\">\r\n                <param name=\"ShowUserListMenu\" value=\"false\">\r\n            </OBJECT>\r\n            <script language=\"javascript\">document.all.incSig");
      out.print(k);
      out.write(".LoadSignature();</script>\r\n        </td> \r\n        </tr>\r\n        ");

	       //if(str3[14]!=null && str3[14].length()>4){
	       if(false){
        	 //使用了电子签章	         
        
      out.write("\r\n\t    <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n          <td height=\"1\"><div id=\"signPosi_");
      out.print(str3[14]);
      out.write("\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:100%;");
}
      out.write("'></div></td>\r\n        </tr>\r\n\t    ");

	         }
	    
      out.write("\r\n        <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n            <td>\r\n        ");

		   //判断是否转办人
		   if(str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3")){
		       out.print("转办人：");				
		   }
		   String srcLove="0000";
			if(ub.getSignature(str3[12])!=null && ub.getSignature(str3[12]).length()>6 && ub.getSignature(str3[12]).substring(4,5).equals("_")){
				srcLove=ub.getSignature(str3[12]).substring(0,4);
			}else{
				srcLove="0000";
			}
		
      out.write("\r\n\t\t");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+srcLove+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("&nbsp;&nbsp;(");
      out.print(str3[4]);
      out.write(")\r\n        ");
if(str3[6] != null && !str3[6].toString().equals("")){ 
      out.write("\r\n        <font color=\"blue\">(");
      out.print(str3[6]);
      out.write("代办)</font>\r\n        ");
 }
      out.write("\r\n\t     \t</td>\r\n\t\t</tr>\r\n\t\t");
 }else{//使用自定义批示意见字段处理手写批示意见 
      out.write("\r\n\t             <script language=\"javascript\">\r\n\t        \t\tvar divArr1 = document.getElementsByTagName(\"div\");\t        \t\t\t\r\n\t        \t\tif(divArr1.length>0){\r\n\t\t\t\t        var commentStr = \"");
      out.print((str3[3]==null?"":str3[3].replaceAll("\"","'")));
      out.write("\";\r\n\t\t\t\t        var commentIndex = 0;\r\n\t\t\t\t        var divID = \"\";\r\n\t\t\t\t\t\tfor(var i=0;i<divArr1.length;i++){\r\n\t\t\t\t\t\t\tif(divArr1[i].id.indexOf(\"-\")>=1 && divArr1[i].id.indexOf(\"-\")!=(divArr1[i].id.length-1) && (\"");
      out.print(str3[8]);
      out.write("\".indexOf(\"$\"+divArr1[i].id.split(\"-\")[1]+\"$\")>=0 || \"");
      out.print(str3[8]);
      out.write("\" == divArr1[i].id.split(\"-\")[1] )){\r\n\t\t\t\t\t\t\t\tif(divArr1[i].innerHTML.indexOf(\"<\")==0 ){\r\n\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML=\"\";\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t");
      out.write("\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t");

								   //判断是否转办人
								   /*if(str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3")){
								       out.print("转办人：");				
								   }
								   String srcLove="0000";
									if(ub.getSignature(str3[12])!=null && ub.getSignature(str3[12]).length()>6 && ub.getSignature(str3[12]).substring(4,5).equals("_")){
										srcLove=ub.getSignature(str3[12]).substring(0,4);
									}else{
										srcLove="0000";
									}*/
								
      out.write("\r\n\t\t\t\t\t\t\t\t//divArr1[i].innerHTML +=\"<div align=right>");
//=ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+srcLove+"/peopleinfo/"+ub.getSignature(str3[12])+"'>")
      out.write("&nbsp;&nbsp;(");
      out.print(str3[4]);
      out.write(")\";\r\n\t\t\t\t\t\t\t\t");
//if(str3[6] != null && !str3[6].toString().equals("")){ 
      out.write("\r\n\t\t\t\t\t\t        //divArr1[i].innerHTML +=\"<font color=blue>(");
//=str3[6]
      out.write("代办)</font></div>\";\r\n\t\t\t\t\t\t        ");
// }
      out.write("\r\n\t\t\t\t\t\t        divArr1[i].innerHTML+=\"<div align=right style='font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(';');
      out.write('\'');
      out.write('>');
      out.print(str3[4]);
      out.write("</div>\";\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t//alert(((commentStr!=\"null\" && commentStr!=\"\" && commentStr.indexOf(\":::\")>0)?commentStr.split(\":::\")[commentIndex-1]:commentStr));\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t");

								//if(str3[14]!=null && str3[14].length()>4){
								if(false){
									//使用了电子签章	
								
      out.write("\r\n\t\t\t\t\t\t\t\t");
      out.write("\r\n\t\t\t\t\t\t\t\t");

								}
								
      out.write("      \r\n\t\t\t\t\t\t\t\t");
      out.write("\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t        \t\t}\r\n\t        \t</script>\r\n\t        \t\t\r\n\t ");
       }
	      }else{ //end of if(sx) 未使用手写签批的情况 
      out.write("\r\n\t         <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("; text-align: left;\"><td class=\"td_top\">&nbsp;\r\n\t         ");

	         if(str3[8]==null || "-1".equals(str3[8]) || str3[8].trim().length()<1 || str3[8].trim().toUpperCase().equals("NULL")){
	         	   if(str3[3] != null){
                       out.print(str3[3]);
                   }
	         
      out.write("\r\n\t         </td>\r\n\t         </tr>\r\n\t         ");

	         //if(str3[14]!=null && str3[14].length()>4){
	         if(false){
	        	 //使用了电子签章	         
	         
      out.write("\r\n\t\t    <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n\t          <td height=\"1\"><div id=\"signPosi_");
      out.print(str3[14]);
      out.write("\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:100%;");
}
      out.write("'></div></td>\r\n\t        </tr>\r\n\t         ");
 } 
      out.write("\r\n\t         <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\"><td height=\"20\" align=\"right\">\r\n\t         ");

                   if(str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3")){
                       out.print("转办人：");
                   }
                   String src_Love="0000";
					if(ub.getSignature(str3[12])!=null && ub.getSignature(str3[12]).length()>6 && ub.getSignature(str3[12]).substring(4,5).equals("_")){
						src_Love=ub.getSignature(str3[12]).substring(0,4);
					}else{
						src_Love="0000";
					}
   
      out.write("<!-- 显示名字和日期 -->\r\n                   ");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+src_Love+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("&nbsp;&nbsp;(");
      out.print(str3[4]);
      out.write(")\r\n   ");

                   if(str3[6] != null && !str3[6].toString().equals("")){
   
      out.write("\r\n                      <font color=\"blue\">(");
      out.print(str3[6]);
      out.write("代办)</font>\r\n   ");

                   }
              
      out.write("\r\n              </td>\r\n              </tr>\r\n              \r\n   ");
      }else{//enf of if(str3[8]==null || "-1".equals(str3[8]) || str3[8].tri.......
		   	  //批示意见对应字段情况
   
      out.write("\r\n                   <script language=\"javascript\">\r\n\t\t\t        \tvar divArr1 = document.getElementsByTagName(\"div\");\r\n\t\t        \t\tif(divArr1.length){\r\n\t\t\t\t\t\t\t\tvar commentStr = \"");
      out.print((str3[3]==null?"":str3[3].replaceAll("\"","'")));
      out.write("\";\r\n\t\t\t\t\t\t\t\tvar commentIndex = 0;\r\n\t\t\t\t\t\t\t\tfor(var i=0;i<divArr1.length;i++){\r\n\t\t\t\t\t\t\t\t  \r\n\t\t\t\t                   if(divArr1[i].id.indexOf(\"-\")>=1 && divArr1[i].id.indexOf(\"-\")!=(divArr1[i].id.length-1) && (\"");
      out.print(str3[8]);
      out.write("\".indexOf(\"$\"+divArr1[i].id.split(\"-\")[1]+\"$\")>=0 || \"");
      out.print(str3[8]);
      out.write("\" == divArr1[i].id.split(\"-\")[1] )){\r\n\t\t\t\t\t\t\t\t\t\t/*if(divArr1[i].innerHTML.indexOf(\"<\")==0 ){\r\n\t\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML=\"\";\r\n\t\t\t\t\t\t\t\t\t\t}*/\r\n\t\t\t\t\t\t\t\t\t\t");

										String src_myLove="0000";
										if(ub.getSignature(str3[12])!=null && ub.getSignature(str3[12]).length()>6 && ub.getSignature(str3[12]).substring(4,5).equals("_")){
											src_myLove=ub.getSignature(str3[12]).substring(0,4);
										}else{
											src_myLove="0000";
										}
										
										 
      out.write("\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML += \"<div><div style='font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"+((commentStr!=\"null\" && commentStr!=\"\" && commentStr.indexOf(\":::\")>0)?commentStr.split(\":::\")[commentIndex++]:commentStr)+\r\n\t\t\t\t\t\t\t\t\t\t\"</div><div style='TEXT-ALIGN: right;padding-right:20px;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"\r\n\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3"))?"转办人：":"");
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+src_myLove+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("\"+\"&nbsp;(");
      out.print(str3[4]);
      out.write(")\"\r\n\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[6] != null && !str3[6].toString().equals(""))?("("+str3[6]+"代办)"):"");
      out.write("</div></div>\";\r\n\t\t\t\t\t\t\t\t\t\t");

										//if(str3[14]!=null && str3[14].length()>4){
										if(false){
											//使用了电子签章
											String divIdSet = str3[14].endsWith("id=")?str3[14].substring(0,str3[14].indexOf(" id=")):str3[14];
										
      out.write("\r\n\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML+=\"<div id=\\\"signPosi_");
      out.print(divIdSet);
      out.write("\\\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:100%;");
}
      out.write("'></div>\";\r\n\t\t\t\t\t\t\t\t\t\t");
}
      out.write("\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}//end of for()\r\n\t\t        \t\t}//end of if\r\n\t\t\t\t     </script>\r\n\t\t\t\t     \r\n\t ");
       } // end of enf of if(str3[8]==null 批示意见对应字段
           }// end of end of if(sx)
        }//end of if(str2[0].equals(str3[0]) && (str2[2]
     }//end of for(int k=0 
     
     }// end of if(request.getParameter("gd") != null || inc
   
     }// end for(int j = 0; j < tmpList.size(); j ++){
     
      out.write("\r\n     </table>\r\n     ");

   }// end if(tmpList.size()>0){
   if(commentSize>0){
	   
      out.write("\r\n\t   <script>\r\n\t   document.all.commentListTableTemp.style.display='';\r\n\t   </script>\r\n\t   ");

   }else{
	   
      out.write("\r\n\t   <script>\t   \r\n\t   if(document.all.commentListTableTemp)document.all.commentListTableTemp.style.display='none';\r\n\t   </script>\r\n\t   ");

   }
}// end of 业务流程

      out.write("\r\n\r\n\r\n\r\n\r\n<!-- 退回意见 -->\r\n");

	String backCommentStr = new com.js.oa.jsflow.service.WorkFlowButtonBD().getBackComment(request.getParameter("processId"),request.getParameter("table"),request.getParameter("record"));

      out.write("<BR>\r\n    <table width=\"80%\" border=\"0\" cellpadding=\"0\" align=\"center\" cellspacing=\"0\">\r\n    \r\n        <tr style=\"display:");
      out.print("".equals(backCommentStr)?"none":"none");
      out.write("\">\r\n\t\t<td>\r\n\t\t<table border=\"0\" width=\"100%\" style=\"border:1px solid #366AB3;background-color:#F6F6F6;\"><tr>\r\n            <td width=\"120\" nowrap align=\"center\" valign=\"middle\" style=\"border:1px solid #366AB3;background-color:#F6F6F6;border-bottom:1px;border-top:0px;border-left:0px;\">退回意见：</td>\r\n            <td style=\"word-break:break-all;\">\r\n                    <table width=\"100%\" border=\"0\">\r\n\t\t\t\t\t");
      out.print(backCommentStr);
      out.write("                 \r\n                    </table>\r\n                \r\n                &nbsp;\r\n            </td>\r\n\t\t\t</tr></table></td>\r\n        </tr>\r\n    \r\n    </table>\r\n<BR>\r\n");

int _inWorkStatus = new com.js.oa.jsflow.service.WorkFlowBD().getWorkStatusByWorkId(request.getParameter("work"));
if((_inWorkStatus==0 || _inWorkStatus==2) && !"1".equals(request.getParameter("printFlag"))){
    //待批或待阅文件
	//没有设置批示意见对应字段，使用默认批示意见 
	if((request.getAttribute("curCommField")==null || "-1".equals(request.getAttribute("curCommField")) || request.getAttribute("curCommField").toString().trim().length()<1 || request.getAttribute("curCommField").toString().toUpperCase().equals("NULL"))
	&& !"1".equals(request.getParameter("savefirst"))
	&& !"-1".equals(request.getAttribute("commFieldType")+"")
	){
	  String SignatureId = new java.util.Date().getTime() + "";
    
      out.write("\r\n    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"table_border\">\r\n    <tr>\r\n\t    <td class=\"border_bottom_background\"><b>办理意见</b></td>\r\n\t    <td height=\"24\" align=\"left\" class=\"border_bottom_background\">\r\n\t       <div align=\"right\"><a href=\"javascript:void(0);\" onClick=\"getNote(");
if(BrowserJudge.isFirefox(request)){
      out.write("event");
}
      out.write(");\" onmouseout=\"hiddenNote();\" onmouseover=\"lockedNote();\" >常用语</a></div>\r\n\t\t\t <div id=\"noteDiv\" style=\"right:15px;\" onmouseout=\"hiddenNote();\" onmouseover=\"lockedNote();\" value=\"comment\">\r\n\t\t\t\t");

				  if(officelist!=null&&officelist.size()>0){
				   for(int i=0;i<officelist.size();i++){
					 String offContent=""+officelist.get(i);
      out.write("\r\n\t\t\t\t\t  <div class=\"divOut\" onmouseover=\"lockedNote();this.className='divOver'\" onmouseout=\"this.className='divOut'\" onclick=\"include_set_comment(this,'comment')\">");
      out.print(offContent);
      out.write("</div>\t\t\t\t   \r\n\t\t\t\t   ");
}
				}
				
      out.write("\r\n\t\t\t  ");
      out.write("</div> \r\n\t\t\t  </td>\r\n\t  </tr>\r\n\t  <!-- 填写意见框 -->\r\n\t\t<!-- 普通 -->\r\n\t  <tr  id=\"signTb1\">\r\n\t    <td colspan=\"2\" align=\"right\" class=\"td_top\">\r\n\t     <textarea name=\"comment\" id=\"comment\" cols=\"50\" Class=\"inputTextarea\" style=\"width:100%\" rows=\"5\" onblur=\"include_checkTextArea(this,'办理意见',2000);\"></textarea>\r\n\t\t</td>\r\n\t  </tr>\r\n\t  ");
if(handSignInUse==1){
		  String curHandSignType=new com.js.oa.jsflow.service.ActivityBD().getActivityHandSignType(request.getParameter("activity"));
		  realSignHeight=("0".equals(curHandSignType))?userSignHeight:publicSignHeight;
	  
      out.write("\r\n\t\t\t\t<tr id=\"signTb2\"  style=\"display:none\">\r\n\t\t\t\t\t    <td width=\"90%\" height=\"150\">\r\n\t\t\t\t\t\t<OBJECT name=\"incSig");
      out.print(maxHandSignIndex+1);
      out.write("\" classid=\"clsid:2294689C-9EDF-40BC-86AE-0438112CA439\" codebase=\"/jsoa/iWebRevision.jsp/iWebRevision.cab#version=6,0,0,0\" width=\"100%\" height=\"");
      out.print(realSignHeight);
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"weburl\" value=\"http://");
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iWebRevision.jsp/iWebServer.jsp\">\r\n\t\t\t\t\t\t\t<param name=\"recordid\" value=\"");
      out.print(SignatureId);
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"fieldname\" value=\"incSig");
      out.print(maxHandSignIndex+1);
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"username\" value=\"");
      out.print(session.getAttribute("userName"));
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"Enabled\" value=\"1\">\r\n\t\t\t\t\t\t\t<param name=\"PenWidth\" value=\"1\">\r\n\t\t\t\t\t\t\t<param name=\"PenColor\" value=\"00000000\">\r\n\t\t\t\t\t\t\t<param name=\"BorderStyle\" value=\"0\">\r\n\t\t\t\t\t\t\t<param name=\"EditType\" value=\"0\">\r\n\t\t\t\t\t\t    <param name=\"ShowUserListMenu\" value=\"false\">\r\n\t\t\t\t\t\t</OBJECT>\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"comment\" value=\"");
      out.print(SignatureId);
      out.write("\"><br>\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"SignSendOutObject\" value=\"incSig");
      out.print(maxHandSignIndex+1);
      out.write("\"><br>\r\n\t\t\t\t\t\t<!-- <a href=\"javascript:\" onclick=\"if (!SendOut.OpenSignature()){alert(SendOut.Status);}\">打开签章</a> -->\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t<td valign=\"top\" style=\"padding-top:10px;\">\r\n\t\t\t\t\t\t    <input type=\"button\" class=\"btnButton2font\" onclick=\"if (!document.all.incSig");
      out.print(maxHandSignIndex+1);
      out.write(".OpenSignature()){alert(document.all.incSig");
      out.print(maxHandSignIndex+1);
      out.write(".Status);}\"  value=\"签章\">\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t");
}
      out.write("\r\n\t\t\t");
//if(signatureInUse==1){
			if(false){
			
      out.write("\r\n\t\t\t\t<!-- 电子签章 -->\r\n\t\t\t\t<tr id=\"signTb3\" style=\"display:none\">\r\n\t\t\t\t\t    <td width=\"90%\" height=\"10\">\r\n\t\t\t\t\t\t    <div id=\"signPosi_");
      out.print(inc_divId+"0000");
      out.write("\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:100%;");
}
      out.write("'></div>\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"include_signcomment\" value=\"");
      out.print(inc_divId+"0000");
      out.write("\">\r\n\t\t\t\t\t\t</td>\t\t\t\t\t\t\r\n\t\t\t\t</tr>\r\n\t\t\t");
}
      out.write("\r\n\t\t\t\r\n\t\t\t<tr>\r\n\t\t   <td height=\"26\" colspan=\"2\" align=\"right\">\r\n\t\t\t<input type=\"hidden\" name=\"commentSignType\" value=\"0\"><!-- 用户选择的批示类型 -->\r\n\t\t\t");
      out.write("\r\n\t\t\t<div align=\"right\" style=\"clear:both;\" >");
      out.print(writeUserSignature+"("+nowTime+")");
      out.write("</div>\r\n\t\t </td>\r\n\t\t</tr>\t  \r\n    </table>\r\n\r\n    ");

	}
}

      out.write("\r\n\r\n\r\n\r\n");
if(signatureInUse==1){
      out.write('\r');
      out.write('\n');
      out.write('\r');
      out.write('\n');
}
      out.write("\r\n\r\n<script language=\"javascript\">\r\n//增加批示字段对应意见到指定位置 \r\n");
if(request.getAttribute("curCommField")!=null && !"-1".equals(request.getAttribute("curCommField")) && request.getAttribute("curCommField").toString().trim().length()>0 && !request.getAttribute("curCommField").toString().toUpperCase().equals("NULL") && (_inWorkStatus==0 || _inWorkStatus==2)){
      out.write("\r\nvar divArr = document.getElementsByTagName(\"div\");\r\nvar useDivArr = 0;\r\nif(divArr.length){\r\n    for(var i=0;i<divArr.length;i++){\r\n        //1000980-js$f1631\r\n\r\n        if(divArr[i].id.indexOf(\"-\")>=1 && divArr[i].id.indexOf(\"-\")!=(divArr[i].id.length-1) && (\"");
      out.print(request.getAttribute("curCommField").toString());
      out.write("\".indexOf(\"$\"+divArr[i].id.split(\"-\")[1]+\"$\")>=0 || \"");
      out.print(request.getAttribute("curCommField").toString());
      out.write("\" == divArr[i].id.split(\"-\")[1]) ){\r\n            \r\n            /*if(divArr[i].innerHTML.indexOf(\"<\")==0 ){\r\n                divArr[i].innerHTML=\"\";\r\n            }*/\r\n\t\t\t");

				String SignatureId1 = new java.util.Date().getTime() + "";
            
      out.write("\r\n\t\t\t\t//复合三种审批方式\r\n\t\t\t\t//普通\r\n\t\t\t\tdivArr[i].innerHTML+=\r\n\t\t\t\t\t\"<div id='signTb1' style='display:'>\"+\r\n\t\t\t\t\t\"<div align='right' style=\\\"width:98%;\\\">&nbsp;&nbsp;&nbsp;<a href=\\\"javascript:;\\\" onClick=\\\"getNote(");
if(BrowserJudge.isFirefox(request)){
      out.write("event");
}
      out.write(");\\\" onmouseout=\\\"hiddenNote();\\\" onmouseover=\\\"lockedNote();\\\">常用语</a></div>\"+ \r\n\t\t\t\t\t\"<div id=\\\"noteDiv\\\" style=\\\"right:15px;\\\" value=\"+divArr[i].id.split(\"-\")[1]+\" onmouseout=\\\"hiddenNote();\\\" onmouseover=\\\"lockedNote();\\\">\"+\r\n\t\t\t\t\t");

					  if(officelist!=null&&officelist.size()>0){
					   for(int i=0;i<officelist.size();i++){
						 String offContent=""+officelist.get(i);
      out.write("\r\n\t\t\t\t\t\t  \"<div class=\\\"divOut\\\" onmouseover=\\\"lockedNote();this.className='divOver'\\\" onmouseout=\\\"this.className='divOut'\\\" onclick=\\\"include_set_comment(this,'\"+divArr[i].id.split(\"-\")[1]+\"')\\\">");
      out.print(offContent);
      out.write("</div>\"+\r\n\t\t\t\t\t   \r\n\t\t\t\t\t   ");
}
					}
					
      out.write("\t\t\t\r\n\t\t\t\t\t");
      out.write("\"</div>\"+\r\n\t\t\t\t\t\"<div><textarea name=\\\"\"+divArr[i].id.split(\"-\")[1]+\"\\\"  id=\\\"\"+divArr[i].id.split(\"-\")[1]+\"\\\"  Class=\\\"inputTextarea\\\" rows='6' style=\\\"width:98%;\\\" onblur=\\\"include_checkTextArea(this,'办理意见',2000);\\\"></textarea>&nbsp;</div></div>\";\r\n\r\n\t\t\t\t//手写\r\n\t\t\t  ");

			  if(false){
				  String curHandSignType=new com.js.oa.jsflow.service.ActivityBD().getActivityHandSignType(request.getParameter("activity"));
				  realSignHeight=("0".equals(curHandSignType))?userSignHeight:publicSignHeight;
			  
      out.write("\r\n\t\t\t\tdivArr[i].innerHTML += \r\n\t\t\t\t\t\"<div id='signTb2' style='display:none'>\"+\r\n\t\t\t\t\t\"<div style='text-align:right;'><input type='button' class=btnButton2font onclick=\\\"if (!\"+divArr[i].id.split(\"-\")[1]+\"_SendOut.OpenSignature()){alert(\"+divArr[i].id.split(\"-\")[1]+\"_SendOut.Status);}\\\" value='签章' />&nbsp;</div>\"+\r\n\t\t\t\t\t\"<div>\"+\r\n\t\t\t\t\t\"<OBJECT name=\\\"\"+divArr[i].id.split(\"-\")[1]+\"_SendOut\\\" classid=\\\"clsid:2294689C-9EDF-40BC-86AE-0438112CA439\\\" codebase=\\\"/jsoa/iWebRevision.jsp/iWebRevision.cab#version=6,0,0,0\\\" width=\\\"100%\\\" height=\\\"");
      out.print(realSignHeight);
      out.write("\\\">\"\r\n                \t\t\t+\"<param name=\\\"weburl\\\" value=\\\"http://");
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iWebRevision.jsp/iWebServer.jsp\\\">\"\r\n            \t\t\t\t+\"<param name=\\\"recordid\\\" value=\\\"");
      out.print(SignatureId1);
      out.write("\"+i+\"\\\">\"\r\n                \t\t\t+\"<param name=\\\"fieldname\\\" value=\\\"SendOut\\\">\"\r\n                \t\t\t+\"<param name=\\\"username\\\" value=\\\"");
      out.print(session.getAttribute("userName"));
      out.write("\\\">\"\r\n                \t\t\t+\"<param name=\\\"Enabled\\\" value=\\\"1\\\">\"\r\n               \t \t\t\t+\"<param name=\\\"PenColor\\\" value=\\\"00000000\\\">\"\r\n                \t\t\t+\"<param name=\\\"BorderStyle\\\" value=\\\"0\\\">\"\r\n                \t\t\t+\"<param name=\\\"EditType\\\" value=\\\"0\\\"><param name=\\\"PenWidth\\\" value=\\\"1\\\">\"\r\n                            +\"<Param Name=\\\"ShowScale\\\" value=\\\"50\\\">\"\r\n                            +\"<param name=\\\"ShowUserListMenu\\\" value=\\\"false\\\">\"\r\n            \t\t\t\t+\"</OBJECT>\"\r\n            \t\t\t\t+\"<input type=\\\"hidden\\\" name=\\\"\"+divArr[i].id.split(\"-\")[1]+\"\\\" value=\\\"");
      out.print(SignatureId1);
      out.write("\"+i+\"\\\"></div>\"+\r\n\t\t\t\t\t\"</div></div>\";\r\n\t\t\t ");
}
      out.write("\r\n\t\t\t ");
if(false){
      out.write("\r\n\t\t\t\t//电子签章\r\n\t\t\t\tdivArr[i].innerHTML += \r\n\t\t\t\t\t\"<div id='signTb3' style='position:relative;width:100%;height:1px;' style='display:none'>\"+\r\n\t\t\t\t\t\t//\"<div valign=bottom align=\\\"right\\\"></div>&nbsp;\"+\r\n\t\t\t\t\t\t\"<div id=\\\"signPosi_");
      out.print(inc_divId+"0000");
      out.write("\\\" style=\\\"position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:100%;");
}
      out.write("\\\"><div valign=bottom align=\\\"right\\\"><input type=\\\"hidden\\\" name=\\\"include_signcomment\\\" id=\\\"include_signcomment\\\" value=\\\"");
      out.print(inc_divId+"0000");
      out.write("\\\"></div>\"+\r\n\t\t\t\t\t\"</div>\";\r\n\t\t\t ");
}
      out.write("\r\n\t\t\t\tdivArr[i].innerHTML += \r\n\t\t\t\t\t\"<div align=\\\"right\\\"><input type=\\\"hidden\\\" name=\\\"commentSignType\\\" id=\\\"commentSignType\\\" value=\\\"0\\\">\"+\r\n\t\t\t\t\t\"");
if(false){
      out.write("<a href=\\\"javascript:;\\\" onClick=\\\"changeSignTypeArr('0',\"+useDivArr+\");\\\">普通</a>&nbsp;");
}
if(false){
      out.write("<a href=\\\"javascript:;\\\"\"+ \"onClick=\\\"changeSignTypeArr('1',\"+useDivArr+\");\\\">手写签批</a>&nbsp;");
}if(false){
      out.write("<a href=\\\"javascript:;\\\" onClick=\\\"changeSignTypeArr('2',\"+useDivArr+\");include_signature();\\\">盖章</a>&nbsp;<a href=\\\"javascript:;\\\" onClick=\\\"changeSignTypeArr('2',\"+useDivArr+\");include_signature2();\\\">签字</a>&nbsp;");
}
      out.write("</div>\";\r\n\t\t\t\tdivArr[i].innerHTML += \"<div align=\\\"right\\\">");
      out.print(writeUserSignature+"("+nowTime+")");
      out.write("</div>\";\r\n\t\t\t\tuseDivArr ++;\t\t\t\t\r\n        }\r\n    }\r\n}\r\n");
}
      out.write("\r\n\r\n\r\nfunction changeSignTypeArr(type, i){\r\n\tif(document.all.commentSignType.length){\r\n\t\tif(type=='0'){\r\n\t\t\tif(document.all.signTb1 && document.all.signTb1[i]){\r\n\t\t\t\tdocument.all.signTb1[i].style.display=\"\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb2 && document.all.signTb2[i]){\r\n\t\t\t\tdocument.all.signTb2[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb3 && document.all.signTb3[i]){\r\n\t\t\t\tdocument.all.signTb3[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t} else if(type=='1'){\r\n\t\t\tif(winZoomSize>1){\r\n\t\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的放大状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\r\n\t\t\t}else if(winZoomSize<1){\r\n\t\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的缩小状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\t\r\n\t\t\t}else{\t\t\r\n\t\t\t\tif(document.all.signTb2 && document.all.signTb2[i]){\r\n\t\t\t\t\tdocument.all.signTb2[i].style.display=\"\";\r\n\t\t\t\t}\r\n\t\t\t\tif(document.all.signTb1 && document.all.signTb1[i]){\r\n\t\t\t\t\tdocument.all.signTb1[i].style.display=\"none\";\r\n\t\t\t\t}\r\n\t\t\t\tif(document.all.signTb3 && document.all.signTb3[i]){\r\n\t\t\t\t\tdocument.all.signTb3[i].style.display=\"none\";\r\n");
      out.write("\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if(type=='2'){\r\n\t\t\tif(document.all.signTb3 && document.all.signTb3[i]){\r\n\t\t\t\tdocument.all.signTb3[i].style.display=\"\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb1 && document.all.signTb1[i]){\r\n\t\t\t\tdocument.all.signTb1[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb2 && document.all.signTb2[i]){\r\n\t\t\t\tdocument.all.signTb2[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*document.all.commentSignType[i].value = type;\r\n\t\t//判断电子签章选项\r\n\t\tif(!document.all.signTb2 && type=='2'){\r\n\t\t\tdocument.all.commentSignType[i].value = 1;\r\n\t\t}*/\r\n\t\t\r\n\t\tif(type!='2'){\r\n\t\t\tdocument.all.commentSignType[i].value = type;\r\n\t\t}\r\n\t} else{\r\n\t\tchangeSignType(type);\r\n\t}\r\n}\r\n\r\nfunction changeSignType(type){\r\n\tif(type=='0'){\r\n\t\tif(document.all.signTb1){\r\n\t\t\tdocument.all.signTb1.style.display=\"\";\r\n\t\t}\r\n\t\tif(document.all.signTb2){\r\n\t\t\tdocument.all.signTb2.style.display=\"none\";\r\n\t\t}\r\n\t\t/*if(document.all.signTb3){\r\n\t\t\tdocument.all.signTb3.style.display=\"none\";\r\n\t\t}*/\r\n\t} else if(type=='1'){\r\n\t\t\r\n\t\tvar winZoomSize=1;\r\n\t\ttry{\r\n\t\t\twinZoomSize=ZoomHint.ZoomValue;\r\n");
      out.write("\t\t}catch(e){\r\n\t\t\twinZoomSize=1;\r\n\t\t}\t\t\r\n\t\t\r\n\t\tif(winZoomSize>1){\r\n\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的放大状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\r\n\t\t}else if(winZoomSize<1){\r\n\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的缩小状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\t\r\n\t\t}else{\r\n\t\t\tif(document.all.signTb2){\r\n\t\t\t\tdocument.all.signTb2.style.display=\"\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb1){\r\n\t\t\t\tdocument.all.signTb1.style.display=\"none\";\r\n\t\t\t}\r\n\t\t\t/*if(document.all.signTb3){\r\n\t\t\t\tdocument.all.signTb3.style.display=\"none\";\r\n\t\t\t}*/\r\n\t\t}\r\n\t} else if(type=='2'){\r\n\t\tif(document.all.signTb3){\r\n\t\t\tdocument.all.signTb3.style.display=\"\";\r\n\t\t}\r\n\t\t/*if(document.all.signTb1){\r\n\t\t\tdocument.all.signTb1.style.display=\"none\";\r\n\t\t}\r\n\t\tif(document.all.signTb2){\r\n\t\t\tdocument.all.signTb2.style.display=\"none\";\r\n\t\t}*/\r\n\t}\r\n\t/*document.all.commentSignType.value = type;\r\n\t//判断电子签章选项\r\n\tif(!document.all.signTb2 && type=='2'){\r\n\t\tdocument.all.commentSignType.value = 1;\r\n\t}*/\r\n\t\r\n\tif(type!='2'){\r\n\t\tdocument.all.commentSignType.value = type;\r\n");
      out.write("\t}\r\n\t\r\n}\r\n\r\n\r\nfunction changeSignature(name,type){\r\n\tif(eval(\"document.all.\"+name+\".EditType\") == 0){\r\n        \t//手写变键盘\r\n        \teval(\"document.all.\"+name).EditType = 1;\r\n            eval(\"document.all.signatureHref\"+name).innerHTML = \"切换手写\";\r\n        }else{\r\n        \t//键盘变手写\r\n               eval(\"document.all.\"+name).EditType = 0;\r\n                eval(\"document.all.signatureHref\"+name).innerHTML = \"切换键盘\";\r\n        }\r\n}\r\n\r\nfunction include_checkTextArea(obj, tmp, len){\r\n    if(obj.value.length > len){\r\n        alert(tmp + \"不能超过\" + len + \"字！\");\r\n        obj.focus();\r\n    }\r\n}\r\n\r\nfunction include_offiDict(userId, field){\r\n    JSMainWinOpen('/jsoa/jsflow/workflow_offiDict.jsp?userId=' + userId + '&textAreaName=' + field,'','menubar=0,scrollbars=yes,locations=0,width=400,height=200,resizable=yes');\r\n}\r\n\r\nfunction include_set_comment(obj,commentName){\r\n\tvar val=obj.value==null?obj.innerHTML:obj.value;\r\n\tvar cobj=eval(\"document.all.\"+commentName);\r\n\t//cobj.value=cobj.value+val;\r\n\tif(cobj.length){\r\n\t\tcobj[0].value=val;\r\n");
      out.write("\t} else{\r\n\t\tcobj.value=val;\r\n\t}\r\n}\r\n\r\nfunction addDivContent(){\r\n\tvar adddivcontent=document.all.addDivContent.value;\r\n\tvar comment=document.getElementById(\"noteDiv\").getAttribute(\"value\");\r\n\tdocument.getElementById(\"noteDiv\").innerHTML= \"\"+\"<div class='divOut' onmouseover='lockedNote();this.className=\\\"divOver\\\"' onmouseout='this.className=\\\"divOut\\\"' onclick=\\\"include_set_comment(this,\\'\"+comment+\"\\');\\\">\"+adddivcontent+\"<\\/div>\"+document.getElementById(\"noteDiv\").innerHTML;\r\n}\r\n\r\n//电子签章\r\nvar wnd;\r\n//作用：进行甲方签章\r\nfunction include_signature() {\r\n\t\r\n}\r\n\r\n//作用：进行手写签名\r\nfunction include_signature2() {\r\n\t\r\n}\r\n\r\n");
if(false){
      out.write("\r\ntry{\r\n\tdocument.all.SignatureControl.ShowSignature('");
      out.print(request.getParameter("record"));
      out.write("');\r\n}catch(e){\r\n}\r\n");
}
      out.write("\r\n</script>\r\n");

//if(!"1".equals(request.getParameter("printFlag")+"")){
if(false){	// 微信中不引用判断浏览器缩放的js
	
      out.write("\r\n\t<script src=\"/jsoa/skin/zoom/ZoomDetect.js\"></script>\r\n\t");

}

      out.write("\r\n                      \t\t\t\t\t</td>\r\n                   \t\t\t\t\t</tr>\r\n\t\t                            ");

                           			String formName = "frm";//在包含页中指定form的名称
                           			String saveCheckFn = "beforeSubmit()";//保存时校验表单的javascript函数名称
	                            	String mainLinkFile = "/jsoa/WorkFlowProcAction.do?flowpara=1";//文件办理时打开的页面链接
									String passLinkFile = "/jsoa/WorkFlowProcAction.do?flowpara=1";//阅件时打开的页面链接
	                            	String subProcHref = "/jsoa/weiXinJsFlowAddAction.do?action=add&moduleId=1";//新建子流程链接
	                            	String titleFieldName = "";//作为显示标题的表单中的元素的名称,如果为""则按工作流程的标题
	                            	String[][] button = null;//包含页面中的附加按钮的名称和触发的javascript函数名称
	                            	String curCommField = (request.getAttribute("curCommField")==null || "-1".equals(request.getAttribute("curCommField")))?null:request.getAttribute("curCommField").toString();//批示意见对应字段
	                            	String curPassRoundCommField = request.getAttribute("curPassRoundCommField")==null?"":request.getAttribute("curPassRoundCommField").toString();//阅办意见对应字段
                        			String msgFrom = "工作流程";//短信提醒模块名称
	                           	 	
      out.write("\r\n\t                            \t<tr name=\"stepRow\" id=\"stepRow\">\r\n\t                              \t\t<td height=\"22\" colspan=\"2\">\r\n\t                              \t\t\t");
      out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n");

request.setCharacterEncoding("utf-8");
String localhi = session.getAttribute("org.apache.struts.action.LOCALE").toString();

String pageKey=String.valueOf(new java.util.Date().getTime());
//workVO
String workId = WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("work")));
String processId = WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("processId")));
String tableId = WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("table")));
String recordId = WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("record")));
String stepCount = WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("stepCount")));
String hangup = (String)request.getAttribute("hangup");
String workType = WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("workType")));
int inWorkType = ("null".equals(workType) || workType==null)?-1:Integer.parseInt(workType);//流程类型 0随机流程,1业务流程
String curTransactType = new com.js.oa.jsflow.service.WorkFlowButtonBD().getCurTransactTypeByWorkId(workId);//当前节点办理方式
//判断是否已经发起子流程
String subProcWorkId=new com.js.oa.jsflow.service.WorkFlowButtonBD().getSubProcWorkId(processId,tableId,recordId);
if(subProcWorkId==null){
	subProcWorkId="";
}

com.js.oa.jsflow.vo.WorkVO workVO = new com.js.oa.jsflow.vo.WorkVO();
if(workId!=null && tableId!=null && recordId!=null){
	workVO.setId(Long.valueOf(workId));
	workVO.setTableId(Long.valueOf(tableId));
	workVO.setRecordId(Long.valueOf(recordId));
	workVO.setStepCount(stepCount);
}

int inWorkStatus = new com.js.oa.jsflow.service.WorkFlowBD().getWorkStatusByWorkId(workId);
String curParallelActId=request.getAttribute("workPrarllelCurActId")==null?"0":request.getAttribute("workPrarllelCurActId").toString();


      out.write("\r\n<script type='text/javascript' src='/jsoa/workflow/dwr/interface/workflowSync.js'></script>\r\n<script type='text/javascript' src='/jsoa/workflow/dwr/engine.js'></script>\r\n\r\n<link href=\"/jsoa/skin/");
      out.print(session.getAttribute("skin"));
      out.write("/style-");
      out.print(session.getAttribute("browserVersion"));
      out.write("-doc.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<input type=\"hidden\" name=\"workId\" id=\"workId\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("work"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"tableId\" id=\"tableId\" value=\"");
      out.print((tableId!=null && !tableId.toUpperCase().equals("NULL")&& tableId.length()>0) ? tableId : WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getAttribute("tableId"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"recordId\" id=\"recordId\" value=\"");
      out.print((recordId!=null && !recordId.toUpperCase().equals("NULL") && recordId.length()>0) ? recordId : WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getAttribute("recordId"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"workType\" id=\"workType\" value=\"");
      out.print(workType );
      out.write("\">\r\n<input type=\"hidden\" name=\"processName\" id=\"processName\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("processName"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"curActivityId\" id=\"curActivityId\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("activity"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"curActivityName\" id=\"curActivityName\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("activityName"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"submitPerson\" id=\"submitPerson\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("submitPerson"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"submitPersonId\" id=\"submitPersonId\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("submitPersonId"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"stepCount\" id=\"stepCount\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("stepCount"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"remindField\" id=\"remindField\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getAttribute("remindField"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"isStandForWork\" id=\"isStandForWork\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("isStandForWork"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"standForUserId\" id=\"standForUserId\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("standForUserId"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"standForUserName\" id=\"standForUserName\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("standForUserName"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"mainLinkFile\" id=\"mainLinkFile\" value=\"");
      out.print(mainLinkFile );
      out.write("\">\r\n<input type=\"hidden\" name=\"page_token\" id=\"page_token\" value=\"");
      out.print(Calendar.getInstance().getTimeInMillis());
      out.write("\"/>\r\n<input type=\"hidden\" name=\"titleFieldName\" id=\"titleFieldName\" value=\"");
      out.print(titleFieldName );
      out.write("\">\r\n<!-- <input type=\"hidden\" name=\"title\" value=\"");
//=title
      out.write("\"> -->\r\n<input type=\"hidden\" name=\"processId\" id=\"processId\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("processId"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"msgFrom\" id=\"msgFrom\" value=\"");
      out.print(msgFrom );
      out.write("\">\r\n<input type=\"hidden\" name=\"inWorkType\" id=\"inWorkType\" value=\"");
      out.print(inWorkType );
      out.write("\">\r\n<input type=\"hidden\" name=\"submitTime\" id=\"submitTime\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("submitTime"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"submitPersonTime\" id=\"submitPersonTime\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("submitTime"))) );
      out.write("\">\r\n<input type=\"hidden\" name=\"initActivity\" id=\"initActivity\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("initActivity"))) );
      out.write("\">\r\n<input type=\"hidden\" id=\"workPrarllelCurActId\" name=\"workPrarllelCurActId\" value=\"");
      out.print(curParallelActId);
      out.write("\" />\r\n<input type=\"hidden\" id=\"curActivityIsBranch\" name=\"curActivityIsBranch\" value=\"");
      out.print(request.getAttribute("curActivityIsBranch")==null?"0":request.getAttribute("curActivityIsBranch"));
      out.write("\" />\r\n<input type=\"hidden\" id=\"branchActInfo\" name=\"branchActInfo\" value=\"\">\r\n\r\n<!-- 新增表单域 -->\r\n<input type=\"hidden\" name=\"isSend\" id=\"isSend\" value=\"0\"><!-- 是否发送事件 -->\r\n<input type=\"hidden\" name=\"fromdesktop\" id=\"fromdesktop\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("fromdesktop"))) );
      out.write("\">\r\n<INPUT TYPE=\"hidden\" name=\"operName\" id=\"operName\">\r\n<INPUT TYPE=\"hidden\" name=\"operId\" id=\"operId\" >\r\n<input type=hidden name=mainUserType id=\"mainUserType\" value=100><!--参与人类型-->\r\n<input type=hidden name=mainAllowStandFor id=\"mainAllowStandFor\" value=0>\r\n<input type=hidden name=mainAllowCancel id=\"mainAllowCancel\" value=0>\r\n<input type=hidden name=mainAllowTransition id=\"mainAllowTransition\" value=0>\r\n<input type=hidden name=mainPressType id=\"mainPressType\" value=0>\r\n<input type=hidden name=mainDeadLineTime id=\"mainDeadLineTime\" value=-1>\r\n<input type=hidden name=mainPressMotionTime id=\"mainPressMotionTime\" value=-1>\r\n<input type=hidden name=\"mainNextActivityId\" id=\"mainNextActivityId\">\r\n<input type=hidden name=\"mainNextActivityName\" id=\"mainNextActivityName\">\r\n<input type=hidden name=\"emergence\" id=\"emergence\" value=0><!--缓急程度-->\r\n<input type=hidden name=\"needSendMsg\" id=\"needSendMsg\" ><!--短信-->\r\n<input type=hidden name=\"smsContent\" id=\"smsContent\"><!--短信内容-->\r\n<input type=hidden name=\"dealTips\" id=\"dealTips\" ><!--tips内容-->\r\n");
      out.write("<input type=hidden name=\"processDeadlineDate\" id=\"processDeadlineDate\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("processDeadlineDate"))) );
      out.write("\"><!--流程办理期限-->\r\n");
String[][] sendMsgToInit = new DataSourceBase().queryArrayBySql("SELECT sendMsgToInitiator,opinionmust,opinionLengthSet,opinionLengthMin,opinionLengthMax,sendMsgToDealDone FROM jsf_activity WHERE WF_ACTIVITY_ID="
		+request.getParameter("activity")); 
      out.write("\r\n<input type=\"hidden\" name=\"sendMsgToInitiator\" id=\"sendMsgToInitiator\" value=\"");
      out.print(sendMsgToInit.length>0 ? sendMsgToInit[0][0] : "0" );
      out.write("\"> <!-- 是否给发起人发送提醒 -->\r\n<input type=\"hidden\" name=\"opinionmust\" id=\"opinionmust\" value=\"");
      out.print(sendMsgToInit.length > 0 ? sendMsgToInit[0][1]:"0" );
      out.write("\"> <!-- 意见必填 -->\r\n<input type=\"hidden\" name=\"opinionLengthSet\" id=\"opinionLengthSet\" value=\"");
      out.print(sendMsgToInit.length>0 ? sendMsgToInit[0][2] : "0" );
      out.write("\"> <!-- 意见长度 -->\r\n<input type=\"hidden\" name=\"opinionLengthMin\" id=\"opinionLengthMin\" value=\"");
      out.print(sendMsgToInit.length>0 ? sendMsgToInit[0][3] : "10" );
      out.write("\"> <!-- 意见最短长度 -->\r\n<input type=\"hidden\" name=\"opinionLengthMax\" id=\"opinionLengthMax\" value=\"");
      out.print(sendMsgToInit.length>0 ? sendMsgToInit[0][4] : "1000" );
      out.write("\"> <!-- 意见最长长度 -->\r\n<input type=\"hidden\" name=\"sendMsgToDealDone\" id=\"sendMsgToDealDone\" value=\"");
      out.print(sendMsgToInit.length>0?sendMsgToInit[0][5]:"0" );
      out.write("\"> <!-- 是否给已办人员发送提醒 -->\r\n\r\n\r\n\r\n<input type=\"hidden\" name=\"changeDeadLineTime\" id=\"changeDeadLineTime\" value=\"-1\">\r\n");
      out.write("\r\n<!--阅件参数-->\r\n<input type=hidden name=\"mainNeedPassRound\" id=\"mainNeedPassRound\" value=\"1\">\r\n<input type=hidden name=\"mainPassRoundUserType\" id=\"mainPassRoundUserType\" value=100><!--阅件人类型-->\r\n<input type=hidden name=\"passRoundId\" id=\"passRoundId\" >\r\n<input type=hidden name=\"passRoundName\" id=\"passRoundName\" >\r\n\r\n\r\n<!--子流程临时workID-->\r\n<input type=\"hidden\" name=\"subProcTempWorkId\" id=\"subProcTempWorkId\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("subProcWorkId"))) );
      out.write("\">\r\n\r\n<!--催办-->\r\n<input type=hidden name=pressUserId id=\"pressUserId\">\r\n<input type=hidden name=pressUserName id=\"pressUserName\">\r\n<input type=hidden name=pressTitle id=\"pressTitle\">\r\n<input type=hidden name=pressContent id=\"pressContent\">\r\n<input type=hidden name=pressSMS id=\"pressSMS\">\r\n\r\n<!--反馈-->\r\n<input type=hidden name=feedUserId id=\"feedUserId\">\r\n<input type=hidden name=feedUserName id=\"feedUserName\" >\r\n<input type=hidden name=feedTitle id=\"feedTitle\">\r\n<input type=hidden name=feedContent id=\"feedContent\">\r\n\r\n<!--转办-->\r\n<input type=hidden name=transitionUser id=\"transitionUser\">\r\n<input type=hidden name=transitionUserName id=\"transitionUserName\">\r\n<input type=hidden name=\"tranType\" id=\"tranType\" value=\"");
      out.print(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("tranType"))) );
      out.write("\">\r\n<input type=hidden name=\"tranFromPersonId\" id=\"tranFromPersonId\" value=\"");
      out.print(request.getParameter("tranFromPersonId")==null?"-1" : WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("tranFromPersonId"))) );
      out.write("\">\r\n\r\n<!--收回-->\r\n<input type=hidden name=receiveActivityId id=\"receiveActivityId\">\r\n<input type=hidden name=receiveActivityName id=\"receiveActivityName\">\r\n<input type=hidden name=receiveUserName id=\"receiveUserName\">\r\n\r\n<!--阅件-->\r\n<input type=hidden name=\"passLinkFile\" id=\"passLinkFile\" value=\"");
      out.print(passLinkFile);
      out.write("\">\r\n\r\n<!--当前节点办理方式--默认'1'为多人并行-->\r\n<input type=hidden name=approveMode value=\"1\" id=\"approveMode\">\r\n\r\n<input type=hidden name=saveCheckFn id=\"saveCheckFn\"  value=\"");
      out.print(saveCheckFn);
      out.write("\">\r\n<input type=hidden name=formName id=\"formName\" value=\"");
      out.print(formName);
      out.write("\">\r\n<input type=hidden name=bodyContent id=\"bodyContent\" value=\"\">\r\n\r\n<!--流程按钮-->\r\n");

com.js.oa.jsflow.service.WorkFlowBD workFlowBD = new com.js.oa.jsflow.service.WorkFlowBD();
com.js.oa.jsflow.service.WorkFlowCommonBD workFlowCommonBD = new com.js.oa.jsflow.service.WorkFlowCommonBD();
com.js.oa.jsflow.service.WorkFlowButtonBD wfbd = new com.js.oa.jsflow.service.WorkFlowButtonBD();
String moduleId = workFlowCommonBD.getModuleId(tableId);//模块ID
String operButton = "";

/*if(inWorkStatus==101){
	modiButton = ",Print";	
}*/

//流程中显示按钮
if("none".equals(modiButton)){
	com.js.oa.jsflow.vo.ActivityVO avo = workFlowBD.getProceedActiVO(request.getParameter("table"),request.getParameter("record"),request.getParameter("activity"),"0");
	operButton = avo.getOperButton();
	if(operButton!=null && !"".equals(operButton)){
		operButton = operButton.replaceAll("cmd",",");
	}
	
	modiButton =  "";
	if(inWorkStatus==0){
		//待办

		//发文
		if("1".equals(moduleId) || "2".equals(moduleId) || "3".equals(moduleId) || (Integer.parseInt(moduleId)>=200 && Integer.parseInt(moduleId)<=300)){
			modiButton +=  ",Saveclose";
		}

		//起草正文
		if(operButton.indexOf("Writetext")!=-1){
			modiButton += ",Writetext";
		}

		//引入正文
		if(operButton.indexOf("Imptext")!=-1){
			modiButton += ",Imptext";
		}

		//附件管理
		if(operButton.indexOf("Manageracc")!=-1){
			modiButton += ",Manageracc";
			modiButton = modiButton.replaceAll(",Viewacc","");
		}

		//默认显示发送
		modiButton +=  ",Send";

			//显示【办理完毕】按钮,不为代办且为多人审批时显示办理完毕按钮
			//com.js.oa.jsflow.service.WorkFlowButtonBD wfbd = new com.js.oa.jsflow.service.WorkFlowButtonBD();
			boolean showEnd = wfbd.hasMoreDealFile(workVO);
			if(!"1".equals(request.getParameter("isStandForWork")) && showEnd){
				modiButton = modiButton.replaceAll("Send","End");
			}else if("1".equals(request.getParameter("isStandForWork")) && showEnd && ("3".equals(curTransactType) || "1".equals(curTransactType))){
				//当是多人并行或串行时，是代办人的情况也只显示办理完毕
				modiButton = modiButton.replaceAll("Send","End");
			}

			//自动返回节点显示【办理完毕】按钮
			String[] activityInfo = workFlowBD.getActivityClass(request.getParameter("table"), request.getParameter("record"), ("0".equals(curParallelActId))?request.getParameter("activity"):curParallelActId);
			if("3".equals(activityInfo[0])){
				//自动返回节点
				modiButton = modiButton.replaceAll("Send","EndAutoReturn");		
			}
			
			//转办后自动返回待办文件显示【办理完毕】按钮
			String tranType = request.getParameter("tranType")==null?"0":request.getParameter("tranType");
			if("1".equals(tranType)){
				modiButton = modiButton.replaceAll("Send","EndAutoReturn");		
			}

			//后继为结束节点显示【办理完毕】按钮
			java.util.List activityList = workFlowBD.getAllNextActivity(request.getParameter("table"), request.getParameter("record"), ("0".equals(curParallelActId))?request.getParameter("activity"):curParallelActId);
			if(activityList.size()==1 && ((com.js.oa.jsflow.vo.ActivityVO) activityList.get(0)).getBeginEnd() == 2){
				//后继为结束节点
				modiButton = modiButton.replaceAll("Send","EndOnlyComp");		
			}
		
		//转办
		if(operButton.indexOf("Tran")!=-1){
			//转办(Tran)，转阅(TranRead) 会混淆 故判断较复杂		
			if("Tran".equals(operButton) || ",Tran".equals(operButton)){
				modiButton += ",Tran";
			}else{
				if(operButton.endsWith("Tran") || operButton.startsWith("Tran,")){
					modiButton += ",Tran";
				}else{
					if(operButton.indexOf(",Tran,")!=-1){
						modiButton += ",Tran";
					}
				}
			}
			
		}

		//退回
		if(operButton.indexOf("Back")!=-1){
			modiButton += ",Back";
		}

		//反馈
		if(operButton.indexOf("Feedback")!=-1){
			modiButton += ",Feedback";
		}

		//打印
		if(operButton.indexOf("Print")!=-1){
			modiButton += ",Print";
		}

		//作废
		if(operButton.indexOf("Delete")!=-1){
			modiButton += ",Delete";
		}

		//查看正文
		if(operButton.indexOf("Viewtext")!=-1){
			modiButton += ",Viewtext";
		}

		//查看附件
		if(operButton.indexOf("Viewacc")!=-1){
			modiButton += ",Viewacc";
		}

		//打印阅办单
		if(operButton.indexOf("Printcomm")!=-1){
			modiButton += ",Printcomm";
		}

		//打印正文
		if(operButton.indexOf("Printtext")!=-1){
			modiButton += ",Printtext";
		}

		//附件管理
		if(operButton.indexOf("Manageracc")!=-1){
			//modiButton += ",Manageracc";
			modiButton = modiButton.replaceAll(",Viewacc","");
		}

		//归档
		if(operButton.indexOf("Document")!=-1){
			modiButton += ",Document";
		}

		//正文管理
		if(operButton.indexOf("Textmanager")!=-1){
			modiButton += ",Textmanager";
		}

		//批阅正文
		if(operButton.indexOf("Readtext")!=-1){
			modiButton += ",Readtext";
			modiButton = modiButton.replaceAll(",Viewtext","");
		}

		//生成正式文件
		if(operButton.indexOf("Savefile")!=-1){
			modiButton += ",Savefile";
			modiButton = modiButton.replaceAll(",Viewtext","");
			//modiButton = modiButton.replaceAll(",Readtext","");
		}

		//编号
		if(operButton.indexOf("Code")!=-1){
			modiButton += ",Code";
		}

		//内部分发
		if(operButton.indexOf("Selfsend")!=-1){
			modiButton += ",Selfsend";
		}

		//转本部门
		if(operButton.indexOf("Toselfdept")!=-1){
			modiButton += ",Toselfdept";
		}

		//分发
		if(operButton.indexOf("Sendclose")!=-1){
			modiButton += ",Sendclose";
		}


	} else if(inWorkStatus==1011 || inWorkStatus==101){
		//在办
		avo = workFlowBD.getProceedActiVO(request.getParameter("table"),request.getParameter("record"),request.getParameter("initActivity"),"0");
		operButton = avo.getOperButton();
		if(operButton!=null && !"".equals(operButton)){
			operButton = operButton.replaceAll("cmd",",");
		}

		//撤办(超过一步不显示撤办)
		if(operButton.indexOf("Undo")!=-1 && wfbd.showUndoButton(workVO)){
			modiButton += ",Undo";
		}

		//催办
		if(operButton.indexOf("Wait")!=-1){
			modiButton += ",Wait";
		}

		//反馈
		if(operButton.indexOf("Feedback")!=-1){
			modiButton += ",Feedback";
		}

		//收回
		if(operButton.indexOf("Return")!=-1){
			modiButton += ",Return";
		}

		//打印
		if(operButton.indexOf("Print")!=-1){
			modiButton += ",Print";
		}

		//转阅
		/*if(operButton.indexOf("TranRead")!=-1){
			modiButton += ",TranRead";
		}*/

		//发文
		//if("2".equals(moduleId) || "3".equals(moduleId)){
		if("2".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext,Viewread";
		}

		//收文
		if("3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Viewread";
		}

		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}

		//增加批阅人
		/*if(operButton.indexOf("Addperson")!=-1){
			modiButton += ",Addperson";
		}*/

	} else if(inWorkStatus==1012){
		//办结
		avo = workFlowBD.getProceedActiVO(tableId, recordId, request.getParameter("initActivity"), "0");
		operButton = avo.getOperButton();
		if(operButton!=null && !"".equals(operButton)){
			operButton = operButton.replaceAll("cmd", ",");
		}

		//收回
		/*if(operButton.indexOf("Return")!=-1){
			modiButton += ",Return";
		}*/
		
		//反馈
		if(operButton.indexOf("Feedback") != -1){
			modiButton += ",Feedback";
		}

		//打印
		if(operButton.indexOf("Print") != -1){
			modiButton += ",Print";
		}

		//转阅
		/*if(operButton.indexOf("TranRead")!=-1){
			modiButton += ",TranRead";
		}*/

		//发文
		if("2".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext,Viewread";
		}

		//收文
		if("3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Viewread";
		}

		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}

	} else if(inWorkStatus==2){
		//待阅
		modiButton +=  ",End";

		//反馈
		if(operButton.indexOf("Feedback")!=-1){
			modiButton += ",Feedback";
		}

		//转阅
		if(operButton.indexOf("TranRead")!=-1){
			modiButton += ",TranRead";
		}

		//发文
		if("2".equals(moduleId) || "3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext";
		}
		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}
		
	} else if(inWorkStatus==102){
		//已阅

		//转阅
		/*if(operButton.indexOf("TranRead")!=-1){
			modiButton += ",TranRead";
		}*/

		//发文
		if("2".equals(moduleId) || "3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext";
		}
		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}

	} else if(inWorkStatus==1){
		//我的在办

		//打印
		//if(operButton.indexOf("Print")!=-1){
			modiButton += ",Print";
		//}

		//催办
		//if(operButton.indexOf("Wait")!=-1){
			modiButton += ",Wait";
		//}

		//发文
		if("2".equals(moduleId) || "3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext";
		}

		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}
		//取消
		if(operButton.indexOf("Cancel")!=-1 && "dealwith".equals(WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("from"))))){
			modiButton += ",Cancel";
		}

	} else if(inWorkStatus==100){
		//我的办结

		modiButton += ",Print";

		//发文
		if("2".equals(moduleId) || "3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext";
		}

		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}

	} else if(inWorkStatus==-1){
		//我的退回
		//发文
		if("2".equals(moduleId) || "3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext";
		}
		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}


	} else if(inWorkStatus==-2){
		//我的取消
		//发文
		if("2".equals(moduleId) || "3".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc,Printcomm,Printtext";
		}
		//文件送审签
		if("34".equals(moduleId)){
			modiButton +=  ",Viewtext,Viewacc";
		}

	}

	//通用公文按钮
		//转收文
		if(operButton.indexOf("Toreceive")!=-1){
			modiButton += ",Toreceive";
		}
		//转发文
		if(operButton.indexOf("Tosend")!=-1){
			modiButton += ",Tosend";
		}
		//转文件按送审签
		if(operButton.indexOf("Tocheck")!=-1){
			modiButton += ",Tocheck";
		}

	if("".equals(modiButton) && inWorkStatus==101){
		modiButton = ",Print";	
	}

	//隐藏查看附件按钮
	modiButton = modiButton.replaceAll("Viewacc,","").replaceAll("Viewacc","").replaceAll("Printcomm,","").replaceAll("Printcomm","").replaceAll("Printtext,","").replaceAll("Printtext","");
	modiButton = modiButton.replaceAll("Manageracc,","").replaceAll("Manageracc","").replaceAll("Textmanager,","").replaceAll("Textmanager","");
	modiButton = modiButton.replaceAll("Document,","").replaceAll("Document","").replaceAll("Toselfdept,","").replaceAll("Toselfdept","");

} 


//办理查阅时按钮
operButton = modiButton;

/****************************************************************************************************/
/*在线用户锁处理*/
/****************************************************************************************************/

//在线参数
String onlineEditUser = "";//帐号
String onlineEditUserName = "";//人名
String onlineWorkId = "";//
boolean onlineUserValidate = false;

//多人并行时判断在线用户同时编辑
java.util.Map para = new java.util.HashMap();
java.text.SimpleDateFormat dfTime = new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss");//设置日期格式
para.put("recordId", recordId);
para.put("tableId", tableId);
para.put("processId", request.getParameter("processId"));
para.put("userAccount", session.getAttribute("userAccount").toString());
para.put("userName", session.getAttribute("userName").toString());
para.put("workId", workId);
para.put("pageKey",pageKey);
para.put("onlinebegintime",dfTime.format(new Date()).toString());

//返回在线编辑人员
String[] userArr = wfbd.getWFOnlineUser(para);
onlineEditUser = userArr[0];
onlineEditUserName = userArr[1];
onlineWorkId = userArr[2];
if("".equals(onlineEditUser)){
	onlineUserValidate=false;
}else if(onlineEditUser.equals(session.getAttribute("userAccount").toString())){
	onlineUserValidate=false;
}else{
	onlineUserValidate=true;
}

if(onlineEditUser.equals(session.getAttribute("userAccount").toString()) && onlineWorkId.equals(request.getParameter("work"))){
	onlineUserValidate = false;
	para.put("workId",onlineWorkId);
	wfbd.delWFOnlineUser(para);
	para.put("workId", workId);
}

//上锁
//if(!onlineUserValidate && ("0".equals(request.getParameter("workStatus")) || "1012".equals(request.getParameter("workStatus")) || "1011".equals(request.getParameter("workStatus")))){
if(!onlineUserValidate && inWorkStatus==0){ //只在办理的时候上锁	
	
	
	wfbd.setWFOnlineUser(para);
	onlineEditUser=session.getAttribute("userAccount").toString();//新进员工
	onlineEditUserName=session.getAttribute("userName").toString();//新进员工
	onlineWorkId = request.getParameter("work");
}

//在线编辑提醒
//if(onlineUserValidate && !onlineEditUser.equals(session.getAttribute("userAccount").toString())){//不判断本人
if(onlineUserValidate){//判断本人
		operButton = "";
	
      out.write("\r\n\t<SCRIPT LANGUAGE=\"JavaScript\">\r\n\tvar onlineUser = \"");
      out.print(onlineEditUserName);
      out.write('(');
      out.print(onlineEditUser);
      out.write(')');
      out.print(Resource.getValue(localhi,"workflow","workflow.includeediting"));
      out.write("\";\r\n\tweixinMessageReminder(\"alert\", \"提示：\", onlineUser, \"\");\r\n\t</SCRIPT>\r\n\t");

}	

      out.write("\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\nfunction sendRequest(recordId, tableId, processId, workId)\r\n{\r\n\tvar xmlhttp;\r\n\t//开始初始化XMLHttpRequest对象\r\n\tif(window.XMLHttpRequest) { //Mozilla 浏览器\r\n\t\txmlhttp = new XMLHttpRequest();\r\n\t\tif (xmlhttp.overrideMimeType) {//设置MiME类别\r\n\t\t\txmlhttp.overrideMimeType('text/xml');\r\n\t\t}\r\n\t}\r\n\telse if (window.ActiveXObject) { // IE浏览器\r\n\t\ttry {\r\n\t\t\txmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t} catch (e) {\r\n\t\t\ttry {\r\n\t\t\t\txmlhttp = new ActiveXObject(\"MSXML2.XMLHTTP\");\r\n\t\t\t} catch (e) {\r\n\t\t\t\talert(\"您看到此信息，说明您的浏览器不支持XML解析。\\r\\n请在弹出页面中下载XML解析器并安装！\");\r\n\t\t\t\tJSMainWinOpen('/jsoa/public/select_user/XMLSetup.html','下载说明','toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=10,height=10');\r\n\t\t\t}\r\n\t\t}\r\n\t}\t\r\n\txmlhttp.open(\"POST\",\"/jsoa/jsflow/closeWindow.jsp?recordId=\"+recordId+\"&tableId=\"+tableId+\"&processId=\"+processId+\"&workId=\"+workId,false);\r\n\txmlhttp.send();\r\n}\r\n</SCRIPT>\r\n\r\n");


//用户退出当前页面,在线编辑解锁函数
//if(!onlineUserValidate && (("0".equals(request.getParameter("workStatus")) || "1012".equals(request.getParameter("workStatus")) || "1011".equals(request.getParameter("workStatus"))))){

      out.write("\r\n\t<SCRIPT FOR=window EVENT=onbeforeunload>\r\n\tsendRequest(\"");
      out.print(recordId);
      out.write('"');
      out.write(',');
      out.write('"');
      out.print(tableId);
      out.write('"');
      out.write(',');
      out.write('"');
      out.print(processId);
      out.write('"');
      out.write(',');
      out.write('"');
      out.print(workId);
      out.write("\");\r\n\t</SCRIPT>\r\n");

//}

/****************************************************************************************************/

      out.write("\r\n\r\n\r\n<!--记录待办首次查看时间-->\r\n");

if(inWorkStatus == 0 || inWorkStatus==2){
	com.js.oa.jsflow.vo.WorkLogVO workLogVO = new com.js.oa.jsflow.vo.WorkLogVO();
		workLogVO.setSendUserId(session.getAttribute("userId").toString());
		workLogVO.setSendUserName(session.getAttribute("userName").toString());
		workLogVO.setSendAction((request.getParameter("activityName")==null || "".equals(request.getParameter("activityName")) || "null".equals(request.getParameter("activityName"))?"" : WorkflowForWeiXinUtil.decordStr(WorkflowForWeiXinUtil.decordStr(request.getParameter("activityName"))))+"签收");
		workLogVO.setReceiveUserName(" ");
		workLogVO.setProcessId(request.getParameter("processId"));
		workLogVO.setTableId(request.getParameter("table"));
		workLogVO.setRecordId(request.getParameter("record"));
		workLogVO.setDomainId(session.getAttribute("domainId").toString());
	new com.js.oa.jsflow.service.WorkFlowButtonBD().setWorkViewedDate(workId,workLogVO,String.valueOf((Integer.parseInt(request.getParameter("stepCount")==null || "null".equals(request.getParameter("stepCount"))?"0":request.getParameter("stepCount")) - 1)));
}

      out.write("\r\n<!--待办首次查看时间-->\r\n\r\n");

if(request.getParameter("processId") != null && !"null".equals(request.getParameter("processId"))){
//表示是走了流程的

boolean handSignInUse1 = false;//是否使用了手写签名
java.util.Map include_sysMap1 = com.js.system.util.SysSetupReader.getInstance().getSysSetupMap(session.getAttribute("domainId").toString());
if(include_sysMap1 != null && include_sysMap1.get("使用手写意见") != null && "1".equals(include_sysMap1.get("使用手写意见").toString())){
    handSignInUse1 = true;
}

//int inWorkType = ("null".equals(request.getParameter("workType")) || request.getParameter("workType")==null)?-1:Integer.parseInt(request.getParameter("workType"));//流程类型 0随机流程,1业务流程
/*com.js.oa.jsflow.service.WorkFlowBD inc_wfbd = new com.js.oa.jsflow.service.WorkFlowBD();
java.util.ArrayList alist = new java.util.ArrayList();
if(inWorkStatus == 0){
    //将工作任务的可撤销(workAllowCancle)置为0
    alist.add("update jsdb.JSF_WORK set workAllowCancel = 0 where worktable_id = " + request.getParameter("table") + " and workrecord_id = " + request.getParameter("record") + " and workStepCount = " + (Integer.parseInt("null".equals(request.getParameter("stepCount"))?"0":request.getParameter("stepCount")) - 1) );
}
inc_wfbd.updateTable(alist);
*/

      out.write("\r\n\r\n<input type=\"hidden\" name=\"moduleId\" id=\"moduleId\" value=\"");
      out.print(moduleId);
      out.write("\">\r\n<input type=\"hidden\" name=\"curTransactType\" id=\"curTransactType\" value=\"");
      out.print(curTransactType);
      out.write("\">\r\n<table align=\"center\" width=\"100%\" border=\"0\" id=\"inc_tb\">\r\n\r\n");

    if(inWorkStatus == 0 || inWorkStatus == 2){
    //待批或待阅文件
  
        //业务流程
        if(inWorkStatus == 0){
            //待批文件
            com.js.oa.jsflow.service.WorkFlowBD include_workFlowBD = new com.js.oa.jsflow.service.WorkFlowBD();
            String[] include_actiClass = null;
            if("".equals(subProcWorkId)){
            include_actiClass = include_workFlowBD.getActivityClass(request.getParameter("table"), request.getParameter("record"), ("0".equals(curParallelActId))?request.getParameter("activity"):curParallelActId);
            }else{
            include_actiClass = include_workFlowBD.getActivityClass(request.getParameter("table"), request.getParameter("record"), ("0".equals(curParallelActId))?request.getParameter("activity"):curParallelActId,subProcWorkId);
            }
            
            if(include_actiClass[0].equals("0")){
                //子过程节点
            
      out.write("\r\n                <tr style=\"display:");
      out.print("1".equals(request.getParameter("transend"))?"none":"");
      out.write("\">\r\n                    <td><span style=\"cursor:pointer\" onclick=\"createSubProcess('");
      out.print(subProcHref);
      out.write("&processId=");
      out.print(include_actiClass[1]);
      out.write("&tableId=");
      out.print(include_actiClass[3]);
      out.write("&processName=");
      out.print(include_actiClass[4]);
      out.write("&processType=");
      out.print(include_actiClass[5]);
      out.write("&remindField=");
      out.print(include_actiClass[6]);
      out.write("&subProc=1&isSubProcWork=1&pareProcActiId=");
      out.print(request.getParameter("activity"));
      out.write("&pareStepCount=");
      out.print(request.getParameter("stepCount"));
      out.write("&pareTableId=");
      out.print(request.getParameter("table"));
      out.write("&pareRecordId=");
      out.print(request.getParameter("record"));
      out.write("&subProcess=1','','menubar=0,scrollbars=yes,locations=0,width=400,height=200,resizable=yes');\"><a href=\"#\">启动“");
      out.print(include_actiClass[4]);
      out.write("”(子流程)</a></span></td>\r\n                </tr>\r\n                <input type=\"hidden\" name=\"subProcType\" id=\"subProcType\" value=\"");
      out.print(include_actiClass[2]);
      out.write("\">\r\n                <input type=\"hidden\" name=\"subProcName\" id=\"subProcName\" value=\"");
      out.print(include_actiClass[4]);
      out.write("\">\r\n                <input type=\"hidden\" name=\"subProcId\" id=\"subProcId\" value=\"");
      out.print(include_actiClass[1]);
      out.write("\">\r\n                <input type=\"hidden\" name=\"processId\" id=\"processId\" value=\"");
      out.print(include_actiClass[1]);
      out.write("\">\r\n                <input type=\"hidden\" name=\"subProcTableId\" id=\"subProcTableId\" value=\"");
      out.print(include_actiClass[3]);
      out.write("\">\r\n                <input type=\"hidden\" name=\"subProcessType\" id=\"subProcessType\" value=\"");
      out.print(include_actiClass[5]);
      out.write("\">\r\n                <input type=\"hidden\" name=\"subRemindField\" id=\"subRemindField\" value=\"");
      out.print(include_actiClass[6]);
      out.write("\">\r\n                <input type=\"hidden\" name=\"subProcWorkId\" id=\"subProcWorkId\" value=\"");
      out.print(subProcWorkId );
      out.write("\">\r\n                <input type=\"hidden\" name=\"subWorkstatus\" id=\"subWorkstatus\" value=\"");
      out.print(include_actiClass[7]);
      out.write("\">\r\n            ");

            }
            
      out.write("\r\n            <input type=\"hidden\" name=\"activityClass\" id=\"activityClass\" value=\"");
      out.print(include_actiClass[0]);
      out.write("\">\r\n            \r\n           \r\n        ");

        }
    
}
      out.write("\r\n\t<!-- \r\n        <tr>\r\n            <td height=\"40\">&nbsp;</td>\r\n        </tr>\r\n       -->  \r\n    </table>\r\n    <input type=\"hidden\" name=\"include_comment\" id=\"include_comment\">\r\n    ");

    if(inWorkStatus == 0){
        //待批文件,取批示意见对应字段
        if(curCommField != null && !curCommField.equals("")){
        
      out.write("\r\n            <input type=\"hidden\" name=\"include_commField\" id=\"include_commField\" value=\"");
      out.print(curCommField);
      out.write("\">\r\n        ");

        }
    }else{
        //待阅文件,取阅示意见对应字段
        if(curPassRoundCommField != null && !curPassRoundCommField.equals("")){
            
      out.write("\r\n            <input type=\"hidden\" name=\"include_commField\" id=\"include_commField\" value=\"");
      out.print(curPassRoundCommField);
      out.write("\">\r\n        ");

        }
    }

      out.write("\r\n\r\n<!-- 阅件提交的iframe，避免关闭页面 -->\r\n<iframe id=\"tempIframe\" name=\"tempIframe\" style=\"display:none\"></iframe>\r\n\r\n<script language=\"javascript\">\r\nvar include_td1HTML = \"\";\r\nif(document.all.include_td1){\r\n    include_td1HTML = document.all.include_td1.innerHTML;\r\n}\r\n\r\n//阅件时保存意见\r\nfunction include_save(){\r\n    if(!include_saveSignature()){\r\n        return;\r\n    }\r\n    var backto = document.getElementById(\"backto\").value;\r\n    include_setComment();\r\n    //document.all.");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n    document.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=dealpassround&backto=\" + backto;\r\n    document.all.");
      out.print(formName);
      out.write(".submit();\r\n    //include_close();\r\n}\r\n\r\n//取消显示退回信息\r\nfunction include_backCacnel(){\r\n    document.all.include_td1.innerHTML = include_td1HTML;\r\n}\r\n\r\n//按钮提交退回\r\nfunction include_backSubmit(include_backActivity,backto){\r\n    if(!include_saveSignature()){       \r\n        return;\r\n    }\r\n    include_setComment();\r\n    var submitTime=document.getElementById(\"submitTime\").value;\r\n\tvar tmpPerson = \"\", backToUserName = \"\";\r\n    var tmp = include_backActivity;\r\n    var formAction = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=back&submitTime=\"+submitTime+\"&backto=\"+backto;\r\n    if(tmp == 0){\r\n        //退回发起人\r\n        backToUserName = document.all.submitPerson.value;\r\n        formAction += \"&type=0&backToUserName=\" + encodeURI(encodeURI(backToUserName)) + \"&backToActivityName=\" + encodeURI(encodeURI(\"发起人\"));\r\n\t\ttmpPerson = \"发起人\";\r\n    }else{\r\n        //退回到其他步骤\r\n        tmpArr = tmp.split(\",\");\r\n        backToUserName =  tmpArr[4];\r\n        formAction += \"&type=1&backToUserId=\" + tmpArr[3] +\"&backToUserName=\" +encodeURI(encodeURI(backToUserName)) + \"&backToActivityId=\" + tmpArr[0] + \"&backToStep=\" + tmpArr[1] + \"&backToActivityName=\" + encodeURI(encodeURI(tmpArr[2]));\r\n");
      out.write("\t\ttmpPerson = tmpArr[2];\r\n    }\r\n    ");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n    document.all.");
      out.print(formName);
      out.write(".action = formAction;\r\n    document.all.");
      out.print(formName);
      out.write(".submit();\r\n    weixinMessageReminder(\"alert\", \"提示：\", \"已退回到\" + tmpPerson + \"[\" + decodeURI(backToUserName) + \"]\", \"include_close();\");\r\n}\r\n\r\n//按钮催办\r\nfunction include_waitSubmit(){\r\n    //发邮件\r\n\t");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n\t");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=press\";\r\n\t");
      out.print(formName);
      out.write(".submit();\r\n\tweixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccesspress"));
      out.write("\", \"include_close();\");\r\n\t//document.getElementById('commonPopDiv').style.display = 'none';\r\n\t\r\n}\r\n\r\n//按钮反馈\r\nfunction include_feedbackSubmit(){\r\n    //发邮件\r\n\t");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n\t");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=feedback\";\r\n\t");
      out.print(formName);
      out.write(".submit();\r\n\tweixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessfeedback"));
      out.write("\", \"\");\r\n\tdocument.getElementById('formBody').style.display = 'block';\r\n\tdocument.getElementById('commonPopDiv').style.display = 'none';\r\n}\r\n\r\n//按钮撤办\r\nfunction include_undoSubmit(){\r\n\tweixinMessageReminder(\"confirm\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmundo"));
      out.write("\", \"include_undoSubmit2();\");\r\n}\r\nfunction include_undoSubmit2(){\r\n\tvar backto = document.getElementById(\"backto\").value;\r\n\tdocument.all.");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n    document.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=undo&backto=\" + backto;\r\n    document.all.");
      out.print(formName);
      out.write(".submit();\r\n    //include_close();\r\n}\r\n\r\n//按钮收回\r\nfunction include_returnSubmit(){\r\n\tdocument.all.");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n    document.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=return\";\r\n    document.all.");
      out.print(formName);
      out.write(".submit();\r\n    weixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includesuccessreceive"));
      out.write("\"+document.all.receiveActivityName.value+\"！\", \"include_close();\");\r\n}\r\n\r\n//按钮作废\r\nfunction include_deleteSubmit(){\r\n\tweixinMessageReminder(\"confirm\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmdelete"));
      out.write("\", \"include_deleteSubmit2();\");\r\n}\r\nfunction include_deleteSubmit2(){\r\n\tdocument.all.");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n    document.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=delete\";\r\n    document.all.");
      out.print(formName);
      out.write(".submit();\r\n    //include_close();\r\n}\r\n\r\n//办理完毕与阅件保存--多人办理--待阅办理\r\nfunction include_endAndSaveSubmit(){\r\n\tif('");
      out.print(inWorkStatus);
      out.write("'=='2'){\r\n\t\t//阅件\r\n\t\tweixinMessageReminder(\"confirm\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmsaveread"));
      out.write("\", \"include_save();\");\r\n\t} else{\r\n\t\t//办理完毕\r\n\t\tweixinMessageReminder('confirm', '提示：', '");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmturntodeal"));
      out.write("', 'include_endSubmit();')\r\n\t\t\r\n\t}\r\n}\r\n\r\n//办理完毕--多人办理\r\nfunction include_endSubmit(){\r\n\tweixinMessageReminder(\"confirm\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmturntodeal"));
      out.write("\", \"include_endSubmit2();\");\r\n}\r\nfunction include_endSubmit2(){\r\n\tif(include_checkUser()){\r\n        if(");
      out.print(saveCheckFn);
      out.write("){\r\n\t\t\tif(!include_saveSignature()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tinclude_setComment();\r\n\t\t\tvar backto = document.getElementById(\"backto\").value;\r\n\t\t\t//document.all.");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n\t\t\tdocument.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=end&backto=\" + backto;\r\n\t\t\tdocument.all.");
      out.print(formName);
      out.write(".submit();\r\n\t\t\t//include_close();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//办理完毕-自动返回\r\nfunction include_endAutoReturn(){\r\n\tvar hangup=");
      out.print(hangup);
      out.write(";\r\n    if(hangup==1){\r\n    \tweixinMessageReminder(\"alert\", \"提示：\", \"该流程已挂起！\", \"\");\r\n    }else{\r\n    \tweixinMessageReminder(\"confirm\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmturntodeal"));
      out.write("\", \"include_sub2();\");\r\n    }\r\n}\r\n\r\n//办理完毕--后继唯一结束\r\nfunction include_endOnlyComp(){\r\n    weixinMessageReminder('confirm', '提示：', '");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmcompleteprocess"));
      out.write("', 'include_comp2();')\r\n}\r\n\r\n//内部分发\r\nfunction include_selfsendSubmit(type){\r\n\tvar _mainPassRoundUserType=document.all.mainPassRoundUserType.value;\r\n\tif(_mainPassRoundUserType==\"10\"){\r\n\t\t//组织领导方式按照用户处理(已经选择了领导)\r\n\t\t_mainPassRoundUserType=\"100\";\r\n\t}\r\n    switch (parseInt(_mainPassRoundUserType)) {\r\n\t\tcase 10:\r\n\t\t\t//组织领导\r\n\t\t\tvar orgId = \"\";\r\n\t\t\tvar idstr = document.all.operId.value;\r\n\t\t\tif(idstr != \"\"){\r\n\t\t\t\tfor( var i = 0; i < idstr.length; i ++ ){\r\n\t\t\t\t\tflagCode = idstr.charAt(i);\r\n\t\t\t\t\tnextPos = idstr.indexOf(flagCode,i + 1);\r\n\t\t\t\t\tstr = idstr.substring(i+1,nextPos);\r\n\t\t\t\t\tif(flagCode == \"*\"){\r\n\t\t\t\t\t\torgId = orgId + str + \",\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti = nextPos;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\torgId = orgId.substring(0,orgId.length-1);\r\n\t\t\tdocument.all.operId.value = orgId;\r\n\t\t\tworkflowSync.getLeaderByOrgId(orgId, include_checkUserStatusSelfsend(type));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tdocument.all.");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n\t\t\tdocument.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=passround&type=\"+type;\r\n\t\t\tdocument.all.");
      out.print(formName);
      out.write(".submit();\r\n\t\t\tvar message = \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturn"));
      out.write("\"+(document.all.operName.value==''?\"\":(\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeto"));
      out.write("\"+document.all.operName.value))+(document.all.mainPassRoundUserType.value=='10'?\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeleader"));
      out.write("\":\"\")+\"！\"\r\n\t\t\tweixinMessageReminder(\"alert\", \"提示：\", message, \"\");\r\n\t\t\tdocument.getElementById('formBody').style.display = 'block';\r\n\t\t\tdocument.getElementById('commonPopDiv').style.display = 'none';\r\n    }\r\n}\r\n\r\n//内部分发检测用户有效\r\nfunction include_checkUserStatusSelfsend(type,s) {\r\n\t if(s==\"noleader\"){\r\n\t\t//组织领导不存在\r\n\t\talert(\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includenoleader"));
      out.write("\");\r\n\t\treturn;\r\n\t}\r\n    document.all.");
      out.print(formName);
      out.write(".target = \"tempIframe\";\r\n    document.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonAction.do?flag=passround&type=\"+type;\r\n    document.all.");
      out.print(formName);
      out.write(".submit();\r\n\talert(\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturn"));
      out.write("\"+(document.all.operName.value==''?\"\":(\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeto"));
      out.write("\"+document.all.operName.value))+(document.all.mainPassRoundUserType.value=='10'?\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeleader"));
      out.write("\":\"\")+\"！\");\r\n\r\n}\r\n\r\n//转办\r\nfunction include_transTo(actiontype){\r\n    if(!include_saveSignature()){\r\n        return;\r\n    }\r\n    if(");
      out.print(saveCheckFn);
      out.write("){//表单校验函数\r\n        if(document.all.transitionUserName.value == \"\" && actiontype!='tranAutoReturn'){\r\n            weixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeseltranuser"));
      out.write("\", \"\");\r\n        }else{\r\n\t\t\tinclude_setComment();\r\n            document.all.inc_tb.style.display=\"none\";\r\n            document.all.");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n            document.all.");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowCommonForWeiXinAction.do?flag=trans&actiontype=\"+actiontype+\"&transend=");
      out.print(request.getParameter("transend"));
      out.write("\";\r\n            document.all.");
      out.print(formName);
      out.write(".submit();\r\n            weixinMessageReminder(\"alert\", \"提示：\", \"已提交给\"+document.all.transitionUserName.value+\"！\", \"include_close();\");\r\n        }\r\n    }\r\n}\r\n\r\n//用户决定流程走向时的“提交”事件\r\nfunction include_sub(){\r\n\tif(document.all.mainUserType && (document.all.mainUserType.value==\"0\" || document.all.mainUserType.value==\"7\")){\r\n\t\tif(!document.all.mainCandidateUser){\r\n\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includenotsetupleader"));
      out.write("\", \"\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n    var i = 0;\r\n    if(document.all.nextActivity){\r\n        if(document.all.nextActivity.length){\r\n            for(var j = 0; j < document.all.nextActivity.length; j ++){\r\n                if(document.all.nextActivity[j].checked){\r\n                    i = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }else{\r\n            if(document.all.nextActivity.checked){\r\n                i = 1;\r\n            }\r\n        }\r\n    }\r\n    if(include_checkUser()){\r\n        if(");
      out.print(saveCheckFn);
      out.write("){\r\n            if(!include_saveSignature()){\r\n                return;\r\n            }\r\n            include_setComment();\r\n\r\n\t\t\t//发送标记\r\n\t\t\tdocument.all.isSend.value = 1;\r\n\r\n\t\t\tvar _userType=document.all.mainUserType.value;\r\n        \tif(_userType==\"10\"){\r\n        \t\t//选择方式是部门领导的，已经将领导empId,empName 取出，按照用户处理\r\n        \t\t_userType=\"100\";\r\n        \t}\r\n        \t\r\n            switch (parseInt(_userType)) {\r\n\t\t\t\tcase 100:\r\n                    //新节点\r\n                    var empId = \"\";\r\n                    var orgId = \"\";\r\n                    var groupId = \"\";\r\n                    var idstr = document.all.operId.value;\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i,nextPos+1);\r\n                            if(flagCode == \"$\"){\r\n                                empId = empId + str;\r\n                            }else if(flagCode == \"*\"){\r\n");
      out.write("                                orgId = orgId + str;\r\n                            }else{\r\n                                groupId = groupId + str;\r\n                            }\r\n                            i = nextPos;\r\n                        }\r\n                    }\r\n                    workflowSync.getUserStatusByEmpOrgGrp(empId, orgId, groupId, include_checkUserStatus);\r\n                    break;\r\n\r\n\t\t\t\tcase 10:\r\n                    //组织领导\r\n                    var orgId = \"\";\r\n                    var idstr = document.all.operId.value;\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i+1,nextPos);\r\n                            if(flagCode == \"*\"){\r\n                                orgId = orgId + str + \",\";\r\n                            }\r\n                            i = nextPos;\r\n");
      out.write("                        }\r\n                    }\r\n\t\t\t\t\torgId = orgId.substring(0,orgId.length-1);\r\n\t\t\t\t\tdocument.all.operId.value = orgId;\r\n                    workflowSync.getLeaderByOrgId(orgId, include_checkUserStatus);\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n            ");
      out.write("\r\n        }\r\n    }\r\n}\r\nfunction include_branch_sub(){\r\n\tif(");
      out.print(saveCheckFn);
      out.write("){\r\n\t\tif(confirm(\"您确定提交处理吗？\")){\r\n            document.all.inc_tb.style.display=\"none\";\r\n            include_setComment();\r\n            ");
      out.print(formName);
      out.write(".target = \"_self\";\r\n            ");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonAction.do?flag=branchsend\";\t\t\t\r\n            ");
      out.print(formName);
      out.write(".submit();\r\n        }\r\n\t}\r\n}\r\n//流程决定走向时的“提交”事件\r\nfunction include_sub2(){\r\n    if(include_checkUser()){\r\n        if(");
      out.print(saveCheckFn);
      out.write("){\r\n            if(!include_saveSignature()){\r\n                return;\r\n            }\r\n            include_setComment();\r\n            switch (parseInt(document.all.mainUserType.value)) {\r\n                case 0:\r\n                    //流程发起人的上级领导\r\n                    var userIds = \"\";\r\n                    if(document.all.mainCandidateUser.length){\r\n                        for(i = 0; i < document.all.mainCandidateUser.length; i ++ ){\r\n                            if(document.all.mainCandidateUser[i].checked){\r\n                                userIds += document.all.mainCandidateUser[i].value + \",\";\r\n                            }\r\n                        }\r\n                    }else{\r\n                        userIds = document.all.mainCandidateUser.value;\r\n                    }\r\n                    workflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n                    break;\r\n                case 1:\r\n                    //由上一节点参与者从所有用户中选择\r\n                    var empId = \"\";\r\n                    var orgId = \"\";\r\n");
      out.write("                    var groupId = \"\";\r\n                    var idstr = document.all.mainOperProcUser.value;\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i,nextPos+1);\r\n                            if(flagCode == \"$\"){\r\n                                empId = empId + str;\r\n                            }else if(flagCode == \"*\"){\r\n                                orgId = orgId + str;\r\n                            }else{\r\n                                groupId = groupId + str;\r\n                            }\r\n                            i = nextPos;\r\n                        }\r\n                    }\r\n                    workflowSync.getUserStatusByEmpOrgGrp(empId, orgId, groupId, include_checkUserStatus);\r\n                    break;\r\n                case 2:\r\n                    //从候选人员中指定candidateUser\r\n");
      out.write("                    var userIds = \"\";\r\n                    if(document.all.mainCandidateUser.length){\r\n                        for(i = 0; i < document.all.mainCandidateUser.length; i ++ ){\r\n                            if(document.all.mainCandidateUser[i].checked){\r\n                                userIds += document.all.mainCandidateUser[i].value + \",\";\r\n                            }\r\n                        }\r\n                    }else{\r\n                        userIds = document.all.mainCandidateUser.value;\r\n                    }\r\n                    workflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n                    break;\r\n                case 3:\r\n                    //指定全部办理人\r\n                    var userIds = \"\";\r\n                    if(document.all.mainAllUser.length){\r\n                        for(i = 0; i < document.all.mainAllUser.length; i ++ ){\r\n                            userIds += document.all.mainAllUser[i].value + \",\";\r\n                        }\r\n                    }else{\r\n");
      out.write("                        userIds = document.all.mainAllUser.value;\r\n                    }\r\n                    workflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n                    break;\r\n                case 5:\r\n                    //流程发起人\r\n                    workflowSync.getUserStatus(document.all.submitPersonId.value, include_checkUserStatus);\r\n                    break;\r\n                case 6:\r\n                    //角色用户\r\n                    workflowSync.getUserStatusByRole(document.all.mainPartRole.value, document.all.submitPersonId.value, include_checkUserStatus);\r\n                    break;\r\n\t\t\t\tcase 100:\r\n\t\t\t\t\t//默认:自动返回节点\r\n\t\t\t\t\tinclude_checkUserStatus(\"endAutoReturn\");\r\n                default:\r\n                    break;\r\n            }\r\n            ");
      out.write("\r\n        }\r\n    }\r\n}\r\n\r\nfunction include_checkUserStatus(s) {\r\n\t if(s==\"noleader\"){\r\n\t\t//组织领导不存在\r\n\t\tweixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includenoleader"));
      out.write("\", \"\");\r\n\t\treturn;\r\n\t}\r\n    if(s == \"\"){\r\n        document.all.inc_tb.style.display=\"none\";\r\n        ");
      out.write("\r\n        var frm=document.getElementsByName(\"");
      out.print(formName);
      out.write("\")[0];\r\n\t\tfrm.target = \"myIframe\";\r\n\t\tfrm.action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=update\";\r\n\t\tfrm.submit();\r\n\t\tvar alertStr = \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
      out.write("\"+document.all.operName.value+(document.all.mainUserType.value=='10'?\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeleader"));
      out.write("\":\"\")+\"[\"+document.all.mainNextActivityName.value+\"]\";\r\n\t\tweixinMessageReminder(\"alert\", \"提示：\", alertStr, \"alertAndBack();\");\r\n    } else if(s == \"endAutoReturn\"){\r\n\t\t//自动返回\r\n        document.all.inc_tb.style.display=\"none\";\r\n        var frm = document.getElementsByName(\"");
      out.print(formName);
      out.write("\")[0];\r\n        frm.target = \"include_iframe\";\r\n        frm.action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=update\";\r\n        weixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturntosign"));
      out.write("\", \"include_close();\");\r\n        frm.submit();\r\n    } else {\r\n   \t    var frm=document.getElementsByName(\"");
      out.print(formName);
      out.write("\")[0];\r\n        if(confirm(\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includenextuser"));
      out.write("：\" + s + \",");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmturntodeal"));
      out.write("\")){\r\n            document.all.inc_tb.style.display=\"none\";\r\n            frm.target = \"include_iframe\";\r\n            frm.action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=update\";\r\n            var alertStr = \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
      out.write("\"+document.all.operName.value+(document.all.mainUserType.value=='10'?\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeleader"));
      out.write("\":\"\")+\"[\"+document.all.mainNextActivityName.value+\"]\";\r\n\t\t\tweixinMessageReminder(\"alert\", \"提示：\", alertStr, \"alertAndBack();\");\r\n            frm.submit();\r\n        }\r\n    }\r\n}\r\nfunction alertAndBack(str){\r\n\tinclude_close();\r\n\t\r\n}\r\n//检验办理用户\r\nfunction include_checkUser(){\r\n\tif(document.all.mainUserType && (document.all.mainUserType.value==\"0\" || document.all.mainUserType.value==\"7\")){\r\n\t\tif(!document.all.mainCandidateUser){\r\n\t\t\tparent.weixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includenotsetupleader"));
      out.write("\", \"\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n    if(document.all.mainCandidateUser){\r\n        var i = 0;\r\n        if(document.all.mainCandidateUser.length){\r\n            for(var j = 0; j < document.all.mainCandidateUser.length; j ++){\r\n                if(document.all.mainCandidateUser[j].checked){\r\n                    i = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }else{\r\n            if(document.all.mainCandidateUser.checked){\r\n                i = 1;\r\n            }\r\n        }\r\n        if(i == 0){\r\n        \tparent.weixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
      out.write("\", \"\");\r\n            return false;\r\n        }\r\n    }\r\n\r\n    if(document.all.mainOperProcUserName){\r\n        if(document.all.mainOperProcUserName.value == \"\"){\r\n        \tparent.weixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
      out.write("\", \"\");\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\n//结束流程\r\nfunction include_comp(){\r\n\tweixinMessageReminder(\"confirm\", \"提示：\", \"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmcompleteprocess"));
      out.write("\", \"include_comp2();\");\r\n}\r\nfunction include_comp2(){\r\n\tvar backto = document.getElementById(\"backto\").value;\r\n\t\tif(");
      out.print(saveCheckFn);
      out.write("){\r\n\t\t\tif(!include_saveSignature()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tinclude_setComment();\r\n\t\t\tdocument.all.inc_tb.style.display=\"none\";\r\n\t\t\t");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=complete&backto=\" + backto;\r\n\t\t\tif(document.all.moduleId.value!=\"1\"){\r\n\t\t\t\ttry{\r\n\t\t\t\t\t// 隐藏上面的菜单栏\r\n\t\t\t\t\tdocument.getElementById(\"commandBar\").style.display = \"none\";\r\n\t\t\t\t\tdocument.getElementById(\"panleAll\").style.display = \"none\";\r\n\t\t\t\t\t// 将body中的内容提交到后台，以备归档处理\r\n\t\t\t\t\tdocument.all.bodyContent.value=document.body.innerHTML;\r\n\t\t\t\t}catch(e){\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t");

			// 如果需要归档
			if(com.js.oa.jsflow.util.WorkflowToArchive.isNeedArchive(processId)){
				
      out.write("\r\n\t\t\t\ttry{\r\n\t\t\t\t\t// 隐藏上面的菜单栏\r\n\t\t\t\t\tdocument.getElementById(\"commandBar\").style.display = \"none\";\r\n\t\t\t\t\tdocument.getElementById(\"panleAll\").style.display = \"none\";\r\n\t\t\t\t\t// 将body中的内容提交到后台，以备归档处理\r\n\t\t\t\t\tdocument.all.bodyContent.value=document.body.innerHTML;\r\n\t\t\t\t}catch(e){ }\r\n\t          \t");

			}
			
      out.write("\r\n\t\t}\r\n\t            \r\n\t\t");
      out.print(formName);
      out.write(".submit();\r\n\t\t// pullXMenuDisabledAllMenu();\r\n\t\t//");
//=formName
      out.write(".action = \"/jsoa/WorkflowCommonAction.do?flag=complete&curActivityId=\" + //document.getElementById(\"curActivityId\").value + \"&title=\" + document.getElementById(\"title\").value;\r\n\t\t//");
//=formName
      out.write(".submit();\r\n\t}\r\n}\r\n\r\n\r\n//保存手写意见 微信不判断手写意见\r\nfunction include_saveSignature(){\r\n   return true;\r\n}\r\n\r\n//批示意见\r\nfunction include_setComment(){\r\n    ");

    if(inWorkStatus == 0){
		//批示意见对应字段
        if(curCommField != null && !curCommField.equals("") && !curCommField.trim().equals("-1") && !"null".equals(curCommField)){
            if(!curCommField.startsWith("$")){
			//一个批示意见字段
        
      out.write("\r\n\t\t\tif(document.all.");
      out.print(curCommField);
      out.write("){\r\n\t\t\t\tvar commentSignType = document.all.commentSignType;\r\n\t\t\t\tif(commentSignType && document.all.");
      out.print(curCommField);
      out.write(".length){\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.");
      out.print(curCommField);
      out.write("[commentSignType.value].value;\r\n\t\t\t\t} else{\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.");
      out.print(curCommField);
      out.write(".value;\r\n                }\r\n\t\t\t}\r\n        ");

            }else{
			//多个批示意见字段
                String[] curCommFieldArr = curCommField.substring(1, curCommField.length() - 1).split("\\$\\$");
                
      out.write("\r\n                var j = 0;\r\n                commentValue = \"\";\r\n                commFieldValue = \"\";\r\n                ");

                for(int i = 0; i < curCommFieldArr.length; i ++){
      out.write("\r\n                    if(document.all.");
      out.print(curCommFieldArr[i]);
      out.write(" && document.all.");
      out.print(curCommFieldArr[i]);
      out.write(".value != \"\"){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar commentSignType = document.all.commentSignType[");
      out.print(i);
      out.write("].value;\r\n\r\n                        commentValue += document.all.");
      out.print(curCommFieldArr[i]);
      out.write("[commentSignType].value + \":::\";\r\n                        commFieldValue += \"$");
      out.print(curCommFieldArr[i]);
      out.write("$\";\r\n                        j ++;\r\n                    }\r\n                ");

                }
      out.write("\r\n                if(j == 0){\r\n                    document.all.include_comment.value = document.all.");
      out.print(curCommFieldArr[0]);
      out.write("[0].value;\r\n                    document.all.include_commField.value = \"");
      out.print(curCommFieldArr[0]);
      out.write("\";\r\n                }else if(j == 1){\r\n                    commentValue = commentValue.substring(3, commentValue.length-3);\r\n                    document.all.include_comment.value = commentValue.substring(commentValue.indexOf(\";;;\") + 3, commentValue.length);\r\n                    document.all.include_commField.value = commFieldValue.substring(1, commFieldValue.length-1);\r\n                }else{\r\n                    document.all.include_comment.value = commentValue;\r\n                    document.all.include_commField.value = commFieldValue;\r\n                }\r\n                ");

            }
    	}else{
		//自动增长批示意见
        
      out.write("\r\n            if(document.all.comment){\r\n\t\t\t\tvar commentSignType = document.all.commentSignType.value;\r\n\t\t\t\tif(document.all.comment.length){\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.comment[commentSignType].value;\r\n\t\t\t\t} else{\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.comment.value;\r\n\t\t\t\t}\r\n            }\r\n        ");

        }
    }
    if(inWorkStatus == 2){
        if(curPassRoundCommField != null && !curPassRoundCommField.equals("") && !curPassRoundCommField.trim().equals("-1")){
            if(!curPassRoundCommField.startsWith("$")){
        
      out.write("\r\n\t\t\tif(document.all.");
      out.print(curPassRoundCommField);
      out.write("){\r\n\t\t\t\tvar commentSignType = document.all.commentSignType;\r\n\t\t\t\tif(commentSignType && document.all.");
      out.print(curPassRoundCommField);
      out.write(".length){\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.");
      out.print(curPassRoundCommField);
      out.write("[commentSignType.value].value;\r\n\t\t\t\t} else{\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.");
      out.print(curPassRoundCommField);
      out.write(".value;\r\n                }\r\n\t\t\t}\r\n        ");

            }else{
                String[] curCommFieldArr = curPassRoundCommField.substring(1, curPassRoundCommField.length() - 1).split("\\$\\$");
                
      out.write("\r\n                var j = 0;\r\n                commentValue = \"\";\r\n                commFieldValue = \"\";\r\n                ");

                for(int i = 0; i < curCommFieldArr.length; i ++){
      out.write("\r\n                    if(document.all.");
      out.print(curCommFieldArr[i]);
      out.write(" && document.all.");
      out.print(curCommFieldArr[i]);
      out.write(".value != \"\"){\r\n                        commentValue += document.all.");
      out.print(curCommFieldArr[i]);
      out.write(".value + \":::\";\r\n                        commFieldValue += \"$");
      out.print(curCommFieldArr[i]);
      out.write("$\";\r\n                        j ++;\r\n                    }\r\n                ");

                }
      out.write("\r\n                if(j == 0){\r\n                    document.all.include_comment.value = document.all.");
      out.print(curCommFieldArr[0]);
      out.write(".value;\r\n                    document.all.include_commField.value = \"");
      out.print(curCommFieldArr[0]);
      out.write("\";\r\n                }else if(j == 1){\r\n                    commentValue = commentValue.substring(3, commentValue.length-3);\r\n                    document.all.include_comment.value = commentValue.substring(commentValue.indexOf(\";;;\") + 3, commentValue.length);\r\n                    document.all.include_commField.value = commFieldValue.substring(1, commFieldValue.length-1);\r\n                }else{\r\n                    document.all.include_comment.value = commentValue;\r\n                    document.all.include_commField.value = commFieldValue;\r\n                }\r\n                ");

            }
    	}else{
        
      out.write("\r\n\t\t\tif(document.all.comment){\r\n\t\t\t\tvar commentSignType = document.all.commentSignType.value;\r\n\t\t\t\tif(document.all.comment.length){\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.comment[commentSignType].value;\r\n\t\t\t\t} else{\r\n\t\t\t\t\tdocument.all.include_comment.value = document.all.comment.value;\r\n\t\t\t\t}\r\n            }\r\n        ");

        }
    }
    
      out.write("\r\n}\r\n\r\nfunction include_randomSave(s){\r\n    if(s == \"next\"){\r\n        if(document.all.randomProcUser){\r\n            if(document.all.randomProcUser.value == \"\"){\r\n                alert(\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
      out.write("\");\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    if(");
      out.print(saveCheckFn);
      out.write("){\r\n        if(!include_saveSignature()){            \r\n            return;\r\n        }\r\n        include_setComment();\r\n        ");
      out.print(formName);
      out.write(".target = \"include_iframe\";\r\n        ");
      out.print(formName);
      out.write(".action = \"/jsoa/WorkflowCommonAction.do?flag=random&type=\" + s;\r\n        ");
      out.print(formName);
      out.write(".submit();\r\n\t\tif(s == \"next\"){\r\n\t\t\talert(\"已成功提交给\"+document.all.randomProcUserName.value+\"！\");\r\n\t\t} else{\r\n\t\t\talert(\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeprocesshascomplete"));
      out.write("\");\r\n\t\t}\r\n    }\r\n}\r\n\r\nfunction include_myOpen(obj, objName, rangeName, rangeId){\r\n    var imgObj = eval(\"document.all.\" + objName);\r\n    if(imgObj.length){\r\n        for(var i = 0; i < imgObj.length; i ++){\r\n            if(imgObj[i] == obj){\r\n                var input_name = eval(\"document.all.\" + rangeName + \"[\" + i + \"]\");\r\n                var input_id = eval(\"document.all.\" + rangeId + \"[\" + i + \"]\");\r\n                openEndow(rangeId + \"[\" + i + \"]\",rangeName + \"[\" + i + \"]\", input_id.value, input_name.value, \"user\",\"no\",\"orgusergroup\",\"*0*\");\r\n                break;\r\n            }\r\n        }\r\n    }else{\r\n        if(obj == imgObj){\r\n            var input_name = eval(\"document.all.\" + rangeName);\r\n            var input_id = eval(\"document.all.\" + rangeId);\r\n            openEndow(rangeId,rangeName,input_id.value,input_name.value,\"user\",\"no\",\"orgusergroup\",\"*0*\");\r\n        }\r\n    }\r\n}\r\n\r\n\r\n//选择全部办理/阅件用户\r\nfunction selectAll(name,obj){\r\n\tif(eval(\"document.all.\"+name)){\r\n\t\tif(eval(\"document.all.\"+name+\".length\")){\r\n");
      out.write("\t\t\tfor(i=0;i<eval(\"document.all.\"+name+\".length\");i++){\r\n\t\t\t\tif(obj.checked){\r\n\t\t\t\t\teval(\"document.all.\"+name)[i].checked = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\teval(\"document.all.\"+name)[i].checked = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(obj.checked){\r\n\t\t\t\teval(\"document.all.\"+name).checked = true;\r\n\t\t\t}else{\r\n\t\t\t\teval(\"document.all.\"+name).checked = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nfunction cmdClose(){\r\n\tvar backto = document.getElementById(\"backto\").value;\r\n    include_close(backto);\r\n}\r\n\r\n//关闭\r\nfunction include_close(backto){\r\n\t// 解除对表单的占用\r\n    sendRequest(\"");
      out.print(recordId);
      out.write('"');
      out.write(',');
      out.write('"');
      out.print(tableId);
      out.write('"');
      out.write(',');
      out.write('"');
      out.print(processId);
      out.write('"');
      out.write(',');
      out.write('"');
      out.print(workId);
      out.write("\");\r\n    backto = document.getElementById(\"backto\").value;\r\n   \t// 页面跳转\r\n   \tif(\"dbsx\" == backto){\t// 待办事项\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=list&status=0\");\r\n    } else if(\"dysx\" == backto){\t// 待阅事项\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=list&status=2\");\r\n    } else if(\"ybsx\" == backto){\t// 已办事项\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=list&status=101&from=mine\");\r\n    } else if(\"yysx\" == backto){\t// 已阅事项\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=list&status=102&from=mine\");\r\n    } else if(\"yfzb\" == backto){\t// 已发在办\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=mine&workStatus=1\");\r\n    } else if(\"yfbj\" == backto){\t// 已发办结\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=mine&workStatus=100\");\r\n    } else if(\"yfth\" == backto){\t// 已发退回\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=mine&workStatus=-1\");\r\n    } else if(\"yfqx\" == backto){\t// 已发取消\r\n    \tlocation.replace(\"/jsoa/weiXinBacklogAction.do?action=mine&workStatus=-2\");\r\n");
      out.write("    } else if(\"cbtx\" == backto){\t// 已发取消\r\n    \tlocation.replace(\"/jsoa/weiXinMessageAction.do?method=personalCuibanList&from=1\");\r\n    } else{\t// 否则认为是消息提醒过来的，关闭窗口\r\n    \t");

		if("weixin".equals(loginType)){
			
      out.write("closeWindow();");

		} else if("wap".equals(loginType)){
			
      out.write("loadURL();");

		}
		
      out.write("\r\n\t}\r\n}\r\n\r\n//在线锁提醒\r\nfunction checkWFOnlineUser(){\r\n\t\r\n\tvar nolock = false;\r\n\tfunction alertOnlineUser(s){\r\n\t\tif(s != \"\"){\r\n\t\t\tweixinMessageReminder(\"alert\", \"提示：\", s+\"");
      out.print(Resource.getValue(localhi,"workflow","workflow.includeediting"));
      out.write("\", \"\");\r\n\t\t\tnolock = false;\r\n\t\t} else{\r\n\t\t\tnolock = true;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t DWREngine.setAsync(false);       //设置成同步 \r\n\t workflowSync.getWFOnlineUser(document.all.recordId.value, document.all.tableId.value, document.all.processId.value, document.all.workId.value,'");
      out.print(session.getAttribute("userAccount").toString());
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(pageKey);
      out.write("', alertOnlineUser);\r\n\t DWREngine.setAsync(true);       //重新设置为异步方式\r\n\t\r\n\t \r\n\t return nolock;    \r\n\r\n}\r\n</script>\r\n<iframe id=\"include_iframe\" name=\"include_iframe\" style=\"display:none\"></iframe>\r\n");
}
      out.write('\r');
      out.write('\n');

if("y".equals(request.getParameter("fromDossierData")) && "100".equals(request.getParameter("workStatus"))&&
		request.getParameter("finish")==null){
	operButton+=",FlowToArchives";
}

      out.write("\r\n\r\n<!--流程按钮-->\r\n<script src=\"/jsoa/weixin/public/cmdbuttonForWeiXin.jsp?button=Close");
      out.print(operButton);
      out.write("\"></script> \r\n<!--流程按钮-->\r\n\r\n\r\n");

//显示办理提示
String dealTips = new com.js.oa.jsflow.service.WorkFlowButtonBD().getDealTipsByWorkId(request.getParameter("work"));

      out.write("\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\nfunction showDealTips(){\r\n\t");
if(dealTips!=null && !dealTips.equals("")){
      out.write("\t\t\r\n\t\t//JSMainWinOpenNew(\"/jsoa/weixin/workflow/showDealTipsForWeiXin.jsp?work=");
      out.print(request.getParameter("work"));
      out.write("\",'','scrollbars=yes,resizable=yes,width=250,height=150');\r\n\t");
}
      out.write("\r\n}\r\n\r\nvar i_link,i_handle,i_para;\r\nfunction createSubProcess(link,handle,para){\r\n\ti_link=link;\r\n\ti_handle=handle;\r\n\ti_para=para;\r\n\tvar subProcWorkId=document.getElementsByName(\"subProcWorkId\")[0].value;\t\r\n\tvar processId=document.getElementsByName(\"subProcId\")[0].value;\r\n\tif(subProcWorkId==\"\"){\r\n\t    //JSMainWinOpen(link,hand,para);\r\n\t    workflowSync.userCanCreateFlow(processId,'");
      out.print(session.getAttribute("userId").toString());
      out.write("', '");
      out.print(session.getAttribute("orgId").toString());
      out.write("', '");
      out.print(session.getAttribute("orgIdString").toString());
      out.write("', getCreateSubProcessRight);\r\n\t}else{\r\n\t\tif(weixinMessageReminder(\"confirm\", \"提示：\", \"当前流程已经发起过子流程,您确定还要再次发起吗?\", \"\")){\r\n\t\t\t//JSMainWinOpen(link,hand,para);\r\n\t\t\tworkflowSync.userCanCreateFlow(processId,'");
      out.print(session.getAttribute("userId").toString());
      out.write("', '");
      out.print(session.getAttribute("orgId").toString());
      out.write("', '");
      out.print(session.getAttribute("orgIdString").toString());
      out.write("', getCreateSubProcessRight);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getCreateSubProcessRight(res){\r\n\t if(res==\"0\"){\r\n\t \tweixinMessageReminder(\"alert\", \"提示：\", \"您没有发起当前子流程的权限,请与管理员联系!\", \"\");\r\n\t }else{\r\n\t \twindow.location.href=i_link;\r\n\t }\r\n}\r\nfunction editOffices(field,fileType,template,showSign){\r\n\tvar recordId = eval(\"document.all.\"+field+\".value\");\r\n\tvar userName = document.all.user_Name.value;\r\n\t");
if(onlineUserValidate){ 
      out.write("\r\n\twindow.open(\"/jsoa/iWebOfficeSign/DocumentEdit.jsp?RecordID=\"+recordId+\"&EditType=0&UserName=\"+userName+\r\n\t\t\t\"&ShowSign=\"+showSign+\"&CanSave=0&moduleType=information&saveHtmlImage=0&saveDocFile=0&field=\"+field+\r\n\t\t\t\"&FileType=.\"+fileType+\"&showEditButton=1&showSignButton=1&Template=\"+template, \r\n\t\t\t\"\", \"status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,Height=400,left=0,top=0\");\r\n\t");
}else{ 
      out.write("\r\n\twindow.open(\"/jsoa/iWebOfficeSign/DocumentEdit.jsp?RecordID=\"+recordId+\"&EditType=1&UserName=\"+userName+\r\n\t\t\t\"&ShowSign=\"+showSign+\"&CanSave=1&moduleType=information&saveHtmlImage=0&saveDocFile=0&field=\"+field+\r\n\t\t\t\"&FileType=.\"+fileType+\"&showEditButton=1&showSignButton=1&Template=\"+template, \r\n\t\t\t\"\", \"status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,Height=400,left=0,top=0\");\r\n\t");
} 
      out.write("\r\n}\r\n</SCRIPT>");
      out.write("\r\n\t                              \t\t</td>\r\n\t                            \t</tr>\r\n\t                            </table>\r\n                        \t</div>\r\n                        \t\r\n                        \t<div id=\"docinfo1\" style=\"display:none;\">\r\n\t\t\t\t\t\t\t\t");

								if(inWorkType != 0 ) {
									
      out.write("\r\n                          \t\t\t<table width=\"100%\" border=\"0\" cellpadding=\"1\" cellspacing=\"1\">\r\n                              \t\t\t<tr>                                        \r\n                                  \t\t\t<td width=\"100%\" align=\"center\">                                      \r\n\t\t\t\t\t\t\t\t\t\t\t\t<iframe id=\"flowviewFrame\" frameborder=\"0\" height=\"500\" width=\"100%\"  src=\"\"></iframe>\r\n                                  \t\t\t</td>\r\n                              \t\t\t</tr>\r\n                              \t\t</table>\r\n\t\t\t\t\t\t\t\t\t");

								}
								
      out.write("\r\n                          \t</div>\r\n                          \t\r\n\t\t\t\t\t \t\t<div id=\"docinfo4\" style=\"display:none;\">\r\n\t\t\t\t\t \t\t\t<iframe id=\"flowRecordFrame\" frameborder=\"0\" height=\"0\" width=\"0\" src=\"\"></iframe>\t\t\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<div id=\"docinfo5\" style=\"display:none;\">\r\n\t\t\t\t\t\t\t\t<table width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td>");
out.print(activityDescription);
      out.write("</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t    \t\t\t</div>\r\n\t\t\t    \t\t\t\r\n\t\t\t\t\t    \t<!-- 相关流程start -->\r\n\t\t\t\t\t    \t<div id=\"docinfo7\" style=\"display:none;\">\t\t\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t      \t<table width=\"98%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"flowRecordTable\">\r\n\t\t\t\t\t\t\t\t  \t<tr>\r\n\t\t\t\t\t\t\t\t    \t<td colspan=\"5\" align=\"left\" valign=\"middle\" class=\"flowRecordTitle\"><b>&nbsp;相关流程</b></td>    \r\n\t\t\t\t\t\t\t\t  \t</tr>\r\n\t\t\t\t\t\t\t\t  \t");

								  	if(listRelationWork!=null&&listRelationWork.size()>0){
										for(int i=0; i<listRelationWork.size(); i++){
											String[] rWork = (String[]) listRelationWork.get(i);
										 	
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t  \t<tr>\r\n\t\t\t\t\t\t\t\t\t\t    \t<td width=\"15%\" nowrap align=\"left\" valign=\"middle\" class=\"flowRecordBorder\">&nbsp;");
      out.print(("0".equals(rWork[6]))?"父流程":"子流程");
      out.write("</td>\r\n\t\t\t\t\t\t\t\t\t\t    \t<td width=\"45%\" nowrap align=\"left\" valign=\"middle\" class=\"flowRecordBorder\">");
      out.print(rWork[2]);
      out.write("</td>\r\n\t\t\t\t\t\t\t\t\t\t    \t<td width=\"30%\" nowrap align=\"center\" valign=\"middle\" class=\"flowRecordBorder\">");
      out.print(rWork[3]);
      out.write(" </td>\r\n\t\t\t\t\t\t\t\t\t\t  \t</tr>\r\n\t\t\t\t\t\t\t\t\t\t  \t");

										}
									}
						  			
      out.write("\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<!-- 相关流程end -->\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t");

						  	String showDisplay = "block";
						  	if(0 == SystemCommon.getIsShowProject()){
						  		showDisplay = "none";
						  	}
							//String relProjectId=StaticParam.getWorkFlowProject(request.getParameter("processId"),request.getParameter("table"),request.getParameter("record"));
 							String relProjectIdAndName = StaticParam.getWorkFlowProjectIdAndName(request.getParameter("processId"), request.getParameter("table"), request.getParameter("record"));
						 	String relProjectId = relProjectIdAndName;
						  	String relProjectName = "无";
						  	if(relProjectIdAndName.indexOf(";") > 0){
						  		relProjectId = relProjectIdAndName.substring(0, relProjectIdAndName.indexOf(";"));
						  		relProjectName = relProjectIdAndName.substring(relProjectIdAndName.indexOf(";") + 1);
						  	}
						  	
      out.write("\r\n\t\t\t\t\t\t  \t<div style=\"text-align: right; display: ");
      out.print(showDisplay );
      out.write("; width: 96%; padding: 0 2%;\">\r\n\t\t\t\t\t    \t\t<input type=\"hidden\" name=\"relproject\" id=\"relproject\" value=\"");
      out.print(relProjectId );
      out.write("\" />\r\n\t\t\t\t\t\t    \t相关项目：");
      out.print(relProjectName );
      out.write("\r\n\t\t\t\t\t\t  \t</div>\r\n\t\t\t\t\t\t\t");

						  	if(null!=workStatustr && "-2".equals(workStatustr)){
							  	String reason = new WorkFlowBD().getCancelReason(request.getParameter("work"));
						  		
      out.write("\r\n\t\t\t\t\t\t  \t\t<div>取消原因：");
      out.print(reason );
      out.write("</div>\r\n\t\t\t\t\t\t  \t\t");

						  	}
						  	
      out.write("\r\n\t\t\t\t\t\t  \t<div style=\"display: none;\">\r\n\t\t\t\t\t\t  \t\t<iframe name=\"myIframe\"></iframe>\r\n\t\t\t\t\t\t  \t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t \t\t\t</form>\r\n\t\t\t\t<form name=\"form4\" action=\"/jsoa/weixin/workflow/workflow_myflow_add_gd.jsp?gd=1&workId=");
      out.print(request.getParameter("work"));
      out.write("&submitPersonId=");
      out.print(request.getAttribute("submitPersonId"));
      out.write("&title=");
      out.print(request.getAttribute("processName"));
      out.write("&recordId=");
      out.print(request.getParameter("record"));
      out.write("\" method=\"POST\">\r\n\t    \t\t\t<input type=\"hidden\" name=\"pageContent\">\r\n\t\t\t\t</form>\r\n\t\t\t\t");

				String[] formJSCode = {"", ""};
				String exeScript = "";
				String beforeSubmit = "";
				if(com.js.util.config.SystemCommon.getFormProgram() == 1){ 
					formJSCode = new com.js.oa.eform.service.CustomFormBD().getJSCode(pageId);
					exeScript = request.getAttribute("exeScript")==null ? "" : request.getAttribute("exeScript").toString();
					if("null".equals(exeScript)){
						exeScript = "";
					}
					beforeSubmit = request.getAttribute("beforeSubmit")==null ? "" : request.getAttribute("beforeSubmit").toString();
					if("null".equals(beforeSubmit)){
						beforeSubmit = "";
					}
				}
				
      out.write("\r\n\t\t\t\t<script language=\"javascript\">\r\n\t\t\t\t//归档\r\n\t\t\t\tfunction guidang(){\r\n\t\t\t\t    form4.pageContent.value = document.body.innerHTML;\r\n\t\t\t\t    form4.submit();\r\n\t\t\t\t}\r\n\t\t\t\t");

				if(request.getParameter("gd") != null){
					
      out.write("guidang();");

				}
				
      out.write("\r\n\t\t\t\tfunction changePanle(flag){\r\n\t\t\t\t   if(flag == 0) {\r\n\t\t\t\t\t\tPanle0.style.color = \"red\";\r\n\t\t\t\t       \tPanle1.style.color = \"black\";\r\n\t\t\t\t\t\tPanle5.style.color = \"black\";\r\n\t\t\t\t\t\tPanle6.style.color = \"black\";\r\n\t\t\t\t       \tif(document.all.Panle2){\r\n\t\t\t\t           \tPanle2.style.color = \"black\";\r\n\t\t\t\t       \t}\r\n\t\t\t\t       \tif(document.all.Panle3){\r\n\t\t\t\t           \tPanle3.style.color = \"black\";\r\n\t\t\t\t       \t}\r\n\t\t\t\t\t\tPanle4.style.color = \"black\";\r\n\t\t\t\t\t\tPanle7.style.color = \"black\"; \r\n\t\t\t\t\r\n\t\t\t\t       \tdocinfo0.style.display = \"\";\r\n\t\t\t\t       \tdocinfo1.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo4.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo5.style.display = \"none\";\r\n\t\t\t\t\t\t//docinfo6.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo7.style.display = \"none\";\r\n\t\t\t\t   }else if(flag == 1) {\r\n\t\t\t\t       \tPanle0.style.color = \"black\";\r\n\t\t\t\t       \tPanle1.style.color = \"red\";\r\n\t\t\t\t\t\tPanle5.style.color = \"black\";\r\n\t\t\t\t\t\tPanle6.style.color = \"black\";\r\n\t\t\t\t       \tif(document.all.Panle2){\r\n\t\t\t\t           \tPanle2.style.color = \"black\";\r\n\t\t\t\t       \t}\r\n");
      out.write("\t\t\t\t       \tif(document.all.Panle3){\r\n\t\t\t\t           \tPanle3.style.color = \"black\";\r\n\t\t\t\t       \t}\r\n\t\t\t\t\t\tPanle4.style.color = \"black\";\r\n\t\t\t\t\t\tPanle7.style.color = \"black\"; \r\n\t\t\t\t\r\n\t\t\t\t       \tdocinfo0.style.display = \"none\";\r\n\t\t\t\t       \tdocinfo1.style.display = \"\";\r\n\t\t\t\t\t\tdocinfo4.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo5.style.display = \"none\";\r\n\t\t\t\t\t\t");

						if(inWorkType != 0 ) {
							if(!"0".equals(request.getParameter("processType"))){			
				   				
      out.write("\r\n\t\t\t\t    \t\t\tdocument.all.flowviewFrame.src= \"/jsoa/weixin/workflow/jsflow_view10ForWeiXin.jsp?processId=");
      out.print(request.getParameter("processId"));
      out.write("&table=");
      out.print(request.getParameter("table"));
      out.write("&record=");
      out.print(request.getParameter("record"));
      out.write("&CurActivityID=&ActivityIDStr=\";\r\n\t\t\t\t       \t\t\t");

				         	}
						}
						
      out.write("\r\n\t\t\t\t\t\t//docinfo6.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo7.style.display = \"none\";\r\n\t\t\t\t   \t} else if(flag == 2){\r\n\t\t\t\t      \r\n\t\t\t\t   \t} else if(flag == 3){\r\n\t\t\t\t   \r\n\t\t\t\t   \t} else if(flag == 4) {\r\n\t\t\t\t   \t\t//显示流程记录\r\n\t\t\t\t       \tPanle0.style.color = \"black\";\r\n\t\t\t\t\t\tPanle1.style.color = \"black\";\r\n\t\t\t\t       \tPanle4.style.color = \"red\";\r\n\t\t\t\t\t\tPanle5.style.color = \"black\";\r\n\t\t\t\t\t\tPanle6.style.color = \"black\";\r\n\t\t\t\t       \tif(document.all.Panle2){\r\n\t\t\t\t           \tPanle2.style.color = \"black\";\r\n\t\t\t\t       \t}\r\n\t\t\t\t       \tif(document.all.Panle3){\r\n\t\t\t\t           \tPanle3.style.color = \"black\";\r\n\t\t\t\t       \t}\r\n\t\t\t\t       \tPanle7.style.color = \"black\"; \r\n\t\t\t\t\r\n\t\t\t\t       \tdocinfo0.style.display = \"none\";\r\n\t\t\t\t       \tdocinfo1.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo4.style.display = \"\";\r\n\t\t\t\t\t\tdocinfo5.style.display = \"none\";\r\n\t\t\t\t\t\t//docinfo6.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo7.style.display = \"none\";\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif(document.getElementById(\"flowRecordFrame\")){\r\n\t\t\t\t\t\t\tdocument.getElementById(\"flowRecordFrame\").src=\"/jsoa/weixin/workflow/workflow_myflow_getFlowRecord.jsp?processId=");
      out.print(request.getParameter("processId"));
      out.write("&table=");
      out.print(request.getParameter("table"));
      out.write("&record=");
      out.print(request.getParameter("record"));
      out.write("\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t   \t} else if(flag == 5) {\r\n\t\t\t\t   \t\tPanle0.style.color = \"black\";\r\n\t\t\t\t\t\tPanle1.style.color = \"black\";\r\n\t\t\t\t        Panle4.style.color = \"black\";\r\n\t\t\t\t\t\tPanle5.style.color = \"red\";\r\n\t\t\t\t\t\tPanle6.style.color = \"black\";\r\n\t\t\t\t        if(document.all.Panle2){\r\n\t\t\t\t            Panle2.style.color = \"black\";\r\n\t\t\t\t        }\r\n\t\t\t\t        if(document.all.Panle3){\r\n\t\t\t\t            Panle3.style.color = \"black\";\r\n\t\t\t\t        }\r\n\t\t\t\t        Panle7.style.color = \"black\";\r\n\r\n\t\t\t\t        docinfo0.style.display = \"none\";\r\n\t\t\t\t        docinfo1.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo4.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo5.style.display = \"\";\r\n\t\t\t\t\t\t//docinfo6.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo7.style.display = \"none\";\r\n\t\t\t\t   \t} else if(flag == 6) {\r\n\t\t\t\t       \tPanle0.style.color = \"black\";\r\n\t\t\t\t\t\tPanle1.style.color = \"black\";\r\n\t\t\t\t       \tPanle4.style.color = \"black\";\r\n\t\t\t\t\t\tPanle5.style.color = \"black\";\r\n\t\t\t\t\t\tPanle6.style.color = \"red\";\r\n\t\t\t\t       \tif(document.all.Panle2){\r\n\t\t\t\t           \tPanle2.style.color = \"black\";\r\n");
      out.write("\t\t\t\t   \t\t}\r\n\t\t\t\t       \tif(document.all.Panle3){\r\n\t\t\t\t           \tPanle3.style.color = \"black\";\r\n\t\t\t\t       \t}\r\n\t\t\t\t   \t\tPanle7.style.color = \"black\";      \r\n\t\t\t\t       \r\n\t\t\t\t       \tdocument.all.flowviewFrame.src= \"/jsoa/weixin/workflow/workflow_descriptionForWeixin.jsp?liuzhuan=1&processId=");
      out.print(request.getParameter("processId"));
      out.write("&ndate=\"+new Date();\r\n\t\t\t\t\r\n\t\t\t\t        docinfo0.style.display = \"none\";\r\n\t\t\t\t        docinfo1.style.display = \"\";\r\n\t\t\t\t\t\tdocinfo4.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo5.style.display = \"none\";\r\n\t\t\t\t\t\t//docinfo6.style.display = \"\";\r\n\t\t\t\t\t\tdocinfo7.style.display = \"none\";\r\n\t\t\t\t    } else if(flag == 7) {\r\n\t\t\t\t        Panle0.style.color = \"black\";\r\n\t\t\t\t\t\tPanle1.style.color = \"black\";\r\n\t\t\t\t        Panle4.style.color = \"black\";\r\n\t\t\t\t\t\tPanle5.style.color = \"black\";\r\n\t\t\t\t\t\tPanle6.style.color = \"black\";\r\n\t\t\t\t        if(document.all.Panle2){\r\n\t\t\t\t            Panle2.style.color = \"black\";\r\n\t\t\t\t        }\r\n\t\t\t\t        if(document.all.Panle3){\r\n\t\t\t\t            Panle3.style.color = \"black\";\r\n\t\t\t\t        }\r\n\t\t\t\t        Panle7.style.color = \"red\";        \r\n\t\t\t\t        \r\n\t\t\t\t        docinfo0.style.display = \"none\";\r\n\t\t\t\t        docinfo1.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo4.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo5.style.display = \"none\";\r\n\t\t\t\t\t\tdocinfo7.style.display = \"\";\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t\t</script>\r\n\t\t\t\t<script language=\"javascript\">\r\n");
      out.write("\t\t\t\tfunction SaveSignature(){\r\n\t\t\t\t    if(frm.SendOut){\r\n\t\t\t\t        if(frm.SendOut.Modify){\r\n\t\t\t\t            if(!frm.SendOut.SaveSignature()){\r\n\t\t\t\t                return false;\r\n\t\t\t\t            }\r\n\t\t\t\t        }\r\n\t\t\t\t    }\r\n\t\t\t\t    return true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction save(s){\r\n\t\t\t\t    if(s == 'save'){\r\n\t\t\t\t        frm.action = \"/jsoa/WorkFlowPassRoundAction.do\";\r\n\t\t\t\t        frm.submit();\r\n\t\t\t\t    }else{\r\n\t\t\t\t        setHtmlValue();\r\n\t\t\t\t        document.all.myaction.value = s;\r\n\t\t\t\t        if(beforeSubmit(s)){\r\n\t\t\t\t            SaveSignature();\r\n\t\t\t\t            frm.action = \"/jsoa/WorkFlowSubmitAction.do\";\r\n\t\t\t\t            frm.submit();\r\n\t\t\t\t        }\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction setHtmlValue(){\r\n\t\t\t\t    if(document.all.hasHtml){\r\n\t\t\t\t        //页面中包含有HTML编辑器\r\n\t\t\t\t        if(document.all.hasHtml.length){\r\n\t\t\t\t            //页面中包含不止一个HTML编辑器\r\n\t\t\t\t            var len = document.all.hasHtml.length;\r\n\t\t\t\t            for(var j = 0; j < len; j ++){\r\n\t\t\t\t            \tvar htmlEditName = document.all.hasHtml[j].value;\r\n");
      out.write("\t\t\t\t            \tvar o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n\t\t\t\t            \tdocument.getElementById(htmlEditName).value = o_Editor.getHTML();\r\n\t\t\t\t                //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n\t\t\t\t            }\r\n\t\t\t\t        }else{\r\n\t\t\t\t            //页面上仅有一个HTML编辑器\r\n\t\t\t\t            var htmlEditName = document.all.hasHtml.value;\r\n\t\t\t\t            var o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n\t\t\t\t            document.getElementById(htmlEditName).value = o_Editor.getHTML();\r\n\t\t\t\t            //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n\t\t\t\t        }\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction addFile(fieldName){\r\n\t\t\t\t    JSMainWinOpen(\"jsflow/workflow_upload.jsp?fieldName=\" + fieldName ,'上传','menubar=0,scrollbars=0,locations=0,width=400,height=200,resizable=no');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction deleteRow(rowNum,fieldName,saveName){\r\n\t\t\t\t    var tableObj = eval(\"document.all.\" + fieldName + \"_tab\");\r\n");
      out.write("\t\t\t\t    for(var i = 0; i < tableObj.rows.length; i ++){\r\n\t\t\t\t    \tvar removeNode = tableObj.rows(i);\r\n\t\t\t\t        if(removeNode.all.tableRow){\r\n\t\t\t\t            if(removeNode.all.tableRow.value == rowNum){\r\n\t\t\t\t                removeNode.removeNode(true);\r\n\t\t\t\t                document.all.myIframe.src = \"/jsoa/jsflow/workflow_deleteFile.jsp?saveName=\" + saveName;\r\n\t\t\t\t            }\r\n\t\t\t\t        }\r\n\t\t\t\t    }\r\n\t\t\t\t//    removeNode.removeNode(true);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction beforeSubmit(){\r\n\t\t\t\t\tsetHtmlValue();\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tsetComputeForeignField();\r\n\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t    var canSubmit = true;\r\n\t\t\t\t    var mustWrite = document.getElementsByName(\"mustWrite\");\r\n\t\t\t\t    var mustField = \",\";\r\n\t\t\t\t    if(mustWrite!=null && mustWrite.length>0){\r\n\t\t\t\t\t\tfor(var i=0; i<mustWrite.length; i++){\r\n\t\t\t\t\t\t\tmustField += mustWrite[i].value + \",\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t        //如果页面有必填项\r\n\t\t\t\t        if(mustWrite.length > 1){\r\n\t\t\t\t            //如果页面不止一个必填项\r\n\t\t\t\t            for(var i =0; i < mustWrite.length; i ++){\r\n");
      out.write("\t\t\t\t\t\t\t\t//if(!canSubmit) break;//字表必填项不填写的时候，只有一次提示\r\n\t\t\t\t\t\t\t\tvar obj = eval(\"document.all.\" + document.all.mustWrite[i].value);\t// eval(\"document.getElementById('\" + mustWrite[i].value+\"')\");\r\n\t\t\t\t                if(obj){\r\n\t\t\t\t                    var objType = \"\";\r\n\t\t\t\t                    if(obj.type){\r\n\t\t\t\t                       objType = obj.type.toUpperCase();\r\n\t\t\t\t                    }else{\r\n\t\t\t\t                        if(obj.length){\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var k=0; k<obj.length; k++){\r\n\t\t\t\t\t\t\t\t\t\t\t\t//i++;\r\n\t\t\t\t\t\t\t\t\t\t\t\tobjType = obj[k].type.toUpperCase();\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar objTemp = obj[k];\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n");
      out.write("\t\t\t\t\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}else if(objType == \"HIDDEN\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}else if(objType == \"CHECKBOX\" || objType==\"RADIO\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(!checkboxIsChecked(obj)){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}else if(objType == \"HTML\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(eval(objTemp.id + \".getHTML()\")==\"\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t                        }else{\r\n\t\t\t\t                            objType = \"HTML\";\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }\r\n\t\t\t\t                    if(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n");
      out.write("\t\t\t\t                        if(textIsEmpty(obj)){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            obj.focus();\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                            break;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n\t\t\t\t                        if(textIsEmpty(obj)){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            obj.focus();\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                            break;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }else if(objType == \"HIDDEN\"){\r\n\t\t\t\t                        if(textIsEmpty(obj)){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                            break;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }else if(objType == \"CHECKBOX\"){\r\n");
      out.write("\t\t\t\t                        if(!checkboxIsChecked(obj)){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                            break;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }else if(objType == \"HTML\"){\r\n\t\t\t\t                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }\r\n\t\t\t\t                }\r\n\t\t\t\t                if(document.all.fieldName && document.all.fieldName.length){\r\n\t\t\t\t                    for(var j = 0; j < document.all.fieldName.length; j ++){\r\n\t\t\t\t                        if(document.all.fieldName[j].value == document.all.mustWrite[i].value + \"_file\"){\r\n\t\t\t\t                            if(!eval(\"document.all.\" + document.all.mustWrite[i].value + \"_fileName\")){\r\n\t\t\t\t                            \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n");
      out.write("\t\t\t\t                                canSubmit = false;\r\n\t\t\t\t                                break;\r\n\t\t\t\t                            }\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }\r\n\t\t\t\t                    if(!canSubmit){\r\n\t\t\t\t                    \tbreak;\r\n\t\t\t\t                    }\r\n\t\t\t\t                }\r\n\t\t\t\t                obj = eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\");\r\n\t\t\t\t                if(obj){\r\n\t\t\t\t                   if(eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\").value==\"\"){\r\n\t\t\t\t                \t   weixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                        canSubmit = false;\r\n\t\t\t\t                        break;\r\n\t\t\t\t                    }\r\n\t\t\t\t                }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t        }else{\r\n\t\t\t\t            //页面只有一个必填项\r\n\t\t\t\t            var obj = eval(\"document.all.\" + document.getElementById(\"mustWrite\").value);//document.getElementById(document.getElementById(\"mustWrite\").value);\r\n\t\t\t\t            if(obj){\r\n\t\t\t\t                var objType = \"\";\r\n");
      out.write("\t\t\t\t                if(obj.type){\r\n\t\t\t\t                    objType = obj.type.toUpperCase();\r\n\t\t\t\t                }else{\r\n\t\t\t\t                    if(obj.length){\r\n\t\t\t\t                        objType = obj[0].type.toUpperCase();\r\n\t\t\t\t                    }else{\r\n\t\t\t\t                        objType = \"HTML\";\r\n\t\t\t\t                    }\r\n\t\t\t\t                }\r\n\t\t\t\t                if(objType == \"TEXT\"  || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n\t\t\t\t                    if(textIsEmpty(obj)){\r\n\t\t\t\t                    \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                        obj.focus();\r\n\t\t\t\t                        canSubmit = false;\r\n\t\t\t\t                    }\r\n\t\t\t\t                }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n\t\t\t\t                    if(obj.html.length == 0){\r\n\t\t\t\t                    \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                        obj.focus();\r\n\t\t\t\t                        canSubmit = false;\r\n\t\t\t\t                    }\r\n");
      out.write("\t\t\t\t                }else if(objType == \"CHECKBOX\" || objType == \"RADIO\"){\r\n\t\t\t\t                    if(!checkboxIsChecked(obj)){\r\n\t\t\t\t                    \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                        canSubmit = false;\r\n\t\t\t\t                    }\r\n\t\t\t\t                }else if(objType == \"HIDDEN\"){\r\n\t\t\t\t                        if(textIsEmpty(obj)){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }else if(objType == \"HTML\"){\r\n\t\t\t\t                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }\r\n\t\t\t\t            }\r\n\t\t\t\t            if(document.all.fieldName && document.all.fieldName.length){\r\n\t\t\t\t                for(var j = 0; j < document.all.fieldName.length; j ++){\r\n");
      out.write("\t\t\t\t                    if(document.all.fieldName[j].value == document.all.mustWrite.value + \"_file\"){\r\n\t\t\t\t                        if(!eval(\"document.all.\" + document.all.mustWrite.value + \"_fileName\")){\r\n\t\t\t\t                        \tweixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                            canSubmit = false;\r\n\t\t\t\t                            break;\r\n\t\t\t\t                        }\r\n\t\t\t\t                    }\r\n\t\t\t\t                }\r\n\t\t\t\t            }\r\n\t\t\t\t          //判断单选人选框的必填\r\n\t\t\t\t            obj = eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\");\r\n\t\t\t\t            if(obj){\r\n\t\t\t\t               if(eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\").value==\"\"){\r\n\t\t\t\t                    weixinMessageReminder(\"alert\", \"提示：\", \"请填写必填项！\", \"\");\r\n\t\t\t\t                    canSubmit = false;\r\n\t\t\t\t                }\r\n\t\t\t\t            }\r\n\t\t\t\t        }\r\n\t\t\t\t    }\r\n\t\t\t\t   \r\n\t\t\t\t    //检查日期字段是否合法 2010-10-12\r\n\t\t\t\t    var formDateTimeObj = document.getElementsByName(\"needCheckField\");\r\n");
      out.write("\t\t\t\t    var singleObj, singleObjName;\r\n\t\t\t\t    for(var i=0; i<formDateTimeObj.length; i++){\r\n\t\t\t\t    \t\r\n\t\t\t\t    \t//检查每一个字段\r\n\t\t\t\t    \tsingleObjName = formDateTimeObj[i].value;   \r\n\t\t\t\t    \tif(mustField.indexOf(\",\" + singleObjName + \",\") >= 0){ \t\r\n\t\t\t\t\t    \tsingleObj = document.getElementsByName(singleObjName);\r\n\t\t\t\t\t    \tsingleObjType = document.getElementsByName(singleObjName + \"_type\");\r\n\t\t\t\t\t    \tfor(var j=0; j<singleObj.length; j++){    \t\r\n\t\t\t\t\t    \t\tif(singleObjType[j].value==\"jsdate\" || singleObjType[j].value==\"datetime\"){\r\n\t\t\t\t\t    \t\t\t\r\n\t\t\t\t\t    \t\t\tif(!checkSimpleDate(singleObj[j].value)){\r\n\t\t\t\t\t    \t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"日期格式不正确！\", \"\");\r\n\t\t\t\t\t    \t\t\t\tsingleObj[j].focus();\r\n\t\t\t\t\t    \t\t\t\treturn false;\r\n\t\t\t\t\t    \t\t\t}\r\n\t\t\t\t\t    \t\t\t     \r\n\t\t\t\t\t    \t\t}else if(singleObjType[j].value == \"jstime\"){\r\n\t\t\t\t\t    \t\t\t//时间类型\r\n\t\t\t\t\t    \t\t\t");

					    			if(com.js.util.config.SystemCommon.getSYWorkflowHR() == 1){
					    				
      out.write("\r\n\t\t\t\t\t    \t\t\t\tif(!checkSimpleTime(singleObj[j].value)){\r\n\t\t\t\t\t    \t\t\t\t\tvar timevalue = singleObj[j].value;\r\n\t\t\t\t\t    \t\t\t   \t\tif(timevalue.indexOf(\"0:00:00\")>=0 || timevalue.indexOf(\"00:00:00\")>=0){\r\n\t\t\t\t\t    \t\t\t\t \t\t// return true;\r\n\t\t\t\t\t    \t\t\t  \t \t}else{\r\n\t\t\t\t\t    \t\t\t  \t \t\tweixinMessageReminder(\"alert\", \"提示：\", \"时间格式不正确！\", \"\");\r\n\t\t\t\t\t    \t\t\t\t \t\tsingleObj[j].focus();\r\n\t\t\t\t\t    \t\t\t\t \t\treturn false;\r\n\t\t\t\t\t    \t\t\t   \t\t}\r\n\t\t\t\t\t    \t\t\t\t\r\n\t\t\t\t\t    \t\t\t\t}\r\n\t\t\t\t\t    \t\t\t\t");

					    			}else{
					    				
      out.write("\r\n\t\t\t\t\t\t    \t\t\tif(!checkSimpleTime(singleObj[j].value)){\r\n\t\t\t\t\t\t    \t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"时间格式不正确！\", \"\");\r\n\t\t\t\t\t\t    \t\t\t\tsingleObj[j].focus();\r\n\t\t\t\t\t\t    \t\t\t\treturn false;\r\n\t\t\t\t\t\t    \t\t\t}\r\n\t\t\t\t\t    \t\t\t\t");

					    			}
					    			
      out.write("\r\n\t\t\t\t\t    \t\t}\r\n\t\t\t\t\t    \t}\r\n\t\t\t\t    \t}\r\n\t\t\t\t    }   \r\n\t\t\t\t    var computeFields = document.getElementsByName(\"computeField\");\r\n\t\t\t\t    var computeFieldValues = document.getElementsByName(\"computeFieldValue\");\r\n\t\t\t\t    for(var i=0; i<computeFields.length; i++){   \r\n\t\t\t\t      \ttry{\r\n\t\t\t\t    \t\tvar computeField = computeFields[i].value;\r\n\t\t\t\t        \tvar exp = computeFieldValues[i].value;        \r\n\t\t\t\t        \tsetMainComputeField(computeField,exp);\r\n\t\t\t\t       }catch(e){ }\r\n\t\t\t\t    }\r\n\t\t\t\t    //检查每一个字段的大小\r\n\t\t\t\t    if(canSubmit){\r\n\t\t\t\t\t    if(checkAllObjectSize()){\r\n\t\t\t\t\t    \tcanSubmit = true;\r\n\t\t\t\t\t    }else{\r\n\t\t\t\t\t    \tcanSubmit = false;\r\n\t\t\t\t\t    } \r\n\t\t\t\t    }\r\n\t\t\t\t    \r\n\t\t\t\t    setHtmlValue();\r\n\t\t\t\t\r\n\t\t\t\t\t//校验自动增长批示意见\r\n\t\t\t\t\tif(document.all.comment){\r\n\t\t\t\t\t\tvar commentSignType = document.all.commentSignType.value;\r\n\t\t\t\t\t\tif(document.all.comment.length){\r\n\t\t\t\t\t\t\tif(document.all.comment[commentSignType].value.indexOf(\"'\") >= 0){\r\n\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"批示意见不能包含单引号！\", \"\");\r\n\t\t\t\t\t\t\t\tcanSubmit = false;\r\n");
      out.write("\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(document.all.comment[commentSignType].value.length>999){\r\n\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"意见内容最多不能超过1000字符！\", \"\");\r\n\t\t\t\t\t\t    \treturn false;\r\n\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\tif(document.all.comment.value.indexOf(\"'\") >= 0){\r\n\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"批示意见不能包含单引号！\", \"\");\r\n\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(document.all.comment.value.length>999){\r\n\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"意见内容最多不能超过1000字符！\", \"\");\r\n\t\t\t\t\t\t    \treturn false;\r\n\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//校验定义的批示意见\r\n\t\t\t\t\t");

					if(curCommField!=null && !"".equals(curCommField) && !"null".equals(curCommField)){
						
      out.write("\r\n\t\t\t\t\t\tif(document.all.");
      out.print(curCommField);
      out.write("){\r\n\t\t\t\t\t\t\tvar commentSignType = document.all.commentSignType;\r\n\t\t\t\t\t\t\tif(commentSignType && document.all.");
      out.print(curCommField);
      out.write(".length){\r\n\t\t\t\t\t\t\t\tif(document.all.");
      out.print(curCommField);
      out.write("[commentSignType.value].value.indexOf(\"'\") >= 0){\r\n\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"批示意见不能包含单引号！\", \"\");\r\n\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(document.all.");
      out.print(curCommField);
      out.write("[commentSignType.value].value.length>999){\r\n\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"意见内容最多不能超过1000字符！\", \"\");\r\n\t\t\t\t\t\t\t    \treturn false;\r\n\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\t\tif(document.all.");
      out.print(curCommField);
      out.write(".value.indexOf(\"'\") >= 0){\r\n\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"批示意见不能包含单引号！\", \"\");\r\n\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(document.all.");
      out.print(curCommField);
      out.write(".value.length>999){\r\n\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"意见内容最多不能超过1000字符\", \"\");\r\n\t\t\t\t\t\t\t    \treturn false;\r\n\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t");

					}
					
      out.write("\r\n\t\t\t\t\tif(!canSubmit){\r\n\t\t\t\t  \t\treturn ;\r\n\t\t\t\t  \t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 日期判断\r\n\t\t\t\t  \tif(document.getElementById(\"dateCompare\") != null){\r\n\t\t\t\t  \t\tif(dateCompare(document.getElementById(\"dateCompare\").value)){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t  \t}\r\n\t\t\t\t\t// 执行用户定义Javascript代码\r\n\t\t\t\t    ");
      out.print(beforeSubmit );
      out.write("\r\n\t\t\t\t    ");

				   	// 判断手写意见是否为空
				   	if(com.js.util.config.SystemCommon.getHandWriteNotEmpty() == 1){
				   		
      out.write("\r\n\t\t\t\t   \t\tif(!include_saveSignature()){\r\n\t\t\t\t         \treturn false;\r\n\t\t\t\t       \t}\r\n\t\t\t\t   \t\t");

				   	}
				   	
      out.write("\r\n\t\t\t\t    return canSubmit; \r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction init(){\r\n\t\t\t\t\t");

					if("1".equals(request.getAttribute("hangup"))){
						
      out.write("\r\n\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"流程已挂起\", \"\");\r\n\t\t\t\t\t  \twindow.close();\r\n\t\t\t\t  \t\t");

				  	}
				  	
      out.write("\r\n\t\t\t\t    if(document.all.hasHtml){\r\n\t\t\t\t        // 页面中包含有HTML编辑器\r\n\t\t\t\t        if(document.all.hasHtml.length){\r\n\t\t\t\t            // 页面中包含不止一个HTML编辑器\r\n\t\t\t\t            var len = document.all.hasHtml.length;\r\n\t\t\t\t            for(var j=0; j<len; j++){\r\n\t\t\t\t            \tvar htmlEditName = document.all.hasHtml[j].value;\r\n\t\t\t\t            \tvar o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n\t\t\t\t            \tdocument.getElementById(htmlEditName).value = o_Editor.getHTML();\r\n\t\t\t\t                //eval(htmlEditName + \"_html.setHTML(document.all.\" + htmlEditName + \".value)\");\r\n\t\t\t\t            }\r\n\t\t\t\t        } else{\r\n\t\t\t\t            //页面上仅有一个HTML编辑器\r\n\t\t\t\t            var htmlEditName = document.all.hasHtml.value;\r\n\t\t\t\t            var o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n\t\t\t\t            document.getElementById(htmlEditName).value = o_Editor.getHTML();\r\n\t\t\t\t            //eval(htmlEditName + \"_html.setHTML(document.all.\" + htmlEditName + \".value)\");\r\n\t\t\t\t        }\r\n");
      out.write("\t\t\t\t    }\r\n\t\t\t\t\t//updatePrint(\"get\");//初始化加载表单被打印的次数\r\n\t\t\t\t\r\n\t\t\t\t\t// 转交\r\n\t\t\t\t\t");

					if("1".equals(request.getParameter("tran"))){
						
      out.write("cmdTran();");

					}
					
      out.write("\r\n\t\t\t\t\t");
//=formJSCode[0]
      out.write("\r\n\t\t\t\t\t");

					// 执行本节点设置的初始化语句
					if("0".equals(request.getParameter("workStatus"))){
						out.println(exeScript);
					}
					//if("chinaLife".equals(SystemCommon.getCustomerName())){
						out.println(formJSCode[0]);
					//}
					
      out.write("\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction trans(){\r\n\t\t\t\t    try{\r\n\t\t\t\t\t    var reg = /(f\\d+)/g;\r\n\t\t\t\t\t    if(document.all.computeField){\r\n\t\t\t\t\t        if(document.all.computeField.length){\r\n\t\t\t\t\t            for(var i = 0; i < document.all.computeField.length; i ++){\r\n\t\t\t\t\t                var computeField = document.all.computeField[i].value;\r\n\t\t\t\t\t                var computeFieldValue = document.all.computeFieldValue[i].value;\r\n\t\t\t\t\t                var fieldArray = computeFieldValue.match(reg);\r\n\t\t\t\t\t                var isNotTime = true;\r\n\t\t\t\t\t                if(fieldArray.length == 2){\r\n\t\t\t\t\t                    var testValue1 = \"\";\r\n\t\t\t\t\t                    if(eval(\"document.all.\" + fieldArray[0])){\r\n\t\t\t\t\t                        testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n\t\t\t\t\t                    }else{\r\n\t\t\t\t\t                        testValue1 = eval(\"document.all.\" + fieldArray[0] + \"_day.value\") + \" \" +\r\n\t\t\t\t\t                                     eval(\"document.all.\" + fieldArray[0] + \"_hour.value\") + \":\" +\r\n");
      out.write("\t\t\t\t\t                                     eval(\"document.all.\" + fieldArray[0] + \"_minute.value\");\r\n\t\t\t\t\t                    }\r\n\t\t\t\t\t                    var testValue2 = \"\";\r\n\t\t\t\t\t                    if(eval(\"document.all.\" + fieldArray[1])){\r\n\t\t\t\t\t                        testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n\t\t\t\t\t                    }else{\r\n\t\t\t\t\t                        testValue2 = eval(\"document.all.\" + fieldArray[1] + \"_day.value\") + \" \" +\r\n\t\t\t\t\t                                     eval(\"document.all.\" + fieldArray[1] + \"_hour.value\") + \":\" +\r\n\t\t\t\t\t                                     eval(\"document.all.\" + fieldArray[1] + \"_minute.value\");\r\n\t\t\t\t\t                    }\r\n\t\t\t\t\t                    if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"/\") > 0 && testValue2.indexOf(\"/\") > 0){\r\n\t\t\t\t\t                        isNotTime = false;\r\n\t\t\t\t\t                        var day =((new Date(testValue1) - new Date(testValue2)) / 86400000) + \"\";\r\n\t\t\t\t\t                        if(day.indexOf(\".\") > 0){\r\n");
      out.write("\t\t\t\t\t                            if((day.length - day.indexOf(\".\")) > 2){\r\n\t\t\t\t\t                            \tday = day.substring(0, day.indexOf(\".\") + 3);\r\n\t\t\t\t\t                            }\r\n\t\t\t\t\t                        }\r\n\t\t\t\t\t                        eval(\"document.all.\" + computeField + \".value='\" + day + \"'\");\r\n\t\t\t\t\t                    }\r\n\t\t\t\t\t                }\r\n\t\t\t\t\t                if(isNotTime){\r\n\t\t\t\t\t                    for(var j = 0; j < fieldArray.length; j ++){\r\n\t\t\t\t\t                        computeFieldValue = computeFieldValue.replace(fieldArray[j],eval(\"document.all.\" + fieldArray[j] + \".value\"));\r\n\t\t\t\t\t                    }\r\n\t\t\t\t\t                    eval(\"document.all.\" + computeField + \".value = \" + eval(computeFieldValue));\r\n\t\t\t\t\t                }\r\n\t\t\t\t\t            }\r\n\t\t\t\t\t        }else{\r\n\t\t\t\t\t            var computeField = document.all.computeField.value;\r\n\t\t\t\t\t            var computeFieldValue = document.all.computeFieldValue.value;\r\n\t\t\t\t\t            var fieldArray = computeFieldValue.match(reg);\r\n");
      out.write("\t\t\t\t\t            var isNotTime = true;\r\n\t\t\t\t\t            if(fieldArray.length == 2){\r\n\t\t\t\t\t                var testValue1 = \"\";\r\n\t\t\t\t\t                if(eval(\"document.all.\" + fieldArray[0])){\r\n\t\t\t\t\t                    testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n\t\t\t\t\t                }else{\r\n\t\t\t\t\t                    testValue1 = eval(\"document.all.\" + fieldArray[0] + \"_day.value\") + \" \" +\r\n\t\t\t\t\t                                 eval(\"document.all.\" + fieldArray[0] + \"_hour.value\") + \":\" +\r\n\t\t\t\t\t                                 eval(\"document.all.\" + fieldArray[0] + \"_minute.value\");\r\n\t\t\t\t\t                }\r\n\t\t\t\t\t                var testValue2 = \"\";\r\n\t\t\t\t\t                if(eval(\"document.all.\" + fieldArray[1])){\r\n\t\t\t\t\t                    testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n\t\t\t\t\t                }else{\r\n\t\t\t\t\t                    testValue2 = eval(\"document.all.\" + fieldArray[1] + \"_day.value\") + \" \" +\r\n\t\t\t\t\t                                 eval(\"document.all.\" + fieldArray[1] + \"_hour.value\") + \":\" +\r\n");
      out.write("\t\t\t\t\t                                 eval(\"document.all.\" + fieldArray[1] + \"_minute.value\");\r\n\t\t\t\t\t                }\r\n\t\t\t\t\t                if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"/\") > 0 && testValue2.indexOf(\"/\") > 0){\r\n\t\t\t\t\t                    isNotTime = false;\r\n\t\t\t\t\t                    var day =((new Date(testValue1) - new Date(testValue2)) / 86400000) + \"\";\r\n\t\t\t\t\t                    if(day.indexOf(\".\") > 0){\r\n\t\t\t\t\t                        if((day.length - day.indexOf(\".\")) > 2){\r\n\t\t\t\t\t                            day = day.substring(0, day.indexOf(\".\") + 3);\r\n\t\t\t\t\t                        }\r\n\t\t\t\t\t                    }\r\n\t\t\t\t\t                    eval(\"document.all.\" + computeField + \".value='\" + day + \"'\");\r\n\t\t\t\t\t                }\r\n\t\t\t\t\t            }\r\n\t\t\t\t\t            if(isNotTime){\r\n\t\t\t\t\t                for(var i = 0; i < fieldArray.length; i ++){\r\n\t\t\t\t\t                    computeFieldValue = computeFieldValue.replace(fieldArray[i],eval(\"document.all.\" + fieldArray[i] + \".value\"));\r\n\t\t\t\t\t                }\r\n");
      out.write("\t\t\t\t\t            }\r\n\t\t\t\t\t\r\n\t\t\t\t\t            eval(\"document.all.\" + computeField + \".value = \" + eval(computeFieldValue));\r\n\t\t\t\t\t        }\r\n\t\t\t\t\t    }\r\n\t\t\t\t    }catch(e){}\r\n\t\t\t\t\t/*\r\n\t\t\t\t    if(textIsEmpty(document.all.transitionUserName)){\r\n\t\t\t\t    \talert(\"请选择办理人！\");\r\n\t\t\t\t    }else{\r\n\t\t\t\t        SaveSignature();\r\n\t\t\t\t        frm.action = \"/jsoa/WorkFlowTransitionAction.do\";\r\n\t\t\t\t        frm.submit();\r\n\t\t\t\t    }\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction delGroupRow(fieldName,rowNum){\r\n\t\t\t\t    var tableObj = eval(\"document.all.\" + fieldName + \"_group\");\r\n\t\t\t\t    for(var i = 1; i < tableObj.rows.length; i ++){\r\n\t\t\t\t        var removeNode = tableObj.rows(i);\r\n\t\t\t\t        if(removeNode.all.tableRow.value == rowNum){\r\n\t\t\t\t            removeNode.removeNode(true);\r\n\t\t\t\t        }\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction untread(){\r\n\t\t\t\t    frm.action = \"/jsoa/WorkFlowUntreadAction.do\";\r\n\t\t\t\t    frm.submit();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction checkTextArea(obj,alertString,len){\r\n\t\t\t\t    if(obj.value.length > len){\r\n\t\t\t\t    \tweixinMessageReminder(\"alert\", \"提示：\", alertString + \"太长了！（最多\" + len + \"个字）\", \"\");\r\n");
      out.write("\t\t\t\t        obj.focus();\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction offiDict(userId, textAreaName){\r\n\t\t\t\t    JSMainWinOpen('jsflow/workflow_offiDict.jsp?userId=' + userId + '&textAreaName=' + textAreaName,'','menubar=0,scrollbars=yes,locations=0,width=400,height=200,resizable=yes');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction changeText(){\r\n\t\t\t\t}\r\n\t\t\t\tfunction clickRadio(obj){\r\n\t\t\t\t    changeText();\r\n\t\t\t\t}\r\n\t\t\t\tfunction clickCheckbox(){\r\n\t\t\t\t    changeText();\r\n\t\t\t\t}\r\n\t\t\t\tfunction changeSelect(){\r\n\t\t\t\t    changeText();\r\n\t\t\t\t}\r\n\t\t\t\tfunction changeTextarea(){\r\n\t\t\t\t    changeText();\r\n\t\t\t\t}\r\n\t\t\t\t//function procNextStep(){\r\n\t\t\t\t   //document.all.myIframe.src = \"/jsoa/jsflow/workflow_myflow_add_iframe.jsp\";\r\n\t\t\t\t//   WorkFlowSubmitActionForm.submit\r\n\t\t\t\t//}\r\n\t\t\t\t\r\n\t\t\t\t//打印预览\r\n\t\t\t\tfunction preview(){\r\n\t\t\t\t\tJSMainWinOpen(\"/jsoa/jsflow/printWord.jsp\");\r\n\t\t\t\t\tupdatePrint('add');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//将页面导出到Word\r\n\t\t\t\tfunction openWord(){\r\n\t\t\t\t\tvar oWD = new ActiveXObject(\"Word.Application\");\r\n\t\t\t\t  \tvar oDC = oWD.Documents.Add(\"\", 0, 1);\r\n\t\t\t\t  \tvar oRange =oDC.Range(0,1);\r\n");
      out.write("\t\t\t\t  \tvar sel = document.body.createTextRange();\r\n\t\t\t\t  \tsel.select();\r\n\t\t\t\t  \tsel.execCommand(\"Copy\");\r\n\t\t\t\t  \toRange.Paste();\r\n\t\t\t\t  \toWD.Application.Visible = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//用户点击打印时，更新数据库中该流程表单已被打印的次数,\r\n\t\t\t\tvar xmlHttp = false;\r\n\t\t\t\ttry {\r\n\t\t\t\t\txmlHttp = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\txmlHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t\t\t\t} catch (e2) {\r\n\t\t\t\t\t\txmlHttp = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!xmlHttp && typeof XMLHttpRequest != 'undefined') {\r\n\t\t\t\t\txmlHttp = new XMLHttpRequest();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction updatePrint(tag){\r\n\t\t\t\t\txmlHttp.open(\"GET\", \"/jsoa/jsflow/printnum.jsp?recordId=");
      out.print(request.getParameter("record"));
      out.write("&operate=\"+tag, true);\r\n\t\t\t\t\txmlHttp.onreadystatechange = updatePrintNum;\r\n\t\t\t\t\txmlHttp.send(null);\r\n\t\t\t\t}\r\n\t\t\t\t//更新页面显示的打印数\r\n\t\t\t\tfunction updatePrintNum(){\r\n\t\t\t\t\tif (xmlHttp.readyState < 4) {\r\n\t\t\t\t\t\t//document.all.printNum.innerHTML=\"正在加载\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (xmlHttp.readyState == 4) {\r\n\t\t\t\t\t\tvar response = xmlHttp.responseText;\r\n\t\t\t\t\t\tdocument.all.printNum[0].innerHTML=\"已打印<label class=mustFillcolor> \"+response+\"</label>次\";\r\n\t\t\t\t\t\tdocument.all.printNum[1].innerHTML=\"第<label class=mustFillcolor> \"+response+\"</label>次打印\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfunction showMoney(){\r\n\t\t\t\t\tif(document.all.moneyNum){\r\n\t\t\t\t\t\tif(document.all.moneyNum.length){\r\n\t\t\t\t\t\t\tvar i=0;\r\n\t\t\t\t\t\t\tfor(i=0;i<document.all.moneyNum.length;i++){\r\n\t\t\t\t\t\t\t\tdocument.all.moneyNum[i].style.display = 'none';\r\n\t\t\t\t\t\t\t\tdocument.all.moneyChar[i].style.display = '';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tdocument.all.moneyNum.style.display = 'none';\r\n\t\t\t\t\t\t\tdocument.all.moneyChar.style.display = '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t/*处理自定义表单中HTML编辑器延时加载 */\r\n\t\t\t\tfunction reloadHTMLEditor(){\r\n");
      out.write("\t\t\t\t\tfor(var i=0; i<document.getElementsByTagName(\"iframe\").length; i++){\r\n\t\t\t\t\t\tif(document.getElementsByTagName(\"iframe\")[i].src.indexOf(\"ewebeditor.htm\") > 0){\r\n\t\t\t\t\t\t\tvar src = document.getElementsByTagName(\"iframe\")[i].src;\r\n\t\t\t\t\t\t\tdocument.getElementsByTagName(\"iframe\")[i].src = \"\";\r\n\t\t\t\t\t\t\tdocument.getElementsByTagName(\"iframe\")[i].src = src;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t/*处理自定义表单中HTML编辑器延时加载*/\r\n\t\t\t\tfunction openDealTipsWindow(logId){\r\n\t\t\t\t\t//JSMainWinOpen('/jsoa/weixin/workflow/showDealTipsForWeiXin.jsp?logId=' + logId, '', '');\r\n\t\t\t\t\tvar url='/jsoa/weixin/workflow/showDealTipsForWeiXin.jsp?logId=' + logId;\r\n\t\t\t\t\twindow.location.href=url;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction dateCompare(compareStr){\r\n\t\t\t\t\tif(compareStr != \"\"){\r\n\t\t\t\t\t\tvar returnValue = false;\r\n\t\t\t\t\t\tcompareStr = compareStr.substring(1,compareStr.length-1);\r\n\t\t\t\t\t\tvar strs = compareStr.split(\"}{\");\r\n\t\t\t\t\t\tfor(var i=0;i<strs.length;i++){\r\n\t\t\t\t\t\t\tvar v = strs[i].split(\"#\");\r\n\t\t\t\t\t\t\tvar b = v[0].split(\").beforeDate(\")[0].substring(1);\r\n\t\t\t\t\t\t\tvar c = v[0].split(\").beforeDate(\")[1];\r\n");
      out.write("\t\t\t\t\t\t\tvar t = c.substring(c.indexOf(\")\")+1);\r\n\t\t\t\t\t\t\tc = c.substring(0,c.indexOf(\")\"));\r\n\t\t\t\t\t\t\tif(b.indexOf(\"+\") >= 0){\r\n\t\t\t\t\t\t\t\tvar s = b.split(\"+\");\r\n\t\t\t\t\t\t\t\tif(document.getElementById(s[1]) != null){\r\n\t\t\t\t\t\t\t\t\tb = document.getElementById(s[0]).value + \" \" + document.getElementById(s[1]).value + \":\" +\r\n\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById(s[2]).value + \":\" + document.getElementById(s[3]).value;\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tb = \"\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tif(document.getElementById(b) != null){\r\n\t\t\t\t\t\t\t\t\tb = document.getElementById(b).value;\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tb = \"\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif(c.indexOf(\"+\") >= 0){\r\n\t\t\t\t\t\t\t\tvar s = c.split(\"+\");\r\n\t\t\t\t\t\t\t\tif(document.getElementById(s[1]) != null){\r\n\t\t\t\t\t\t\t\t\tc = document.getElementById(s[0]).value + \" \" + document.getElementById(s[1]).value + \":\" +\r\n\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById(s[2]).value + \":\" + document.getElementById(s[3]).value;\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tc = \"\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tif(document.getElementById(c)!=null){\r\n");
      out.write("\t\t\t\t\t\t\t\t\tc = document.getElementById(c).value;\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tc = \"\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(b!=\"\" && c!=\"\"){\r\n\t\t\t\t\t\t\t\t//alert(\"'\"+b+\"'.beforeDate('\"+c+\"')\"+t+\"    \"+eval(\"'\"+b+\"'.beforeDate('\"+c+\"')\"+t));\r\n\t\t\t\t\t\t\t\tif(eval(\"'\" + b + \"'.beforeDate('\" + c + \"')\" + t)){\r\n\t\t\t\t\t\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", v[1], \"\");\r\n\t\t\t\t\t\t\t\t\treturnValue = true;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn returnValue;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t</script>\r\n\t\t\t\t");

			}
		}
		
      out.write("\r\n\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/workflow/eform/selectUser.jsp", out, false);
      out.write("\r\n\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/workflow/eform/selectFile.jsp", out, false);
      out.write("\r\n\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/workflow/eform/getFilterList.jsp", out, false);
      out.write("\r\n\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/workflow/item/filedealwith_relation.jsp", out, false);
      out.write("\r\n\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/workflow/searchInfo/search_infoForWeiXin.jsp", out, false);
      out.write("\r\n\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/weixin/workflow/daibanflow/weixinshowhtml.jsp", out, false);
      out.write("\r\n\t\t<div id=\"commonPopDiv\" class=\"nextStep\" style=\"text-align: center; vertical-align: middle;-webkit-overflow-scrolling:touch;overflow:auto;\">\r\n    \t\t<iframe id=\"commonPopIframe\" style=\"width: 100%;height:99%; border: none;\"></iframe>\r\n\t\t</div>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t");

		// 办理提示
		String dealTipstr = new com.js.oa.jsflow.service.WorkFlowButtonBD().getDealTipsByWorkId(request.getParameter("work"));
		if(null!=dealTipstr && !"".equals(dealTipstr) && !"null".equals(dealTipstr)){	// 办理提示
			
      out.write("\r\n\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"");
      out.print(dealTipstr );
      out.write("\", \"\");\r\n\t\t\t");

		} else if((resubmit!=null && "1".equals(resubmit)) || (null!=workStatustr && "-2".equals(workStatustr))){	// 取消流程
			List<String[]> commentList = new WorkFlowButtonBD().getAllComment(request.getParameter("work"));
			for(int i=0;i<commentList.size()-1;i++){
				String[] obj = commentList.get(i);
				
      out.write("\r\n\t\t\t\t");
      out.print(obj[0] );
      out.write('：');
      out.print(obj[1] );
      out.write("  办理人：");
      out.print(obj[3] );
      out.write("&nbsp;&nbsp;时间：");
      out.print(obj[2] );
      out.write(" </br>\r\n\t\t\t\t");

			}
			
      out.write("\r\n\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"办理提示：取消流程已处理。\", \"\");\r\n\t\t\t");

		}
		
      out.write("\r\n\t\t</script>\r\n\t</body>\r\n</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }

  private boolean _jspx_meth_bean_005fmessage_005f0(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  bean:message
    org.apache.struts.taglib.bean.MessageTag _jspx_th_bean_005fmessage_005f0 = (org.apache.struts.taglib.bean.MessageTag) _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.get(org.apache.struts.taglib.bean.MessageTag.class);
    boolean _jspx_th_bean_005fmessage_005f0_reused = false;
    try {
      _jspx_th_bean_005fmessage_005f0.setPageContext(_jspx_page_context);
      _jspx_th_bean_005fmessage_005f0.setParent(null);
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(217,19) name = bundle type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f0.setBundle("workflow");
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(217,19) name = key type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f0.setKey("workflow.newworkflowchart");
      int _jspx_eval_bean_005fmessage_005f0 = _jspx_th_bean_005fmessage_005f0.doStartTag();
      if (_jspx_th_bean_005fmessage_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.reuse(_jspx_th_bean_005fmessage_005f0);
      _jspx_th_bean_005fmessage_005f0_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_bean_005fmessage_005f0, _jsp_getInstanceManager(), _jspx_th_bean_005fmessage_005f0_reused);
    }
    return false;
  }

  private boolean _jspx_meth_bean_005fmessage_005f1(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  bean:message
    org.apache.struts.taglib.bean.MessageTag _jspx_th_bean_005fmessage_005f1 = (org.apache.struts.taglib.bean.MessageTag) _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.get(org.apache.struts.taglib.bean.MessageTag.class);
    boolean _jspx_th_bean_005fmessage_005f1_reused = false;
    try {
      _jspx_th_bean_005fmessage_005f1.setPageContext(_jspx_page_context);
      _jspx_th_bean_005fmessage_005f1.setParent(null);
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(234,10) name = bundle type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f1.setBundle("filetransact");
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(234,10) name = key type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f1.setKey("file.workflowrecord");
      int _jspx_eval_bean_005fmessage_005f1 = _jspx_th_bean_005fmessage_005f1.doStartTag();
      if (_jspx_th_bean_005fmessage_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.reuse(_jspx_th_bean_005fmessage_005f1);
      _jspx_th_bean_005fmessage_005f1_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_bean_005fmessage_005f1, _jsp_getInstanceManager(), _jspx_th_bean_005fmessage_005f1_reused);
    }
    return false;
  }

  private boolean _jspx_meth_bean_005fmessage_005f2(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  bean:message
    org.apache.struts.taglib.bean.MessageTag _jspx_th_bean_005fmessage_005f2 = (org.apache.struts.taglib.bean.MessageTag) _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.get(org.apache.struts.taglib.bean.MessageTag.class);
    boolean _jspx_th_bean_005fmessage_005f2_reused = false;
    try {
      _jspx_th_bean_005fmessage_005f2.setPageContext(_jspx_page_context);
      _jspx_th_bean_005fmessage_005f2.setParent(null);
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(243,11) name = bundle type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f2.setBundle("workflow");
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(243,11) name = key type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f2.setKey("workflow.activitydescription");
      int _jspx_eval_bean_005fmessage_005f2 = _jspx_th_bean_005fmessage_005f2.doStartTag();
      if (_jspx_th_bean_005fmessage_005f2.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.reuse(_jspx_th_bean_005fmessage_005f2);
      _jspx_th_bean_005fmessage_005f2_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_bean_005fmessage_005f2, _jsp_getInstanceManager(), _jspx_th_bean_005fmessage_005f2_reused);
    }
    return false;
  }

  private boolean _jspx_meth_bean_005fmessage_005f3(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  bean:message
    org.apache.struts.taglib.bean.MessageTag _jspx_th_bean_005fmessage_005f3 = (org.apache.struts.taglib.bean.MessageTag) _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.get(org.apache.struts.taglib.bean.MessageTag.class);
    boolean _jspx_th_bean_005fmessage_005f3_reused = false;
    try {
      _jspx_th_bean_005fmessage_005f3.setPageContext(_jspx_page_context);
      _jspx_th_bean_005fmessage_005f3.setParent(null);
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(249,13) name = bundle type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f3.setBundle("workflow");
      // /weixin/workflow/workflow_myflow_add_modifyForWeiXin.jsp(249,13) name = key type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f3.setKey("workflow.activitydescription");
      int _jspx_eval_bean_005fmessage_005f3 = _jspx_th_bean_005fmessage_005f3.doStartTag();
      if (_jspx_th_bean_005fmessage_005f3.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.reuse(_jspx_th_bean_005fmessage_005f3);
      _jspx_th_bean_005fmessage_005f3_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_bean_005fmessage_005f3, _jsp_getInstanceManager(), _jspx_th_bean_005fmessage_005f3_reused);
    }
    return false;
  }
}
