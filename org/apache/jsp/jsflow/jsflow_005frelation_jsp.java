/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 10:08:08 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.jsflow;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.sql.PreparedStatement;
import com.js.lang.Resource;
import com.js.oa.jsflow.service.ActivityBD;
import com.js.oa.jsflow.service.WorkFlowBD;
import com.js.util.util.CharacterTool;
import com.js.oa.jsflow.vo.SimpleFieldVO;

public final class jsflow_005frelation_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(1);
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-html.tld", Long.valueOf(1499751390000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.util.util.CharacterTool");
    _jspx_imports_classes.add("com.js.oa.jsflow.vo.SimpleFieldVO");
    _jspx_imports_classes.add("com.js.lang.Resource");
    _jspx_imports_classes.add("java.sql.PreparedStatement");
    _jspx_imports_classes.add("com.js.oa.jsflow.service.ActivityBD");
    _jspx_imports_classes.add("com.js.oa.jsflow.service.WorkFlowBD");
  }

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fhtml_005fhtml;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fhtml_005fhtml = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fhtml_005fhtml.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n");

request.setCharacterEncoding("GBK");
response.setHeader("Cache-Control","no-store");
response.setHeader("Pragma","no-cache");
response.setDateHeader ("Expires", 0);

String local = session.getAttribute("org.apache.struts.action.LOCALE").toString();

String processId=request.getParameter("processId");
String tableId=request.getParameter("tableId");
String moduleId=request.getParameter("moduleId");

String transId=request.getParameter("transId");

String from=request.getParameter("from");
String fromName=request.getParameter("fromName");
String fromType=request.getParameter("fromType");
String fromClass=request.getParameter("fromClass");
String fromIsBranch="0";

String to=request.getParameter("to");
String toName=request.getParameter("toName");
String expression="";


String fieldId="";
String oprate="";
String oprateValue="";
String relationDesc="",relationDescShow="";

String defaultActivity="0";
String lineOrder="1";

com.js.util.util.DataSourceBase base=new com.js.util.util.DataSourceBase();
java.sql.Connection conn=null;
try{
	 conn=base.getDataSource().getConnection();
	 java.sql.ResultSet rs;
	 
	 String sql="select activityName,activitybeginend,isbranch from jsf_activity where wf_activity_id=?";	 
	 
	 PreparedStatement pstmt=conn.prepareStatement(sql);
	 pstmt.setString(1, from);
	 rs = pstmt.executeQuery();
	 if(rs.next()){
	     fromName = rs.getString("activityName");
	     if(fromName == null || "".equals(fromName) || "null".equalsIgnoreCase(fromName)){
	         if("1".equals(rs.getString("activitybeginend"))){
	             fromName = "开始";
	         }else if("2".equals(rs.getString("activitybeginend"))){
	             fromName = "结束";
	         }
	     }
	     fromIsBranch=rs.getString("isbranch");
	 }
	 rs.close();
	 pstmt.close();
	 
	 sql="select activityName,activitybeginend from jsf_activity where wf_activity_id=?";
	 pstmt=conn.prepareStatement(sql);
	 pstmt.setString(1, to);
	 
	 rs = pstmt.executeQuery();
	 if(rs.next()){
	     toName = rs.getString("activityName");
	     if(toName == null || "".equals(toName) || "null".equalsIgnoreCase(toName)){
	         if("1".equals(rs.getString("activitybeginend"))){
	             toName = "开始";
	         }else if("2".equals(rs.getString("activitybeginend"))){
	             toName = "结束";
	         }
	     }
	 }
	 rs.close();
	 pstmt.close();
	 
	 if("update".equals(request.getParameter("flag"))){
		 defaultActivity=request.getParameter("defaultActivity");
		 fieldId=request.getParameter("fieldId");
		 oprate=request.getParameter("oprate");
		 oprateValue=request.getParameter("oprateValue");
		 relationDesc=request.getParameter("relationDesc");
		 lineOrder=request.getParameter("lineOrder");
		 if(lineOrder==null){
			 lineOrder="1";
		 }
		 		 
		 expression=request.getParameter("expression");
		 
		 if("1".equals(defaultActivity)){
			 //设条件为默认
			 sql="update jsf_transition set defaultactivity=?,transitiondescription=?,expression=?,lineorder=? where wf_transition_id=?";
			 pstmt=conn.prepareStatement(sql);
			 pstmt.setString(1, to);
			 pstmt.setString(2, relationDesc);
			 pstmt.setString(3, expression);
			 pstmt.setString(4, lineOrder);
			 pstmt.setString(5, transId);
			 pstmt.executeUpdate();
			 pstmt.close();
			 
			 sql="update jsf_transition set defaultactivity=0 where transitionfrom=? and wf_transition_id<>?";
			 pstmt=conn.prepareStatement(sql);
			 pstmt.setString(1, from);
			 pstmt.setString(2, transId);
			 pstmt.executeUpdate();
			 pstmt.close();
		 }else{
			 //检查其他条件是否有被设置为默认的，若没有则该条件仍设为默认
			 sql="select max(defaultactivity) from jsf_transition where transitionfrom=? and wf_transition_id<>?";
			 pstmt=conn.prepareStatement(sql);
			 pstmt.setString(1, from);
			 pstmt.setString(2, transId);
			 
			 rs=pstmt.executeQuery();			  
			 String defId="0";
			 if(rs.next()){
				 defId=rs.getString(1);
			 }
			 rs.close();
			 pstmt.close();
			 
			 sql="update jsf_transition set defaultactivity=?,transitiondescription=?,expression=?,lineorder=? where wf_transition_id=?";
			 pstmt=conn.prepareStatement(sql);
			 if("0".equals(defId)){
				 pstmt.setString(1, to);
			 }else{
				 pstmt.setString(1,"0");
			 }
			 pstmt.setString(2, relationDesc);
			 pstmt.setString(3, expression);
			 pstmt.setString(4, lineOrder);
			 pstmt.setString(5, transId);
			 pstmt.executeUpdate();
			 pstmt.close();
		 }
		 
		 /*fieldId=request.getParameter("fieldId");
		 oprate=request.getParameter("oprate");
		 oprateValue=request.getParameter("oprateValue");		 
		 
		 if(fieldId!=null){
			 stmt.executeUpdate("update jsf_transitionrestriction set conditionfield="+fieldId+",relation='"+oprate+"',comparevalue='"+oprateValue+"' where wf_transition_id="+transId);			 
		 }*/
		 
	 }
	 
	 sql="select defaultactivity,transitiondescription,expression,lineorder from jsf_transition where wf_transition_id=?";
	 pstmt=conn.prepareStatement(sql);
	 pstmt.setString(1, transId);
	 rs=pstmt.executeQuery();
	 if(rs.next()){
		 defaultActivity=rs.getString(1);
		 relationDesc=rs.getString(2);
		 if(relationDesc==null || "null".equals(relationDesc)){
			 relationDesc="";
		 }
		 expression=rs.getString(3);
		 lineOrder=rs.getString(4);
	 }
	 rs.close();
	 pstmt.close();
	 
	 //若没有设置多个条件则取早期条件设置
	 if(expression==null || "".equals(expression)){
		 sql="select conditionfield,relation,comparevalue from jsf_transitionrestriction where wf_transition_id=?";
		 pstmt=conn.prepareStatement(sql);
		 pstmt.setString(1, transId);
		 rs=pstmt.executeQuery();
		 if(rs.next()){
			 fieldId=rs.getString(1);
			 oprate=rs.getString(2);
			 oprateValue=rs.getString(3);
			 if(oprateValue==null || "null".equals(oprateValue)){
				 oprateValue="";
			 }
		 }
		 rs.close();
		 pstmt.close();
	 }
	 
	 conn.close();
}catch(Exception ex){
	 ex.printStackTrace();
	 conn.close();
}


relationDescShow=CharacterTool.escapeHTMLTags(relationDesc);

if("update".equals(request.getParameter("flag"))){
	
      out.write("\r\n\t<script>\r\n\t  opener.setLineDescription('");
      out.print(transId);
      out.write('\'');
      out.write(',');
      out.write('\'');
      out.print(relationDescShow);
      out.write("');\r\n\t  window.close();\r\n\t</script>\r\n\t");

}

      out.write("\r\n\r\n");
      //  html:html
      org.apache.struts.taglib.html.HtmlTag _jspx_th_html_005fhtml_005f0 = (org.apache.struts.taglib.html.HtmlTag) _005fjspx_005ftagPool_005fhtml_005fhtml.get(org.apache.struts.taglib.html.HtmlTag.class);
      boolean _jspx_th_html_005fhtml_005f0_reused = false;
      try {
        _jspx_th_html_005fhtml_005f0.setPageContext(_jspx_page_context);
        _jspx_th_html_005fhtml_005f0.setParent(null);
        int _jspx_eval_html_005fhtml_005f0 = _jspx_th_html_005fhtml_005f0.doStartTag();
        if (_jspx_eval_html_005fhtml_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
          do {
            out.write("\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\">\r\n<link href=\"/jsoa/skin/");
            out.print(session.getAttribute("skin"));
            out.write("/style-");
            out.print(session.getAttribute("browserVersion"));
            out.write(".css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<title>设置转移条件</title>\r\n\r\n<script language=\"JavaScript\" src=\"/jsoa/js/resource/");
            out.print(local);
            out.write("/CommonResource.js\" type=\"text/javascript\"></script>\r\n<script language=\"JavaScript\" src=\"js/date0.js\"></script>\r\n<script src=\"/jsoa/js/resource/");
            out.print(local);
            out.write("/PersonalworkResource.js\" language=\"javascript\"></script>\r\n<script src=\"js/Combox.js\"></script>\r\n</head>\r\n\r\n<body  class=\"MainFrameBox Pupwin\">\r\n<table width=\"100%\" border=0 cellpadding=\"0\" cellspacing=\"0\">\r\n<tr>\r\n<td>\r\n\r\n<!--table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanel\"-->\r\n<table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanel\">\r\n <tr>\r\n    <td valign=\"top\">\r\n\t   <table width=\"100%\" border=\"0\" cellpadding=\"2\" cellspacing=\"1\">\r\n\t\t<form name=\"frm\" action=\"/jsoa/jsflow/jsflow_relation.jsp?flag=update\" method=\"post\">\r\n\t\t<input type=\"hidden\" name=\"transId\" value=\"");
            out.print(transId );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"from\" value=\"");
            out.print(from );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"fromName\" value=\"");
            out.print(fromName );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"fromClass\" value=\"");
            out.print(fromClass );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"fromType\" value=\"");
            out.print(fromType );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"to\" value=\"");
            out.print(to );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"toName\" value=\"");
            out.print(toName );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"processId\" value=\"");
            out.print(processId );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"tableId\" value=\"");
            out.print(tableId );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"moduleId\" value=\"");
            out.print(moduleId );
            out.write("\">\r\n\t\t<input type=\"hidden\" name=\"expression\" value=\"\">\r\n\t\t<tr>\r\n\t\t  <td width=\"12%\" nowrap>当前节点：</td>\r\n\t\t  <td colspan=2>");
            out.print(fromName );
            out.write("           \r\n          </td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t  <td>下一节点：</td>\r\n\t\t  <td width=\"40%\">");
            out.print(toName );
            out.write("           \r\n          </td>\r\n          <td width=\"50%\">\r\n           <input type=\"checkbox\" name=\"defaultActivity\" value=\"1\" ");
if(to.equals(defaultActivity)){out.print("checked");} 
            out.write("> 设为默认\r\n          </td>\r\n\t\t</tr>\r\n\t\t\r\n\t\t");

         if(("2".equals(fromClass) || "0".equals(fromType)) && !"1".equals(fromIsBranch)){ 
        	 WorkFlowBD workFlowBD = new WorkFlowBD();
        	 java.util.List fieldList=workFlowBD.getRelationSimpleField(moduleId, tableId);
         
         
            out.write("\r\n        <tr style=\"display:none\">\r\n\t\t\t<td colspan=\"3\">\r\n\t\t\t");

			String OPR_LT="<";
			String OPR_LTOREQ="<=";
			String OPR_EQ="=";
			String OPR_NOTEQ="<>";
			String OPR_GT=">";
			String OPR_GTOREQ=">=";
			String OPR_LIKE="like";
			String OPR_NOTLIKE="not like";
			
            out.write("\r\n\t\t\t<select name=\"oprateTemp\" id=\"oprateTemp\">\r\n\t\t\t\t<option value=\"");
            out.print(OPR_LT );
            out.write("\">小于(&lt;)</option>\r\n                <option value=\"");
            out.print(OPR_LTOREQ );
            out.write("\">不大于(&lt;=)</option>\r\n                <option value=\"");
            out.print(OPR_NOTEQ );
            out.write("\">不等于(≠)</option>\r\n                <option value=\"");
            out.print(OPR_EQ );
            out.write("\">等于(=)</option>\r\n                <option value=\"");
            out.print(OPR_GT );
            out.write("\">大于(&gt;)</option>\r\n                <option value=\"");
            out.print(OPR_GTOREQ );
            out.write("\">不小于(&gt;=)</option>\r\n                <option value=\"");
            out.print(OPR_LIKE );
            out.write("\">相似于(like)</option>   \r\n                <option value=\"");
            out.print(OPR_NOTLIKE );
            out.write("\">不相似于(not like)</option>           \r\n\t\t\t</select>\r\n\t\t\t<select name=\"fieldIdTemp\" id=\"fieldIdTemp\" onchange=\"changeField(this)\">\r\n\t\t\t\t<option value=\"-1\">发起人职务</option>\r\n\t\t\t\t<option value=\"-2\">发起人职务级别</option>\r\n\t\t\t\t<option value=\"-4\">发起人角色</option>\r\n\t\t\t\t<option value=\"-5\">发起人岗位</option>\r\n\t\t\t\t<option value=\"-3\">上一节点办理人职务级别</option>\t\t\t\t\r\n\t\t\t\t<option value=\"-6\">上一节点办理人角色</option>\t\t\t\t\r\n\t\t\t\t<option value=\"-7\">上一节点办理人岗位</option>\r\n\t\t\t\t");

				SimpleFieldVO fieldVO = null;
				for(int j = 0; j < fieldList.size(); j ++ ){
					  fieldVO = (SimpleFieldVO) fieldList.get(j);
				if("9".equals(request.getParameter("tableId")) || "2794".equals(request.getParameter("tableId"))){
            out.write("\r\n\t\t\t\t   <option value=\"");
            out.print(fieldVO.getId());
            out.write(',');
            out.print(fieldVO.getPoField() );
            out.write('"');
            out.write('>');
            out.print(fieldVO.getDisplayName());
            out.write("</option>\r\n\t\t\t\t");
}else{
            out.write("\r\n\t\t\t\t <option value=\"");
            out.print(fieldVO.getId());
            out.write(',');
            out.print(fieldVO.getRealName() );
            out.write('"');
            out.write('>');
            out.print(fieldVO.getDisplayName());
            out.write("</option>\r\n\t\t\t\t");
}}
            out.write("\r\n\t\t\t\t<option value=\"0\" ");
if(fieldId.equals("0")) out.print("selected");
            out.write(">无条件</option>\r\n\t\t\t</select>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t  <td valign=\"top\">转移条件：</td>\r\n          <td colspan=\"2\" width=\"90%\">\r\n             \r\n             <table cellpadding=\"0\" cellspacing=\"0\" id=transTable >\r\n               ");

               if(expression==null || expression.length()<5){
            	   //早期的单个条件的设置               
               
            out.write("\r\n               <tr>\r\n                 <td>\r\n                   <input type=\"text\" name=\"leftTag\" id=\"leftTag\" size=\"3\" value=\"(\">\r\n                   <select name=\"fieldId\" onchange=\"changeField(this)\">\r\n\t\t\t\t\t\t<option value=\"-1\" ");
if(fieldId.equals("-1")) out.print("selected");
            out.write(">发起人职务</option>\r\n\t\t\t\t\t\t<option value=\"-2\" ");
if(fieldId.equals("-2")) out.print("selected");
            out.write(">发起人职务级别</option>\r\n\t\t\t\t\t\t<option value=\"-4\" ");
if(fieldId.equals("-4")) out.print("selected");
            out.write(">发起人角色</option>\r\n\t\t\t\t\t\t<option value=\"-5\" ");
if(fieldId.equals("-5")) out.print("selected");
            out.write(">发起人岗位</option>\r\n\t\t\t\t\t\t<option value=\"-3\" ");
if(fieldId.equals("-3")) out.print("selected");
            out.write(">上一节点办理人职务级别</option>\r\n\t\t\t\t\t\t<option value=\"-6\" ");
if(fieldId.equals("-6")) out.print("selected");
            out.write(">上一节点办理人角色</option>\t\t\t\t\r\n\t\t\t\t\t\t<option value=\"-7\" ");
if(fieldId.equals("-7")) out.print("selected");
            out.write(">上一节点办理人岗位</option>\r\n\t\t\t\t\t\t");
						
						for(int j = 0; j < fieldList.size(); j ++ ){
							  fieldVO = (SimpleFieldVO) fieldList.get(j);
						if("9".equals(request.getParameter("tableId")) || "2794".equals(request.getParameter("tableId"))){
            out.write("\r\n\t\t\t\t\t\t   <option value=\"");
            out.print(fieldVO.getId());
            out.write(',');
            out.print(fieldVO.getPoField() );
            out.write('"');
            out.write(' ');
if((fieldVO.getId() + "").equals(fieldId)) out.print("selected");
            out.write('>');
            out.print(fieldVO.getDisplayName());
            out.write("</option>\r\n\t\t\t\t\t\t");
}else{
            out.write("\r\n\t\t\t\t\t\t<option value=\"");
            out.print(fieldVO.getId());
            out.write(',');
            out.print(fieldVO.getRealName() );
            out.write('"');
            out.write(' ');
if((fieldVO.getId() + "").equals(fieldId)) out.print("selected");
            out.write('>');
            out.print(fieldVO.getDisplayName());
            out.write("</option>\r\n\t\t\t\t\t\t");
}}
            out.write("\r\n\t\t\t\t\t\t<option value=\"0\" ");
if(fieldId.equals("0")) out.print("selected");
            out.write(">无条件</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t\t<select name=\"oprate\">\r\n\t\t\t\t\t   <option value=\"");
            out.print(OPR_LT );
            out.write('"');
            out.write(' ');
if(oprate.equals("<")) {out.print("selected");}
            out.write(">小于(&lt;)</option>\r\n                       <option value=\"");
            out.print(OPR_LTOREQ );
            out.write('"');
            out.write(' ');
if(oprate.equals("<=")){ out.print("selected");}
            out.write(">不大于(&lt;=)</option>\r\n                       <option value=\"");
            out.print(OPR_NOTEQ );
            out.write('"');
            out.write(' ');
if(oprate.equals("<>")){ out.print("selected");}
            out.write(">不等于(≠)</option>\r\n                       <option value=\"");
            out.print(OPR_EQ );
            out.write('"');
            out.write(' ');
if(oprate.equals("=")){ out.print("selected");}
            out.write(">等于(=)</option>\r\n                       <option value=\"");
            out.print(OPR_GT );
            out.write('"');
            out.write(' ');
if(oprate.equals(">")){ out.print("selected");}
            out.write(">大于(&gt;)</option>\r\n                       <option value=\"");
            out.print(OPR_GTOREQ );
            out.write('"');
            out.write(' ');
if(oprate.equals(">=")){ out.print("selected");}
            out.write(">不小于(&gt;=)</option>\r\n                       <option value=\"");
            out.print(OPR_LIKE );
            out.write('"');
            out.write(' ');
if(oprate.equals("like")){ out.print("selected");}
            out.write(">相似于(like)</option>\r\n                       <option value=\"");
            out.print(OPR_NOTLIKE );
            out.write('"');
            out.write(' ');
if(oprate.equals("not like")){ out.print("selected");}
            out.write(">不相似于(not like)</option> \r\n                     </select>\r\n                     <input type=\"text\" name=\"oprateValue\" size=\"16\" value=\"");
            out.print(oprateValue );
            out.write("\">\r\n                     <input type=\"text\" name=\"rightTag\" id=\"rightTag\" size=\"3\" value=\")\">\r\n                     <select name=\"nextTag\" id=\"nextTag\" onchange=\"showNextRow(this)\">\r\n                     \t<option value=\"0\"></option>\r\n                     \t<option value=\"1\">并且</option>\r\n                     \t<option value=\"2\">或者</opton>\r\n                     </select>\r\n                 </td>\r\n                 <td></td>\r\n                 <td></td>\r\n               </tr>\r\n               ");

               }else{
            	   //有设置多个条件组合
            	   String leftTag,fieldName,rightTag,nextTag;
                   String fieldNameValue;
                   
            	   String[] exps=expression.split("\\@\\$\\@");
                   for(int i=0;i<exps.length;i++){
                		if(!"".equals(exps[i])){
                			String expTemp=exps[i]; //($:$jst_3331_f3334$:$>$:$234$:$)$:$0
                			
                			leftTag=expTemp.substring(0,expTemp.indexOf("$:$"));
                			expTemp=expTemp.substring(expTemp.indexOf("$:$")+3);
                			
                			fieldName=expTemp.substring(0,expTemp.indexOf("$:$"));
                			expTemp=expTemp.substring(expTemp.indexOf("$:$")+3);
                			
                			oprate=expTemp.substring(0,expTemp.indexOf("$:$"));
                			expTemp=expTemp.substring(expTemp.indexOf("$:$")+3);
                			
                			oprateValue=expTemp.substring(0,expTemp.indexOf("$:$"));
                			expTemp=expTemp.substring(expTemp.indexOf("$:$")+3);
                			
                			rightTag=expTemp.substring(0,expTemp.indexOf("$:$"));
                			
                			nextTag=expTemp.substring(expTemp.indexOf("$:$")+3);
                			
               
            out.write("\r\n               <tr>\r\n                 <td>\r\n                   <input type=\"text\" name=\"leftTag\" id=\"leftTag\" size=\"3\" value=\"");
            out.print(leftTag );
            out.write("\">\r\n                   <select name=\"fieldId\" onchange=\"changeField(this)\">\r\n\t\t\t\t\t\t<option value=\"-1\" ");
if(fieldName.equals("-1")) out.print("selected");
            out.write(">发起人职务</option>\r\n\t\t\t\t\t\t<option value=\"-2\" ");
if(fieldName.equals("-2")) out.print("selected");
            out.write(">发起人职务级别</option>\r\n\t\t\t\t\t\t<option value=\"-4\" ");
if(fieldName.equals("-4")) out.print("selected");
            out.write(">发起人角色</option>\r\n\t\t\t\t\t\t<option value=\"-5\" ");
if(fieldName.equals("-5")) out.print("selected");
            out.write(">发起人岗位</option>\r\n\t\t\t\t\t\t<option value=\"-3\" ");
if(fieldName.equals("-3")) out.print("selected");
            out.write(">上一节点办理人职务级别</option>\r\n\t\t\t\t\t\t<option value=\"-6\" ");
if(fieldName.equals("-6")) out.print("selected");
            out.write(">上一节点办理人角色</option>\t\t\t\t\r\n\t\t\t\t\t\t<option value=\"-7\" ");
if(fieldName.equals("-7")) out.print("selected");
            out.write(">上一节点办理人岗位</option>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t");
						
						for(int j = 0; j < fieldList.size(); j ++ ){
							  fieldVO = (SimpleFieldVO) fieldList.get(j);
						if("9".equals(request.getParameter("tableId")) || "2794".equals(request.getParameter("tableId"))){
            out.write("\r\n\t\t\t\t\t\t   <option value=\"");
            out.print(fieldVO.getId());
            out.write(',');
            out.print(fieldVO.getPoField() );
            out.write('"');
            out.write(' ');
if((fieldVO.getPoField() + "").equals(fieldName)) out.print("selected");
            out.write('>');
            out.print(fieldVO.getDisplayName());
            out.write("</option>\r\n\t\t\t\t\t\t");
}else{
            out.write("\r\n\t\t\t\t\t\t <option value=\"");
            out.print(fieldVO.getId());
            out.write(',');
            out.print(fieldVO.getRealName() );
            out.write('"');
            out.write(' ');
if((fieldVO.getRealName() + "").equals(fieldName)) out.print("selected");
            out.write('>');
            out.print(fieldVO.getDisplayName());
            out.write("</option>\r\n\t\t\t\t\t\t");
}}
            out.write("\r\n\t\t\t\t\t\t<option value=\"0\" ");
if(fieldName.equals("0")) out.print("selected");
            out.write(">无条件</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t\t<select name=\"oprate\">\r\n\t\t\t\t\t   <option value=\"");
            out.print(OPR_LT );
            out.write('"');
            out.write(' ');
if(oprate.equals("<")) {out.print("selected");}
            out.write(">小于(&lt;)</option>\r\n                       <option value=\"");
            out.print(OPR_LTOREQ );
            out.write('"');
            out.write(' ');
if(oprate.equals("<=")){ out.print("selected");}
            out.write(">不大于(&lt;=)</option>\r\n                       <option value=\"");
            out.print(OPR_NOTEQ );
            out.write('"');
            out.write(' ');
if(oprate.equals("<>")){ out.print("selected");}
            out.write(">不等于(≠)</option>\r\n                       <option value=\"");
            out.print(OPR_EQ );
            out.write('"');
            out.write(' ');
if(oprate.equals("=")){ out.print("selected");}
            out.write(">等于(=)</option>\r\n                       <option value=\"");
            out.print(OPR_GT );
            out.write('"');
            out.write(' ');
if(oprate.equals(">")){ out.print("selected");}
            out.write(">大于(&gt;)</option>\r\n                       <option value=\"");
            out.print(OPR_GTOREQ );
            out.write('"');
            out.write(' ');
if(oprate.equals(">=")){ out.print("selected");}
            out.write(">不小于(&gt;=)</option>\r\n                       <option value=\"");
            out.print(OPR_LIKE );
            out.write('"');
            out.write(' ');
if(oprate.equals("like")){ out.print("selected");}
            out.write(">相似于(like)</option>\r\n                       <option value=\"");
            out.print(OPR_NOTLIKE );
            out.write('"');
            out.write(' ');
if(oprate.equals("not like")){ out.print("selected");}
            out.write(">不相似于(not like)</option> \r\n                     </select>\r\n                     <input type=\"text\" name=\"oprateValue\" size=\"16\" value=\"");
            out.print(oprateValue );
            out.write("\">\r\n                     <input type=\"text\" name=\"rightTag\" id=\"rightTag\" size=\"3\" value=\"");
            out.print(rightTag );
            out.write("\">\r\n                     <select name=\"nextTag\" id=\"nextTag\" onchange=\"showNextRow(this)\">\r\n                     \t<option value=\"0\"></option>\r\n                     \t<option value=\"1\" ");
if("1".equals(nextTag)){ out.print("selected");} 
            out.write(">并且</option>\r\n                     \t<option value=\"2\" ");
if("2".equals(nextTag)){ out.print("selected");} 
            out.write(">或者</opton>\r\n                     </select>\r\n                     ");

                     if(i>0){
                    	 
            out.write("\r\n                    \t <img src=\"/jsoa/images/del.gif\" name=\"deleteImg\" id=\"deleteImg\" onclick=\"deleteRow(this)\">\r\n                    \t ");

                     }
                     
            out.write("\r\n                 </td>\r\n                 <td></td>\r\n                 <td></td>\r\n               </tr>\r\n               ");
       }// end of if?(!""
                	}// end of for(int 
               }//end of 有设置多个条件组合
               
            out.write("\r\n             </table>\r\n            \r\n          </td>\r\n\t\t</tr>\r\n\t\t");
}else{ 
            out.write("\r\n\t\t<tr>\r\n\t\t  <td>节点顺序：</td>\t\t\t   \r\n          <td colspan=\"2\" width=\"90%\">\r\n          \t<input type=\"text\" name=\"lineOrder\" id=\"lineOrder\" value=\"");
            out.print(lineOrder);
            out.write("\"> <font color=\"green\">数字越小，排序越靠前</font>  \r\n          </td>\r\n        </tr>\r\n\t\t<tr>\r\n\t\t  <td>转移条件：</td>\t\t\t   \r\n          <td colspan=\"2\" width=\"90%\">\r\n             流程走向由用户决定！\r\n          </td>\r\n        </tr>\r\n        ");
} 
            out.write("\r\n\t\t<tr ");
if(("2".equals(fromClass) || "0".equals(fromType)) && !"1".equals(fromIsBranch)){}else{
            out.write(" style=\"display:none\"");
} 
            out.write(">\r\n\t\t  <td valign=\"top\">条件描述：</td>\r\n\t\t  <td colspan=2>\r\n           <textarea name=\"relationDesc\" id=\"relationDesc\" style=\"width:400px;\" rows=4>");
            out.print(relationDesc );
            out.write("</textarea>\r\n          </td>\r\n\t\t</tr>\r\n\t\t\r\n\t\t\r\n                <tr>\r\n                    <td height=\"20\">&nbsp;</td>\r\n                </tr>\r\n\t\t</form>\r\n\t</table>\r\n\t<table>\r\n\t\t<tr>\r\n\t\t\t<td colspan=\"2\">\r\n\t\t\t\t<input type=\"button\" class=\"btnButton2font\" onclick=\"submitForm();\" value=\" 确 定  \" />\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n</tr>\r\n</table>\r\n</td></tr></table>\r\n</body>\r\n");
            int evalDoAfterBody = _jspx_th_html_005fhtml_005f0.doAfterBody();
            if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
              break;
          } while (true);
        }
        if (_jspx_th_html_005fhtml_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
          return;
        }
        _005fjspx_005ftagPool_005fhtml_005fhtml.reuse(_jspx_th_html_005fhtml_005f0);
        _jspx_th_html_005fhtml_005f0_reused = true;
      } finally {
        org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_html_005fhtml_005f0, _jsp_getInstanceManager(), _jspx_th_html_005fhtml_005f0_reused);
      }
      out.write("\r\n<script>\r\nfunction submitForm(){   \r\n      /*if(document.all.oprateValue.value==''){\r\n         alert(\"请设置条件！\");\r\n         document.all.oprateValue.focus();\r\n         return false;\r\n      }\r\n      \r\n      if(document.all.relationDesc.value==\"\"){\r\n      \tvar fieldObj=document.all.fieldId;\r\n      \tvar oprObj=document.all.oprate;\r\n      \tvar str=fieldObj.options[fieldObj.selectedIndex].text;      \t\r\n      \tstr+=oprObj.options[oprObj.selectedIndex].text;\r\n      \tstr+=document.all.oprateValue.value;\r\n      \tdocument.all.relationDesc.value=str;\r\n      \t\r\n      }*/\r\n      \r\n      var oprateValueObj=document.getElementsByName(\"oprateValue\");\r\n      \r\n      if(oprateValueObj!=null && oprateValueObj.length>0){\r\n      \t  //将条件组合成条件串      \r\n\t      var expression=\"\";\r\n\t      var leftTagObj=document.getElementsByName(\"leftTag\");\r\n\t      var fieldIdObj=document.getElementsByName(\"fieldId\");\r\n\t      var oprateObj=document.getElementsByName(\"oprate\");\t      \r\n\t      var rightTagObj=document.getElementsByName(\"rightTag\");\r\n\t      var nextTagObj=document.getElementsByName(\"nextTag\");\r\n");
      out.write("\t      var isNeedSetOprateValue = \"0\";\r\n\t      var i=0;\r\n\t      for(i=0;i<oprateValueObj.length;i++){\r\n\t         if(oprateValueObj[i].value == \"\"){\r\n\t            isNeedSetOprateValue = \"1\";\r\n\t            break;\r\n\t         }\r\n\t      }\r\n\t      if(isNeedSetOprateValue==\"1\"){\r\n\t      \talert(\"请设置条件!\");\r\n\t      }else{\r\n\t      \t  var descStr=\"\";\r\n\t\t      var rows=leftTagObj.length; \r\n\t\t      var fieldRealName;   \r\n\t\t      for(var i=0;i<rows;i++){\r\n\t\t      \tfieldRealName=fieldIdObj[i].value;\r\n\t\t      \tif(fieldRealName.lastIndexOf(\",\")>0){\r\n\t\t\t    \tfieldRealName=fieldRealName.substring(fieldRealName.lastIndexOf(\",\")+1);\r\n\t\t\t    }\r\n\t\t      \t\r\n\t\t      \texpression+=leftTagObj[i].value;\r\n\t\t      \texpression+=\"$:$\"+fieldRealName;\r\n\t\t      \texpression+=\"$:$\"+oprateObj[i].value;      \t\r\n\t\t      \texpression+=\"$:$\"+oprateValueObj[i].value;\r\n\t\t      \texpression+=\"$:$\"+rightTagObj[i].value;\r\n\t\t      \texpression+=\"$:$\"+nextTagObj[i].value;\t\t      \t\r\n\t\t      \texpression+=\"@$@\";\t\t\r\n\t\t      \t\r\n\t\t      \tdescStr+=fieldIdObj[i].options[fieldIdObj[i].selectedIndex].text;\r\n");
      out.write("\t\t      \tdescStr+=oprateObj[i].options[oprateObj[i].selectedIndex].text;\r\n\t\t      \tdescStr+=oprateValueObj[i].value;\r\n\t\t      \tif(nextTagObj[i].value!=\"0\"){\r\n\t\t      \t\tdescStr+=\" \"+nextTagObj[i].options[nextTagObj[i].selectedIndex].text+\" \";\r\n\t\t      \t}\r\n\t\t      \t      \t\r\n\t\t      }\r\n\t\t      \r\n\t\t      document.all.expression.value=expression;\r\n\t\t      \r\n\t\t      if(document.all.relationDesc.value==\"\"){\t\t      \t\r\n\t\t      \tif(descStr.length>100){\r\n\t\t      \t\tdescStr=descStr.substring(0,100);\r\n\t\t      \t}\r\n\t\t      \tdocument.all.relationDesc.value=descStr;\r\n\t\t      }\t\r\n\t\t      document.all.frm.submit();\t      \r\n\t      }\r\n      }else{\r\n            document.all.frm.submit();\r\n      }\r\n         \r\n}\r\nfunction showNextRow(obj){\r\n\t//判断当前行下面是否有数据，若没有则添加一行\r\n\tvar eles=document.getElementsByName(obj.name);\r\n\tvar fieldIndex=0;\r\n\tfor(var i=0;i<eles.length;i++){\r\n\t\tif(eles[i]==obj){\r\n\t\t\tfieldIndex=i;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif(fieldIndex==(eles.length-1)){\t\r\n\t\tif(obj.value==1 || obj.value==2){\r\n\t\t\tinsertFieldRow();\r\n\t\t}\r\n\t}\r\n}\r\nfunction insertFieldRow(){\r\n");
      out.write("\tvar tableObj = document.getElementById(\"transTable\");\r\n\tvar tableObj = tableObj.insertRow(tableObj.rows.length);\r\n\t\r\n    var fieldCell=tableObj.insertCell(0);\r\n  \r\n    var html=\"<input type=\\\"text\\\" name=\\\"leftTag\\\" id=\\\"leftTag\\\" size=\\\"3\\\" value=\\\"(\\\">\\n\";\r\n   \r\n    html+=getFieldIdHTML()+\"\\n\";   \r\n    html+=getOprateHTML()+\"\\n\";   \r\n   \r\n    html+=\"<input type=\\\"text\\\" name=\\\"oprateValue\\\" size=\\\"16\\\" value=\\\"");
      out.print(oprateValue );
      out.write("\\\">\"+\"\\n\";   \r\n    html+=\"<input type=\\\"text\\\" name=\\\"rightTag\\\" id=\\\"rightTag\\\" size=\\\"3\\\" value=\\\")\\\">\"+\"\\n\";   \r\n    html+=\"<select name=\\\"nextTag\\\" id=\\\"nextTag\\\" onchange=\\\"showNextRow(this)\\\">\";\r\n    html+=\"<option value=\\\"0\\\"></option>\";\r\n    html+=\"<option value=\\\"1\\\">并且</option>\";\r\n    html+=\"<option value=\\\"2\\\">或者</option>\";\r\n    html+=\"</select>\"+\"\\n\";\r\n    \r\n    html+=\"<img src=\\\"/jsoa/images/del.gif\\\" name=\\\"deleteImg\\\" id=\\\"deleteImg\\\" onclick=\\\"deleteRow(this)\\\">\";\r\n   \r\n    fieldCell.innerHTML=html;\r\n\t\r\n\t\t\t\r\n}\r\nfunction getFieldIdHTML(){\r\n\tvar str=\"<select name=\\\"fieldId\\\" id=\\\"fieldId\\\" onchange=\\\"changeField(this)\\\">\";\r\n\tvar oSelectObject=document.getElementById(\"fieldIdTemp\");\t\r\n\t\r\n\tfor(var i=0; i<oSelectObject.options.length; i++){\r\n\t\tstr+=\"<option value=\\\"\";\r\n\t\tstr+=oSelectObject.options[i].value+\"\\\"\";\r\n\t\tif(oSelectObject.options[i].selected){\r\n\t\t\tstr+=\" selected\";\r\n\t\t}\r\n\t\tstr+=\">\";\r\n\t\tstr+=oSelectObject.options[i].text;\r\n\t\tstr+=\"</option>\";\r\n\t}\t\r\n\tstr+=\"</select>\";\r\n\treturn str;\r\n}\r\nfunction getOprateHTML(){\r\n");
      out.write("\tvar str=\"<select name=\\\"oprate\\\" id=\\\"oprate\\\" onchange=\\\"changeField(this)\\\">\";\r\n\tvar oSelectObject=document.getElementById(\"oprateTemp\");\r\n\tfor(var i=0; i<oSelectObject.options.length; i++){\r\n\t\tstr+=\"<option value=\\\"\";\r\n\t\tstr+=oSelectObject.options[i].value+\"\\\"\";\r\n\t\tif(oSelectObject.options[i].selected){\r\n\t\t\tstr+=\" selected\";\r\n\t\t}\r\n\t\tstr+=\">\";\r\n\t\tstr+=oSelectObject.options[i].text;\r\n\t\tstr+=\"</option>\";\r\n\t}\r\n\tstr+=\"</select>\";\r\n\treturn str;\r\n}\r\nfunction getCellFieldType(){\r\n\tvar str=\"<select name=fieldType style=\\\"width:100%;\\\" onchange=\\\"changeFieldType(this)\\\">\";\r\n\tvar oSelectObject=document.all.fieldTypeTmp;\r\n\tfor(var i=0; i<oSelectObject.options.length; i++){\r\n\t\tstr+=\"<option value=\";\r\n\t\tstr+=oSelectObject.options[i].value;\r\n\t\tif(oSelectObject.options[i].selected){\r\n\t\t\tstr+=\" selected\";\r\n\t\t}\r\n\t\tstr+=\">\";\r\n\t\tstr+=oSelectObject.options[i].text;\r\n\t\tstr+=\"</option>\";\r\n\t}\r\n\r\n\tstr+=\"</select>\";\r\n\treturn str;\r\n}\r\nfunction deleteRow(obj){\r\n\tvar tableObj = document.getElementById(\"transTable\");\t\r\n\tvar eles=document.getElementsByName(obj.name);\r\n");
      out.write("\t//整个表格的行数\r\n\tvar tableRows=tableObj.rows.length;\t\r\n\t\r\n\t//计算当前是第几行\r\n\tvar rowIndex=0;\r\n\tfor(var i=0;i<eles.length;i++){\r\n\t\tif(eles[i]==obj){\r\n\t\t\trowIndex=i;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\trowIndex+=2;\r\n\t\r\n\tif(rowIndex==tableRows){\r\n\t\t//删除最后一行\r\n\t\ttableObj.deleteRow(rowIndex-1);\r\n\t\t//倒数第二行的逻辑运算为空\r\n\t\tvar ele=document.getElementsByName(\"nextTag\");\t\t\r\n\t\tele[tableRows-2].value=\"0\";\r\n\t\t\r\n\t}else{\r\n\t\ttableObj.deleteRow(rowIndex-1);\r\n\t}\r\n\t\r\n}\r\n</script>\r\n<script src=\"/jsoa/js/util.js\"></script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
