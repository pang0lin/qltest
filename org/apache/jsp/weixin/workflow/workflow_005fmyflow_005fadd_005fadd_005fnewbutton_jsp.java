/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 09:59:16 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.weixin.workflow;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.sql.*;
import java.util.*;
import java.text.*;
import java.io.*;
import java.lang.*;
import com.js.lang.Resource;
import com.js.oa.jsflow.service.WorkFlowBD;
import com.js.oa.jsflow.util.NewWorkflowUtil;
import java.util.List;
import com.js.oa.userdb.service.CustomDatabaseBD;
import com.js.oa.eform.service.CustomFormBD;
import com.js.util.config.SystemCommon;
import java.util.Calendar;
import java.util.Set;
import java.util.Map;
import com.js.lang.Resource;
import com.js.util.util.BrowserJudge;

public final class workflow_005fmyflow_005fadd_005fadd_005fnewbutton_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {


private String dealWithColorCode(String html){
	int s = -1, e = -1;
	String temp = html, bgcolor = "", color = "";
	String[] colors = null;
	s = temp.indexOf("rgb(");
	while(s > -1){
		// 截取img标签
		temp = temp.substring(s + 4);
		e = temp.indexOf(")");
		bgcolor = temp.substring(0, e);
		colors = bgcolor.split(",");
		for(int i=0; i<colors.length; i++){
			color += Integer.toHexString(Integer.parseInt(colors[i].trim()));
		}
		
		if(!"".equals(color)){
			html = html.replace("rgb(" + bgcolor + ")", "#" + color);
			color = "";
		}
		s = temp.indexOf("rgb(");
	}
	return html;
}

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(9);
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-nested.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/weixin/public/cmdbuttonnewForWeiXin.jsp", Long.valueOf(1499751472000L));
    _jspx_dependants.put("/weixin/workflow/eform/showform.jsp", Long.valueOf(1499751476000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-tiles.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-logic.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-html.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/weixin/workflow/workflow_include_firstHidden.jsp", Long.valueOf(1499751476000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-template.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-bean.tld", Long.valueOf(1499751390000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("java.sql");
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("java.util");
    _jspx_imports_packages.add("java.text");
    _jspx_imports_packages.add("java.lang");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("java.io");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.oa.jsflow.util.NewWorkflowUtil");
    _jspx_imports_classes.add("com.js.lang.Resource");
    _jspx_imports_classes.add("java.util.List");
    _jspx_imports_classes.add("com.js.oa.eform.service.CustomFormBD");
    _jspx_imports_classes.add("java.util.Calendar");
    _jspx_imports_classes.add("com.js.util.config.SystemCommon");
    _jspx_imports_classes.add("java.util.Map");
    _jspx_imports_classes.add("com.js.oa.userdb.service.CustomDatabaseBD");
    _jspx_imports_classes.add("java.util.Set");
    _jspx_imports_classes.add("com.js.util.util.BrowserJudge");
    _jspx_imports_classes.add("com.js.oa.jsflow.service.WorkFlowBD");
  }

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fhtml_005fhtml;
  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fbean_005fwrite_0026_005fproperty_005fname_005fnobody;
  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fhtml_005fhtml = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
    _005fjspx_005ftagPool_005fbean_005fwrite_0026_005fproperty_005fname_005fnobody = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
    _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fhtml_005fhtml.release();
    _005fjspx_005ftagPool_005fbean_005fwrite_0026_005fproperty_005fname_005fnobody.release();
    _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=utf-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			"/public/jsp/error.jsp", true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n");
      //  html:html
      org.apache.struts.taglib.html.HtmlTag _jspx_th_html_005fhtml_005f0 = (org.apache.struts.taglib.html.HtmlTag) _005fjspx_005ftagPool_005fhtml_005fhtml.get(org.apache.struts.taglib.html.HtmlTag.class);
      boolean _jspx_th_html_005fhtml_005f0_reused = false;
      try {
        _jspx_th_html_005fhtml_005f0.setPageContext(_jspx_page_context);
        _jspx_th_html_005fhtml_005f0.setParent(null);
        int _jspx_eval_html_005fhtml_005f0 = _jspx_th_html_005fhtml_005f0.doStartTag();
        if (_jspx_eval_html_005fhtml_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
          do {
            out.write("\r\n<head>\r\n<title>");
            if (_jspx_meth_bean_005fwrite_005f0(_jspx_th_html_005fhtml_005f0, _jspx_page_context))
              return;
            out.write("</title>\r\n<link href=\"/jsoa/skin/");
            out.print(session.getAttribute("skin"));
            out.write("/style-");
            out.print(session.getAttribute("browserVersion"));
            out.write(".css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<script src=\"/jsoa/js/js.js\" language=\"javascript\"></script>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"public/date_picker/DateObject2.css\">\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/DateObject.js\"></SCRIPT>\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/DatePicker.js\"></SCRIPT>\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/editlib.js\"></SCRIPT>\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/tree.js\"></SCRIPT>\r\n<script language=\"javascript\" src=\"js/openEndow.js\"></script>\r\n<script language=\"javascript\" src=\"js/checkForm.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/eform/datetime/datetime_check.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/eform/datetime/datetime_select.js\"></script>\r\n\r\n<script src=\"/jsoa/js/toolbar/standardAdd.js\" language=\"javascript\"></script>\r\n<script src=\"/jsoa/js/clsPullXMenu.js\" language=\"javascript\"></script>\r\n<!--script src=\"/jsoa/public/jsp/cmdbuttonnew.jsp?button=Close,Send\"></script//-->\r\n");
            out.write("<!--\r\n工具栏调用方式\r\n/jsoa/public/jsp/cmdbutton.jsp?button=close,send,end,save,toreceive,toselfdept,back,undo,wait,feedback,return,tran,delete,print,writetext,readtext,viewtext,textmanager,imptext,savefile,viewacc,manageracc,printcomm,document,code,selfsend,addperson\r\n-->\r\n\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"><style type=\"text/css\">\r\n<!--\r\nbody {\r\n\tmargin-left: 0px;\r\n\tmargin-top: 0px;\r\n}\r\n-->\r\n</style></head>\r\n");

	//System.out.print("\n------------------\n");
	//System.out.println(request.getAttribute("formType"));
	//System.out.println(request.getRequestURI());
	//System.out.print("\n------------------\n");
	if(request.getAttribute("formType")!=null && "1".equals(request.getAttribute("formType").toString().trim())){//使用用户上传JSP文件
		request.setCharacterEncoding("gb2312");
		if(request.getAttribute("jspFile")!=null && !"NULL".equals(request.getAttribute("jspFile").toString().toUpperCase()))
			response.sendRedirect("/jsoa/jsflow/"+request.getAttribute("jspFile").toString()+"?processId="+request.getParameter("processId")+"&processType="+request.getParameter("processType")+"&tableId="+request.getParameter("tableId")+"&processName="+request.getParameter("processName")+"&moduleId="+request.getParameter("moduleId"));
		else{
			out.print("<SCRIPT LANGUAGE=\"JavaScript\">alert(\"请先设置流程使用JSP文件\");window.close();</SCRIPT>");
		}
	}else{//使用自定义表单

            out.write("\r\n\r\n");
if(request.getParameter("close") != null){

            out.write("\r\n<script language=\"javascript\">\r\n");

if(request.getAttribute("submitFailed") != null){
            out.write("\r\nalert(\"没有办理用户！\");\r\n");
}
            out.write("\r\nwindow.close();\r\n</script>\r\n");

}else{
            out.write("\r\n<script language=\"javascript\">\r\nfunction changePanle(flag){\r\n    if(flag == 0) {\r\n        Panle0.style.color = \"red\";\r\n        Panle1.style.color = \"black\";\r\n        docinfo0.style.display = \"\";\r\n        docinfo1.style.display = \"none\";\r\n    }else if(flag == 1) {\r\n        Panle0.style.color = \"black\";\r\n        Panle1.style.color = \"red\";\r\n        docinfo0.style.display = \"none\";\r\n        docinfo1.style.display = \"\";\r\n\t\tdocument.all.flowimg.src=\"/jsoa/jsflow/jsflow_view.jsp?processId=");
            out.print(request.getParameter("processId"));
            out.write("&table=");
            out.print(request.getParameter("table"));
            out.write("&record=");
            out.print(request.getParameter("record"));
            out.write("&CurActivityID=&ActivityIDStr=\";\r\n    }\r\n}\r\n</script>\r\n<body onLoad=\"init();resizeWin(800,630);loadMenu();\" onResize=\"loadMenu();\" class=\"MainFrameBox PupwinForFlow\" scroll=\"no\">\r\n<table width=\"100%\" height=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n  <tr>\r\n    <td height=\"27\" id=\"popToolbar\">\r\n\t<div id=\"btnMoveLeft\" style=\"float:left;\" onclick=\"menuMoveLeft();\"><img src='/jsoa/images/toolbar/more.gif' align='top' class=\"cmdButtonIco\" style='width:21px;'></div>\r\n\t<div id=\"cmdBarFrame\" style=\"width:100px;float:left;overflow:hidden;\">\r\n\t    <div id=\"cmdBarFrame\" style=\"width:3000px;\">\r\n\t\t\t<div id=\"commandBar\" style=\"float:left;\">\r\n\t\t\t");

			String strButton="Close,Send";
			
            out.write("\r\n\t\t\t");
            out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<script>\r\n\r\nfunction setMoveButton(){\t\r\n\tvar m=document.getElementById(\"cmdBarFrame\");\r\n\tvar mW=document.getElementById(\"commandBar\").offsetWidth-m.offsetWidth;\r\n\tvar sW=m.scrollLeft;\r\n\tif(sW <= 0){\r\n\t\t//document.all.btnMoveLeft.style.filter=\"gray()\";\r\n\t\tdocument.all.btnMoveLeft.style.visibility =\"hidden\";\r\n\t}else{\r\n\t\t//document.all.btnMoveLeft.style.filter=\"\";\r\n\t\tdocument.all.btnMoveLeft.style.visibility =\"visible\";\r\n\t}\r\n\r\n\tif(sW<mW){\r\n\t\t//document.all.btnMoveRight.style.filter=\"\";\r\n\t\tdocument.all.btnMoveRight.style.visibility =\"visible\";\r\n\t}else{\r\n\t\t//document.all.btnMoveRight.style.filter=\"gray()\";\r\n\t\tdocument.all.btnMoveRight.style.visibility =\"hidden\";\r\n\t}\r\n} \r\n\r\nfunction menuMoveRight(){\r\n\tvar m=document.getElementById(\"cmdBarFrame\");\r\n\tvar mW=document.getElementById(\"commandBar\").offsetWidth-m.offsetWidth;\r\n\tvar sW=m.scrollLeft;\r\n\r\n\tif(sW<mW){\r\n        sW+=200;\r\n\t}\r\n    if(sW>mW){\r\n\t\tsW=mW\r\n\t}\r\n\tm.scrollLeft=sW;\r\n\tsetMoveButton();\r\n}\r\n\r\nfunction menuMoveLeft(){\r\n\tvar m=document.getElementById(\"cmdBarFrame\");\r\n");
            out.write("\tvar mW=0;\r\n\tvar sW=m.scrollLeft;\r\n\tif(sW>mW){\r\n        sW-=200;\r\n\t}\r\n    if(sW<mW){sW=mW}\r\n\tm.scrollLeft=sW;\r\n\tsetMoveButton();\r\n}\r\n\r\n\r\nfunction loadMenu(){\r\n\tvar w=document.body.offsetWidth;\r\n\tvar m=document.getElementById(\"cmdBarFrame\");\r\n\tm.style.width=(w-80)+\"px\";\r\n\tsetMoveButton();\r\n}\r\nfunction execCmd(strCmd){\r\n\t\tif (strCmd.indexOf(\"link:\") == 0){\r\n\t\t\twindow.location.href = strCmd.substr(5);\r\n\t\t}else {\r\n\t\t\tif (strCmd.indexOf(\"js:\") == 0) {\r\n\t\t\t\teval(strCmd.substr(3));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\twindow.location.href = strCmd;\r\n\t\t\t}\r\n\t\t}\r\n}\r\n</script>\r\n\r\n\r\n");

String localcmd = session.getAttribute("org.apache.struts.action.LOCALE").toString();

            out.write("\r\n\r\n");

String strButton=request.getParameter("button");
if(strButton!=null && strButton.trim().length()>0){
	String[] cmdButtons=strButton.split(",");

	Hashtable buttons = new Hashtable();
	//æ ¼å¼ï¼ææ¬,è¯´æ,å¾æ ,æ¯å¦ææ,å®½åº¦,å¨ä½
	buttons.put("Close",Resource.getValue(localcmd,"filetransact","file.close")+","+Resource.getValue(localcmd,"filetransact","file.close")+",/jsoa/images/toolbar/close.gif,true,10,js:cmdClose()");
	buttons.put("Send",Resource.getValue(localcmd,"filetransact","file.send")+","+Resource.getValue(localcmd,"filetransact","file.send")+",/jsoa/images/toolbar/send.gif,true,10,js:cmdSend()");
	buttons.put("End",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonend")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonend")+",/jsoa/images/toolbar/end.gif,true,10,js:cmdEnd()");
	buttons.put("EndAutoReturn",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonend")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonend")+",/jsoa/images/toolbar/end.gif,true,10,js:cmdEndAutoReturn()");
	buttons.put("EndOnlyComp",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonend")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonend")+",/jsoa/images/toolbar/end.gif,true,10,js:cmdEndOnlyComp()");
	buttons.put("Save","ä¿å­èç¨¿,ä¿å­èç¨¿,/jsoa/images/toolbar/save.gif,true,10,js:cmdSave()");
	buttons.put("SaveFirst",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonsavefirst")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonsavefirst")+",/jsoa/images/toolbar/end.gif,true,10,js:cmdSaveFirst()");
	buttons.put("Toreceive","è½¬æ¶æ,è½¬æ¶æ,/jsoa/images/toolbar/toreceive.gif,true,10,js:cmdToreceive()");
	buttons.put("Toselfdept","è½¬æ¬é¨é¨,è½¬æ¬é¨é¨,/jsoa/images/toolbar/toselfdept.gif,true,10,js:cmdToselfdept()");
	buttons.put("Back",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonback")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonback")+",/jsoa/images/toolbar/back.gif,true,10,js:cmdBack()");
	buttons.put("Undo",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonundo")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonundo")+",/jsoa/images/toolbar/undo.gif,true,10,js:cmdUndo()");
	buttons.put("Wait",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonwait")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonwait")+",/jsoa/images/toolbar/wait.gif,true,10,js:cmdWait()");
	buttons.put("Feedback",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonfeedback")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonfeedback")+",/jsoa/images/toolbar/feedback.gif,true,10,js:cmdFeedback()");
	buttons.put("Return",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonreturn")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonreturn")+",/jsoa/images/toolbar/return.gif,true,10,js:cmdReturn()");
	buttons.put("Tran",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttontran")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttontran")+",/jsoa/images/toolbar/tran.gif,true,10,js:cmdTran()");
	buttons.put("Delete",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttondelete")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttondelete")+",/jsoa/images/toolbar/delete.gif,true,10,js:cmdDelete()");
	buttons.put("Print",Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonprint")+","+Resource.getValue(localcmd,"workflow","workflow.newactivitybuttonprint")+",/jsoa/images/toolbar/print.gif,true,10,js:cmdPrint()");

	buttons.put("Writetext","èµ·èæ­£æ,èµ·èæ­£æ,/jsoa/images/toolbar/writetext.gif,true,10,js:cmdWritetext()");
	buttons.put("Readtext","æ¹éæ­£æ,æ¹éæ­£æ,/jsoa/images/toolbar/readtext.gif,true,10,js:cmdReadtext()");
	buttons.put("Viewtext","æ¥çæ­£æ,æ¥çæ­£æ,/jsoa/images/toolbar/viewtext.gif,true,10,js:cmdViewtext()");
	buttons.put("Textmanager","æ­£æç®¡ç,æ­£æç®¡ç,/jsoa/images/toolbar/textmanager.gif,true,10,js:cmdTextmanager()");
	buttons.put("Imptext","å¼å¥æ­£æ,å¼å¥æ­£æ,/jsoa/images/toolbar/imptext.gif,true,10,js:cmdImptext()");
    buttons.put("Savefile","çææ­£å¼æä»¶,çææ­£å¼æä»¶,/jsoa/images/toolbar/savefile.gif,true,10,js:cmdSavefile()");
	buttons.put("Viewacc","æ¥çéä»¶,æ¥çéä»¶,/jsoa/images/toolbar/viewacc.gif,true,10,js:cmdViewacc()");
	buttons.put("Manageracc","éä»¶ç®¡ç,éä»¶ç®¡ç,/jsoa/images/toolbar/manageracc.gif,true,10,js:cmdManageracc()");
	buttons.put("Printcomm","æå°éåå,æå°éåå,/jsoa/images/toolbar/printcomm.gif,true,10,js:cmdPrintcomm()");
	buttons.put("Document","å½æ¡£,å½æ¡£,/jsoa/images/toolbar/document.gif,true,10,js:cmdDocument()");
	buttons.put("Code","ç¼å·,ç¼å·,/jsoa/images/toolbar/code.gif,true,10,js:cmdCode()");
	buttons.put("Selfsend",Resource.getValue(localcmd,"filetransact","file.review")+","+Resource.getValue(localcmd,"filetransact","file.review")+",/jsoa/images/toolbar/selfsend.gif,true,10,js:cmdSelfsend()");
	buttons.put("Addperson","å¢å æ¹éäºº,å¢å æ¹éäºº,/jsoa/images/toolbar/addperson.gif,true,10,js:cmdAddperson()");
	buttons.put("DirectSend","ç´æ¥åé,ç´æ¥åé,/jsoa/images/toolbar/selfsend.gif,true,10,js:cmdDirectSend()");

    buttons.put("Viewread","æ¥çä¼ é,æ¥çä¼ é,/jsoa/images/toolbar/seeread.gif,true,10,js:cmdViewread()");

	buttons.put("Saveclose","ä¿å­éåº,ä¿å­éåº,/jsoa/images/toolbar/end.gif,true,10,js:cmdSaveclose()");
	buttons.put("Sendclose","åå,åå,/jsoa/images/toolbar/documentSend.gif,true,10,js:cmdSendclose()");
	buttons.put("Printtext","æå°æ­£æ,æå°æ­£æ,/jsoa/images/toolbar/printcomm.gif,true,10,js:cmdPrinttext()");

	int num=0;
	String[] cmdButton=null;
	for(int i=0;i<cmdButtons.length;i++){
		if(buttons.containsKey(cmdButtons[i])){
	      cmdButton=((String) buttons.get(cmdButtons[i])).split(",");


            out.write("\r\n   <div class=\"cmdMenu\" style=\"float:left\" onclick=\"execCmd('");
            out.print(cmdButton[5]);
            out.write("')\" onmouseover=\"this.className='cmdMenuOver'\" onmouseout=\"this.className='cmdMenu'\">\r\n      <SAPN title=\"");
            out.print(cmdButton[1]);
            out.write("\"><img src=\"");
            out.print(cmdButton[2]);
            out.write("\" align='top' class=\"cmdButtonIco\">");
            out.print(cmdButton[0]);
            out.write("</span>\r\n   </div>\r\n");

		}
	}

}

            out.write('\r');
            out.write('\n');
            out.write("\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div  id=\"btnMoveRight\"  style=\"float:right;\" onclick=\"menuMoveRight();\"><img src='/jsoa/images/toolbar/more.gif' align='top' class=\"cmdButtonIco\" style='width:21px;'></div>\r\n\t</td> \r\n  </tr>\r\n  <!--tr>\r\n    <td height=35 valign=\"bottom\">\r\n\t<table width=\"100%\" height=\"25\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"inlineBottomLine\">\r\n\t  <tr>\r\n\t\t<td>\r\n\t\t  <div id=\"Panle0\" class=\"btnBQselected AlignLeft\">基本信息</div>\r\n\r\n\t\t</td>\r\n\t  </tr>\r\n\t</table>\r\n\t</td>\r\n  </tr//--->\r\n  <tr>\r\n    <td style=\"padidng:1px;padding-top:0px;\">\r\n<table width=\"100%\" height=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n    <tr>\r\n        <td class=\"pannelWin\" valign=\"top\" align=\"center\">\r\n        <div style=\"height:100%;width:100%;padding:20px;\"  class=\"scrollBox\">\r\n<table width=\"99%\" height=\"99%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanelForFlow\">\r\n    <tr>\r\n       <td>\r\n   <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n       <tr>\r\n           <td></td>\r\n");
            out.write("           <td></td>\r\n           <td colspan=\"5\" height=\"25\">\r\n               <span id=\"Panle0\" onClick=\"changePanle(0);\" style=\"color:red;cursor:pointer\">");
            if (_jspx_meth_bean_005fmessage_005f0(_jspx_th_html_005fhtml_005f0, _jspx_page_context))
              return;
            out.write("</span> \r\n\t\t\t   ");

				if(!"0".equals(request.getParameter("processType"))){
			   
            out.write("\r\n                |\r\n\t\t\t\t<span id=\"Panle1\" onClick=\"changePanle(1);\" style=\"color:black;cursor:pointer;display:\">");
            if (_jspx_meth_bean_005fmessage_005f1(_jspx_th_html_005fhtml_005f0, _jspx_page_context))
              return;
            out.write("</span>\r\n\t\t\t   ");
}
            out.write("\r\n           </td>\r\n       </tr>\r\n       <tr>\r\n           <td width=\"25\" height=\"25\"></td>\r\n           <td width=\"25\" style=\"border-bottom:1px solid #aaaaaa;border-right:1px solid #aaaaaa;\"><br></td>\r\n           <td></td>\r\n           <td width=\"25\" style=\"border-bottom:1px solid #aaaaaa;border-left:1px solid #aaaaaa;\"><br></td>\r\n           <td width=\"25\"></td>\r\n       </tr>\r\n       <tr><td colspan=\"5\" height=\"15\"></td></tr>\r\n       <tr>\r\n           <td width=\"25\"></td>\r\n           <td width=\"25\"></td>\r\n           <td height=\"400\" valign=\"top\">\r\n           <div id=\"docinfo0\">\r\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n            <form name=\"WorkFlowFormActionForm\" action=\"/jsoa/JsFlowAddAction.do\" method=\"post\">\r\n                <input type=\"hidden\" name=\"myAction\">\r\n                <input type=\"hidden\" name=\"remindField\" value=\"");
            out.print(request.getAttribute("remindField"));
            out.write("\">\r\n                ");
if(request.getAttribute("formContent")!=null && request.getAttribute("formContent").toString().length()>0){
            out.write("\r\n                    <tr><td><table border=0>\r\n                    ");
            out.print(request.getAttribute("formContent"));
            out.write("\r\n                    </table></td></tr>\r\n                ");
}
            out.write("\r\n                ");

                String pageId =request.getAttribute("tableId").toString();//自定义表单ID
                request.setAttribute("hideField",request.getAttribute("noWriteField"));//发起时不填写字段
                
            out.write("\r\n                <tr><td>\r\n                    ");
            out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n");
            out.write("\r\n\r\n");

request.setCharacterEncoding("utf-8");
CustomFormBD cst = new CustomFormBD();
CustomDatabaseBD userDB = new CustomDatabaseBD();
String scriptappend = "";
String domainId = session.getAttribute("domainId")==null?"0":session.getAttribute("domainId").toString();
String parent_fromDraft="draftForm".equals(request.getParameter("action"))?"1":"0";
if("1".equals(request.getParameter("resubmit"))){
	parent_fromDraft="1";
}
String hideTableHTML = "";
String showTableHTML = "";
List boxFieldList = userDB.getOnchangeMethodInfo(pageId,domainId);

//读取隐藏字段（不可编辑字段）
String hide_Field = request.getAttribute("hideField")==null ? "" : request.getAttribute("hideField").toString();
String noDisplayFields="";
if(request.getAttribute("initActivity")!=null){
	noDisplayFields=new NewWorkflowUtil().getNoDisplayField(request.getAttribute("initActivity").toString(),request.getParameter("work"));
}else{
	if(request.getParameter("initActivity")!=null){
		noDisplayFields=new NewWorkflowUtil().getNoDisplayField(request.getParameter("initActivity").toString(),request.getParameter("work"));
	}else{
		//发起时去掉隐藏的字段
		noDisplayFields=new NewWorkflowUtil().getFirstActivityNoDisplayField(request.getParameter("processId"));
	}
	
}

            out.write("\r\n\r\n<style type=\"text/css\">\r\n.flowInput { behavior: url(/jsoa/js/validate.htc); /*border:1px solid #E8E8E8;*/}\r\n.flowInputRed { behavior: url(/jsoa/js/formvalidate.htc); /*border:1px solid #E8E8E8;*/}\r\n.flowInputenter { border: 1px solid blue;}\r\n.mustwrite { border: 1px solid red;}\r\n.divnowrap { meizz: expression(this.noWrap=true);}\r\n/*必填提醒颜色*/\r\n.mustFillcolor, .mustFillcolo:link, .mustFillcolo:hover { color:#FF0000; font-size:12px;}\r\n</style>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/jsoa/eform/ext/resources/css/ext-all-jiusi.css\"/>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/adapter/ext/ext-base.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/ext-all.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/js/ajax.js\"></script>\r\n<SCRIPT type=\"text/javascript\">\r\n// 必填的word和excel控件，添加默认的空白文档\r\nfunction getDocModel(field, fileType){\r\n\t$.ajax({\r\n\t\ttype : \"post\",\r\n\t\turl : \"/jsoa/weiXinCommonAction.do?action=fileModel&fileType=\" + fileType,\r\n\t\tasync : false,\r\n\t\tdataType : \"text\",\r\n");
            out.write("\t\tsuccess : function(returnData){ $(\"#\" + field).val(returnData);},\r\n\t\terror : function(XMLHttpRequest, textStatus, errorThrown){ },\r\n\t\tcomplete : function(XHR, TS){ XHR = null;}\r\n\t});\r\n}\r\nvar currentRow = null;\t\r\nvar tblTR = new Array();\r\nvar tblTRHTML = new Array();\r\n");

//取设置了检索的字段信息
  
//取设置了提取数据的字段信息

            out.write("\r\nvar tempComboBoxStore = new Array();\r\nvar tempSelectHtml = new Array();\r\nvar tempCombofieldObjArr=new Array();\r\nvar tempComboBoxCntArr=new Array();\r\nExt.onReady(function(){\r\n\t//Ext.QuickTips.init();\r\n\t");

	String[] fieldObj;
	String hide_field_readonly = "," + hide_Field + ",";
	for(int fi=0; fi<boxFieldList.size(); fi++){
		fieldObj = (String[]) boxFieldList.get(fi);
		if("1".equals(fieldObj[2])){
			//需要输入检索
			if (hide_field_readonly.indexOf(","+fieldObj[0]+",") >= 0 || hide_field_readonly.indexOf(fieldObj[1]) >= 0) {
				//如果是只读字段则不使用输入样式
				continue;
			} else{
				
            out.write("\r\n\t\t\t\t//记录字段值\r\n\t\t\t\tvar tempCombofieldObj={};\r\n\t\t\t\ttempCombofieldObj.id=\"");
            out.print(fieldObj[1]);
            out.write("\";\r\n\t\t\t\ttempCombofieldObj.val=");
            out.print(net.sf.json.JSONArray.fromObject(fieldObj));
            out.write(";\r\n\t\t\t\ttempCombofieldObjArr[tempCombofieldObjArr.length]=tempCombofieldObj;\r\n\t\t\t\t//记录html\r\n\t\t\t\tvar tempSelectHtmlObj={};\r\n\t\t\t\ttempSelectHtmlObj.id=\"");
            out.print(fieldObj[1]);
            out.write("\";\r\n\t\t\t\ttempSelectHtmlObj.val=document.getElementById(\"");
            out.print(fieldObj[1]);
            out.write("\").parentNode.parentNode.innerHTML;\r\n\t\t\t\ttempSelectHtml[tempSelectHtml.length]=tempSelectHtmlObj;\r\n\t\t\t\textWidth = document.getElementById(\"");
            out.print(fieldObj[1]);
            out.write("\")==null?extWidth:document.getElementById(\"");
            out.print(fieldObj[1]);
            out.write("\").offsetWidth+\"px\";\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar cb");
            out.print(fi);
            out.write(" = new Ext.form.ComboBox({\r\n\t\t\t\t\t\ttypeAhead: true,\r\n\t\t\t\t\t\ttriggerAction: 'all',\r\n\t\t\t\t\t\ttransform:'");
            out.print(fieldObj[1]);
            out.write("',\r\n\t\t\t\t\t\twidth:'200',\r\n\t\t\t\t\t\tforceSelection:true,\r\n\t\t\t\t\t\t//listClass:'inputText',\r\n\t\t\t\t\t\tminListWidth:205+2+2,\t\t\t\r\n\t\t\t\t\t\tlisteners:{\r\n\t\t\t\t        \tselect:{\r\n\t\t\t\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t\t\t\t");
if(!"0".equals(fieldObj[3])){
            out.write("\r\n\t\t\t\t\t\t\t\t\t\t");
            out.print(fieldObj[1]);
            out.write("_onchange(combo);\r\n\t\t\t\t\t\t\t\t\t");
}
            out.write("\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t        \t},\r\n\t\t\t\t\t\t\t'beforequery':function(e){         \r\n\t\t\t\t\t\t \t\tvar combo = e.combo;    \r\n\t\t\t\t\t\t \t\tif(!e.forceAll){    \r\n\t\t\t\t\t\t  \t\t\tvar input = e.query;    \r\n\t\t\t\t\t\t  \t\t\t// 检索的正则  \r\n\t\t\t\t\t\t\t\t\t var regExp = new RegExp(\".*\" + input + \".*\");  \r\n\t\t\t\t\t\t\t\t\t// 执行检索  \r\n\t\t\t\t\t\t\t\t\t combo.store.filterBy(function(record,id){    \r\n\t\t\t\t\t\t \t\t\t\t// 得到每个record的项目名称值  \r\n\t\t\t\t\t\t\t\t\t\tvar text = record.get(combo.displayField);    \r\n\t\t\t\t\t\t\t\t\t\treturn regExp.test(text);   \r\n\t\t\t\t\t\t\t\t\t });  \r\n\t\t\t\t\t\t\t\t\t combo.expand();    \r\n\t\t\t\t\t\t\t\t\treturn false;  \r\n\t\t\t\t\t\t     }  \r\n\t\t\t\t\t\t   }  \r\n\t\t\t\t\t\t}\r\n\t\t\t\t    });\r\n\t\t\t\t\tcb");
            out.print(fi);
            out.write(".el.setStyle({\r\n\t\t\t\t\t\twidth:'152px',\r\n\t\t\t\t\t\ttop:'0.1px'\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//记录数据源\r\n\t\t\t\t\tvar tempComboBoxStoreObj={};\r\n\t\t\t\t\ttempComboBoxStoreObj.id=\"");
            out.print(fieldObj[1]);
            out.write("\";\r\n\t\t\t\t\ttempComboBoxStoreObj.val=cb");
            out.print(fi);
            out.write(".store;\r\n\t\t\t\t\ttempComboBoxStore[tempComboBoxStore.length]=tempComboBoxStoreObj;\r\n\t\t\t\t\t//记录个数\r\n\t\t\t\t\tvar tempComboBoxCnt={};\r\n\t\t\t\t\ttempComboBoxCnt.id=\"");
            out.print(fieldObj[1]);
            out.write("\";\r\n\t\t\t\t\ttempComboBoxCnt.val=1;\r\n\t\t\t\t\ttempComboBoxCntArr[tempComboBoxCntArr.length]=tempComboBoxCnt;\r\n\t\t\t\t}catch(ee){ }\r\n\t\t\t\t");

			}
		}
	}
	
            out.write("\r\n\ttempComboBoxCreateFun();\r\n});\r\nfunction tempComboBoxCreateFun1(vid){\r\n\tvar r=-1;\r\n\tfor(var j=0;j<tempComboBoxStore.length;j++){\r\n\t\t if(vid.indexOf(tempComboBoxStore[j].id)>=0){\r\n\t\t\t r=j;\r\n\t\t\t break;\r\n\t\t }\r\n\t }\r\n\treturn r;\r\n}\r\n  function tempComboBoxCreateFun(){\r\n\t  if(tempComboBoxStore.length>0){\r\n\t\t  \r\n\t\t  var oobj=document.getElementsByName(tempComboBoxStore[0].id)[0];\r\n\t\t  while(oobj.nodeName!=\"TBODY\"){\r\n\t\t\t  oobj=oobj.parentNode;\r\n\t\t  }\r\n\t\t  var tempSelect=oobj.getElementsByTagName(\"select\");\r\n\t\t if(tempSelect.length==0){\r\n\t\t\t return;\r\n\t\t }\r\n\t\t for(var i=tempSelect.length-1;i>=0;i--){\r\n\t\t\t var tempXh=tempComboBoxCreateFun1(tempSelect[i].id);\r\n\t\t\t if(tempXh != -1){\r\n\t\t\t\t//判断当id重复时增加后缀\r\n\t\t\t\t if(tempComboBoxCntArr[tempXh].id==tempSelect[i].id){\r\n\t\t\t\t\t var tt=parseInt(tempComboBoxCntArr[tempXh].val);\r\n\t\t\t\t\t tempSelect[i].id=tempSelect[i].id+\"_\"+tt;\r\n\t\t\t\t\t tempComboBoxCntArr[tempXh].val=tt++;\r\n\t\t\t\t }\r\n\t\t\t\t extWidth = document.getElementById(tempSelect[i].id)==null?extWidth:document.getElementById(tempSelect[i].id).offsetWidth+\"px\";\r\n");
            out.write("\t\t\t\t\tnew Ext.form.ComboBox({\r\n\t\t\t\t\t\ttypeAhead: true,\r\n\t\t\t\t\t\ttriggerAction: 'all',\r\n\t\t\t\t\t\ttransform:tempSelect[i].id,\r\n\t\t\t\t\t\tforceSelection:true,\t\t\r\n\t\t\t\t\t\tlisteners:{\r\n\t\t\t\t        \tselect:{\r\n\t\t\t\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tvar tempTransform = tempComboBoxCreateFun1(combo.transform);\r\n\t\t\t\t\t\t\t\t\tvar tempf=tempCombofieldObjArr[tempTransform].val;\r\n\t\t\t\t\t\t\t\t\tif(tempf[3]!=0){\r\n\t\t\t\t\t\t\t\t\t\t//tempComboBox_onchange(combo,tempf);\r\n\t\t\t\t\t\t\t\t\t\ttempComboBox_onchange1(combo);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t        \t},\r\n\t\t\t\t\t\t\t'beforequery':function(e){         \r\n\t\t\t\t\t\t \t\tvar combo = e.combo;    \r\n\t\t\t\t\t\t \t\tif(!e.forceAll){    \r\n\t\t\t\t\t\t  \t\t\tvar input = e.query;    \r\n\t\t\t\t\t\t  \t\t\t// 检索的正则  \r\n\t\t\t\t\t\t\t\t\t var regExp = new RegExp(\".*\" + input + \".*\");  \r\n\t\t\t\t\t\t\t\t\t// 执行检索  \r\n\t\t\t\t\t\t\t\t\t combo.store.filterBy(function(record,id){    \r\n\t\t\t\t\t\t \t\t\t\t// 得到每个record的项目名称值  \r\n\t\t\t\t\t\t\t\t\t\tvar text = record.get(combo.displayField);    \r\n\t\t\t\t\t\t\t\t\t\treturn regExp.test(text);   \r\n\t\t\t\t\t\t\t\t\t });  \r\n\t\t\t\t\t\t\t\t\t combo.expand();    \r\n");
            out.write("\t\t\t\t\t\t\t\t\treturn false;  \r\n\t\t\t\t\t\t     }  \r\n\t\t\t\t\t\t   }  \r\n\t\t\t\t\t\t}\r\n\t\t\t\t    });\r\n\t\t\t }\r\n\t\t\t \r\n\t\t }\r\n\t\t \r\n      }\r\n\t\t\r\n\t}\r\n//构造字段onchange事件\r\n");

for(int fi=0; fi<boxFieldList.size(); fi++){
	fieldObj = (String[]) boxFieldList.get(fi);
	if(!"0".equals(fieldObj[3]) || "1".equals(fieldObj[12])){
		//onchange fangfa
		
            out.write("\t\r\n\t\tfunction ");
            out.print(fieldObj[1]);
            out.write("_onchange(obj){\r\n\t\t\tvar curIndex = 0;\r\n\t\t\tvar curObj;\r\n\t\t    if(obj.name!=undefined){\r\n\t\t    \tcurObj=document.getElementsByName(obj.name);\r\n\t\t    }else{\r\n\t\t    \tcurObj=document.getElementsByName(obj.hiddenName);\r\n\t\t    \tobj = obj.wrap.dom.childNodes[0];\r\n\t\t    }\r\n\t\t\tfor(var i=0; i<curObj.length; i++){\r\n\t\t\t\tif(curObj[i] == obj){\r\n\t\t\t\t\tcurIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t");

			if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				out.print(fieldObj[5]);
			}
			
            out.write("\r\n\t\t\tvar selValue=obj.value;\r\n\t\t\tselValue=escape(escape(selValue));\r\n\t\t\t\r\n\t\t\t//获取sql语句中的参数\r\n\t\t    var _postData=\"\";\r\n\t\t    ");

		    String _fetchSQL=fieldObj[4]==null?"":fieldObj[4];
		    String[] _fetchSQLArr=_fetchSQL.split("\\@\\@");
		    for(int si=0;si<_fetchSQLArr.length;si++){
		    	if(!"".equals(_fetchSQLArr[si]) && _fetchSQLArr[si].indexOf(" ")<0 && !"curYear".equals(_fetchSQLArr[si]) && !"curMonth".equals(_fetchSQLArr[si])){
		    		
            out.write("\r\n\t\t    \t\tif(document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\")){\r\n\t\t    \t\t\tif(document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\").length==1){\r\n\t\t    \t\t\t\t_postData+=\"&");
            out.print(_fetchSQLArr[si]);
            out.write("=\"+document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\")[0].value;\r\n\t\t    \t\t\t}else{\r\n\t\t    \t\t\t\t_postData+=\"&");
            out.print(_fetchSQLArr[si]);
            out.write("=\"+document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\")[curIndex].value;\r\n\t\t    \t\t\t}\r\n\t\t    \t\t}\r\n\t\t    \t\t");

		    	}
		    }    
		    
            out.write(" \r\n\t\t    \r\n\t\t\t");

			if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				
            out.write("\r\n\t\t\t\t// 提取数据\r\n\t\t\t\tvar selValue = obj.value;\r\n\t\t\t\tvar submitPersonObj = document.getElementsByName(\"submitPersonId\");\r\n\t\t\t\tvar submitPersonId = \"\";\r\n\t\t\t\tif(submitPersonObj.length > 0){\r\n\t\t\t\t\tsubmitPersonId = submitPersonObj[0].value;\r\n\t\t\t\t}\r\n\t\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
            out.print(fieldObj[0]);
            out.write("&submitPersonId=\"+submitPersonId+\"&selValue=\"+selValue+_postData,\"\",showFormSubData);\r\n\t\t\t\t");

			}
			if(fieldObj[12]!=null && "1".equals(fieldObj[12])){
				if(fieldObj[9]!=null && fieldObj[10]!=null){
					
            out.write("\r\n\t\t\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata_inteface.jsp?transValue=\"+obj.value+\"&curIndex=\"+curIndex+\"&fieldId=");
            out.print(fieldObj[0]);
            out.write("\",\"\",showInteface_Data);\r\n\t\t\t\t\t");

				}
			}
			
			
            out.write("\r\n\t\t}\r\n\t\tfunction tempComboBox_onchange1(obj){\r\n\t\t    var curIndex=0;\r\n\t\t    var curObj;\r\n\t\t    if(obj.name!=undefined){\r\n\t\t    \tcurObj=document.getElementsByName(obj.name);\r\n\t\t    }else{\r\n\t\t    \tcurObj=document.getElementsByName(obj.hiddenName);\r\n\t\t    \tobj = obj.wrap.dom.childNodes[0];\r\n\t\t    }\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n\t\t    ");

		    if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				out.print(fieldObj[5]);
			}
		    
            out.write("\r\n\t\t    var selValue=obj.value;\r\n\t\t    selValue=escape(escape(selValue));\r\n\t\t    \r\n\t\t    var _postData=\"\";\r\n\t\t    ");

		    for(int si=0;si<_fetchSQLArr.length;si++){
		    	if(!"".equals(_fetchSQLArr[si]) && _fetchSQLArr[si].indexOf(" ")<0 && !"curYear".equals(_fetchSQLArr[si]) && !"curMonth".equals(_fetchSQLArr[si])){
		    		
            out.write("\r\n\t\t    \t\tif(document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\")){\r\n\t\t    \t\t\tif(document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\").length==1){\r\n\t\t    \t\t\t\t_postData+=\"&");
            out.print(_fetchSQLArr[si]);
            out.write("=\"+document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\")[0].value;\r\n\t\t    \t\t\t}else{\r\n\t\t    \t\t\t\t_postData+=\"&");
            out.print(_fetchSQLArr[si]);
            out.write("=\"+document.getElementsByName(\"");
            out.print(_fetchSQLArr[si]);
            out.write("\")[curIndex].value;\r\n\t\t    \t\t\t}\r\n\t\t    \t\t}\r\n\t\t    \t\t");

		    	}
		    }    
		    
            out.write(" \r\n\t\t   \r\n\t\t\t");

			if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				
            out.write("\r\n\t\t\t\t//提取数据\t\t\r\n\t\t\t\tvar submitPersonIdObj=document.getElementsByName(\"submitPersonId\");\r\n\t\t\t\tvar submitPersonObj=document.getElementsByName(\"submitPerson\");\r\n\t\t\t\tvar submitPersonId=\"\",submitPerson=\"\";\r\n\t\t\t\tif(submitPersonIdObj.length>0){\r\n\t\t\t\t\tsubmitPersonId=submitPersonIdObj[0].value;\r\n\t\t\t\t}\r\n\t\t\t\tif(submitPersonObj.length>0){\r\n\t\t\t\t\tsubmitPerson=submitPersonObj[0].value;\r\n\t\t\t\t}\r\n\t\t\t\tsubmitPerson=escape(escape(submitPerson));\r\n\t\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
            out.print(fieldObj[0]);
            out.write("&submitPersonId=\"+submitPersonId+\"&submitPerson=\"+submitPerson+\"&selValue=\"+selValue+_postData,\"\",showFormSubData);\r\n\t\t\t\t");

			}
			if(fieldObj[12]!=null&&"1".equals(fieldObj[12])){
				if(fieldObj[9]!=null && fieldObj[10]!=null){
			
            out.write("\r\n\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata_inteface.jsp?transValue=\"+selValue+\"&curIndex=\"+curIndex+\"&fieldId=");
            out.print(fieldObj[0]);
            out.write("\",\"\",showInteface_Data);\r\n\t\t\t");

			}}
			
            out.write("\r\n\t\t}\r\n\t\t");

	}
	// 输入检索的回车触发事件
	if("450".equals(fieldObj[7])){
		
            out.write("\r\n\t\tfunction ");
            out.print(fieldObj[1]);
            out.write("_enter(obj){\r\n\t\t\tvar curIndex = 0;\r\n\t\t\tvar curObj = document.getElementsByName(obj.name);\r\n\t\t\tfor(var i=0; i<curObj.length; i++){\r\n\t\t\t\tif(curObj[i]==obj){\r\n\t\t\t\t\tcurIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar inputValueObj = document.getElementsByName(\"");
            out.print(fieldObj[1]);
            out.write("_temp\");\r\n\t\t\tvar inputValue = inputValueObj[curIndex].value;\t\r\n\t\t\tvar submitPersonObj = document.getElementsByName(\"submitPersonId\");\r\n\t\t\tvar submitPersonId = \"\";\r\n\t\t\tif(submitPersonObj.length > 0){\r\n\t\t\t\tsubmitPersonId = submitPersonObj[0].value;\r\n\t\t\t}\r\n\t\t\t// 如果是程序调用需解析参数\r\n\t\t\tvar interfacePara = \"\";\r\n\t\t\t");

			if(fieldObj[8]!=null && fieldObj[8].startsWith("$[interface")){
				
            out.write("\r\n\t\t\t\tinterfacePara = \"&getDataFlag=1\";\r\n\t\t\t\t");
		
				if(fieldObj[8].indexOf(";;;;") > 0){			
					//有设置参数 @@ 表示表单中字段  @$@ 表示默认字段
					String interfaceParaStr = fieldObj[8].substring(fieldObj[8].indexOf(";;;;")+4,fieldObj[8].length()-1);			
					String[] interfaceParaArr = interfaceParaStr.split(",");			
					String interfaceParaTemp;
					for(int interi=0; interi<interfaceParaArr.length; interi++){				
						if(interfaceParaArr[interi].startsWith("@@")){					
							//表单中的值组织参数
							interfaceParaTemp = interfaceParaArr[interi].substring(2,interfaceParaArr[interi].length()-2);
							if(interfaceParaTemp.equals(fieldObj[1])){
								
            out.write("\r\n\t\t\t\t\t\t\t\tvar fieldText = \"\";\r\n\t\t\t\t\t\t\t\tif(curIndex > 0){\r\n\t\t\t\t\t\t\t\t\tvar objTemp = document.getElementsByName(\"");
            out.print(interfaceParaTemp);
            out.write("_temp\");\r\n\t\t\t\t\t\t\t\t\tfieldText = objTemp[curIndex].value;\r\n\t\t\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\t\t\tfieldText = document.getElementById(\"");
            out.print(interfaceParaTemp);
            out.write("_temp\").value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinterfacePara += \"&");
            out.print(interfaceParaTemp);
            out.write("=\"+fieldText;\r\n\t\t\t\t\t\t\t\t");

							} else{
								
            out.write("\r\n\t\t\t\t\t\t\t\tvar fieldText = \"\";\r\n\t\t\t\t\t\t\t\tif(curIndex > 0){\r\n\t\t\t\t\t\t\t\t\tvar objTemp = document.getElementsByName(\"");
            out.print(interfaceParaTemp);
            out.write("\");\r\n\t\t\t\t\t\t\t\t\tfieldText = objTemp[curIndex].value;\r\n\t\t\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\t\t\tfieldText = document.getElementById(\"");
            out.print(interfaceParaTemp);
            out.write("\").value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinterfacePara+=\"&");
            out.print(interfaceParaTemp);
            out.write("=\"+fieldText;\r\n\t\t\t\t\t\t\t\t");

							}
						}
					}
				}
			}
			
            out.write("\r\n\t    \r\n\t\t\tdocument.getElementById(\"messageBodyFilter\").style.display = \"block\";\r\n\t\t\tdocument.getElementById(\"curIndex\").value=curIndex;\r\n\t\t\tdocument.getElementById(\"fieldName\").value=\"");
            out.print(fieldObj[1]+"");
            out.write("\";\r\n\t\t\tvar url = \"/jsoa/weiXinFormDataFilterAction.do?curIndex=\"+curIndex+\"&fieldId=");
            out.print(fieldObj[0]);
            out.write("&fieldName=");
            out.print(fieldObj[1]);
            out.write("&submitPersonId=\"+submitPersonId+\"&inputValue=\"+encodeURI(encodeURI(inputValue+interfacePara)); \r\n\t\t\t$.post(url, {}, function(returnHTML){\r\n\t\t\t\tcallbackCorp(returnHTML)\r\n\t\t\t}, \"JSON\");\r\n     \r\n\t\t\t");

			if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
				out.print(fieldObj[5]);
			}
			
            out.write("\r\n\t\t}\r\n\t\tfunction callbackCorp(data){\r\n   \r\n\t\t\tvar i = 0, index = 0, dataIndex = 0, listClass; \r\n\t\t\tvar aryHead = new Array();\r\n\t\t\tvar ss = eval(data);\r\n\t\t\taryHead = ss[0].filterListField;\r\n\t\t\tvar aryList = new Array();    \r\n\t\t\taryList = ss[0].list;   \r\n\t\t\tvar str = \"\";\r\n\t\t\tvar fileTitle = \"\";\r\n\t\t\tstr += \"<table  width=\\\"100%\\\" border=\\\"0\\\" cellpadding=\\\"0\\\" cellspacing=\\\"0\\\" >\";\r\n\t\t\tstr += \"<tr align='center'>\";\r\n\t\t\tfor(var i=0; i<aryHead.length; i++){\r\n\t\t\t\tstr += \"<td align='center' height=\\\"30px\\\" style='border-right:1px solid #acacac;' >\"+aryHead[i][0]+\"</td>\";\r\n\t\t\t}\r\n\t\t\tstr += \"<td align='center' height=\\\"30px\\\" style='border-right:1px solid #acacac;'>操作</td>\";\r\n\t\t\tstr += \"</tr>\";\r\n\t\t\tfor(var s=0; s<aryList.length; s++){\r\n\t\t\t    str += \"<tr align='center'>\";\r\n\t\t\t    index ++;\r\n\t\t\t\tif(index%2 != 0){\r\n\t\t\t\t     listClass=\"listTableLine2\";\r\n\t\t\t\t} else{\r\n\t\t\t\t     listClass=\"listTableLine1\";\r\n\t\t\t\t}\r\n\t\t\t    for(var j=0; j<aryHead.length; j++){\r\n\t\t\t\t\tif(aryHead[j][2]!=null){\r\n\t\t\t\t\t\tdataIndex = Number(aryHead[j][2]);\r\n");
            out.write("\t\t\t\t\t} else{\r\n\t\t\t\t\t\tdataIndex = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstr += \"<td height=\\\"30px\\\" style='border-right:1px solid #acacac;' class=\"+listClass+\">&nbsp;\"+aryList[s][dataIndex]+\"</td>\";\r\n\t\t\t\t}\r\n\t\t\t\tstr += \"<td height=\\\"30px\\\" style='border-right:1px solid #acacac;' class=\"+listClass+\">\";\r\n\t\t\t\tstr += \"<input type=\\\"button\\\" id=\\\"buttonOK\\\" name=\\\"buttonOK\\\"  onClick=dataOK('\"+aryList[s][0]+\"','\"+aryList[s][1]+\"')  value=\\\"选择\\\" >\" ;\r\n\t\t\t\tstr += \"<input type=\\\"hidden\\\" name=\\\"turnValue\\\" value=\"+aryList[s][0]+\">\";\r\n\t\t\t\tstr += \"<input type=\\\"hidden\\\" name=\\\"turnText\\\" value=\"+aryList[s][1]+\">\";\r\n\t\t\t\tstr += \"</td>\";\r\n\t\t\t\tstr+=\" </tr>\";\r\n\t\t\t}\r\n\t\t\tstr += \"</table>\";\r\n\t\t\tstr += \"<div id=\\\"messageButtonFilter\\\" class=\\\"messageButtons\\\"></div>\";\r\n\r\n\t\t\tdocument.getElementById(\"messageBodyFilter\").innerHTML = str;\r\n\t\t\tvar buts = document.getElementById(\"messageButtonFilter\");\r\n\t\t\tvar butString = \"\";\r\n\t\t\tbutString += \"<div class='messageButton' onclick='hiddenMessageBodyFilter()'>取消</div>\";\r\n\t\t\tbuts.innerHTML = butString;\r\n\t\t}\r\n\t\tfunction dataOK(dataId,dataText){\r\n");
            out.write("\t\t\tvar curIndex=document.getElementById(\"curIndex\").value;\r\n\t\t    var fieldName=document.getElementById(\"fieldName\").value;\r\n\t\t\tvar obj=document.getElementsByName(fieldName);\r\n\t\t\tvar objTemp=document.getElementsByName(fieldName+\"_temp\");\r\n\t\t\tvar objbtn=document.getElementsByName(fieldName+\"_btn\");\r\n\t\t\tobj[curIndex].value=dataId+\"@@$@@\"+dataText;\r\n\t\t\tobjTemp[curIndex].value=dataText;\r\n\t\t\ttry{\r\n\t\t\t\t");
            out.print(fieldObj[1]);
            out.write("_onchange(obj[curIndex]);\r\n\t\t\t}catch(e){\r\n\t\t\t}\r\n\t\t\thiddenMessageBodyFilter();\r\n\t\t}\r\n\t\t");

	}
}

            out.write("\r\n\r\ndocument.onkeydown = listenKeyDown;\r\n\r\nfunction listenKeyDown(){\r\n\tvar event = arguments[0] ||window.event;\r\n\tif(event.keyCode==13){\r\n\t\t//按下了enter\r\n\t\ttry{\r\n\t\t    var obj=event.srcElement;\r\n\t\t\tvar objname=event.srcElement.name;\t\r\n\t\t\t\r\n\t\t\tvar curIndex=0;\r\n\t\t    var curObj=document.getElementsByName(objname);\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n    \r\n\t\t\tobjname=objname.substring(0,objname.length-5);\r\n\t\t\tobjname=objname+\"_btn\";\t\t\t\r\n\t\t\t\r\n\t\t\tobj=document.getElementsByName(objname);\r\n\t\t\tobj[curIndex].click();\r\n\t\t\t\r\n\t\t\t//eval(objname+\"_enter(\"+document.getElementsByName(objname)[0]+\")\");\r\n\t\t}catch(e){\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction showIntefaceData(response){\r\n\r\n\tvar context = response.responseText;\r\n\t\r\n\tcontext=context.substring(context.indexOf(\"{\"));\r\n\t\r\n\tif(context.length>2){\r\n\t\tcontext=context.substring(2,context.length-3);\r\n\t\t\r\n\t\tvar contextValue=context.split(\"];[\");\r\n\t\t\r\n\t\tfor(var i=0;i<contextValue.length;i++){\r\n\t\t\t\r\n\t\t\tif(contextValue[i].indexOf(\":{\")>0 &&contextValue[i].substring(contextValue[i].length-1)==\"}\" ){\r\n");
            out.write("\t\t\t\tvar kValue = contextValue[i].split(\":{\");\r\n\t\t\t\treturn_Value(\"{\"+kValue[1],kValue[0]) ;\r\n\t\t\t}else{\r\n\t\t\t\tvar kValue=contextValue[i].split(\":\");\r\n\t\t\t\treturn_Value(kValue[1],kValue[0]) ;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t  \r\n\r\n}\r\n\r\n\r\nfunction return_Value(showValue,fieldName){\r\n\tif(document.getElementById(fieldName)){\r\n\t\tvar fieldObj =document.getElementById(fieldName);\r\n\t\tif(fieldObj.nodeName==\"SELECT\"&&(showValue.substring(0,2)==\"{[\" && showValue.substring(showValue.length-2,showValue.length)==\"]}\")){//下拉框形式\r\n\t\t\tvar showValues =  showValue.substring(2,showValue.length-2).split(\"],[\");\r\n\t \t\tfieldObj.options.length=0;\r\n\t \t\t\r\n\t \t\tvar option =document.createElement(\"option\");\r\n\t \t\tfieldObj.appendChild(option);\r\n\t\t\toption.value = \"\";\r\n\t\t\toption.text = \"--请选择--\";\r\n\t\t\t\r\n\t \t\tfor(var i=0;i<showValues.length;i++){\r\n\t \t\t\tvar option2 = document.createElement(\"option\");\r\n\t \t \t\tfieldObj.appendChild(option2);\r\n\t \t \t\t\r\n\t \t\t\tvar optionShow = showValues[i].split(\":\");\r\n\t \t\t\toption2.value = optionShow[0]+\"@#@\"+optionShow[1];\r\n\t \t\t\toption2.text = optionShow[1];\r\n");
            out.write("\t \t\t}\r\n\t \t}else{\r\n\t \t\tdocument.getElementById(fieldName).value=showValue;\r\n\t \t}\r\n\t}\r\n}\r\n\r\nfunction showInteface_Data(response){\r\n\t \r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n    \t\r\n    \t//如是字表多行时需确定本行的位置\r\n    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,content;\r\n    \t//alert(\"11222\"+datas);\r\n    \tfor(var i=0;i<datas.length;i++){\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n    \t\tif(formfield==\"error\"){\r\n    \t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n    \t\t\tweixinMessageReminder(\"alert\", \"提示：\", content, \"\");\r\n    \t\t}else{\r\n\t    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n\t    \t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n\t    \t\t//if(fetchdata==\"0\"){\r\n");
            out.write("\t    \t\treturn_Value(content,formfield);\r\n\t    \t\t//}\r\n\t\t\t}\t\r\n    \t}\r\n    \t\r\n\t}\t\t\r\n}\t\r\nfunction showFormSubData(response){\r\n\t//将取回的数据显示在正确的表单中\r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n    \t\r\n    \t//如是字表多行时需确定本行的位置\r\n    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n    \t    \t\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,content,fieldTagName;\r\n    \tvar subdatas,datavalue,datatext;\r\n    \tvar oprObj;\r\n    \tfor(var i=0;i<datas.length;i++){\r\n     \t\t// 控件名称\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n    \t\t// 控件类型\r\n    \t\tfieldtype=datas[i].getElementsByTagName(\"fieldtype\")[0].firstChild.nodeValue;\r\n    \t\t\r\n    \t\tif(fetchdata==\"0\"){\t// 检索赋值\r\n\t    \t\t// 控件的值\r\n\t    \t\tif(null != datas[i].getElementsByTagName(\"content\")[0].firstChild){\r\n");
            out.write("\t    \t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n\t    \t\t} else{\r\n\t    \t\t\tcontent = \"\";\r\n\t    \t\t}\r\n\t    \t\t\r\n\t\t\t\t//alert(formfield + \"---\" + fetchdata);\r\n\t    \t\t// 根据控件名称和下标索引获取控件对象\r\n\t    \t\toprObj = document.getElementsByName(formfield);\r\n\t    \t\t\r\n\t    \t\t// 判断要赋值的控件的类型\r\n\t    \t\tif(\"103\" == fieldtype){\t// 单选\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t\t    \t\t\tvar index = 0;\r\n\t\t    \t\t\tfor(var j=0; j<oprObj.length; j++){\t// 遍历所有的radio选项\r\n\t\t    \t\t\t\tif(oprObj[j].value == content){\t// 判断值为选择值的radio选择\r\n\t\t    \t\t\t\t\tif(index == curIndex){\t// 选中值跟选择值相同，且下标相同的radio选项\r\n\t\t    \t\t\t\t\t\toprObj[j].checked = \"checked\";\r\n\t\t    \t\t\t\t\t} else{\r\n\t\t    \t\t\t\t\t\toprObj[j].checked = \"\";\r\n\t\t    \t\t\t\t\t}\r\n\t\t    \t\t\t\t\tindex++;\r\n\t\t    \t\t\t\t}\r\n\t\t    \t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t} else if(\"104\" == fieldtype){\t// 多选\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t    \t\t\t\t// 统计页面上出现同名同值复选框的个数\r\n\t    \t\t\t\tvar sum = 0;\r\n\t    \t\t\t\tfor(var j=0; j<oprObj.length; j++){\r\n\t    \t\t\t\t\tif(oprObj[0].value == oprObj[j].value){\r\n\t    \t\t\t\t\t\tsum++;\r\n");
            out.write("\t    \t\t\t\t\t}\r\n\t    \t\t\t\t}\r\n\t    \t\t\t\t// 页面上设置的同名多选控件中选项的个数\r\n\t    \t\t\t\tvar count = oprObj.length / sum;\r\n\t    \t\t\t\t// 循环开始下标\r\n\t    \t\t\t\tvar index = curIndex * count;\r\n\t    \t\t\t\tcontent = \",\" + content;\r\n\t    \t\t\t\tfor(var j=index; j<(index+count); j++){\r\n\t    \t\t\t\t\tif(content.indexOf(\",\"+oprObj[j].value+\",\") > -1){\t// 多选值中包含当前选项的值\r\n\t    \t\t\t\t\t\toprObj[j].checked = \"checked\";\r\n\t    \t\t\t\t\t} else{\r\n\t    \t\t\t\t\t\toprObj[j].checked = \"\";\r\n\t    \t\t\t\t\t}\r\n\t    \t\t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t} else if(\"105\" == fieldtype){\t// 下拉框\r\n\t    \t\t\tvar opts = oprObj[curIndex].options;\t// 获取所有选项\r\n\t    \t\t\tfor(var j=0; j<opts.length; j++){\r\n\t\t\t\t\t\tif(content == opts[j].value){\t// 选项值等于选择值时，选项选中\r\n\t\t\t\t\t\t\topts[j].selected = \"selected\";\r\n\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\topts[j].selected = \"\";\r\n\t\t\t\t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t}else if(\"210\"==fieldtype||\"211\"==fieldtype){//单选人/多选人\r\n\t    \t\t\toprObj = document.getElementsByName(formfield+\"_Name\");\r\n\t    \t\t\toprObjId = document.getElementById(formfield+\"_Id\");\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t    \t\t\tvar name=content.substring(0,content.indexOf(\";\"));\r\n");
            out.write("\t    \t\t\tvar id=content.substring(content.indexOf(\";\")+1);\r\n\t    \t\t\t\toprObj[curIndex].value = name;\r\n\t    \t\t\t\toprObjId.value=id;\r\n\t    \t\t\t}\r\n\t    \t\t}else{\t// 其他类型控件，直接赋值，需要特殊处理时在之前加if判断\r\n\t    \t\t\t");

	    			if(com.js.util.config.SystemCommon.getSYWorkflowHR() == 1){
	    				
            out.write("\r\n\t\t\t\t\t\tif(content.indexOf(\"00:00:00.0\") > 0){\r\n\t\t\t\t\t\t\tcontent = content.replace(\"00:00:00.0\",\"\");\r\n\t\t\t\t\t\t}\r\n\t    \t\t\t\t");

	    			}
	    			
            out.write("\r\n\t    \t\t\toprObj[curIndex].value = content;\r\n\t    \t\t}\r\n    \t\t} else if(fetchdata == \"2\"){\t// 级联\r\n    \t\t\tsubdatas=datas[i].getElementsByTagName(\"content\")[0].getElementsByTagName(\"subdata\");\r\n    \t\t\t//下拉列表形式    \t\t\t\r\n    \t\t\t//oprObj=eval(\"document.all.\"+formfield);\r\n    \t\t\toprObj=document.getElementsByName(formfield)[curIndex];    \t\t\t\r\n    \t\t\t\r\n    \t\t\tfieldTagName=oprObj.tagName;    \t\t\t\r\n    \t\t\tif(fieldTagName==\"INPUT\" || fieldTagName==\"TEXTAREA\"){\r\n    \t\t\t\t//普通输入 \r\n    \t\t\t\toprObj.value=\"\";   \r\n    \t\t\t\tif(subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild!=null){\t\t\t\t\r\n\t    \t\t\t\tdatavalue=subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue; \r\n\t    \t\t\t\toprObj.value=datavalue;\r\n    \t\t\t\t}\r\n    \t\t\t}else if(fieldTagName==\"SELECT\"){\r\n    \t\t\t\t//删除原来的option    \t\t\t\t\r\n    \t\t\t\tjs_deleteAllOptions(oprObj);    \t\t\t\t\r\n    \t\t\t\t//新增option\r\n    \t\t\t\tfor(var j=0;j<subdatas.length;j++){\r\n    \t\t\t\t    try{\r\n\t    \t\t\t\t\tdatavalue=subdatas[j].getElementsByTagName(\"datavalue\")[0].firstChild.nodeValue;\r\n\t    \t\t\t\t\tdatatext=subdatas[j].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue;\r\n");
            out.write("\t    \t\t\t\t\tjs_addOption(oprObj,datavalue,datatext);\r\n    \t\t\t\t\t}catch(e){\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n    \t\t\t\toprObj.onchange();    \t\t\t\t\r\n    \t\t\t}\r\n    \t\t}\r\n    \t\t\r\n    \t}\r\n    }\r\n}\r\n\r\nfunction js_deleteAllOptions(obj){\r\n\twhile(length!=0){ \r\n　　 \tvar length=obj.options.length;\r\n　　 \tfor(var i=0;i<length;i++)\r\n　　 \t\tobj.options.remove(i);\r\n　　 \tlength=length/2;\r\n　　 }\r\n}\r\nfunction js_addOption(obj,optionValue,optionText){\r\n\tvar newOption=new Option(optionText,optionValue); \r\n\tobj.options[obj.length]=newOption; \r\n} \r\n\r\nsetInterval(\"updateOnlineTime()\",30000);\r\nfunction updateOnlineTime(){\r\n   var workId=\"\";\r\n   var processId=\"\";\r\n   var recordId=\"\";\r\n   var tableId=\"\";\r\n   if(document.getElementById(\"workId\")){\r\n\t   workId=document.getElementById(\"workId\").value;\r\n\t}\r\n\tif(document.getElementById(\"processId\")){\r\n\t   processId=document.getElementById(\"processId\").value;\r\n\t}\r\n\tif(document.getElementById(\"recordId\")){\r\n\t  recordId=document.getElementById(\"recordId\").value;\r\n\t}\r\n    if(document.getElementById(\"tableId\")){\r\n\t   tableId=document.getElementById(\"tableId\").value;\r\n");
            out.write("\t}\r\n\tJSRequest.sendPOST(\"/jsoa/jsflow/jsflow_updateonlineTime.jsp?processId=\"+processId+\"&recordId=\"+recordId+\"&wfWorkId=\"+workId+\"&tableId=\"+tableId,\"\",doTime);\r\n}\r\nfunction  doTime(){\r\n\r\n}\r\n</SCRIPT>\r\n<script language=javascript src=\"/jsoa/weixin/workflow/eform/js/form.js\"></script>\r\n<input type=\"hidden\" name=\"user_Id\" id=\"user_Id\" value=\"");
            out.print(session.getAttribute("userId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Name\" id=\"user_Name\" value=\"");
            out.print(session.getAttribute("userName"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Account\" id=\"user_Account\" value=\"");
            out.print(session.getAttribute("userAccount"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"org_Name\" id=\"org_Name\" value=\"");
            out.print(session.getAttribute("orgName"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"org_ID\" id=\"org_ID\" value=\"");
            out.print(session.getAttribute("orgId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"group_ID\" id=\"group_ID\" value=\"");
            out.print(session.getAttribute("groupId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"Hide_Field\" id=\"Hide_Field\" value=\"");
            out.print(request.getAttribute("hideField"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"Page_Id\" id=\"Page_Id\" value=\"");
            out.print(pageId);
            out.write("\"/>\r\n<input type=\"hidden\" name=\"Info_Id\" id=\"Info_Id\" value=\"");
            out.print(null==request.getAttribute("infoId") ? "" : request.getAttribute("infoId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"work_Status\" id=\"work_Status\" value=\"");
            out.print(request.getParameter("workStatus"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"parent_fromDraft\" id=\"parent_fromDraft\" value=\"");
            out.print(parent_fromDraft);
            out.write("\">\r\n<input type=\"hidden\" name=\"totalValueSet\" id=\"totalValueSet\" value=\"\" />\r\n<input type=\"hidden\" name=\"dateCompare\" id=\"dateCompare\" value=\"\" />\r\n<input type=\"hidden\" id=\"fieldName\" name=\"fieldName\" />\r\n<input type=\"hidden\" id=\"curIndex\" name=\"curIndex\" />\r\n<input type=\"hidden\" name=\"sendSMS\" id=\"sendSMS\" value=\"");
            out.print(SystemCommon.getSendSMS() );
            out.write("\" />\r\n<!-- 取 -->\r\n");
            out.print(cst.getComputeFieldHTML(pageId));
            out.write("\r\n<div id=\"formHTML\">\r\n<!-- 读取表单设计模板 begin -->\r\n");

String tempHtml = cst.getCode(pageId).replace("window.open","showSearchInfo");
tempHtml = this.dealWithColorCode(tempHtml);

            out.write('\r');
            out.write('\n');
            out.print(tempHtml );
            out.write("\r\n<!-- 读取表单设计模板 end -->\r\n</div>\r\n\r\n<script type=\"text/javascript\">\r\n");

String allCoumputFieldStr = cst.getMainAndForeignComputeFields(pageId);
//判断当前表单是否新增
if(request.getAttribute("infoId")==null || request.getAttribute("infoId").toString().toUpperCase().equals("NULL") 
		|| request.getAttribute("infoId").toString().trim().length()<1){
	//初始化显示界面(新增)
	// 如果是发起子流程则如果子流程中的表单与主表单相同则将数据继承
	String pareFormId = request.getParameter("pareTableId");
	boolean isNewForm = true;
	if(pareFormId!=null || !"null".equals(pareFormId) || !"".equals(pareFormId)){
		//取得父表单ID则比较父表单ID是否与当前表单ID相同，如果相同的话，则继承主表单数据
		isNewForm = cst.isNewForm(pareFormId,pageId);
	}
	if(isNewForm){
		//新表单
		//取得表单关联的所有字段信息的数据(主表)
		String[][] fieldArr = cst.getPageField(pageId);
		String forHideField = "";	// 可写字段
		if(fieldArr != null){
			//遍历所有字段，获得字段的页面显示脚本
			for(int i=0; i<fieldArr.length; i++){
				if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
					
					//2016-12-26 首节点隐藏 
					if(noDisplayFields.indexOf(","+fieldArr[i][0]+",")>=0){
						String noDisplayHTML="if(document.getElementById('" + fieldArr[i][1] + "-" + fieldArr[i][0] + "'))\n{document.getElementById('" +
								fieldArr[i][1] + "-" + fieldArr[i][0] + "').innerHTML='';}";
						out.print(noDisplayHTML);
					}else{			
						out.print(dealWithColorCode(cst.getHTMLForWeiXin(fieldArr[i][0],hide_Field,domainId,fieldArr[i][1],request,allCoumputFieldStr)));
					}
					if(hide_field_readonly.indexOf(fieldArr[i][1])>-1){
						//roTempString+=fieldArr[i][0]+"@@";
					}else{
						//rwTempString+=fieldArr[i][0]+"@@";
					}
				}
			}
		}

		//获得表单关联的所有子表字段
		String[][] forFieldArr = cst.getForeignField(pageId);
		if(forFieldArr != null){
			String tempHideField = "," + hide_Field + ",";
			//遍历所有字段，获得字段的页面显示脚本
			for(int i=0; i<forFieldArr.length; i++){
				if(forFieldArr[i][2]!=null && (!forFieldArr[i][2].trim().equals(""))){
					out.print(cst.getHTMLForWeiXin(forFieldArr[i][2], hide_Field, domainId, forFieldArr[i][3], request, allCoumputFieldStr));
				}
				if(tempHideField.indexOf("," + forFieldArr[i][3] + ",") < 0){	// 不可写字段中不包含当前字段
					// 字段名称追加到可写字段
					forHideField += "," + forFieldArr[i][2] + ",";
				}
			}
		}		
         
		//start
		//获得表单关联的所有子表数组
		String[] tables = cst.getForeignTable(pageId);
		if (tables != null && tables.length > 0) {
			//遍历所有子表
			for(int i = 0; i < tables.length; i++) {
				if (tables[i] == null || tables[i].trim().length() < 1){
					continue;
				}
				
				//提取字表关联的所有字段
				String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
				if(forFields!=null && forFields.length>0){
					boolean hideTable = true;//子表是否有可写字段
					for(int k=0; k<forFields.length; k++){
						//遍历所有字段
						if(forHideField.indexOf(forFields[k][5]) > -1){
							//如果该子表中有可编辑字段，则该表可编辑
							hideTable = false;
						}
					}
				   
					//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
					if(hideTable){
						hideTableHTML += "<input type=hidden name=hideTable id=hideTable value=" + tables[i] + ">";
					} else{
						showTableHTML += "<input type=hidden name=showTable id=showTable value=" + tables[i] + ">";
					}
				}
				
				// 二维表添加增删行按钮列
				//out.print("creatTabButs('tab" + tables[i] + "');");
                  
				//if(i == 0){//将第一个子表设置为增加行、删除行图标所在的焦点
				//	scriptappend = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];setAbsolute(currentRow);";
				//}
				String agent = request.getHeader("USER-AGENT");   
				if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
					if(-1 != agent.indexOf("MSIE 10")){
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
					} else{
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
					}
				} else{
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
				}

				//设置统计字段
				String[][] tlFlds = cst.getTotalFieldByTableName(pageId,tables[i],domainId);
				if(tlFlds !=null && tlFlds.length>0){
					String tlfld = "";
					String duiying = "";
					int show = 0;

					for(int p=0; p<tlFlds.length; p++){
						String totalValue = tlFlds[p][3];
						if(totalValue.startsWith("1;")){
							show = 1;
							break;
						}
					}
					out.print("addTotalRow('" + tables[i] + "'," + show + ");");
					for(int p=0; p<tlFlds.length; p++){
						tlfld +=  tlFlds[p][0] + ",";
						String totalValue = tlFlds[p][3];
						if(totalValue.endsWith(";yes")){
							duiying += tlFlds[p][0] + ":";
							String[] toValue = totalValue.split(";");
							for(int to=1; to<toValue.length-1; to++){
								String[] tValue = toValue[to].split("@");
								duiying += tValue[0] + ",";
							}
							while(duiying.endsWith(",")){
								duiying = duiying.substring(0, duiying.length()-1);
							}
							duiying += ";";
						}
						if(totalValue.startsWith("1;")){
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						} else{
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						}
					}
					out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
					out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
					out.print("setTotalValue();");
					while(duiying.endsWith(";")){
						duiying = duiying.substring(0, duiying.length()-1);
					}
				}
			}
		}
	} else{
		//子流程表单与主流程表单用的是同一张数据表，取主流程中的数据填充表单
		pageId = pareFormId;
		//当前表单为编辑表单（表单已有对应的数据）
		String forHideField = "";//字表不可编辑字段
		if("1".equals(request.getParameter("flag"))){
			hide_Field="ALL";
		}
     
		//所有字段不可编辑，该种情况表示在自定义模块中点击链接查看信息
		String[][] fieldArr = cst.getPageField(pageId);//读取表单那关联的所有主表字段信息
		if(fieldArr != null){
			for(int i=0; i<fieldArr.length; i++){
				//遍历所有主表字段
				if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
					//获得主表字段的显示脚本
					out.print(cst.getEditHTMLForWeiXin(fieldArr[i][0],request.getParameter("pareRecordId"),pageId,hide_Field,domainId,fieldArr[i][1],parent_fromDraft,allCoumputFieldStr,request));
				}
			}
		}
 		 
		//start
		//获得表单那关联的所有子表
		String[] tables = cst.getForeignTable(pageId);
		if (tables != null && tables.length > 0) {
			for (int i = 0; i < tables.length; i++) {
				//遍历所有子表
				if (tables[i] == null || tables[i].trim().length() < 1)continue;
				//提取字表关联的所有字段
				String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
				//拼装SQL
				String sql = "";//查询子表关联到表单中的所有字段值的SQL语句
				if(forFields!=null && forFields.length>0){
					boolean hideTable = true;//子表是否有可写字段
					for(int k=0; k<forFields.length; k++){
						//遍历所有字段
						sql += forFields[k][5]+",";//将字段添加到数据查询的SQL中
						if(forHideField.indexOf(forFields[k][5])<0){
							//如果该子表中有可编辑字段，则该表可编辑
							hideTable = false;
						}
					}
				   
					//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
					if(hideTable){
						hideTableHTML += "<input type=hidden name=showTable id=hideTable value="+tables[i]+">";
					} else{
						showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
					}
                    sql = sql.substring(0,sql.length()-1);
				}
				//提取子表数据
				String[][] data = null;
				if(sql.length() > 1){
					sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getParameter("pareRecordId")+ " order by "+ tables[i] +"_id";
					data = cst.loadDataBySQL(sql,String.valueOf(forFields.length+1));
				} else{
					continue;
				}
				//设置页面子表行数
				if(data!=null && data.length>0){
					for(int n=0; n<data.length-1; n++){//遍历所有数据，解析数据行，根据记录数量增加行
						String script = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];addRow();";
						out.print(script);
					}
					for(int n=0; n<data.length; n++){//遍历数据，解析数据在表单上的展示
						//解析数据
						for(int m=0; m<forFields.length; m++){//遍历字段，生成该字段及其值展示在表单上的脚本
							out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],data[n][m],forFields,"",m,String.valueOf(n),forFields[m][0],parent_fromDraft,tables[i],request.getParameter("pareRecordId"),data[n][forFields.length],forFields[m][10],allCoumputFieldStr));
						}
						String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
						out.print(script);
					}
				} else{//该子表没有数据，隐藏模板中初始化的第一个数据行
					for(int m=0; m<forFields.length; m++){
						out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],"",forFields,(("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus")))?hide_Field+forHideField:"ALL"),m,"0",forFields[m][0],parent_fromDraft,tables[i],request.getParameter("pareRecordId"),"-100",forFields[m][10],allCoumputFieldStr));
					}
					out.print("document.getElementsByName('"+tables[i]+"TR')[0].style.display='none';");
				}
				String agent = request.getHeader("USER-AGENT");   
                if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
					if(-1 != agent.indexOf("MSIE 10")){
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
					} else{
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
					}
				} else{
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
				}
				//设置统计字段
				String[][] tlFlds = cst.getTotalFieldByTableName(pageId,tables[i],domainId);             
				if(tlFlds !=null && tlFlds.length>0){
                  	//增加统计字段显示行
              	    /*out.print("addTotalRow('"+tables[i]+"');");
                    String tlfld = "";
                    for(int p=0;p<tlFlds.length;p++){//遍历统计字段，设置对应的统计字段表单元素
                    	  tlfld +=  tlFlds[p][0]+",";
                    	  String totalValue = tlFlds[p][3];
                    	  if(totalValue.startsWith("1;")){
                          	  out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
                          }else{
                          	  out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
                          }     
                    }
                    out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField  id=totalField value="+tlfld+">';");
                    out.print("setTotalValue();");*/
					String tlfld = "";
					String duiying = "";
					int show = 0;
					for(int p=0; p<tlFlds.length; p++){
						String totalValue = tlFlds[p][3];
						if(totalValue.startsWith("1;")){
							show = 1;
							break;
						}
					}
					out.print("addTotalRow('" + tables[i] + "'," + show + ");");
					for(int p=0; p<tlFlds.length; p++){
						tlfld +=  tlFlds[p][0] + ",";
						String totalValue = tlFlds[p][3];
						if(totalValue.endsWith(";yes")){
							duiying += tlFlds[p][0]+":";
							String[] toValue = totalValue.split(";");
							for(int to=1; to<toValue.length-1; to++){
								String[] tValue = toValue[to].split("@");
								duiying += tValue[0] + ",";
							}
							while(duiying.endsWith(",")){
								duiying = duiying.substring(0, duiying.length()-1);
							}
							duiying += ";";
						}
						if(totalValue.startsWith("1;")){
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						} else{
							out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
						}
					}
					out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
					out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
					out.print("setTotalValue();");
					while(duiying.endsWith(";")){
						duiying = duiying.substring(0, duiying.length()-1);
					}
				}
			}
		}//end
	}
} else{
	//当前表单为编辑表单（表单已有对应的数据）
	String forHideField = "";//字表不可编辑字段
	String writeFieldString = "";//可写字段串 $字段名称$$字段名称$
	if(request.getParameter("processId")!=null){
		//表单在流程中调用
		WorkFlowBD workFlowBD = new WorkFlowBD();
		//取读字段
		
		if("0".equals(request.getParameter("workStatus"))){
			//是待办文件
			//取当前节点的可写字段List
			List list = (List) request.getAttribute("RWFieldList");
			String[] str = null;
			for(int i = 0; list!=null && i < list.size(); i ++){//遍历可写字段，将可写字段转化为字符串形式
				str = (String[]) list.get(i);
				if(str[0].equals("1")){//可写字段
					writeFieldString += "$" + str[1] + "$";
				}
			}
			//表单中关联的所有子表字段信息
			String[][] forFieldArr = new CustomFormBD().getForeignField(pageId);
			if(forFieldArr != null){
				for(int i=0; i<forFieldArr.length; i++){
					//遍历所有子表字段，如果字段不在可写字段中，则字段为不可编辑字段
					if(writeFieldString.indexOf("$"+forFieldArr[i][2]+"$")<0){
						forHideField += forFieldArr[i][2]+",";
					}
				}
			}
		}
	}

	if("1".equals(request.getParameter("flag")) || (!"0".equals(request.getParameter("workStatus")) 
			&& !"-2".equals(request.getParameter("workStatus")) && !"-1".equals(request.getParameter("workStatus")))){
		hide_Field="ALL";
	}
	//草稿箱或扩展模块中使用表单
	if(request.getAttribute("fromEFormFlag")!=null && "1".equals(request.getAttribute("fromEFormFlag").toString())){
		hide_Field = "";
	}
		 
	//所有字段不可编辑，该种情况表示在自定义模块中点击链接查看信息
	String[][] fieldArr = cst.getPageField(pageId);//读取表单那关联的所有主表字段信息
	if(fieldArr != null){
		for(int i=0; i<fieldArr.length; i++){
			//遍历所有主表字段
			if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
				//获得主表字段的显示脚本
				//2016-12-26 隐藏表单字段
				if(noDisplayFields.indexOf(","+fieldArr[i][0]+",")>=0){
					String noDisplayHTML="if(document.getElementById('" + fieldArr[i][1] + "-" + fieldArr[i][0] + "'))\n{document.getElementById('" +
							fieldArr[i][1] + "-" + fieldArr[i][0] + "').innerHTML='';}";				
					out.println(noDisplayHTML);
				}else{
					out.print(cst.getEditHTMLForWeiXin(fieldArr[i][0],request.getAttribute("infoId").toString(),pageId,hide_Field,domainId,fieldArr[i][1],parent_fromDraft,allCoumputFieldStr,request));
				}
			}
		}
	}

	//start
	//获得表单那关联的所有子表
	String[] tables = cst.getForeignTable(pageId);
	if (tables != null && tables.length > 0) {
		for (int i = 0; i < tables.length; i++) {
			//遍历所有子表
			if (tables[i] == null || tables[i].trim().length() < 1){
				continue;
			}
			//提取字表关联的所有字段
			String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
			//拼装SQL
			String sql = "";//查询子表关联到表单中的所有字段值的SQL语句
			if(forFields!=null && forFields.length>0){
				int wrLenTemp=0;//可写字段个数
				boolean hideTable = true;//子表是否有可写字段
				for(int k=0; k<forFields.length; k++){
					//遍历所有字段
					sql += forFields[k][5]+",";//将字段添加到数据查询的SQL中
					if(forHideField.indexOf(forFields[k][5])>0){
						//如果该子表中有可编辑字段，则该表可编辑
						hideTable = false;
					}
					if(writeFieldString.indexOf(forFields[k][5])>-1 || "111".equals(forFields[k][1]) || "302".equals(forFields[k][1])){
						//当可写或为自动编号、序号时不验证
						wrLenTemp++;
					}
				}
				if(wrLenTemp==forFields.length||request.getParameter("processId")==null){//子表字段全部可写时该表可增加删除行或者非流程
					hideTable=false;
				}else{
					hideTable=true;
				}
				//如果是待发流程默认为可写表单
				if("1".equals(parent_fromDraft)){
					hideTable=false;
				}
				//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
				if(hideTable){
					hideTableHTML += "<input type=hidden name=hideTable id=hideTable value="+tables[i]+">";
				} else{
					showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
				}
				sql = sql.substring(0,sql.length()-1);
			}
             
			//提取子表数据
			String foreignHideField = "";
			if("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus"))){
				foreignHideField = hide_Field + forHideField;
			} else{
				foreignHideField = "ALL";
			}
			if(request.getAttribute("fromEFormFlag")!=null && "1".equals(request.getAttribute("fromEFormFlag").toString())){
				foreignHideField = "";
			}
			String[][] data = null;
			if(sql.length() > 1){
				sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getAttribute("infoId").toString()+ " order by "+ tables[i] +"_id";
				data = cst.loadDataBySQL(sql,String.valueOf(forFields.length+1));
			} else{
				continue;
			}
			//设置页面子表行数
			if(data!=null && data.length>0){
				for(int n=0; n<data.length-1; n++){//遍历所有数据，解析数据行，根据记录数量增加行
					String script = "currentRow = document.getElementById('"+tables[i]+"TR');addRow();";
					out.print(script);
				}
				for(int n=0; n<data.length; n++){//遍历数据，解析数据在表单上的展示
					//解析数据
					for(int m=0; m<forFields.length; m++){//遍历字段，生成该字段及其值展示在表单上的脚本
						//System.out.println("----------------------:"+data[n][m]);
						String valueString = "";
						if(data[n][m]!=null && data[n][m].toString().startsWith(".")){
							valueString = "0" + data[n][m];
						} else{
							valueString = data[n][m];
						}
						out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],valueString,forFields,foreignHideField,m,String.valueOf(n),forFields[m][0],parent_fromDraft,tables[i],request.getAttribute("infoId").toString(),data[n][forFields.length],forFields[m][10],allCoumputFieldStr));
					}
					String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
					out.print(script);
				}
			} else{//该子表没有数据，隐藏模板中初始化的第一个数据行
				for(int m=0; m<forFields.length; m++){
					out.print(cst.getForeignEditHTMLForWeiXin(request,forFields[m][5],"",forFields,foreignHideField,m,"0",forFields[m][0],parent_fromDraft,tables[i],request.getAttribute("infoId").toString(),"-100",forFields[m][10],allCoumputFieldStr));
				}
				//	吴凯20130205修改为不隐藏
			}
			String agent = request.getHeader("USER-AGENT");   
			if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
				if(-1 != agent.indexOf("MSIE 10")){
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
				} else{
					out.print("document.getElementById('"+tables[i]+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
				}
			} else{
				out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
			}
			//设置统计字段
			String[][] tlFlds = cst.getTotalFieldByTableName(pageId,tables[i],domainId);
			if(tlFlds !=null && tlFlds.length>0){
				//增加统计字段显示行
				/*out.print("addTotalRow('"+tables[i]+"');");
				String tlfld = "";
				for(int p=0;p<tlFlds.length;p++){//遍历统计字段，设置对应的统计字段表单元素
					tlfld +=  tlFlds[p][0]+",";
					String totalValue = tlFlds[p][3];
					if(totalValue.startsWith("1;")){
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}else{
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}  
				}
				out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
				out.print("setTotalValue();");*/
		                    
				String tlfld = "";
				String duiying = "";
				int show = 0;
		
				for(int p=0; p<tlFlds.length; p++){
					String totalValue = tlFlds[p][3];
					if(totalValue.startsWith("1;")){
						show = 1;
						break;
					}
				}
				out.print("addTotalRow('"+tables[i]+"',"+show+");");
				for(int p=0; p<tlFlds.length; p++){
					tlfld +=  tlFlds[p][0]+",";
					String totalValue = tlFlds[p][3];
					if(totalValue.endsWith(";yes")){
						duiying += tlFlds[p][0] + ":";
						String[] toValue = totalValue.split(";");
						for(int to=1; to<toValue.length-1; to++){
							String[] tValue = toValue[to].split("@");
							duiying += tValue[0] + ",";
						}
						while(duiying.endsWith(",")){
							duiying = duiying.substring(0, duiying.length()-1);
						}
						duiying += ";";
					}
					if(totalValue.startsWith("1;")){
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}else{
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}
				}
				out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
				out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
				out.print("setTotalValue();");
				while(duiying.endsWith(";")){
					duiying = duiying.substring(0, duiying.length()-1);
				}
			}
		}
	}//end
}

            out.write("\r\n</script>\r\n");

//子表的计算字段设置
out.print(cst.getForeignComputeFieldHTML(pageId));
out.print(hideTableHTML+showTableHTML);  

            out.write("\r\n\r\n<script language=javascript src=\"/jsoa/weixin/workflow/eform/datetime/time.js\"></script>\r\n<script language=\"javascript\">\r\n\r\nif(document.all.wf_ua){\r\n    if(document.all.wf_ua.length){\r\n    \t\r\n    } else{\r\n        eval(\"document.all.\" + document.all.wf_ua.value + \".value='");
            out.print(session.getAttribute("userAccount"));
            out.write("'\");\r\n    }\r\n}\r\n//document.body.attachEvent(\"onload\",function(){});\r\nsetNoWrap();\r\ninitRow();\r\n</script>\r\n<script src=\"/jsoa/js/util.js\"></script>");
            out.write("\r\n                </td></tr>\r\n                <tr>\r\n                    <td height=\"22\" colspan=\"2\">&nbsp;</td>\r\n                </tr>\r\n                <tr><td id=\"newIframeSpan\" colspan=\"10\"></td></tr>\r\n                ");

                String formName="WorkFlowFormActionForm";//表单FORM名称
                String saveCheckFn = "beforeSubmit()";//保存时校验表单的javascript函数名称
                String mainLinkFile = "/jsoa/WorkFlowProcAction.do?flowpara=1";//文件办理时打开的页面链接
				String passLinkFile = "/jsoa/WorkFlowProcAction.do?flowpara=1";//阅件时打开的页面链接
                String titleFieldName = "";//作为显示标题的表单中的元素的名称,如果为""则按工作流程的标题
                String[][] button = null;//包含页面中的附加按钮的名称和触发的javascript函数名称
                String msgFrom = "工作流程";//短信提醒模块名称
                String cancelHref ="JSMainWinOpen('/jsoa/jsflow/workflow_cancelReason.jsp?workStatus=1&workId=workIdValue&tableId=tableIdValue&processName=processNameValue&recordId=recordIdValue&processId=processIdValue&remindValue=remindValueValue&moduleId=1&remindField=" + request.getParameter("remindField") + "','','TOP=0,LEFT=0,scrollbars=no,resizable=no,width=480,height=250')";
                
            out.write("\r\n                <tr>\r\n                    <td height=\"22\" colspan=\"2\">");
            out.write("\r\n\r\n\r\n \r\n\r\n\r\n");

String localhi = session.getAttribute("org.apache.struts.action.LOCALE").toString();

            out.write("\r\n<script type='text/javascript' src='/jsoa/workflow/dwr/interface/workflowSync.js'></script>\r\n<script type='text/javascript' src='/jsoa/workflow/dwr/engine.js'></script> \r\n\r\n<script src=\"/jsoa/js/util.js\"></script>\r\n<input type=\"hidden\" name=\"page_token\" id=\"page_token\" value=\"");
            out.print(Calendar.getInstance().getTimeInMillis());
            out.write("\"/>\r\n<input type=\"hidden\" name=\"tableId\" id=\"tableId\" value=\"");
            out.print((request.getAttribute("tableId")==null || request.getAttribute("tableId").toString().toUpperCase().equals("NULL"))?request.getParameter("tableId"):request.getAttribute("tableId").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"recordId\" id=\"recordId\" value=\"");
            out.print((request.getAttribute("recordId")==null || request.getAttribute("recordId").toString().toUpperCase().equals("NULL"))?request.getParameter("recordId"):request.getAttribute("recordId").toString());
            out.write("\">\r\n\r\n<input type=\"hidden\" name=\"processType\" id=\"processType\" value=\"");
            out.print((request.getAttribute("processType")==null || request.getAttribute("processType").toString().toUpperCase().equals("NULL"))?request.getParameter("processType"):request.getAttribute("processType").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"processName\" id=\"processName\" value=\"");
            out.print((request.getAttribute("processName")==null || request.getAttribute("processName").toString().toUpperCase().equals("NULL"))?request.getParameter("processName"):request.getAttribute("processName").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"processId\" id=\"processId\" value=\"");
            out.print((request.getAttribute("processId")==null || request.getAttribute("processId").toString().toUpperCase().equals("NULL"))?request.getParameter("processId"):request.getAttribute("processId").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"remindField\" id=\"remindField\" value=\"");
            out.print((request.getAttribute("remindField")==null || request.getAttribute("remindField").toString().toUpperCase().equals("NULL"))?request.getParameter("remindField"):request.getAttribute("remindField").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"moduleId\" id=\"moduleId\" value=\"");
            out.print((request.getAttribute("moduleId")==null || request.getAttribute("moduleId").toString().toUpperCase().equals("NULL"))?request.getParameter("moduleId"):request.getAttribute("moduleId").toString());
            out.write("\">\r\n\r\n<input type=\"hidden\" name=\"mainLinkFile\" id=\"mainLinkFile\" value=\"");
            out.print(mainLinkFile);
            out.write("\">\r\n<input type=\"hidden\" name=\"titleFieldName\" id=\"titleFieldName\" value=\"");
            out.print(titleFieldName);
            out.write("\">\r\n<input type=\"hidden\" name=\"msgFrom\" id=\"msgFrom\" value=\"");
            out.print(msgFrom);
            out.write("\">\r\n<input type=\"hidden\" name=\"cancelHref\" id=\"cancelHref\" value=\"");
            out.print(cancelHref);
            out.write("\">\r\n");
if(request.getParameter("isSubProcWork") != null){
            out.write("\r\n<input type=\"hidden\" name=\"isSubProcWork\" id=\"isSubProcWork\" value=\"1\">\r\n<input type=\"hidden\" name=\"pareProcActiId\" id=\"pareProcActiId\" value=\"");
            out.print(request.getParameter("pareProcActiId"));
            out.write("\">\r\n<input type=\"hidden\" name=\"pareStepCount\" id=\"pareStepCount\" value=\"");
            out.print(request.getParameter("pareStepCount"));
            out.write("\">\r\n<input type=\"hidden\" name=\"pareTableId\" id=\"pareTableId\" value=\"");
            out.print(request.getParameter("pareTableId"));
            out.write("\">\r\n<input type=\"hidden\" name=\"pareRecordId\" id=\"pareRecordId\" value=\"");
            out.print(request.getParameter("pareRecordId"));
            out.write("\">\r\n");
}
            out.write("\r\n\r\n<!-- 新增表单域 -->\r\n");



String markField="1";//标记此方法可用：1,不可用：0
//Map map=new  com.js.oa.jsflow.util.InitWorkFlowData().getClassMethod(markField,request);

com.js.oa.jsflow.vo.ActivityVO activityVO = new com.js.oa.jsflow.util.WorkflowCommon().getFirstActivityInfo(request);
if(false){

            out.write("\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\nweixinMessageReminder(\"alert\", \"提示：\", \"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includenosetupstartactivity"));
            out.write("\", \"\");\r\n</SCRIPT>\r\n<script src=\"/jsoa/public/jsp/cmdbutton.jsp?button=Close\"></script>\r\n");
}else{
            out.write("\r\n<input type=hidden name=userType id=\"userType\" value=100>\r\n<INPUT TYPE=\"hidden\" name=\"operName\" id=\"operName\" value=\"");
            out.print(session.getAttribute("userName").toString());
            out.write("\">\r\n<INPUT TYPE=\"hidden\" name=\"operId\" id=\"operId\" value=\"$");
            out.print(session.getAttribute("userId").toString());
            out.write("$\">\r\n<input type=hidden name=allowStandFor id=\"allowStandFor\" value=\"0\">\r\n<input type=hidden name=allowCancel id=\"allowCancel\" value=\"0\">\r\n<input type=hidden name=activityId id=\"activityId\" value=\"");
            out.print(activityVO==null? 0:activityVO.getId());
            out.write("\">\r\n<input type=hidden name=activityName id=\"activityName\" value=\"");
            out.print(activityVO==null?"":activityVO.getName());
            out.write("\">\r\n\r\n<!-- <input type=hidden name=activityId value=\"0\">\r\n<input type=hidden name=activityName value=\"\">\r\n -->\r\n<input type=hidden name=pressType id=\"pressType\" value=\"0\">\r\n<input type=hidden name=deadLineTime id=\"deadLineTime\" value=\"-1\">\r\n<input type=hidden name=pressMotionTime id=\"pressMotionTime\" value=\"-1\">\r\n<input type=hidden name=\"emergence\" id=\"emergence\" value=0><!--缓急程度-->\r\n<input type=hidden name=\"needSendMsg\" id=\"needSendMsg\"><!--短信-->\r\n<input type=hidden name=\"smsContent\" id=\"smsContent\"><!--短信内容-->\r\n<input type=hidden name=\"dealTips\" id=\"dealTips\"><!--tips内容-->\r\n<input type=hidden name=\"processDeadlineDate\" id=\"processDeadlineDate\" value=\"0\"><!--流程办理期限-->\r\n<input type=hidden name=approveMode id=\"approveMode\" value=\"2\"><!--当前节点办理方式--><!--默认为2：单人-->\r\n<input type=hidden name=saveCheckFn id=\"saveCheckFn\" value=\"");
            out.print(saveCheckFn);
            out.write("\">\r\n<input type=hidden name=formName id=\"formName\" value=\"");
            out.print(formName);
            out.write("\">\r\n\r\n<input type=\"hidden\" name=\"sendMsgToInitiator\" id=\"sendMsgToInitiator\" value=\"0\"> <!-- 是否给发起人发送提醒 -->\r\n<input type=\"hidden\" name=\"sendMsgToDealDone\" id=\"sendMsgToDealDone\" value=\"0\"> <!-- 是否给已办人员发送提醒 -->\r\n<input type=hidden name=sendContinue id=\"sendContinue\" value=\"0\"><!-- 是否发送继续，默认否 -->\r\n<input type=hidden name=sendContinueUrl id=\"sendContinueUrl\" >\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\ndocument.all.sendContinueUrl.value=window.location;\r\n</SCRIPT>\r\n<input type=\"hidden\" name=\"subProcess\" id=\"subProcess\" value=\"");
            out.print("1".equals(request.getParameter("subProcess"))?"1":"0");
            out.write("\"><!-- 是否是子流程发起页面 -->\r\n\r\n<input type=\"hidden\" name=\"changeDeadLineTime\" id=\"changeDeadLineTime\" value=\"-1\">\r\n");
            out.write("\r\n<!--阅件参数-->\r\n<input type=hidden name=\"mainNeedPassRound\" id=\"mainNeedPassRound\" value=\"1\">\r\n<input type=hidden name=\"mainPassRoundUserType\" id=\"mainPassRoundUserType\" value=100>\r\n<input type=hidden name=\"passRoundId\" id=\"passRoundId\">\r\n<input type=hidden name=\"passRoundName\" id=\"passRoundName\">\r\n\r\n  <table align=\"center\" width=\"100%\" style=\"display:none\">\r\n        <tr>\r\n            <td height=\"40\" colspan=\"2\" id=\"include_td1\">\r\n                <table border=\"0\" align=\"center\" cellpadding=\"1\" cellspacing=\"1\">\r\n                    <tr>\r\n                        <td>\r\n                            <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                <tr>\r\n                                    <td>\r\n                                    <button class=\"btnButton4font\" onclick=\"javascript:");
            out.print("1".equals(request.getParameter("moduleId"))?"if(beforeSubmit()){":"");
            out.write("include_nextStep();");
            out.print("1".equals(request.getParameter("moduleId"))?"}":"");
            out.write("\">下一步骤</button>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                        ");

                        if(button != null && button.length > 0){
                            for(int i = 0; i < button.length; i++){
                            //String btnStyle = "btnButton4font";
                            //if (button[i][0].toString().length <= 4)
                            //btnStyle = "btnButton2font";
                                
            out.write("\r\n                                <td>\r\n                                    <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                        <tr>\r\n                                            <td><button class=\"btnButton4font\" onclick=\"javascript:");
            out.print(button[i][1]);
            out.write(';');
            out.write('"');
            out.write('>');
            out.print(button[i][0]);
            out.write("</button></td>\r\n                                        </tr>\r\n                                    </table>\r\n                                </td>\r\n                                ");

                            }
                        }
            out.write("\r\n                        <td>\r\n                            <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                <tr>\r\n                                    <td>\r\n                                        <button class=\"btnButton2font\" onclick=\"javascript:window.location.reload();\">重置</button>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                        <td>\r\n                            <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                <tr>\r\n                                    <td>\r\n                                    <button class=\"btnButton2font\" onclick =\"javascript:window.close();\">退出</button>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        ");
//if(com.js.system.util.SysSetupReader.getInstance().hasEzWorkFlow(session.getAttribute("domainId").toString())){
            out.write("\r\n        <!--\r\n        <tr>\r\n            <td colspan=\"2\" align=\"center\">\r\n                <iframe height=\"500\" width=\"90%\" src=\"/jsoa/jsflow/jsflow_view.jsp?processId=");
            out.print(request.getParameter("processId"));
            out.write("&table=");
            out.print(request.getParameter("table"));
            out.write("&record=");
            out.print(request.getParameter("record"));
            out.write("&CurActivityID=&ActivityIDStr=\"></iframe>\r\n            </td>\r\n        </tr>-->\r\n        ");
//}
            out.write("\r\n    </table>\r\n\r\n<iframe width=\"0\" height=\"0\" id=\"include_iframe\" name=\"include_iframe\" style=\"display:none\"></iframe>\r\n<script language=\"javascript\">\r\n");
if(!"0".equals(request.getParameter("processType"))){
            out.write("\r\nvar include_td1HTML = document.all.include_td1.innerHTML;\r\n");
}
            out.write("\r\n\r\n//取消显示退回信息\r\nfunction include_backCacnel(){\r\n    document.all.include_td1.innerHTML = include_td1HTML;\r\n}\r\n\r\n//保存\r\nfunction include_save(){\r\n\tif(");
            out.print(saveCheckFn);
            out.write("){\r\n   \t\tvar _userType=document.all.userType.value;\r\n  \t\tif(_userType==\"10\"){\r\n       \t\t//选择方式是部门领导的，已经将领导empId,empName 取出，按照用户处理\r\n        \t_userType=\"100\";\r\n    \t}\r\n     \tswitch (parseInt(_userType)) {\r\n\t\t\tcase 100:\r\n       \t\t\t//新节点\r\n         \t\tvar empId = \"\";\r\n           \t\tvar orgId = \"\";\r\n        \t\tvar groupId = \"\";\r\n              \tvar idstr = document.all.operId.value;\r\n              \tif(idstr != \"\"){\r\n                \tfor( var i = 0; i < idstr.length; i ++ ){\r\n                   \t\tflagCode = idstr.charAt(i);\r\n                     \tnextPos = idstr.indexOf(flagCode,i + 1);\r\n                    \tstr = idstr.substring(i,nextPos+1);\r\n                     \tif(flagCode == \"$\"){\r\n                        \tempId = empId + str;\r\n                     \t}else if(flagCode == \"*\"){\r\n                          \torgId = orgId + str;\r\n                      \t}else{\r\n                          \tgroupId = groupId + str;\r\n                     \t}\r\n                     \ti = nextPos;\r\n                \t}\r\n                }\r\n            \tworkflowSync.getUserStatusByEmpOrgGrp(empId, orgId, groupId, include_checkUserStatus);\r\n");
            out.write("            \tbreak;\r\n        \tcase 0:\r\n              \t//流程发起人的上级领导\r\n               \tvar userIds = \"\";\r\n             \tif(document.all.candidateUser.length){\r\n                \tfor(i = 0; i < document.all.candidateUser.length; i ++ ){\r\n                   \t\tif(document.all.candidateUser[i].checked){\r\n                        \tuserIds += document.all.candidateUser[i].value + \",\";\r\n                      \t}\r\n                 \t}\r\n             \t}else{\r\n                 \tuserIds = document.all.candidateUser.value;\r\n              \t}\r\n            \tworkflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n              \tbreak;\r\n         \tcase 1:\r\n             \t//由上一节点参与者从所有用户中选择\r\n              \tvar empId = \"\";\r\n              \tvar orgId = \"\";\r\n               \tvar groupId = \"\";\r\n              \tvar idstr = document.all.operProcUser.value;\r\n               \tif(idstr != \"\"){\r\n                 \tfor( var i = 0; i < idstr.length; i ++ ){\r\n                     \tflagCode = idstr.charAt(i);\r\n                     \tnextPos = idstr.indexOf(flagCode,i + 1);\r\n");
            out.write("                      \tstr = idstr.substring(i,nextPos+1);\r\n                      \tif(flagCode == \"$\"){\r\n                        \tempId = empId + str;\r\n                       \t}else if(flagCode == \"*\"){\r\n                          \torgId = orgId + str;\r\n                       \t}else{\r\n                       \t\tgroupId = groupId + str;\r\n                      \t}\r\n                    \ti = nextPos;\r\n                 \t}\r\n              \t}\r\n              \tworkflowSync.getUserStatusByEmpOrgGrp(empId, orgId, groupId, include_checkUserStatus);\r\n            \tbreak;\r\n           \tcase 2:\r\n           \t\t//从候选人员中指定candidateUser\r\n              \tvar userIds = \"\";\r\n              \tif(document.all.candidateUser.length){\r\n                \tfor(i = 0; i < document.all.candidateUser.length; i ++ ){\r\n                    \tif(document.all.candidateUser[i].checked){\r\n                    \t\tuserIds += document.all.candidateUser[i].value + \",\";\r\n                  \t\t}\r\n               \t\t}\r\n              \t}else{\r\n               \t\tuserIds = document.all.candidateUser.value;\r\n");
            out.write("               \t}\r\n              \tworkflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n              \tbreak;\r\n         \tcase 3:\r\n            \t//指定全部办理人\r\n             \tvar userIds = \"\";\r\n              \tif(document.all.allUser.length){\r\n                \tfor(i = 0; i < document.all.allUser.length; i ++ ){\r\n                     \tuserIds += document.all.allUser[i].value + \",\";\r\n                  \t}\r\n                }else{\r\n            \t\tuserIds = document.all.allUser.value;\r\n            \t}\r\n            \tworkflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n               \tbreak;\r\n           \tcase 5:\r\n         \t\t//流程发起人\r\n            \tworkflowSync.getUserStatus(\"");
            out.print(session.getAttribute("userId"));
            out.write("\", include_checkUserStatus);\r\n            \tbreak;\r\n        \tcase 6:\r\n             \t//角色用户\r\n             \tworkflowSync.getUserStatusByRole(document.all.partRole.value, \"");
            out.print(session.getAttribute("userId"));
            out.write("\", include_checkUserStatus);\r\n              \tbreak;\r\n\t\t\tcase 10:\r\n               \t//组织领导\r\n              \tvar orgId = \"\";\r\n            \tvar idstr = document.all.operId.value;\r\n             \tif(idstr != \"\"){\r\n                \tfor( var i = 0; i < idstr.length; i ++ ){\r\n                     \tflagCode = idstr.charAt(i);\r\n                      \tnextPos = idstr.indexOf(flagCode,i + 1);\r\n                   \t\tstr = idstr.substring(i+1,nextPos);\r\n                      \tif(flagCode == \"*\"){\r\n                         \torgId = orgId + str + \",\";\r\n                      \t}\r\n                      \ti = nextPos;\r\n                  \t}\r\n              \t}\r\n\t\t\t\torgId = orgId.substring(0,orgId.length-1);\r\n\t\t\t\tdocument.all.operId.value = orgId;\r\n               \tworkflowSync.getLeaderByOrgId(orgId, include_checkUserStatus);\r\n               \tbreak;\r\n          \tdefault:\r\n            \tbreak;\r\n      \t}\r\n\t}\r\n}\r\n\r\n//保存至草稿\r\nfunction include_saveToDraft(appBh){\r\n\tif(include_checkUser()){\r\n        //");
            out.print(saveCheckFn);
            out.write(";\r\n        \t");
            out.print(formName);
            out.write(".target = \"myIframe\";\r\n\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=saveToDraft&savefirst=1");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t//pullXMenuDisabledAllMenu();\r\n\t\t    weixinMessageReminder(\"alert\", \"提示：\", \"保存成功！\",\"loadURL('\"+appBh+\"');\");\r\n\t\t    //到微信列表页面\r\n\t\t\t\r\n\t}\r\n}\r\nfunction toList(){\r\n   location.href = \"/jsoa/weiXinWorkFlowAction.do?moduleId=1\";\r\n}\r\n\r\n//保存至草稿\r\nfunction include_saveFirstComp(){\r\n\tif(include_checkUser()){\r\n        ");
            out.print(saveCheckFn);
            out.write(";\r\n        \t");
            out.print(formName);
            out.write(".target = \"myIframe\";\r\n\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=saveFirstComp&savefirst=1");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\tpullXMenuDisabledAllMenu();\r\n\t\t\r\n\t}\r\n}\r\n//保存第一步\r\nfunction include_saveFirst(){\r\n    if(include_checkUser()){\r\n        if(");
            out.print(saveCheckFn);
            out.write("){\r\n            switch (parseInt(document.all.userType.value)) {\r\n\t\t\t\tcase 100:\r\n                    //新节点\r\n                    var empId = \"\";\r\n                    var orgId = \"\";\r\n                    var groupId = \"\";\r\n                    var idstr = document.all.operId.value;\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i,nextPos+1);\r\n                            if(flagCode == \"$\"){\r\n                                empId = empId + str;\r\n                            }else if(flagCode == \"*\"){\r\n                                orgId = orgId + str;\r\n                            }else{\r\n                                groupId = groupId + str;\r\n                            }\r\n                            i = nextPos;\r\n                        }\r\n                    }\r\n                    ");
            out.print(formName);
            out.write(".target = \"_self\";\r\n\t\t\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=save&savefirst=1");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t\t\tpullXMenuDisabledAllMenu();\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    \r\n}\r\n\r\n\r\nfunction include_checkUserStatus(s) {\r\n\tif(s==\"noleader\"){\r\n\t\t//组织领导不存在\r\n\t\t//alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includenoleader"));
            out.write("\");\r\n\t\tweixinMessageReminder(\"alert\", \"提示：\", \"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includenoleader"));
            out.write("\");\r\n\t\treturn;\r\n\t}\r\n\t");
if("0".equals(request.getParameter("processType"))){
            out.write("\r\n\t\t\r\n\t");
} else{
            out.write("\r\n\t\t//业务流程\r\n\t\tif(s == \"\"){\r\n\t\t\t\r\n\t\t\tvar frm=document.getElementsByName(\"");
            out.print(formName);
            out.write("\")[0];\r\n\t\t\tfrm.target = \"myIframe\";\r\n\t\t\tfrm.action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=save");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\tfrm.submit();\r\n\t\t\t//");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t//提示“已提交给XX[XX]”");
            out.write("\r\n\t\t\t");
            out.write("\r\n\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
            out.write("\"+document.all.operName.value+\"[\"+document.all.activityName.value+\"]\",\"include_close('");
            out.print(appBh);
            out.write("');\");\r\n\t\t\t//到微信列表页面\r\n\t\t\t\r\n\t\t\t");
            out.write("\r\n\t\t} else {\r\n\t\t//下一办理人：XX ，您确定要提交办理吗？\r\n\t\t\tif(confirm(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includenextuser"));
            out.write("：\" + s + \"，");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmturntodeal"));
            out.write("\")){\r\n\t\t\t\t");
            out.print(formName);
            out.write(".target = \"myIframe\";\r\n\t\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonForWeiXinAction.do?flag=save");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\t\t\r\n\t\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t\t//提示“已提交给XX[XX]”\r\n\t\t\t\t//alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
            out.write("\"+document.all.operName.value+\"[\"+document.all.activityName.value+\"]\");\r\n\t\t\t\tweixinMessageReminder(\"alert\", \"提示：\", \"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
            out.write("\"+document.all.operName.value+\"[\"+document.all.activityName.value+\"]\",\"tolist();\");\r\n\t\t\t\t");
if(BrowserJudge.isFirefox(request)){
            out.write("\r\n\t\t\t\tsetTimeout(\"window.close()\",1200);\r\n\t\t\t\t");
}
            out.write("\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t//pullXMenuDisabledAllMenu();\r\n\t");
}
            out.write("\r\n}\r\n\r\nfunction tolist(){\r\n   location.replace(\"/jsoa/weiXinWorkFlowAction.do?moduleId=1\");\r\n}\r\n//检验办理用户\r\nfunction include_checkUser(){\r\n    if(document.all.randomProcUser){\r\n        if(document.all.randomProcUser.value == \"\"){\r\n            //alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            weixinMessageReminder(\"alert\", \"提示：\", \"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\", \"\");\r\n            return false;\r\n        }\r\n    }\r\n    if(document.all.candidateUser){\r\n        var i = 0;\r\n        if(document.all.candidateUser.length){\r\n            for(var j = 0; j < document.all.candidateUser.length; j ++){\r\n                if(document.all.candidateUser[j].checked){\r\n                    i = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }else{\r\n            if(document.all.candidateUser.checked){\r\n                i = 1;\r\n            }\r\n        }\r\n        if(i == 0){\r\n            //alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            weixinMessageReminder(\"alert\", \"提示：\", \"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            return false;\r\n        }\r\n    }\r\n\r\n    if(document.all.operProcUserName){\r\n        if(document.all.operProcUserName.value == \"\"){\r\n            //alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            weixinMessageReminder(\"alert\", \"提示：\", \"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\n\r\n//选择全部办理/阅件用户\r\nfunction selectAll(name,obj){\r\n\tif(eval(\"document.all.\"+name)){\r\n\t\tif(eval(\"document.all.\"+name+\".length\")){\r\n\t\t\tfor(i=0;i<eval(\"document.all.\"+name+\".length\");i++){\r\n\t\t\t\tif(obj.checked){\r\n\t\t\t\t\teval(\"document.all.\"+name)[i].checked = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\teval(\"document.all.\"+name)[i].checked = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(obj.checked){\r\n\t\t\t\teval(\"document.all.\"+name).checked = true;\r\n\t\t\t}else{\r\n\t\t\t\teval(\"document.all.\"+name).checked = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//保存继续\r\nfunction include_continue(){\r\n    if(include_checkUser()){\r\n        if(");
            out.print(saveCheckFn);
            out.write("){\r\n            document.all.include_td1.style.display = \"none\";\r\n            ");
            out.print(formName);
            out.write(".target = \"_self\";\r\n            ");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowCommonAction.do?flag=save");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("&continue=1\";\r\n            ");
            out.print(formName);
            out.write(".submit();\r\n            pullXMenuDisabledAllMenu();\r\n        }\r\n    }\r\n}\r\n\r\n</script>\r\n");
}
            out.write("\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n//关闭\r\nfunction include_close(appBh){\r\n\t");

	if("weixin".equals(loginType)){
		
            out.write("closeWindow();");

	} else{
		
            out.write("loadURL(appBh);");

	}
	
            out.write("\r\n}\r\nfunction editOffices(field,fileType,template,showSign){\r\n\t//alert(\"开始打开\");\r\n\tvar recordId = eval(\"document.all.\"+field+\".value\");\r\n\tvar userName = document.all.user_Name.value;\r\n\t\r\n\twindow.open(\"/jsoa/iWebOfficeSign/DocumentEdit.jsp?RecordID=\"+recordId+\"&EditType=1&UserName=\"+userName+\r\n\t\t\t\"&ShowSign=\"+showSign+\"&CanSave=1&moduleType=information&saveHtmlImage=0&saveDocFile=0&field=\"+field+\r\n\t\t\t\"&FileType=.\"+fileType+\"&showEditButton=1&showSignButton=1&Template=\"+template, \r\n\t\t\t\"\", \"status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,Height=400,left=0,top=0\");\r\n}\r\n</SCRIPT>\r\n<!-- ******************* -->\r\n<!-- 2014-10-30 张翔  修改：流程退回到发起人时不提示办理意见 -->\r\n");
//办理提示
String dealTips = new com.js.oa.jsflow.service.WorkFlowButtonBD().getDealTipsByWorkId(request.getParameter("work"));
if(dealTips!=null && !dealTips.equals("")){
	
            out.write("\r\n\t<script type='text/javascript'>\r\n\t var url=\"/jsoa/weixin/workflow/showDealTipsForWeiXin.jsp?work=");
            out.print(request.getParameter("work"));
            out.write("&resubmit=");
            out.print(request.getParameter("resubmit") );
            out.write("\";\r\n     var commonPopIframe = document.getElementById(\"commonPopIframe\");\r\n     commonPopIframe.src = url;\r\n     document.getElementById(\"commonPopDiv\").style.display = \"block\";\r\n\t</script>\r\n\t");

}

            out.write("\r\n<!-- ******************* -->");
            out.write("</td>\r\n                </tr>\r\n                </form>\r\n                <tr style=\"display:none\">\r\n                    <td><iframe name=\"myIframe\" ></iframe></td>\r\n                </tr>\r\n            </table>\r\n            </div>\r\n            <div id=\"docinfo1\" style=\"display:none\">\r\n           \r\n                <table width=\"100%\">\r\n                    <tr>\r\n                        <td colspan=\"10\" align=\"center\">\r\n                            <iframe id=\"flowimg\" name=\"flowimg\" height=\"500\" width=\"90%\" src=\"\"></iframe>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </div>\r\n           </td>\r\n           <td width=\"25\" height=\"25\"></td>\r\n           <td width=\"25\" height=\"25\"></td>\r\n        </tr>\r\n       <tr><td colspan=\"5\" height=\"15\"></td></tr>\r\n       <tr>\r\n           <td width=\"25\" height=\"25\"></td>\r\n           <td width=\"25\" style=\"border-top:1px solid #aaaaaa;border-right:1px solid #aaaaaa;\"><br></td>\r\n           <td></td>\r\n           <td width=\"25\" style=\"border-top:1px solid #aaaaaa;border-left:1px solid #aaaaaa;\"><br></td>\r\n");
            out.write("           <td width=\"25\"></td>\r\n       </tr>\r\n       <tr><td colspan=\"5\" height=\"25\"></td></tr>\r\n     </table>\r\n       </td>\r\n    </tr>\r\n</table>\r\n</div>\r\n</td>\r\n</tr>\r\n</table>\r\n</td>\r\n</tr>\r\n</table>\r\n<iframe name=\"newIframe\" id=\"newIframe\" style=\"display:none\"></iframe>\r\n</body>\r\n<script language=\"javascript\">\r\n<!--\r\nfunction checkNum(obj){\r\n    if(isNaN(obj.value)){\r\n        alert(\"请输入数字！\");\r\n        obj.select();\r\n        obj.focus();\r\n    }\r\n}\r\n\r\nfunction checkTextAreaLen(obj,len){\r\n    if(obj.value.length >= len){\r\n        alert(\"文本输入长度不能超过\" + len);\r\n        obj.select();\r\n        obj.focus();\r\n    }\r\n}\r\n\r\nfunction nextStep(){\r\n    if(beforeSubmit()){\r\n        WorkFlowFormActionForm.target = \"newIframe\";\r\n        WorkFlowFormActionForm.action = \"/jsoa/WorkFlowNewIframeAction.do\";\r\n        WorkFlowFormActionForm.submit();\r\n    }\r\n}\r\n\r\nfunction save(){\r\n    //setHtmlValue();\r\n    document.all.myAction.value = \"submitForm\";\r\n    if(beforeSubmit()){\r\n        WorkFlowFormActionForm.target = \"_self\";\r\n        WorkFlowFormActionForm.action = \"/jsoa/JsFlowAddAction.do?sendMsg=4\";\r\n");
            out.write("        WorkFlowFormActionForm.submit();\r\n    }\r\n}\r\n\r\nfunction setHtmlValue(){\r\n    if(document.all.hasHtml){\r\n        //页面中包含有HTML编辑器\r\n        if(document.all.hasHtml.length){\r\n            //页面中包含不止一个HTML编辑器\r\n            var len = document.all.hasHtml.length;\r\n            for(var j = 0; j < len; j ++){\r\n            \tvar htmlEditName = document.all.hasHtml[j].value;\r\n            \tvar o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n            \tdocument.getElementById(htmlEditName).value=o_Editor.getHTML();\r\n                //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n            }\r\n        }else{\r\n        \t//alert(document.all.hasHtml.value);\r\n            //页面上仅有一个HTML编辑器\r\n            var htmlEditName = document.all.hasHtml.value;\r\n            var o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n            document.getElementById(htmlEditName).value=o_Editor.getHTML();\r\n            //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n");
            out.write("        }\r\n    }\r\n}\r\n\r\nfunction addFile(fieldName){\r\n    JSMainWinOpen(\"jsflow/workflow_upload.jsp?fieldName=\" + fieldName ,'上传','menubar=0,scrollbars=0,locations=0,width=400,height=200,resizable=no');\r\n}\r\n\r\nfunction deleteRow(rowNum,fieldName,saveName){\r\n    var tableObj = eval(\"document.all.\" + fieldName + \"_tab\");\r\n    for(var i = 0; i < tableObj.rows.length; i ++){\r\n    \tvar removeNode = tableObj.rows(i);\r\n        if(removeNode.all.tableRow){\r\n            if(removeNode.all.tableRow.value == rowNum){\r\n                removeNode.removeNode(true);\r\n                document.all.myIframe.src = \"/jsoa/jsflow/workflow_deleteFile.jsp?saveName=\" + saveName;\r\n            }\r\n        }\r\n    }\r\n//    removeNode.removeNode(true);\r\n}\r\n\r\nfunction delGroupRow(fieldName,rowNum){\r\n    var tableObj = eval(\"document.all.\" + fieldName + \"_group\");\r\n    for(var i = 1; i < tableObj.rows.length; i ++){\r\n        var removeNode = tableObj.rows(i);\r\n        if(removeNode.all.tableRow.value == rowNum){\r\n            removeNode.removeNode(true);\r\n");
            out.write("        }\r\n    }\r\n}\r\n\r\nfunction beforeSubmit(){\r\n\t\tsetHtmlValue();\r\n    var canSubmit = true;\r\n    if(document.all.mustWrite){\r\n        //如果页面有必填项\r\n        if(document.all.mustWrite.length){\r\n            //如果页面不止一个必填项\r\n            for(var i =0; i < document.all.mustWrite.length; i ++){\r\n                var obj = eval(\"document.all.\" + document.all.mustWrite[i].value);\r\n                if(obj){\r\n                    var objType = \"\";\r\n                    if(obj.type){\r\n                       objType = obj.type.toUpperCase();\r\n                    }else{\r\n                        if(obj.length){\r\n\t\t\t\t\t\t\tfor(var k=0;k<obj.length;k++){\r\n\t\t\t\t\t\t\t\t//i++;\r\n\t\t\t\t\t\t\t\tobjType = obj[k].type.toUpperCase();\r\n\t\t\t\t\t\t\t\tvar objTemp = obj[k];\r\n\t\t\t\t\t\t\t\tif(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n");
            out.write("\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HIDDEN\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\t//obj.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"CHECKBOX\"){\r\n\t\t\t\t\t\t\t\t\tif(!checkboxIsChecked(objTemp)){\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\t//obj.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HTML\"){\r\n\t\t\t\t\t\t\t\t\tif(eval(objTemp.id + \".getHTML()\")==\"\"){\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n                        }else{\r\n                            objType = \"HTML\";\r\n                        }\r\n                    }\r\n                    if(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n                        if(textIsEmpty(obj)){\r\n");
            out.write("                            alert(\"请填写必填项！\");\r\n                            obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"HIDDEN\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"CHECKBOX\"){\r\n                        if(!checkboxIsChecked(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n");
            out.write("                            break;\r\n                        }\r\n                    }else if(objType == \"HTML\"){\r\n                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n                    }\r\n                }\r\n                if(document.all.fieldName && document.all.fieldName.length){\r\n                    for(var j = 0; j < document.all.fieldName.length; j ++){\r\n                        if(document.all.fieldName[j].value == document.all.mustWrite[i].value + \"_file\"){\r\n                            if(!eval(\"document.all.\" + document.all.mustWrite[i].value + \"_fileName\")){\r\n                                alert(\"请填写必填项！\");\r\n                                canSubmit = false;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    if(!canSubmit){\r\n                    \tbreak;\r\n                    }\r\n                }\r\n");
            out.write("                obj = eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\");\r\n                if(obj){\r\n                   if(eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\").value==\"\"){\r\n                        alert(\"请填写必填项！\");\r\n                        canSubmit = false;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }else{\r\n            //页面只有一个必填项\r\n            var obj = eval(\"document.all.\" + document.all.mustWrite.value);\r\n            if(obj){\r\n                var objType = \"\";\r\n                if(obj.type){\r\n                    objType = obj.type.toUpperCase();\r\n                }else{\r\n                    if(obj.length){\r\n                        objType = obj[0].type.toUpperCase();\r\n                    }else{\r\n                        objType = \"HTML\";\r\n                    }\r\n                }\r\n                if(objType == \"TEXT\"  || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n                    if(textIsEmpty(obj)){\r\n");
            out.write("                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n                    if(obj.html.length == 0){\r\n                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"HIDDEN\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                        }\r\n                    }else if(objType == \"CHECKBOX\"){\r\n                    if(!checkboxIsChecked(obj)){\r\n                        alert(\"请填写必填项！\");\r\n                        //obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"HTML\"){\r\n                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n                            alert(\"请填写必填项！\");\r\n");
            out.write("                            canSubmit = false;\r\n                        }\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if(document.all.fieldName && document.all.fieldName.length){\r\n                for(var j = 0; j < document.all.fieldName.length; j ++){\r\n                    if(document.all.fieldName[j].value == document.all.mustWrite.value + \"_file\"){\r\n                        if(!eval(\"document.all.\" + document.all.mustWrite.value + \"_fileName\")){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n\t\t\tobj = eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\");\r\n                if(obj){\r\n                   if(eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\").value==\"\"){\r\n                        alert(\"请填写必填项！\");\r\n                        canSubmit = false;\r\n                    }\r\n                }\r\n        }\r\n    }\r\n\r\n    if(document.all.computeField) {\r\n        //有计算字段\r\n");
            out.write("        if(document.all.computeField.length) {\r\n            //不止一个计算字段\r\n            for(var i = 0; i < document.all.computeField.length.value; i ++){\r\n                setCompleteField(document.all.computeFieldValue[i], document.all.computeField[i].value);\r\n            }\r\n        }else{\r\n            //只有一个计算字段\r\n            setCompleteField(document.all.computeFieldValue, document.all.computeField.value);\r\n        }\r\n    }\r\n\r\n/*\r\n    try{\r\n\t var reg = /(f\\d+)/g;\r\n    if(document.all.computeField){\r\n        if(document.all.computeField.length){\r\n\t\t\t//alert(document.all.computeField.length);\r\n            for(var i = 0; i < document.all.computeField.length; i ++){\r\n\t\t\t\t//alert(i);\r\n                var computeField = document.all.computeField[i].value;\r\n                var computeFieldValue = document.all.computeFieldValue[i].value;\r\n                var fieldArray = computeFieldValue.match(reg);\r\n                var isNotTime = true;\r\n                if(fieldArray.length == 2){\r\n                    var testValue1 = \"\";\r\n");
            out.write("\r\n                    if(eval(\"document.all.\" + fieldArray[0])){\r\n                        testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n                    }else{\r\n                        testValue1 = \"\";\r\n\r\n                    }\r\n\r\n                    var testValue2 = \"\";\r\n                    if(eval(\"document.all.\" + fieldArray[1])){\r\n                        testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n                    }else{\r\n                        testValue2 = \"\";\r\n                    }\r\n\t\t\t\t\t//if(i==1) alert(\"third\");\r\n                    if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"-\") > 0 && testValue2.indexOf(\"-\") > 0){\r\n                        isNotTime = false;\r\n\t\t\t\t\t\tvar date1,date2;\r\n\t\t\t\t\tif(testValue1.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2].split(\" \")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue1 = testValue1.split(\" \")[0];\r\n");
            out.write("\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//alert(testValue1);\r\n\t\t\t\t\tif(testValue2.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2].split(\" \")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue2 = testValue2.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n                   // var day =((new Date(testValue1) - new Date(testValue2))) + \"\";\r\n\t\t\t\t   var day = (date1-date2) / 86400000+\"\";\r\n                        if(day.indexOf(\".\") > 0){\r\n                            if((day.length - day.indexOf(\".\")) > 2){\r\n                            \tday = day.substring(0, day.indexOf(\".\") + 3);\r\n                            }\r\n                        }\r\n\t\t\t\t\t\t//alert(\"day\");\r\n                        document.all.computeFieldValue[i].value=day ;\r\n");
            out.write("\t\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\")){\r\n\t\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\").value = day;\r\n\t\t\t\t\t\t}\r\n\r\n                    }\r\n                }\r\n                if(isNotTime){\r\n\t\t\t\t\t//alert(isNotTime);\r\n                    for(var j = 0; j < fieldArray.length; j ++){\r\n\t\t\t\t\t\tif(eval(\"document.all.\" + fieldArray[j])){\r\n\t\t\t\t\t\t\tcomputeFieldValue = computeFieldValue.replace(fieldArray[j],eval(\"document.all.\" + fieldArray[j] + \".value\"));\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tcomputeFieldValue=\"\\\"\\\"+\\\"\\\"\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n                    }\r\n                    try{\r\n                    \tdocument.all.computeFieldValue[i].value= eval(computeFieldValue);\r\n\t\t\t\t\t\t//alert(document.all.computeField[i].value);\r\n\t\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\") && eval(computeFieldValue)!=\"''\"){\r\n\t\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField[i].value+\"_cmp\").value = eval(computeFieldValue);\r\n\t\t\t\t\t\t}\r\n                    }catch(e){document.all.computeFieldValue[i].value=\"\";}\r\n");
            out.write("\r\n                }\r\n            }\r\n        }else{\r\n            var computeField = document.all.computeField.value;\r\n            var computeFieldValue = document.all.computeFieldValue.value;\r\n            var fieldArray = computeFieldValue.match(reg);\r\n            var isNotTime = true;\r\n            if(fieldArray.length == 2){\r\n                var testValue1 = \"\";\r\n                if(eval(\"document.all.\" + fieldArray[0])){\r\n                    testValue1 = eval(\"document.all.\" + fieldArray[0] + \".value\");\r\n                }else{\r\n                    testValue1 = \"\";\r\n                }\r\n                var testValue2 = \"\";\r\n                if(eval(\"document.all.\" + fieldArray[1])){\r\n                    testValue2 = eval(\"document.all.\" + fieldArray[1] + \".value\");\r\n                }else{\r\n                    testValue2 = \"\";\r\n                }\r\n\r\n                if(computeFieldValue.indexOf(\"-\") > 0 && testValue1.indexOf(\"-\") > 0 && testValue2.indexOf(\"-\") > 0){\r\n                    isNotTime = false;\r\n\t\t\t\t\t//alert(testValue1);\r\n");
            out.write("\t\t\t\t\tvar date1,date2;\r\n\t\t\t\t\tif(testValue1.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2].split(\" \")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue1.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue1 = testValue1.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate1 = new Date(testValue1.split(\"-\")[0],testValue1.split(\"-\")[1],testValue1.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//alert(testValue1);\r\n\t\t\t\t\tif(testValue2.indexOf(\" \")>0){\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2].split(\" \")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[0],testValue2.split(\"-\")[2].split(\" \")[1].split(\":\")[1],\"0\");\r\n\t\t\t\t\t\t//testValue2 = testValue2.split(\" \")[0];\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdate2 = new Date(testValue2.split(\"-\")[0],testValue2.split(\"-\")[1],testValue2.split(\"-\")[2]);\r\n\t\t\t\t\t}\r\n                   // var day =((new Date(testValue1) - new Date(testValue2))) + \"\";\r\n\t\t\t\t   var day = (date1-date2) / 86400000+\"\";\r\n");
            out.write("\t\t\t\t\t//alert(day);\r\n\t\t\t\t\t//alert(date1-date2);\r\n\t\t\t\t\t//alert(((new Date(testValue1) - new Date(testValue2)) / 86400000));\r\n                    if(day.indexOf(\".\") > 0){\r\n\t\t\t\t\t\t//alert(day);\r\n                        if((day.length - day.indexOf(\".\")) > 2){\r\n\t\t\t\t\t\t\t//alert(day);\r\n                            day = day.substring(0, day.indexOf(\".\") + 3);\r\n                        }\r\n                    }\r\n\t\t\t\t\t//alert(day);\r\n                    document.all.computeFieldValue.value = day ;\r\n\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\")){\r\n\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField.value+\"_cmp\").value = day;\r\n\t\t\t\t\t}\r\n                }\r\n            }\r\n            if(isNotTime){\r\n\t\t\t\t//alert(eval(\"document.all.\" + fieldArray[0] + \".value\"));\r\n                for(var j = 0; j < fieldArray.length; j ++){\r\n\t\t\t\t\tif(eval(\"document.all.\" + fieldArray[j])){\r\n\t\t\t\t\t\tcomputeFieldValue = computeFieldValue.replace(fieldArray[j],eval(\"document.all.\" + fieldArray[j] + \".value\"));\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tcomputeFieldValue=\"\\\"\\\"+\\\"\\\"\";\r\n");
            out.write("\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n                }\r\n                try{\r\n\t\t\t\t\t//alert(computeFieldValue);\r\n                    document.all.computeFieldValue.value = eval(computeFieldValue);\r\n\t\t\t\t\t//alert(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\"));\r\n\t\t\t\t\tif(eval(\"document.all.\"+document.all.computeField.value+\"_cmp\") && eval(computeFieldValue)!=\"\"){\r\n\t\t\t\t\t\teval(\"document.all.\"+document.all.computeField.value+\"_cmp\").value = eval(computeFieldValue);\r\n\t\t\t\t\t}\r\n                }catch(e){document.all.computeFieldValue.value = \"\";}\r\n\r\n            }\r\n        }\r\n    }\r\n    }catch(e){}\r\n    */\r\n    if(canSubmit){\r\n\t//自动添加批示意见\r\n\t/*if(document.getElementById(\"noteDiv\")){\r\n\tvar comment=document.getElementById(\"noteDiv\").getAttribute(\"value\");\r\n\tif(eval(\"document.all.\"+comment+\".value\")==''){\r\n\t\tvar r_commentarr = document.all.r_comment;\r\n\t\tvar r_comment ='';\r\n\t\tfor(var i=0;i<r_commentarr.length;i++){\r\n\t\t\tif(r_commentarr[i].checked==true){\r\n\t\t\t\tr_comment = r_commentarr[i].value;\r\n\t\t\t}\r\n\t\t}\r\n\t\t(eval(\"document.all.\"+comment)).value = r_comment;\r\n");
            out.write("\t}*/\r\n\r\n        setHtmlValue();\r\n    //}\r\n   }\r\n   return canSubmit;\r\n\t//return false;\r\n}\r\n\r\nfunction setCompleteField(computeFieldValueObj, computeField){\r\n    computeFieldValue = computeFieldValueObj.value;\r\n\r\n    while(computeFieldValue.indexOf(\"*\") > 0 || computeFieldValue.indexOf(\"/\") > 0){\r\n        var i = computeFieldValue.indexOf(\"*\");\r\n        var j = computeFieldValue.indexOf(\"/\");\r\n        if(i > 0 && j > 0){\r\n            //有乘法有除法\r\n            if(i < j){\r\n                //做乘法\r\n                var field1 = computeFieldValue.substring(0, i);\r\n                var field2;\r\n                var s = computeFieldValue.substring(i+1, computeFieldValue.length);\r\n                if(s.indexOf(\"*\") > 0 || s.indexOf(\"/\") > 0){\r\n                    var p = s.indexOf(\"*\");\r\n                    var q = s.indexOf(\"/\");\r\n                    if(p > 0 && q > 0){\r\n                        if(p < q){\r\n                            field2 = s.substring(0, p);\r\n                        }else{\r\n                            field2 = s.substring(0, q);\r\n");
            out.write("                        }\r\n                    }else{\r\n                        if(p < 0){\r\n                            field2 = s.substring(0, q);\r\n                        }\r\n                        if(q < 0){\r\n                            field2 = s.substring(0, p);\r\n                        }\r\n                    }\r\n                }else{\r\n                    field2 = s;\r\n                }\r\n                var fieldValue1 = field1;\r\n                if(isNaN(field1)) {\r\n                    fieldValue1 = eval(\"document.all.\" + field1 + \".value\");\r\n                }\r\n                var fieldValue2 = eval(\"document.all.\" + field2 + \".value\");\r\n                if(isNaN(fieldValue1)){\r\n                    fieldValue1 = \"1\";\r\n                }\r\n                if(isNaN(fieldValue2)){\r\n                    fieldValue2 = \"1\";\r\n                }\r\n                var tmp = Number(fieldValue1) * Number(fieldValue2);\r\n                computeFieldValue = computeFieldValue.replace(field1 + \"*\" + field2, tmp);\r\n            }else{\r\n");
            out.write("                //做除法\r\n                var field1 = computeFieldValue.substring(0, j);\r\n                var field2;\r\n                var s = computeFieldValue.substring(j + 1, computeFieldValue.length);\r\n                if(s.indexOf(\"*\") > 0 || s.indexOf(\"/\") > 0){\r\n                    var p = s.indexOf(\"*\");\r\n                    var q = s.indexOf(\"/\");\r\n                    if(p > 0 && q > 0){\r\n                        if(p < q){\r\n                            field2 = s.substring(0, p);\r\n                        }else{\r\n                            field2 = s.substring(0, q);\r\n                        }\r\n                    }else{\r\n                        if(p < 0){\r\n                            field2 = s.substring(0, q);\r\n                        }\r\n                        if(q < 0){\r\n                            field2 = s.substring(0, p);\r\n                        }\r\n                    }\r\n                }else{\r\n                    field2 = s;\r\n                }\r\n                var fieldValue1 = field1;\r\n                if(isNaN(field1)) {\r\n");
            out.write("                    fieldValue1 = eval(\"document.all.\" + field1 + \".value\");\r\n                }\r\n                var fieldValue2 = eval(\"document.all.\" + field2 + \".value\");\r\n                if(isNaN(fieldValue1)){\r\n                    fieldValue1 = \"1\";\r\n                }\r\n                if(isNaN(fieldValue2)){\r\n                    fieldValue2 = \"1\";\r\n                }\r\n                var tmp = Number(fieldValue1) / Number(fieldValue2);\r\n                computeFieldValue = computeFieldValue.replace(field1 + \"/\" + field2, tmp);\r\n            }\r\n        }else{\r\n            //只有乘法或除法\r\n            var field1;\r\n            var field2;\r\n            var s;\r\n            if(i < 0){\r\n                //只有除法\r\n                field1 = computeFieldValue.substring(0, j);\r\n                s = computeFieldValue.substring(j + 1, computeFieldValue.length);\r\n            }\r\n            if(j < 0){\r\n                //只有乘法\r\n                field1 = computeFieldValue.substring(0, i);\r\n                s = computeFieldValue.substring(i + 1, computeFieldValue.length);\r\n");
            out.write("            }\r\n\r\n            if(s.indexOf(\"*\") > 0 || s.indexOf(\"/\") > 0){\r\n                var p = s.indexOf(\"*\");\r\n                var q = s.indexOf(\"/\");\r\n                if(p > 0 && q > 0){\r\n                    if(p < q){\r\n                        field2 = s.substring(0, p);\r\n                    }else{\r\n                        field2 = s.substring(0, q);\r\n                    }\r\n                }else{\r\n                    if(p < 0){\r\n                        field2 = s.substring(0, q);\r\n                    }\r\n                    if(q < 0){\r\n                        field2 = s.substring(0, p);\r\n                    }\r\n                }\r\n            }else{\r\n                field2 = s;\r\n            }\r\n            var fieldValue1 = field1;\r\n            if(isNaN(field1)) {\r\n            \tfieldValue1 = eval(\"document.all.\" + field1 + \".value\");\r\n            }\r\n            var fieldValue2 = eval(\"document.all.\" + field2 + \".value\");\r\n            if(isNaN(fieldValue1)){\r\n                fieldValue1 = \"1\";\r\n            }\r\n");
            out.write("            if(isNaN(fieldValue2)){\r\n                fieldValue2 = \"1\";\r\n            }\r\n            if(i < 0){\r\n                //做除法\r\n                var tmp = Number(fieldValue1) / Number(fieldValue2);\r\n                computeFieldValue = computeFieldValue.replace(field1 + \"/\" + field2, tmp);\r\n\r\n            }\r\n            if(j < 0){\r\n                //做乘法\r\n                var tmp = Number(fieldValue1) * Number(fieldValue2);\r\n                computeFieldValue = computeFieldValue.replace(field1 + \"*\" + field2, tmp);\r\n            }\r\n        }\r\n    }\r\n\r\n    var totalMinusValue = 0;\r\n    while(computeFieldValue.indexOf(\"+\") > 0 || computeFieldValue.indexOf(\"-\") > 0){\r\n        var i = computeFieldValue.indexOf(\"+\");\r\n        var j = computeFieldValue.indexOf(\"-\");\r\n        if(i > 0 && j > 0){\r\n            //有加法有减法\r\n            if(i < j){\r\n                //做加法\r\n                var field1 = computeFieldValue.substring(0, i);\r\n                var field2;\r\n                var s = computeFieldValue.substring(i+1, computeFieldValue.length);\r\n");
            out.write("                if(s.indexOf(\"+\") > 0 || s.indexOf(\"-\") > 0){\r\n                    var p = s.indexOf(\"+\");\r\n                    var q = s.indexOf(\"-\");\r\n                    if(p > 0 && q > 0){\r\n                        if(p < q){\r\n                            field2 = s.substring(0, p);\r\n                        }else{\r\n                            field2 = s.substring(0, q);\r\n                        }\r\n                    }else{\r\n                        if(p < 0){\r\n                            field2 = s.substring(0, q);\r\n                        }\r\n                        if(q < 0){\r\n                            field2 = s.substring(0, p);\r\n                        }\r\n                    }\r\n                }else{\r\n                    field2 = s;\r\n                }\r\n                var fieldValue1 = field1;\r\n                if(isNaN(field1)) {\r\n                    fieldValue1 = eval(\"document.all.\" + field1 + \".value\");\r\n                }\r\n                var fieldValue2 = eval(\"document.all.\" + field2 + \".value\");\r\n");
            out.write("                if(isNaN(fieldValue1)){\r\n                    fieldValue1 = \"0\";\r\n                }\r\n                if(isNaN(fieldValue2)){\r\n                    fieldValue2 = \"0\";\r\n                }\r\n                var tmp = Number(fieldValue1) + Number(fieldValue2);\r\n                computeFieldValue = computeFieldValue.replace(field1 + \"+\" + field2, tmp);\r\n            }else{\r\n                //做减法\r\n                var field1 = computeFieldValue.substring(0, j);\r\n                var field2;\r\n                var s = computeFieldValue.substring(j + 1, computeFieldValue.length);\r\n                if(s.indexOf(\"+\") > 0 || s.indexOf(\"-\") > 0){\r\n                    var p = s.indexOf(\"+\");\r\n                    var q = s.indexOf(\"-\");\r\n                    if(p > 0 && q > 0){\r\n                        if(p < q){\r\n                            field2 = s.substring(0, p);\r\n                        }else{\r\n                            field2 = s.substring(0, q);\r\n                        }\r\n                    }else{\r\n                        if(p < 0){\r\n");
            out.write("                            field2 = s.substring(0, q);\r\n                        }\r\n                        if(q < 0){\r\n                            field2 = s.substring(0, p);\r\n                        }\r\n                    }\r\n                }else{\r\n                    field2 = s;\r\n                }\r\n                var fieldValue1 = field1;\r\n                if(isNaN(field1)) {\r\n                    fieldValue1 = eval(\"document.all.\" + field1 + \".value\");\r\n                }\r\n                var fieldValue2 = eval(\"document.all.\" + field2 + \".value\");\r\n                if(isNaN(fieldValue1)){\r\n                    fieldValue1 = \"0\";\r\n                }\r\n                if(isNaN(fieldValue2)){\r\n                    fieldValue2 = \"0\";\r\n                }\r\n                var tmp = Number(fieldValue1) - Number(fieldValue2);\r\n                if(tmp < 0){\r\n                    //减出负数\r\n                    computeFieldValue = computeFieldValue.replace(field1 + \"-\" + field2, \"0\");\r\n                    totalMinusValue = totalMinusValue - tmp;\r\n");
            out.write("                }else{\r\n                    computeFieldValue = computeFieldValue.replace(field1 + \"-\" + field2, tmp);\r\n                }\r\n            }\r\n        }else{\r\n            //只有有加法或减法\r\n            var field1;\r\n            var field2;\r\n            var s;\r\n            if(i < 0){\r\n                //只有减法\r\n                field1 = computeFieldValue.substring(0, j);\r\n                s = computeFieldValue.substring(j + 1, computeFieldValue.length);\r\n            }\r\n            if(j < 0){\r\n                //只有加法\r\n                field1 = computeFieldValue.substring(0, i);\r\n                s = computeFieldValue.substring(i + 1, computeFieldValue.length);\r\n            }\r\n\r\n            if(s.indexOf(\"+\") > 0 || s.indexOf(\"-\") > 0){\r\n                var p = s.indexOf(\"+\");\r\n                var q = s.indexOf(\"-\");\r\n                if(p > 0 && q > 0){\r\n                    if(p < q){\r\n                        field2 = s.substring(0, p);\r\n                    }else{\r\n                        field2 = s.substring(0, q);\r\n                    }\r\n");
            out.write("                }else{\r\n                    if(p < 0){\r\n                        field2 = s.substring(0, q);\r\n                    }\r\n                    if(q < 0){\r\n                        field2 = s.substring(0, p);\r\n                    }\r\n                }\r\n            }else{\r\n                field2 = s;\r\n            }\r\n            var fieldValue1 = field1;\r\n            if(isNaN(field1)) {\r\n            \tfieldValue1 = eval(\"document.all.\" + field1 + \".value\");\r\n            }\r\n            var fieldValue2 = eval(\"document.all.\" + field2 + \".value\");\r\n            if(isNaN(fieldValue1)){\r\n                fieldValue1 = \"0\";\r\n            }\r\n            if(isNaN(fieldValue2)){\r\n                fieldValue2 = \"0\";\r\n            }\r\n            if(i < 0){\r\n                //做减法\r\n                var tmp = Number(fieldValue1) - Number(fieldValue2);\r\n                if(tmp < 0){\r\n                    //减出负数\r\n                    computeFieldValue = computeFieldValue.replace(field1 + \"-\" + field2, \"0\");\r\n                    totalMinusValue = totalMinusValue - tmp;\r\n");
            out.write("                }else{\r\n                    computeFieldValue = computeFieldValue.replace(field1 + \"-\" + field2, tmp);\r\n                }\r\n            }\r\n            if(j < 0){\r\n                //做加法\r\n                var tmp = Number(fieldValue1) + Number(fieldValue2);\r\n                computeFieldValue = computeFieldValue.replace(field1 + \"+\" + field2, tmp);\r\n            }\r\n        }\r\n    }\r\n    computeFieldValueObj.value = computeFieldValue - totalMinusValue;\r\n    eval(\"document.all.\" + computeField +\"_cmp\").value = computeFieldValue - totalMinusValue;\r\n}\r\n\r\n");
java.util.List noWriteField = (java.util.List) request.getAttribute("noWriteField");
            out.write("\r\nfunction init(){\r\n    ");

    for(int i = 0; i < noWriteField.size(); i ++){
    
            out.write("\r\n    if(document.all.tr_");
            out.print(noWriteField.get(i));
            out.write("){\r\n    \tdocument.all.tr_");
            out.print(noWriteField.get(i));
            out.write(".style.display = \"none\";\r\n  \t}\r\n    ");

    }
	
            out.write("\r\n}\r\n\r\nfunction changeText(){\r\n    ");
//if(request.getAttribute("processType").toString().equals("1")){
            out.write("\r\n//    document.all.newIframeSpan.innerHTML = \"\";\r\n//    document.all.subTr.style.display = \"none\";\r\n//    document.all.nextTr.style.display = \"\";\r\n    ");
//}
            out.write("\r\n}\r\nfunction clickRadio(obj){\r\n    changeText();\r\n}\r\nfunction clickCheckbox(){\r\n    changeText();\r\n}\r\nfunction changeSelect(){\r\n    changeText();\r\n}\r\nfunction changeTextarea(){\r\n    changeText();\r\n}\r\n\r\n/*处理自定义表单中HTML编辑器延时加载 */\r\nfunction reloadHTMLEditor(){\r\n\tfor(var i=0;i<document.getElementsByTagName(\"iframe\").length;i++){\r\n\t\tif(document.getElementsByTagName(\"iframe\")[i].src.indexOf(\"ewebeditor.htm\")>0){\r\n\t\t\tvar src = document.getElementsByTagName(\"iframe\")[i].src;\r\n\t\t\tdocument.getElementsByTagName(\"iframe\")[i].src = \"\";\r\n\t\t\tdocument.getElementsByTagName(\"iframe\")[i].src=src;\r\n\t\t}\r\n\t}\r\n}\r\n\t/*处理自定义表单中HTML编辑器延时加载*/\r\n\r\n\r\nvar xmlHttp = false;\r\n\ttry {\r\n\t\txmlHttp = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n\t} catch (e) {\r\n\t\ttry {\r\n\t\t\txmlHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t} catch (e2) {\r\n\t\t\txmlHttp = false;\r\n\t\t}\r\n\t}\r\n\tif (!xmlHttp && typeof XMLHttpRequest != 'undefined') {\r\n\t\txmlHttp = new XMLHttpRequest();\r\n\t}\r\nvar fieldName;\r\n\r\nfunction getAutoCode(obj,field){\r\n\tfieldName = field;\r\n\txmlHttp.open(\"GET\", \"/jsoa/userdb/getAutoCode.jsp?pageId=");
            out.print(request.getParameter("tableId"));
            out.write("&field=\"+field+\"&head=\"+obj.value, true);\r\n\txmlHttp.onreadystatechange = updateAutoCode;\r\n\txmlHttp.send(null);\r\n}\r\n\r\nfunction updateAutoCode(){\r\n\tif (xmlHttp.readyState < 4) {\r\n\t\t//document.all.printNum.innerHTML=\"正在加载\";\r\n\t}\r\n\tif (xmlHttp.readyState == 4) {\r\n\t\tvar response = xmlHttp.responseText;\r\n\t\teval(\"document.all.\"+fieldName).value = response;\r\n\t}\r\n}\r\n</script>\r\n\r\n");
}}
            out.write('\r');
            out.write('\n');
            int evalDoAfterBody = _jspx_th_html_005fhtml_005f0.doAfterBody();
            if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
              break;
          } while (true);
        }
        if (_jspx_th_html_005fhtml_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
          return;
        }
        _005fjspx_005ftagPool_005fhtml_005fhtml.reuse(_jspx_th_html_005fhtml_005f0);
        _jspx_th_html_005fhtml_005f0_reused = true;
      } finally {
        org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_html_005fhtml_005f0, _jsp_getInstanceManager(), _jspx_th_html_005fhtml_005f0_reused);
      }
      out.write("\r\n<script src=\"/jsoa/js/util.js\"></script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }

  private boolean _jspx_meth_bean_005fwrite_005f0(javax.servlet.jsp.tagext.JspTag _jspx_th_html_005fhtml_005f0, javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  bean:write
    org.apache.struts.taglib.bean.WriteTag _jspx_th_bean_005fwrite_005f0 = (org.apache.struts.taglib.bean.WriteTag) _005fjspx_005ftagPool_005fbean_005fwrite_0026_005fproperty_005fname_005fnobody.get(org.apache.struts.taglib.bean.WriteTag.class);
    boolean _jspx_th_bean_005fwrite_005f0_reused = false;
    try {
      _jspx_th_bean_005fwrite_005f0.setPageContext(_jspx_page_context);
      _jspx_th_bean_005fwrite_005f0.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_html_005fhtml_005f0);
      // /weixin/workflow/workflow_myflow_add_add_newbutton.jsp(11,7) name = name type = null reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fwrite_005f0.setName("WorkFlowFormActionForm");
      // /weixin/workflow/workflow_myflow_add_add_newbutton.jsp(11,7) name = property type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fwrite_005f0.setProperty("processName");
      int _jspx_eval_bean_005fwrite_005f0 = _jspx_th_bean_005fwrite_005f0.doStartTag();
      if (_jspx_th_bean_005fwrite_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fbean_005fwrite_0026_005fproperty_005fname_005fnobody.reuse(_jspx_th_bean_005fwrite_005f0);
      _jspx_th_bean_005fwrite_005f0_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_bean_005fwrite_005f0, _jsp_getInstanceManager(), _jspx_th_bean_005fwrite_005f0_reused);
    }
    return false;
  }

  private boolean _jspx_meth_bean_005fmessage_005f0(javax.servlet.jsp.tagext.JspTag _jspx_th_html_005fhtml_005f0, javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  bean:message
    org.apache.struts.taglib.bean.MessageTag _jspx_th_bean_005fmessage_005f0 = (org.apache.struts.taglib.bean.MessageTag) _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.get(org.apache.struts.taglib.bean.MessageTag.class);
    boolean _jspx_th_bean_005fmessage_005f0_reused = false;
    try {
      _jspx_th_bean_005fmessage_005f0.setPageContext(_jspx_page_context);
      _jspx_th_bean_005fmessage_005f0.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_html_005fhtml_005f0);
      // /weixin/workflow/workflow_myflow_add_add_newbutton.jsp(126,92) name = bundle type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f0.setBundle("workflow");
      // /weixin/workflow/workflow_myflow_add_add_newbutton.jsp(126,92) name = key type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f0.setKey("workflow.newactivitybasicinfo");
      int _jspx_eval_bean_005fmessage_005f0 = _jspx_th_bean_005fmessage_005f0.doStartTag();
      if (_jspx_th_bean_005fmessage_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.reuse(_jspx_th_bean_005fmessage_005f0);
      _jspx_th_bean_005fmessage_005f0_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_bean_005fmessage_005f0, _jsp_getInstanceManager(), _jspx_th_bean_005fmessage_005f0_reused);
    }
    return false;
  }

  private boolean _jspx_meth_bean_005fmessage_005f1(javax.servlet.jsp.tagext.JspTag _jspx_th_html_005fhtml_005f0, javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  bean:message
    org.apache.struts.taglib.bean.MessageTag _jspx_th_bean_005fmessage_005f1 = (org.apache.struts.taglib.bean.MessageTag) _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.get(org.apache.struts.taglib.bean.MessageTag.class);
    boolean _jspx_th_bean_005fmessage_005f1_reused = false;
    try {
      _jspx_th_bean_005fmessage_005f1.setPageContext(_jspx_page_context);
      _jspx_th_bean_005fmessage_005f1.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_html_005fhtml_005f0);
      // /weixin/workflow/workflow_myflow_add_add_newbutton.jsp(131,92) name = bundle type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f1.setBundle("workflow");
      // /weixin/workflow/workflow_myflow_add_add_newbutton.jsp(131,92) name = key type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_bean_005fmessage_005f1.setKey("workflow.newworkflowchart");
      int _jspx_eval_bean_005fmessage_005f1 = _jspx_th_bean_005fmessage_005f1.doStartTag();
      if (_jspx_th_bean_005fmessage_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fbean_005fmessage_0026_005fkey_005fbundle_005fnobody.reuse(_jspx_th_bean_005fmessage_005f1);
      _jspx_th_bean_005fmessage_005f1_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_bean_005fmessage_005f1, _jsp_getInstanceManager(), _jspx_th_bean_005fmessage_005f1_reused);
    }
    return false;
  }
}
