/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 10:06:41 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.jsflow;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.js.oa.jsflow.util.NewWorkflowUtil;
import com.js.oa.userdb.service.CustomDatabaseBD;
import com.js.oa.eform.service.CustomFormBD;
import java.util.List;
import com.js.oa.jsflow.service.WorkFlowBD;
import com.js.util.config.SystemCommon;
import com.js.system.util.StaticParam;
import com.js.util.config.SystemCommon;
import com.js.util.util.BrowserJudge;
import com.js.oa.jsflow.util.NewWorkflowUtil;

public final class printWord_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(2);
    _jspx_dependants.put("/eform/showform.jsp", Long.valueOf(1502431418000L));
    _jspx_dependants.put("/jsflow/workflow_include_comment.jsp", Long.valueOf(1502694920000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.oa.jsflow.util.NewWorkflowUtil");
    _jspx_imports_classes.add("com.js.oa.eform.service.CustomFormBD");
    _jspx_imports_classes.add("java.util.List");
    _jspx_imports_classes.add("com.js.system.util.StaticParam");
    _jspx_imports_classes.add("com.js.util.config.SystemCommon");
    _jspx_imports_classes.add("com.js.oa.userdb.service.CustomDatabaseBD");
    _jspx_imports_classes.add("com.js.util.util.BrowserJudge");
    _jspx_imports_classes.add("com.js.oa.jsflow.service.WorkFlowBD");
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write('\r');
      out.write('\n');

	String pageId = "";
	String onload = "";
	String workSubmitPerson="";
	com.js.oa.userdb.util.DbOpt dbopt = new com.js.oa.userdb.util.DbOpt();
	String work=request.getParameter("work");	
	try{
		pageId = dbopt.executeQueryToStr("select PRINT_PAGE_ID from TPAGE where PAGE_ID="+request.getParameter("pageId"));
		
	}catch(Exception e){
		pageId = request.getParameter("pageId");
	}
	if(pageId==null || pageId.trim().length()<1){
		pageId = request.getParameter("pageId");
	}else{
		String pageRef = dbopt.executeQueryToStr("select PAGE_REF from TPAGE where PAGE_ID="+pageId);
		if(pageRef==null || pageRef.trim().length()<8) pageId = request.getParameter("pageId");
	}
	onload = dbopt.executeQueryToStr("select js_onload from TPAGE where PAGE_ID="+request.getParameter("pageId"));
	workSubmitPerson=dbopt.executeQueryToStr("select worksubmitperson from jsf_work where workrecord_id="+request.getParameter("record"));
	//
	try{
		dbopt.close();
	}catch(Exception e2){
		e2.printStackTrace();
	}

      out.write("\r\n<html>\r\n<head>\r\n<title>预览</title>\r\n<script language=\"javascript\" src=\"/jsoa/js/js.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/js/openEndow.js\"></script>\r\n<script language=javascript src=\"/jsoa/eform/datetime/datetime_check.js\"></script>\r\n<script language=javascript src=\"/jsoa/eform/datetime/datetime_select.js\"></script>\r\n<script  src=\"/jsoa/js/checkText.js\"  language=\"javascript\" ></script>\r\n<script language=javascript src=\"/jsoa/eform/js/form.js\"></script>\r\n<link href=\"/jsoa/skin/");
      out.print(session.getAttribute("skin"));
      out.write("/style-");
      out.print(session.getAttribute("browserVersion"));
      out.write("-doc.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<script type=\"text/javascript\">\r\nfunction init(){\r\n");
      out.print(onload==null|| "null".equalsIgnoreCase(onload)?"":onload );
      out.write("\r\n\r\n}\r\n\r\n</script>\r\n</head>\r\n\r\n<body onload=\"resizeWin(800,600);init();\" >\r\n");
 
String type=request.getParameter("Type");
if("PDF".equals(type)&&type!=null){
out.print("<button style=\"display:\" onclick=\"this.style.display='none';javascript:toPDF();\">转PDF</button>");
}else{
out.print("<button style=\"display:\" onclick=\"this.style.display='none';window.print();window.close();\">打印</button>");
}
      out.write("\r\n<table width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanelForPrint\">\r\n<form name=\"form1\" action=\"\" method=\"POST\">\r\n<input type=\"hidden\" id=\"printPage\" value=\"1\" />\r\n\t<input type=hidden name=tableId value=\"");
      out.print(pageId);
      out.write("\">\r\n\t<input type=\"hidden\" name=\"submitPerson\" id=\"submitPerson\" value=\"");
      out.print(workSubmitPerson );
      out.write("\">\r\n\t<tr><td>\r\n\t\t ");

			request.setAttribute("hideField","ALL");
			String flag="none";//自定义表单IDout.print("<input type=hidden name=operate value=modify>");
			out.print("<input type=hidden name=recordId value="+request.getParameter("record")+">");
			request.setAttribute("infoId",request.getParameter("record"));
         
      out.write("\r\n\t\t ");
      out.write("\r\n\r\n\r\n\r\n\r\n\r\n\r\n");

request.setCharacterEncoding("GBK");
CustomFormBD cst = new CustomFormBD();
CustomDatabaseBD userDB = new CustomDatabaseBD();
String scriptappend = "";
String domainId = session.getAttribute("domainId")==null ? "0" : session.getAttribute("domainId").toString();
String parent_fromDraft = "draftForm".equals(request.getParameter("action")) ? "1" : "0";
String resubmit="0";
if("1".equals(request.getParameter("resubmit"))){
	parent_fromDraft = "1";
	resubmit="1";
}
String hideTableHTML = "";
String showTableHTML = "";
List boxFieldList = userDB.getOnchangeMethodInfo(pageId, domainId);

//读取隐藏字段（不可编辑字段）
String hide_Field = request.getAttribute("hideField")==null ? "" : request.getAttribute("hideField").toString();

String noDisplayFields="";
if(request.getAttribute("initActivity")!=null){
	noDisplayFields=new NewWorkflowUtil().getNoDisplayField(request.getAttribute("initActivity").toString(),request.getParameter("work"));
}else{
	if(request.getParameter("initActivity")!=null){
		noDisplayFields=new NewWorkflowUtil().getNoDisplayField(request.getParameter("initActivity").toString(),request.getParameter("work"));
	}else{
		//发起时去掉隐藏的字段
		noDisplayFields=new NewWorkflowUtil().getFirstActivityNoDisplayField(request.getParameter("processId"));
	}
	
}
if(session.getAttribute("userId").toString().equals(request.getParameter("submitPersonId")) && "y".equals(request.getParameter("fromDossierData"))){
	
}else{
	noDisplayFields="";
}

      out.write("\r\n\r\n<style type=\"text/css\">\r\n.flowInput { /*border:1px solid #E8E8E8;*/}\r\n.flowInputRed { behavior:url(/jsoa/js/formvalidate.htc); /*border:1px solid #E8E8E8;*/}\r\n.flowInputenter { border:1px solid blue; }\r\n.mustwrite { border:1px solid red; }\r\n.divnowrap { meizz:expression(this.noWrap=true);}\r\n</style>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/jsoa/eform/ext/resources/css/ext-all-jiusi.css\"/>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/adapter/ext/ext-base.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/ext-all.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/js/ajax.js\"></script>\r\n<!-- 为实现国资委物品 联想查询  20160326 by 陈明伟start-->\r\n<script type=\"text/javascript\" src=\"/jsoa/js/jquery-1.4.2.min.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/js/jquery.autocomplete.min.js\"></script>\r\n<!-- 为实现国资委物品 联想查询  20160326 by 陈明伟 end-->\r\n<!-- 为实现haier机种明细  20161111-->\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/js/haierSpecial.js\"></script>\r\n<SCRIPT type=\"text/javascript\">\r\n");
      out.write("  var currentRow = null;\r\n  var tblTR = new Array();\r\n  var tblTRHTML = new Array();\r\n  var extWidth = \"250px\";\r\n  ");

  //取设置了检索的字段信息
  
  //取设置了提取数据的字段信息
  
      out.write("\r\n  var tempComboBoxStore = new Array();\r\n  var tempSelectHtml = new Array();\r\n  var tempCombofieldObjArr=new Array();\r\n  var tempComboBoxCntArr=new Array();\r\n  Ext.onReady(function(){\r\n\t//Ext.QuickTips.init();\r\n\t");

	String[] fieldObj;
	String hide_field_readonly=","+hide_Field+",";
	for(int fi=0;fi<boxFieldList.size();fi++){
		fieldObj=(String[])boxFieldList.get(fi);
		if("1".equals(fieldObj[2])){
			//需要输入检索
			if (hide_field_readonly.indexOf(","+fieldObj[0]+",") >= 0 || hide_field_readonly.indexOf(fieldObj[1]) >= 0) {
				//如果是只读字段则不使用输入样式
				continue;
			}else{
			
	
      out.write("\r\n\t//记录字段值\r\n\tvar tempCombofieldObj={};\r\n\ttempCombofieldObj.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\ttempCombofieldObj.val=");
      out.print(net.sf.json.JSONArray.fromObject(fieldObj));
      out.write(";\r\n\ttempCombofieldObjArr[tempCombofieldObjArr.length]=tempCombofieldObj;\r\n\t//记录html\r\n\tvar tempSelectHtmlObj={};\r\n\ttempSelectHtmlObj.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\ttempSelectHtmlObj.val=document.getElementById(\"");
      out.print(fieldObj[1]);
      out.write("\").parentNode.parentNode.innerHTML;\r\n\ttempSelectHtml[tempSelectHtml.length]=tempSelectHtmlObj;\r\n\textWidth = document.getElementById(\"");
      out.print(fieldObj[1]);
      out.write("\")==null?extWidth:document.getElementById(\"");
      out.print(fieldObj[1]);
      out.write("\").offsetWidth+\"px\";\r\n\t//alert(extWidth);\r\n\ttry{\r\n\t\tvar cb");
      out.print(fi);
      out.write(" = new Ext.form.ComboBox({\r\n\t\t\ttypeAhead: true,\r\n\t\t\ttriggerAction: 'all',\r\n\t\t\ttransform:'");
      out.print(fieldObj[1]);
      out.write("',\r\n\t\t\t//width:'200',\r\n\t\t\tforceSelection:true,\r\n\t\t\t//listClass:'inputText',\r\n\t\t\t//minListWidth:205+2+2,\t\t\t\r\n\t\t\tlisteners:{\r\n\t        \tselect:{\r\n\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t");
if(!"0".equals(fieldObj[3])){
      out.write("\r\n\t\t\t\t\t\t\t");
      out.print(fieldObj[1]);
      out.write("_onchange(combo);\r\n\t\t\t\t\t\t");
}
      out.write("\r\n\t\t\t\t\t}\r\n\t        \t},\r\n\t\t\t\t'beforequery':function(e){         \r\n\t\t\t \t\tvar combo = e.combo;    \r\n\t\t\t \t\tif(!e.forceAll){    \r\n\t\t\t  \t\t\tvar input = e.query;    \r\n\t\t\t  \t\t\t// 检索的正则  \r\n\t\t\t\t\t\t var regExp = new RegExp(\".*\" + input + \".*\");  \r\n\t\t\t\t\t\t// 执行检索  \r\n\t\t\t\t\t\t combo.store.filterBy(function(record,id){    \r\n\t\t\t \t\t\t\t// 得到每个record的项目名称值  \r\n\t\t\t\t\t\t\tvar text = record.get(combo.displayField);    \r\n\t\t\t\t\t\t\treturn regExp.test(text);   \r\n\t\t\t\t\t\t });  \r\n\t\t\t\t\t\t combo.expand();    \r\n\t\t\t\t\t\treturn false;  \r\n\t\t\t     }  \r\n\t\t\t   }  \r\n\r\n\t\t\t}\r\n\t    });\r\n\t\tcb");
      out.print(fi);
      out.write(".el.setStyle({\r\n\t\t\t//width:extWidth\r\n\t\t\t//top:'0.1px'\r\n\t\t});\r\n\t\t//记录数据源\r\n\t\tvar tempComboBoxStoreObj={};\r\n\t\ttempComboBoxStoreObj.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\t\ttempComboBoxStoreObj.val=cb");
      out.print(fi);
      out.write(".store;\r\n\t\ttempComboBoxStore[tempComboBoxStore.length]=tempComboBoxStoreObj;\r\n\t\t//记录个数\r\n\t\tvar tempComboBoxCnt={};\r\n\t\ttempComboBoxCnt.id=\"");
      out.print(fieldObj[1]);
      out.write("\";\r\n\t\ttempComboBoxCnt.val=1;\r\n\t\ttempComboBoxCntArr[tempComboBoxCntArr.length]=tempComboBoxCnt;\r\n\t}catch(ee){\r\n\t}\r\n\t\r\n\t");
    }
	   }
	}
      out.write("\r\n\ttempComboBoxCreateFun();\r\n});\r\nfunction tempComboBoxCreateFun1(vid){\r\n\tvar r=-1;\r\n\tfor(var j=0;j<tempComboBoxStore.length;j++){\r\n\t\t if(vid.indexOf(tempComboBoxStore[j].id)>=0){\r\n\t\t\t r=j;\r\n\t\t\t break;\r\n\t\t }\r\n\t }\r\n\treturn r;\r\n}\r\n  function tempComboBoxCreateFun(){\r\n\t  if(tempComboBoxStore.length>0){\r\n\t\t  var tempSelect=currentRow.parentNode.getElementsByTagName(\"select\");\r\n\t\t if(tempSelect.length==0){\r\n\t\t\t return;\r\n\t\t }\r\n\t\t for(var i=tempSelect.length-1;i>=0;i--){\r\n\t\t\t var tempXh=tempComboBoxCreateFun1(tempSelect[i].id);\r\n\t\t\t if(tempXh != -1){\r\n\t\t\t\t//判断当id重复时增加后缀\r\n\t\t\t\t if(tempComboBoxCntArr[tempXh].id==tempSelect[i].id){\r\n\t\t\t\t\t var tt=parseInt(tempComboBoxCntArr[tempXh].val);\r\n\t\t\t\t\t tempSelect[i].id=tempSelect[i].id+\"_\"+tt;\r\n\t\t\t\t\t tempComboBoxCntArr[tempXh].val=tt++;\r\n\t\t\t\t }\r\n\t\t\t\t extWidth = document.getElementById(tempSelect[i].id)==null?extWidth:document.getElementById(tempSelect[i].id).offsetWidth+\"px\";\r\n\t\t\t\t\tnew Ext.form.ComboBox({\r\n\t\t\t\t\t\ttypeAhead: true,\r\n\t\t\t\t\t\ttriggerAction: 'all',\r\n\t\t\t\t\t\ttransform:tempSelect[i].id,\r\n");
      out.write("\t\t\t\t\t\tforceSelection:true,\t\t\r\n\t\t\t\t\t\tlisteners:{\r\n\t\t\t\t        \tselect:{\r\n\t\t\t\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tvar tempTransform = tempComboBoxCreateFun1(combo.transform);\r\n\t\t\t\t\t\t\t\t\tvar tempf=tempCombofieldObjArr[tempTransform].val;\r\n\t\t\t\t\t\t\t\t\tif(tempf[3]!=0){\r\n\t\t\t\t\t\t\t\t\t\t//tempComboBox_onchange(combo,tempf);\r\n\t\t\t\t\t\t\t\t\t\ttempComboBox_onchange1(combo);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t        \t},\r\n\t\t\t\t\t\t\t'beforequery':function(e){         \r\n\t\t\t\t\t\t \t\tvar combo = e.combo;    \r\n\t\t\t\t\t\t \t\tif(!e.forceAll){    \r\n\t\t\t\t\t\t  \t\t\tvar input = e.query;    \r\n\t\t\t\t\t\t  \t\t\t// 检索的正则  \r\n\t\t\t\t\t\t\t\t\t var regExp = new RegExp(\".*\" + input + \".*\");  \r\n\t\t\t\t\t\t\t\t\t// 执行检索  \r\n\t\t\t\t\t\t\t\t\t combo.store.filterBy(function(record,id){    \r\n\t\t\t\t\t\t \t\t\t\t// 得到每个record的项目名称值  \r\n\t\t\t\t\t\t\t\t\t\tvar text = record.get(combo.displayField);    \r\n\t\t\t\t\t\t\t\t\t\treturn regExp.test(text);   \r\n\t\t\t\t\t\t\t\t\t });  \r\n\t\t\t\t\t\t\t\t\t combo.expand();    \r\n\t\t\t\t\t\t\t\t\treturn false;  \r\n\t\t\t\t\t\t     }  \r\n\t\t\t\t\t\t   }  \r\n\t\t\t\t\t\t}\r\n\t\t\t\t    });\r\n\t\t\t }\r\n\t\t\t \r\n\t\t }\r\n");
      out.write("\t\t \r\n      }\r\n\t\t\r\n\t}\r\n\r\n//构造字段onchange事件\r\n");

for(int fi=0;fi<boxFieldList.size();fi++){
	fieldObj=(String[])boxFieldList.get(fi);
	
	if(!"0".equals(fieldObj[3]) || "1".equals(fieldObj[12])){
		//onchange fangfa

      out.write("\t\r\nfunction ");
      out.print(fieldObj[1]);
      out.write("_onchange(obj){\r\n\tvar curIndex=0;\r\n    var curObj;\r\n    if(obj.name!=undefined){\r\n    \tcurObj=document.getElementsByName(obj.name);\r\n    }else{\r\n    \tcurObj=document.getElementsByName(obj.hiddenName);\r\n    \tobj = obj.wrap.dom.childNodes[0];\r\n    }\r\n    for(var i=0;i<curObj.length;i++){\r\n    \tif(curObj[i]==obj){\r\n    \t\tcurIndex=i;\r\n    \t}\r\n    }\r\n    ");

    if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		out.print(fieldObj[5]);
	}
    
      out.write("\r\n    var selValue=obj.value;\r\n    selValue=escape(escape(selValue));\r\n    //获取sql语句中的参数\r\n    var _postData=\"\";\r\n    ");

    String _fetchSQL=fieldObj[4]==null?"":fieldObj[4];
    String[] _fetchSQLArr=_fetchSQL.split("\\@\\@");
    for(int si=0;si<_fetchSQLArr.length;si++){
    	if(!"".equals(_fetchSQLArr[si]) && _fetchSQLArr[si].indexOf(" ")<0 && !"curYear".equals(_fetchSQLArr[si]) && !"curMonth".equals(_fetchSQLArr[si])){
    		
      out.write("\r\n    \t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")){\r\n    \t\t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\").length==1){\r\n    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[0].value;\r\n    \t\t\t}else{\r\n    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[curIndex].value;\r\n    \t\t\t}\r\n    \t\t}\r\n    \t\t");

    	}
    }    
    
      out.write("  \r\n\t");

	if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		
      out.write("\r\n\t\t//提取数据\t\t\r\n\t\tvar submitPersonIdObj=document.getElementsByName(\"submitPersonId\");\r\n\t\tvar submitPersonObj=document.getElementsByName(\"submitPerson\");\r\n\t\tvar submitPersonId=\"\",submitPerson=\"\";\r\n\t\tif(submitPersonIdObj.length>0){\r\n\t\t\tsubmitPersonId=submitPersonIdObj[0].value;\r\n\t\t}\r\n\t\tif(submitPersonObj.length>0){\r\n\t\t\tsubmitPerson=submitPersonObj[0].value;\r\n\t\t}\r\n\t\tsubmitPerson=escape(escape(submitPerson));\r\n\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&submitPersonId=\"+submitPersonId+\"&submitPerson=\"+submitPerson+\"&selValue=\"+selValue+_postData,\"\",showFormSubData);\r\n\t\t");

	}
	if(fieldObj[12]!=null&&"1".equals(fieldObj[12])){
		if(fieldObj[9]!=null && fieldObj[10]!=null){
	
      out.write("\r\n\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata_inteface.jsp?transValue=\"+selValue+\"&curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("\",\"\",showInteface_Data);\r\n\t");

	}}
	
	
      out.write("\r\n}\r\nfunction tempComboBox_onchange1(obj){\r\n    var curIndex=0;\r\n    var curObj;\r\n    if(obj.name!=undefined){\r\n    \tcurObj=document.getElementsByName(obj.name);\r\n    }else{\r\n    \tcurObj=document.getElementsByName(obj.hiddenName);\r\n    \tobj = obj.wrap.dom.childNodes[0];\r\n    }\r\n    for(var i=0;i<curObj.length;i++){\r\n    \tif(curObj[i]==obj){\r\n    \t\tcurIndex=i;\r\n    \t}\r\n    }\r\n    ");

    if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		out.print(fieldObj[5]);
	}
    
      out.write("\r\n    var selValue=obj.value;\r\n    selValue=escape(escape(selValue));\r\n    \r\n    var _postData=\"\";\r\n    ");

    for(int si=0;si<_fetchSQLArr.length;si++){
    	if(!"".equals(_fetchSQLArr[si]) && _fetchSQLArr[si].indexOf(" ")<0 && !"curYear".equals(_fetchSQLArr[si]) && !"curMonth".equals(_fetchSQLArr[si])){
    		
      out.write("\r\n    \t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")){\r\n    \t\t\tif(document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\").length==1){\r\n    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[0].value;\r\n    \t\t\t}else{\r\n    \t\t\t\t_postData+=\"&");
      out.print(_fetchSQLArr[si]);
      out.write("=\"+document.getElementsByName(\"");
      out.print(_fetchSQLArr[si]);
      out.write("\")[curIndex].value;\r\n    \t\t\t}\r\n    \t\t}\r\n    \t\t");

    	}
    }    
    
      out.write("     \r\n\t");

	if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		
      out.write("\r\n\t\t//提取数据\t\t\r\n\t\tvar submitPersonIdObj=document.getElementsByName(\"submitPersonId\");\r\n\t\tvar submitPersonObj=document.getElementsByName(\"submitPerson\");\r\n\t\tvar submitPersonId=\"\",submitPerson=\"\";\r\n\t\tif(submitPersonIdObj.length>0){\r\n\t\t\tsubmitPersonId=submitPersonIdObj[0].value;\r\n\t\t}\r\n\t\tif(submitPersonObj.length>0){\r\n\t\t\tsubmitPerson=submitPersonObj[0].value;\r\n\t\t}\r\n\t\tsubmitPerson=escape(escape(submitPerson));\r\n\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&submitPersonId=\"+submitPersonId+\"&submitPerson=\"+submitPerson+\"&selValue=\"+selValue+_postData,\"\",showFormSubData);\r\n\t\t");

	}
	if(fieldObj[12]!=null&&"1".equals(fieldObj[12])){
		if(fieldObj[9]!=null && fieldObj[10]!=null){
	
      out.write("\r\n\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata_inteface.jsp?transValue=\"+selValue+\"&curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("\",\"\",showInteface_Data);\r\n\t");

	}}
	
      out.write("\r\n}\r\n");
  }
	//输入检索的回车触发事件
	if("450".equals(fieldObj[7])){
		
      out.write("\r\nfunction ");
      out.print(fieldObj[1]);
      out.write("_enter(obj){\r\n\tvar curIndex=0;\r\n    var curObj=document.getElementsByName(obj.name);\r\n    for(var i=0;i<curObj.length;i++){\r\n    \tif(curObj[i]==obj){\r\n    \t\tcurIndex=i;\r\n    \t}\r\n    }\r\n    var inputValueObj=document.getElementsByName(\"");
      out.print(fieldObj[1]);
      out.write("_temp\");\r\n  \r\n\tvar inputValue=inputValueObj[curIndex].value;\t\r\n   \r\n\tvar submitPersonObj=document.getElementsByName(\"submitPersonId\");\r\n\tvar submitPersonId=\"\";\r\n\tif(submitPersonObj.length>0){\r\n\t\tsubmitPersonId=submitPersonObj[0].value;\r\n\t}\r\n\t//如果是程序调用需解析参数\r\n\tvar interfacePara=\"\";\r\n\t");

	if(fieldObj[8]!=null && fieldObj[8].startsWith("$[interface")){
		
      out.write("\r\n\t\tinterfacePara=\"&getDataFlag=1\";\r\n\t\t");
		
		if(fieldObj[8].indexOf(";;;;")>0){			
			//有设置参数 @@ 表示表单中字段  @$@ 表示默认字段
			String interfaceParaStr=fieldObj[8].substring(fieldObj[8].indexOf(";;;;")+4,fieldObj[8].length()-1);			
			String[] interfaceParaArr=interfaceParaStr.split(",");			
			String interfaceParaTemp;
			for(int interi=0;interi<interfaceParaArr.length;interi++){				
				if(interfaceParaArr[interi].startsWith("@@")){					
					//表单中的值组织参数
					interfaceParaTemp=interfaceParaArr[interi].substring(2,interfaceParaArr[interi].length()-2);
					if(interfaceParaTemp.equals(fieldObj[1])){
      out.write("\r\n\t\t\t\t\tvar fieldText = \"\";\r\n\t\t\t\t\tif(curIndex>0){\r\n\t\t\t\t\t\tvar objTemp = document.getElementsByName(\"");
      out.print(interfaceParaTemp);
      out.write("_temp\");\r\n\t\t\t\t\t\tfieldText = objTemp[curIndex].value;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tfieldText = document.getElementById(\"");
      out.print(interfaceParaTemp);
      out.write("_temp\").value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinterfacePara+=\"&");
      out.print(interfaceParaTemp);
      out.write("=\"+fieldText;\r\n\t\t\t\t\t");
}else{
      out.write("\r\n\t\t\t\t\tvar fieldText = \"\";\r\n\t\t\t\t\tif(curIndex>0){\r\n\t\t\t\t\t\tvar objTemp = document.getElementsByName(\"");
      out.print(interfaceParaTemp);
      out.write("\");\r\n\t\t\t\t\t\tfieldText = objTemp[curIndex].value;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tfieldText = document.getElementById(\"");
      out.print(interfaceParaTemp);
      out.write("\").value;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinterfacePara+=\"&");
      out.print(interfaceParaTemp);
      out.write("=\"+fieldText;\r\n\t\t\t\t\t");
}
				}				
			}
		}
	}
	
      out.write("\r\n\tJSMainWinOpen2(\"/jsoa/FormDataFilterAction.do?curIndex=\"+curIndex+\"&fieldId=");
      out.print(fieldObj[0]);
      out.write("&fieldName=");
      out.print(fieldObj[1]);
      out.write("&submitPersonId=\"+submitPersonId+\"&inputValue=\"+escape(escape(inputValue))+interfacePara,\"\",\"\");\r\n");

if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
	out.print(fieldObj[5]);
}

      out.write("\r\n}\r\n\t\t");

	}
}
      out.write("\r\nfunction tempComboBox_onchange(obj,tempData){\r\n\t   var curIndex=0;\r\n\t   if(obj.name != undefined){\r\n\t\t   var curObj=document.getElementsByName(obj.name);\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n\t   }\r\n\t   if(obj.transform != undefined){\r\n\t\t   var tmp = obj.transform;\r\n\t\t   var inx = tmp.substring(tmp.lastIndexOf(\"_\")+1);\r\n\t\t   try { \r\n\t\t\t   curIndex = parseInt(inx)-1;\r\n\t\t   }catch(e){\r\n\t\t\t   curIndex = 0; \r\n\t\t   }\r\n\t   }\r\n\t    \r\n\t    if(tempData[3]==\"1\"||tempData[3]==\"3\"){\r\n\t\t\r\n\t\t\t//提取数据\r\n\t\t\tvar selValue=obj.value;\r\n\t\t\tvar submitPersonIdObj=document.getElementsByName(\"submitPersonId\");\r\n\t\t\tvar submitPersonObj=document.getElementsByName(\"submitPerson\");\r\n\t\t\tvar submitPersonId=\"\",submitPerson=\"\";\r\n\t\t\tif(submitPersonIdObj.length>0){\r\n\t\t\t\tsubmitPersonId=submitPersonIdObj[0].value;\r\n\t\t\t}\r\n\t\t\tif(submitPersonObj.length>0){\r\n\t\t\t\tsubmitPerson=submitPersonObj[0].value;\r\n\t\t\t}\r\n\t\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=\"+tempData[0]+\"&submitPersonId=\"+submitPersonId+\"&submitPerson=\"+submitPerson+\"&selValue=\"+selValue,\"\",showFormSubData);\r\n");
      out.write("\t    }\r\n\t    if(tempData[12]!=null && tempData[12]==\"2\"){\r\n\t    \tif(tempData[9]!=null && tempData[10]!=null){\r\n\t    \t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata_inteface.jsp?transValue=\"+obj.value+\"&curIndex=\"+curIndex+\"&fieldId=\"+tempData[0],\"\",showInteface_Data);\r\n\t    \t}\r\n\t    }\r\n\t    if(tempData[3] ==\"2\" || tempData[3] ==\"3\"){\r\n\t    \teval(tempData[5]);\r\n\t    }\r\n\t\t\t\r\n}\r\ndocument.onkeydown=listenKeyDown;\r\n\r\nfunction listenKeyDown(){\r\n\tvar event = arguments[0] ||window.event;\r\n\tif(event.keyCode==13){\r\n\t\t//按下了enter\r\n\t\ttry{\r\n\t\t    var obj=event.srcElement;\r\n\t\t\tvar objname=event.srcElement.name;\t\r\n\t\t\t\r\n\t\t\tvar curIndex=0;\r\n\t\t    var curObj=document.getElementsByName(objname);\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n    \r\n\t\t\tobjname=objname.substring(0,objname.length-5);\r\n\t\t\tobjname=objname+\"_btn\";\t\t\t\r\n\t\t\t\r\n\t\t\tobj=document.getElementsByName(objname);\r\n\t\t\tobj[curIndex].click();\r\n\t\t\t\r\n\t\t\t//eval(objname+\"_enter(\"+document.getElementsByName(objname)[0]+\")\");\r\n");
      out.write("\t\t}catch(e){\r\n\t\t\t//alert(e);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction showIntefaceData(response){\r\n\r\n\tvar context = response.responseText;\r\n\t\r\n\tcontext=context.substring(context.indexOf(\"{\"));\r\n\t\r\n\tif(context.length>2){\r\n\t\tcontext=context.substring(2,context.length-3);\r\n\t\t\r\n\t\tvar contextValue=context.split(\"];[\");\r\n\t\t\r\n\t\tfor(var i=0;i<contextValue.length;i++){\r\n\t\t\t\r\n\t\t\tif(contextValue[i].indexOf(\":{\")>0 &&contextValue[i].substring(contextValue[i].length-1)==\"}\" ){\r\n\t\t\t\tvar kValue = contextValue[i].split(\":{\");\r\n\t\t\t\treturn_Value(\"{\"+kValue[1],kValue[0]) ;\r\n\t\t\t}else{\r\n\t\t\t\tvar kValue=contextValue[i].split(\":\");\r\n\t\t\t\treturn_Value(kValue[1],kValue[0]) ;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t  \r\n\r\n}\r\n\r\n\r\nfunction return_Value(showValue,fieldName){\r\n\tif(document.getElementById(fieldName)){\r\n\t\tvar fieldObj =document.getElementById(fieldName);\r\n\t\tif(fieldObj.nodeName==\"SELECT\"&&(showValue.substring(0,2)==\"{[\" && showValue.substring(showValue.length-2,showValue.length)==\"]}\")){//下拉框形式\r\n\t\t\tvar showValues =  showValue.substring(2,showValue.length-2).split(\"],[\");\r\n");
      out.write("\t \t\tfieldObj.options.length=0;\r\n\t \t\t\r\n\t \t\tvar option =document.createElement(\"option\");\r\n\t \t\tfieldObj.appendChild(option);\r\n\t\t\toption.value = \"\";\r\n\t\t\toption.text = \"--请选择--\";\r\n\t\t\t\r\n\t \t\tfor(var i=0;i<showValues.length;i++){\r\n\t \t\t\tvar option2 = document.createElement(\"option\");\r\n\t \t \t\tfieldObj.appendChild(option2);\r\n\t \t \t\t\r\n\t \t\t\tvar optionShow = showValues[i].split(\":\");\r\n\t \t\t\toption2.value = optionShow[0]+\"@#@\"+optionShow[1];\r\n\t \t\t\toption2.text = optionShow[1];\r\n\t \t\t}\r\n\t \t}else{\r\n\t \t\tdocument.getElementById(fieldName).value=showValue;\r\n\t \t}\r\n\t}\r\n}\r\n\r\nfunction showInteface_Data(response){\r\n\t \r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n    \t\r\n    \t//如是字表多行时需确定本行的位置\r\n    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,content;\r\n    \t//alert(\"11222\"+datas);\r\n    \tfor(var i=0;i<datas.length;i++){\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n");
      out.write("    \t\tif(formfield==\"error\"){\r\n    \t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n    \t\t\talert(content);\r\n    \t\t}else{\r\n\t    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n\t    \t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n\t    \t\t//alert(formfield);\r\n\t    \t\t//alert(content);\r\n\t    \t\t//if(fetchdata==\"0\"){\r\n\t    \t\treturn_Value(content,formfield);\r\n\t    \t\t//}\r\n\t\t\t}\t\r\n    \t}\r\n    \t\r\n\t}\t\t\r\n}\t\r\nfunction showFormSubData(response){\r\n\t//将取回的数据显示在正确的表单中\r\n\t//alert(response.responseText);\r\n    //alert(response.responseXML.documentElement);\r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n\t\t\r\n    \t//如是字表多行时需确定本行的位置\r\n    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n\t\t//<?xml version=\"1.0\" encoding=\"GBK\"?>\r\n\t\t//<root>\r\n\t\t//\t<curIndex>0</curIndex>\r\n\t\t//\t<data>\r\n\t\t//\t\t<formfield>jst_3067_f3501</formfield>\r\n");
      out.write("\t\t//\t\t<fetchdata>0</fetchdata>\r\n\t\t//\t\t<fieldtype>105</fieldtype>\r\n\t\t//\t\t<content>1</content>\r\n\t\t//\t</data>\r\n\t\t//\t<data>\r\n\t\t//\t\t<formfield>ryxm</formfield>\r\n\t\t//\t\t<fetchdata>0</fetchdata>\r\n\t\t//\t\t<fieldtype>101</fieldtype>\r\n\t\t//\t\t<content>王敏</content>\r\n\t\t//\t</data>\r\n\t\t//</root>\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,fieldtype,content,fieldTagName;\r\n    \tvar subdatas,datavalue,datatext;\r\n    \tvar oprObj;\r\n    \tvar oprObjId\r\n    \tfor(var i=0;i<datas.length;i++){\r\n    \t\t// 控件名称\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n    \t\t// 控件类型\r\n    \t\tfieldtype=datas[i].getElementsByTagName(\"fieldtype\")[0].firstChild.nodeValue;\r\n    \t\t\r\n    \t\tif(fetchdata==\"0\"){\t// 检索赋值\r\n\t    \t\t// 控件的值\r\n\t    \t\tif(null != datas[i].getElementsByTagName(\"content\")[0].firstChild){\r\n\t    \t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n\t    \t\t} else{\r\n");
      out.write("\t    \t\t\tcontent = \"\";\r\n\t    \t\t}\r\n\t    \t\t\r\n\t\t\t\t//alert(formfield + \"---\" + fetchdata);\r\n\t    \t\t// 根据控件名称和下标索引获取控件对象\r\n\t    \t\toprObj = document.getElementsByName(formfield);\r\n\t    \t\t\r\n\t    \t\t// 判断要赋值的控件的类型\r\n\t    \t\tif(\"103\" == fieldtype){\t// 单选\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t\t    \t\t\tvar index = 0;\r\n\t\t    \t\t\tfor(var j=0; j<oprObj.length; j++){\t// 遍历所有的radio选项\r\n\t\t    \t\t\t\tif(oprObj[j].value == content){\t// 判断值为选择值的radio选择\r\n\t\t    \t\t\t\t\tif(index == curIndex){\t// 选中值跟选择值相同，且下标相同的radio选项\r\n\t\t    \t\t\t\t\t\toprObj[j].checked = \"checked\";\r\n\t\t    \t\t\t\t\t} else{\r\n\t\t    \t\t\t\t\t\toprObj[j].checked = \"\";\r\n\t\t    \t\t\t\t\t}\r\n\t\t    \t\t\t\t\tindex++;\r\n\t\t    \t\t\t\t}\r\n\t\t    \t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t} else if(\"104\" == fieldtype){\t// 多选\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t    \t\t\t\t// 统计页面上出现同名同值复选框的个数\r\n\t    \t\t\t\tvar sum = 0;\r\n\t    \t\t\t\tfor(var j=0; j<oprObj.length; j++){\r\n\t    \t\t\t\t\tif(oprObj[0].value == oprObj[j].value){\r\n\t    \t\t\t\t\t\tsum++;\r\n\t    \t\t\t\t\t}\r\n\t    \t\t\t\t}\r\n\t    \t\t\t\t// 页面上设置的同名多选控件中选项的个数\r\n\t    \t\t\t\tvar count = oprObj.length / sum;\r\n");
      out.write("\t    \t\t\t\t// 循环开始下标\r\n\t    \t\t\t\tvar index = curIndex * count;\r\n\t    \t\t\t\tcontent = \",\" + content;\r\n\t    \t\t\t\tfor(var j=index; j<(index+count); j++){\r\n\t    \t\t\t\t\tif(content.indexOf(\",\"+oprObj[j].value+\",\") > -1){\t// 多选值中包含当前选项的值\r\n\t    \t\t\t\t\t\toprObj[j].checked = \"checked\";\r\n\t    \t\t\t\t\t} else{\r\n\t    \t\t\t\t\t\toprObj[j].checked = \"\";\r\n\t    \t\t\t\t\t}\r\n\t    \t\t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t} else if(\"105\" == fieldtype){\t// 下拉框\r\n\t    \t\t\tvar opts = oprObj[curIndex].options;\t// 获取所有选项\r\n\t    \t\t\tfor(var j=0; j<opts.length; j++){\r\n\t\t\t\t\t\tif(content == opts[j].value){\t// 选项值等于选择值时，选项选中\r\n\t\t\t\t\t\t\topts[j].selected = \"selected\";\r\n\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\topts[j].selected = \"\";\r\n\t\t\t\t\t\t}\r\n\t    \t\t\t}\r\n\t    \t\t}else if(\"210\"==fieldtype||\"211\"==fieldtype){//单选人/多选人\r\n\t    \t\t\toprObj = document.getElementsByName(formfield+\"_Name\");\r\n\t    \t\t\toprObjId = document.getElementsByName(formfield+\"_Id\");\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t    \t\t\tvar name=content.substring(0,content.indexOf(\";\"));\r\n\t    \t\t\tvar id=content.substring(content.indexOf(\";\")+1);\r\n\t    \t\t\t\toprObj[curIndex].value = name;\r\n");
      out.write("\t    \t\t\t\toprObjId[curIndex].value=id;\r\n\t    \t\t\t}\r\n\t    \t\t}else if(\"212\"==fieldtype){//单选组织\r\n\t\t\t\t\toprObj = document.getElementsByName(formfield+\"_Name\");\r\n\t    \t\t\toprObjId = document.getElementById(formfield+\"_Id\");\r\n\t    \t\t\tif(null!=content && \"\"!=content){\r\n\t    \t\t\tvar name=content.substring(0,content.indexOf(\";\"));\r\n\t    \t\t\tvar id=content.substring(content.indexOf(\";\")+1);\r\n\t    \t\t\t\toprObj[curIndex].value = name;\r\n\t    \t\t\t\toprObjId.value=id;\r\n\t    \t\t\t}\r\n\t\t\t\t}else{\t// 其他类型控件，直接赋值，需要特殊处理时在之前加if判断\r\n\t    \t\t\t");

	    			if(com.js.util.config.SystemCommon.getSYWorkflowHR() == 1){
	    				
      out.write("\r\n\t\t\t\t\t\tif(content.indexOf(\"00:00:00.0\") > 0){\r\n\t\t\t\t\t\t\tcontent = content.replace(\"00:00:00.0\",\"\");\r\n\t\t\t\t\t\t}\r\n\t    \t\t\t\t");

	    			}
	    			
      out.write("\r\n\t    \t\t\toprObj[curIndex].value = content;\r\n\t    \t\t}\r\n    \t\t} else if(fetchdata == \"2\"){\t// 级联\r\n    \t\t\tsubdatas=datas[i].getElementsByTagName(\"content\")[0].getElementsByTagName(\"subdata\");\r\n    \t\t\t//下拉列表形式    \t\t\t\r\n    \t\t\t//oprObj=eval(\"document.all.\"+formfield);\r\n    \t\t\toprObj=document.getElementsByName(formfield)[curIndex];    \t\t\t\r\n    \t\t\t\r\n    \t\t\tfieldTagName=oprObj.tagName;    \t\t\t\r\n    \t\t\tif(fieldTagName==\"INPUT\" || fieldTagName==\"TEXTAREA\"){\r\n    \t\t\t\t//普通输入 \r\n    \t\t\t\toprObj.value=\"\";   \r\n    \t\t\t\tif(subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild!=null){\t\t\t\t\r\n\t    \t\t\t\tdatavalue=subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue; \r\n\t    \t\t\t\toprObj.value=datavalue;\r\n    \t\t\t\t}\r\n    \t\t\t}else if(fieldTagName==\"SELECT\"){\r\n    \t\t\t\t//删除原来的option    \t\t\t\t\r\n    \t\t\t\tjs_deleteAllOptions(oprObj);    \t\t\t\t\r\n    \t\t\t\t//新增option\r\n    \t\t\t\tfor(var j=0;j<subdatas.length;j++){\r\n    \t\t\t\t    try{\r\n\t    \t\t\t\t\tdatavalue=subdatas[j].getElementsByTagName(\"datavalue\")[0].firstChild.nodeValue;\r\n\t    \t\t\t\t\tdatatext=subdatas[j].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue;\r\n");
      out.write("\t    \t\t\t\t\tjs_addOption(oprObj,datavalue,datatext);\r\n    \t\t\t\t\t}catch(e){\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n    \t\t\t\toprObj.onchange();    \t\t\t\t\r\n    \t\t\t}\r\n    \t\t}\r\n\r\n    \t}\r\n    }\r\n}\r\n\r\nfunction js_deleteAllOptions(obj){\r\n\twhile(length!=0){ \r\n　　 \tvar length=obj.options.length;\r\n　　 \tfor(var i=0;i<length;i++)\r\n　　 \t\tobj.options.remove(i);\r\n　　 \tlength=length/2;\r\n　　 }\r\n}\r\nfunction js_addOption(obj,optionValue,optionText){\r\n\tvar newOption=new Option(optionText,optionValue); \r\n\tobj.options[obj.length]=newOption; \r\n} \r\n\r\nsetInterval(\"updateOnlineTime()\",30000);\r\nfunction updateOnlineTime(){\r\n\t\r\n\t var workId=\"\";\r\n\t var processId=\"\";\r\n\t var recordId=\"\";\r\n\t var tableId=\"\";\r\n   \r\n    if(document.getElementById(\"workId\")){\r\n     workId=document.getElementById(\"workId\").value;\r\n    }\r\n    if(document.getElementById(\"processId\")){\r\n    \tprocessId=document.getElementById(\"processId\").value;\r\n    }\r\n    if(document.getElementById(\"recordId\")){\r\n    \trecordId=document.getElementById(\"recordId\").value;\r\n    }\r\n    if(document.getElementById(\"tableId\")){\r\n");
      out.write("    \ttableId=document.getElementById(\"tableId\").value;\r\n    }\r\n    if(document.getElementById(\"tableId\")!=null&&document.getElementById(\"workId\")!=null&&document.getElementById(\"processId\")!=null&&document.getElementById(\"recordId\")!=null){\r\n\t   JSRequest.sendPOST(\"/jsoa/jsflow/jsflow_updateonlineTime.jsp?processId=\"+processId+\"&recordId=\"+recordId+\"&wfWorkId=\"+workId+\"&tableId=\"+tableId,\"\",doTime);\r\n\t}\r\n}\r\nfunction  doTime(){\r\n\r\n}\r\n</SCRIPT>\r\n<script language=javascript src=\"/jsoa/eform/js/form.js\"></script>\r\n<input type=\"hidden\" name=\"user_Id\" id=\"user_Id\" value=\"");
      out.print(session.getAttribute("userId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Name\" id=\"user_Name\" value=\"");
      out.print(session.getAttribute("userName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Account\" id=\"user_Account\" value=\"");
      out.print(session.getAttribute("userAccount"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_Name\" id=\"org_Name\" value=\"");
      out.print(session.getAttribute("orgName"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"org_ID\" id=\"org_ID\" value=\"");
      out.print(session.getAttribute("orgId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"group_ID\" id=\"group_ID\" value=\"");
      out.print(session.getAttribute("groupId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Hide_Field\" id=\"Hide_Field\" value=\"");
      out.print(request.getAttribute("hideField"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Page_Id\" id=\"Page_Id\" value=\"");
      out.print(pageId);
      out.write("\"/>\r\n<input type=\"hidden\" name=\"Info_Id\" id=\"Info_Id\" value=\"");
      out.print(request.getAttribute("infoId"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"work_Status\" id=\"work_Status\" value=\"");
      out.print(request.getParameter("workStatus"));
      out.write("\"/>\r\n<input type=\"hidden\" name=\"parent_fromDraft\" id=\"parent_fromDraft\" value=\"");
      out.print(parent_fromDraft);
      out.write("\">\r\n<input type=\"hidden\" name=\"resubmit\" id=\"resubmit\" value=\"");
      out.print(resubmit);
      out.write("\">\r\n<input type=\"hidden\" name=\"totalValueSet\" id=\"totalValueSet\" value=\"\" />\r\n<input type=\"hidden\" name=\"dateCompare\" id=\"dateCompare\" value=\"\" />\r\n<input type=\"hidden\" name=\"sendSMS\" id=\"sendSMS\" value=\"");
      out.print(SystemCommon.getSendSMS() );
      out.write("\" />\r\n<!-- 取 -->\r\n");
      out.print(cst.getComputeFieldHTML(pageId));
      out.write("\r\n<div id=\"formHTML\">\r\n<!-- 读取表单设计模板 begin -->\r\n");
      out.print(cst.getCode(pageId));
      out.write("\r\n<!-- 读取表单设计模板 end -->\r\n</div>\r\n\r\n<script type=\"text/javascript\">\r\n");

String allCoumputFieldStr = cst.getMainAndForeignComputeFields(pageId);
//判断当前表单是否新增
if(request.getAttribute("infoId")==null || request.getAttribute("infoId").toString().toUpperCase().equals("NULL") 
		|| request.getAttribute("infoId").toString().trim().length()<1){
	//初始化显示界面(新增)
	//System.out.println("新增表单.........................................................");
	// 如果是发起子流程则如果子流程中的表单与主表单相同则将数据继承
	String pareFormId = request.getParameter("pareTableId");
	boolean isNewForm = true;
	if(pareFormId!=null || !"null".equals(pareFormId) || !"".equals(pareFormId)){
		//取得父表单ID则比较父表单ID是否与当前表单ID相同，如果相同的话，则继承主表单数据
		isNewForm = cst.isNewForm(pareFormId, pageId);
	}
	
	if(isNewForm){
		//新表单
		//标识是否只读可写
		String rwTempString="",roTempString="";
		//取得表单关联的所有字段信息的数据(主表)
		String[][] fieldArr = cst.getPageField(pageId);
		String forHideField = "";	// 可写字段
		if(fieldArr != null){
			//遍历所有字段，获得字段的页面显示脚本
			for(int i=0; i<fieldArr.length; i++){
												
				if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
					if(noDisplayFields.indexOf(","+fieldArr[i][0]+",")>=0){
						String noDisplayHTML="if(document.getElementById('" + fieldArr[i][1] + "-" + fieldArr[i][0] + "'))\n{document.getElementById('" +
								fieldArr[i][1] + "-" + fieldArr[i][0] + "').innerHTML='';}";
						out.print(noDisplayHTML);
					}else{			
						out.print(cst.getHTML(fieldArr[i][0],hide_Field,domainId,fieldArr[i][1],request,allCoumputFieldStr));
					}
					if(hide_field_readonly.indexOf(fieldArr[i][1])>-1){
						//roTempString+=fieldArr[i][0]+"@@";
					}else{
						//rwTempString+=fieldArr[i][0]+"@@";
					}
				}
				
			}
		}
		//获得表单关联的所有子表字段
		String[][] forFieldArr = cst.getForeignField(pageId);
		if(forFieldArr != null){
			String tempHideField = "," + hide_Field + ",";
			//遍历所有字段，获得字段的页面显示脚本
			for(int i=0; i<forFieldArr.length; i++){
				if(forFieldArr[i][2]!=null && (!forFieldArr[i][2].trim().equals(""))){
					out.print(cst.getHTML(forFieldArr[i][2], hide_Field, domainId, forFieldArr[i][3], request, allCoumputFieldStr));
				}
				if(tempHideField.indexOf("," + forFieldArr[i][3] + ",") < 0){	// 不可写字段中不包含当前字段
					// 字段名称追加到可写字段
					forHideField += "," + forFieldArr[i][2] + ",";
				}
				if(hide_field_readonly.indexOf(forFieldArr[i][3])>-1){
					roTempString+=forFieldArr[i][2]+"@@";
				}else{
					rwTempString+=forFieldArr[i][2]+"@@";
				}
			}
		}
         
		//start
		//获得表单关联的所有子表数组
		String[] tables = cst.getForeignTable(pageId);
		if (tables != null && tables.length > 0) {
			//遍历所有子表
			for (int i=0; i<tables.length; i++) {
				if (tables[i] == null || tables[i].trim().length() < 1){
					continue;
				}
				
				String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
				if(forFields!=null && forFields.length>0){
					boolean hideTable = true;	// 子表是否有可写字段
					for(int k=0; k<forFields.length; k++){
						// 遍历所有字段，可写字段中包含当前字段
						if(forHideField.indexOf(forFields[k][5]) > -1){	// 子表可增删行
							// 如果该子表中有可编辑字段，则该表可编辑
							hideTable = false;
						}
					}
					//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
					if(hideTable){
						hideTableHTML += "<input type=hidden name=hideTable id=hideTable value=" + tables[i] + ">";
					} else{
						showTableHTML += "<input type=hidden name=showTable id=showTable value=" + tables[i] + ">";
					}
				}
				
				if(i == 0){	// 将第一个子表设置为增加行、删除行图标所在的焦点
					scriptappend = "currentRow = document.getElementsByName('" + tables[i] + "TR')[document.getElementsByName('" + tables[i] + "TR').length-1];setAbsolute(currentRow);";
				}
				String agent = request.getHeader("USER-AGENT");   
				if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
					if(-1 != agent.indexOf("MSIE 10")){
						out.print("document.getElementById('" + tables[i] + "DIV').childNodes[1].onclick=setDelRowsValue;");
					} else{
						out.print("document.getElementById('" + tables[i] + "DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
					}
				} else{
					out.print("document.getElementById('" + tables[i] + "DIV').childNodes[1].onclick=setDelRowsValue;");
				}

				//设置统计字段
				String[][] tlFlds = cst.getTotalFieldByTableName(pageId, tables[i], domainId);
				if(tlFlds !=null && tlFlds.length>0){
					String tlfld = "";
					String duiying = "";
					int show = 0;
			
					for(int p=0; p<tlFlds.length; p++){
						String totalValue = tlFlds[p][3];
						if(totalValue.startsWith("1;")){
							show = 1;
							break;
						}
					}
					out.print("addTotalRow('" + tables[i] + "'," + show + ");");
					for(int p=0; p<tlFlds.length; p++){
						tlfld += tlFlds[p][0] + ",";
						String totalValue = tlFlds[p][3];
						if(totalValue.endsWith(";yes")){
							duiying += tlFlds[p][0] + ":";
							String[] toValue = totalValue.split(";");
							for(int to=1; to<toValue.length-1; to++){
								String[] tValue = toValue[to].split("@");
								duiying += tValue[0] + ",";
							}
							while(duiying.endsWith(",")){
								duiying = duiying.substring(0, duiying.length() - 1);
							}
							duiying += ";";
						}
						if(totalValue.startsWith("1;")){
							out.print("document.getElementById('" + tables[i] + "TOTALTD').innerHTML+='<span>" + tlFlds[p][1] + ":<label id=" + tlFlds[p][0] + "totallabel></label></span>';");
						} else{
							out.print("document.getElementById('" + tables[i] + "TOTALTD').innerHTML+='<span style=display:none;>" + tlFlds[p][1] + ":<label id=" + tlFlds[p][0] + "totallabel></label></span>';");
						}
					}
					out.print("document.getElementById('" + tables[i] + "TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value=" + tlfld + ">';");
					out.print("document.getElementById('totalValueSet').value+='" + duiying + "';");
					out.print("setTotalValue();");
					while(duiying.endsWith(";")){
						duiying = duiying.substring(0, duiying.length()-1);
					}
				}
			}
		}
		if(com.js.util.config.SystemCommon.getCustomerName().equals("haier")){
			//处理变色逻辑
			if(roTempString.length()>2){
				roTempString=roTempString.substring(0, roTempString.length()-2);
				String[] roTempStringArr = roTempString.split("@@");
				for(String str:roTempStringArr){
					out.print("var inps=document.getElementsByName('"+str+"');");
					out.print("if(inps!=undefined && inps.length>0){");
					out.print("	for(var k=0;k<inps.length;k++){");
					out.print("	 inps[k].style.backgroundColor=\"#E6E6FA\";");
					
					out.print("	}}");
				
				}
			}
			if(rwTempString.length()>2){
				rwTempString=rwTempString.substring(0, rwTempString.length()-2);
				String[] rwTempStringArr = rwTempString.split("@@");
				for(String str:rwTempStringArr){
					out.print("var inps=document.getElementsByName('"+str+"');");
					out.print("if(inps!=undefined && inps.length>0){");
					out.print("	for(var k=0;k<inps.length;k++){");
					out.print("	 inps[k].style.backgroundColor=\"#FFEC8B\";");
					out.print("	}}");
				
				}
			}
		}
	} else{
		//子流程表单与主流程表单用的是同一张数据表，取主流程中的数据填充表单

		//当前表单为编辑表单（表单已有对应的数据）
		//System.out.println("新增子流程的继承主流程数据.........................................................");
		String forHideField = "";//字表不可编辑字段

		if("1".equals(request.getParameter("flag"))){
			hide_Field = "ALL";
		}
		
		//2017-07-24 如果当前表单与pareFormId不一致说明是 从主流程中带来的数据，需要先把本表单中的字段显示出来，在填充主流程表单的数据
		if(!pareFormId.equals(pageId)){
			String[][] fieldArr = cst.getPageField(pageId);//读取表单那关联的所有主表字段信息
			if(fieldArr != null){
				for(int i=0; i<fieldArr.length; i++){
					//遍历所有主表字段
					//System.out.println(fieldArr[i][0]+"   :"+fieldArr[i][1]);
					if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
						//获得主表字段的显示脚本				
						out.print(cst.getEditHTML(fieldArr[i][0], request.getParameter("pareRecordId"), pageId, hide_Field, domainId, fieldArr[i][1], parent_fromDraft, allCoumputFieldStr, request));
						
					}
				}
			}
		}
		//2017-07-24 如果当前表单与pareFormId不一致说明是 从主流程中带来的数据，需要先把本表单中的字段显示出来，在填充主流程表单的数据  end
		
		pageId = pareFormId;
		//所有字段不可编辑，该种情况表示在自定义模块中点击链接查看信息
		String[][] fieldArr = cst.getPageField(pageId);//读取表单那关联的所有主表字段信息
		if(fieldArr != null){
			for(int i=0; i<fieldArr.length; i++){
				//遍历所有主表字段
				//System.out.println(fieldArr[i][0]+"   :"+fieldArr[i][1]);
				if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
					//获得主表字段的显示脚本				
					out.print(cst.getEditHTML(fieldArr[i][0], request.getParameter("pareRecordId"), pageId, hide_Field, domainId, fieldArr[i][1], parent_fromDraft, allCoumputFieldStr, request));
					
				}
			}
		}

		//start
		//获得表单那关联的所有子表
		String[] tables = cst.getForeignTable(pageId);
		//System.out.println("talbe:"+tables.length);
		if (tables != null && tables.length > 0) {
			for (int i = 0; i < tables.length; i++) {
				//遍历所有子表
				if (tables[i] == null || tables[i].trim().length() < 1)continue;
					//提取字表关联的所有字段
					String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
					//System.out.println("forFields:"+forFields.length);
					//拼装SQL
					String sql = "";	//查询子表关联到表单中的所有字段值的SQL语句
					if(forFields!=null && forFields.length>0){
						boolean hideTable = true;	//子表是否有可写字段
						for(int k=0; k<forFields.length; k++){
							//遍历所有字段
							sql += forFields[k][5] + ",";	//将字段添加到数据查询的SQL中
							if(forHideField.indexOf(forFields[k][5]) < 0){
								//如果该子表中有可编辑字段，则该表可编辑
								hideTable = false;
							}
						}
				
						//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
						if(hideTable){
							hideTableHTML += "<input type=hidden name=hideTable id=hideTable value="+tables[i]+">";
						} else{
							showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
						}
						sql = sql.substring(0,sql.length()-1);
					}
					//System.out.println("sql:"+sql);
					//提取子表数据
					String[][] data = null;
					if(sql.length() > 1){
						sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getParameter("pareRecordId")+ " order by "+ tables[i] +"_id";
						data = cst.loadDataBySQL(sql,String.valueOf(forFields.length+1));
					} else{
						continue;
					}
					//设置页面子表行数
					if(data!=null && data.length>0){
						for(int n=0; n<data.length-1; n++){	//遍历所有数据，解析数据行，根据记录数量增加行
							String script = "currentRow = document.getElementsByName('"+tables[i]+"TR')[document.getElementsByName('"+tables[i]+"TR').length-1];addRow();";
							out.print(script);
						}
						for(int n=0; n<data.length; n++){	//遍历数据，解析数据在表单上的展示
							//解析数据
							for(int m=0; m<forFields.length; m++){	//遍历字段，生成该字段及其值展示在表单上的脚本
								out.print(cst.getForeignEditHTML(request,forFields[m][5],data[n][m],forFields,"",m,String.valueOf(n),forFields[m][0],parent_fromDraft,tables[i],request.getParameter("pareRecordId"),data[n][forFields.length],forFields[m][10],allCoumputFieldStr));
							}
							String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
							out.print(script);
						}
					} else{//该子表没有数据，隐藏模板中初始化的第一个数据行
						for(int m=0; m<forFields.length; m++){
							out.print(cst.getForeignEditHTML(request,forFields[m][5],"",forFields,(("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus")))?hide_Field+forHideField:"ALL"),m,"0",forFields[m][0],parent_fromDraft,tables[i],request.getParameter("pareRecordId"),"-100",forFields[m][10],allCoumputFieldStr));
						}
						out.print("document.getElementsByName('"+tables[i]+"TR')[0].style.display='none';");
					}
					String agent = request.getHeader("USER-AGENT");   
					if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
						if(-1 != agent.indexOf("MSIE 10")){
							out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
						} else{
							out.print("document.getElementById('"+tables[i]+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
						}
					} else{
						out.print("document.getElementById('"+tables[i]+"DIV').childNodes[1].onclick=setDelRowsValue;");
					}
					//设置统计字段
					String[][] tlFlds = cst.getTotalFieldByTableName(pageId,tables[i],domainId);             
				
					if(tlFlds !=null && tlFlds.length>0){
						//增加统计字段显示行
						/*
						out.print("addTotalRow('"+tables[i]+"');");
						String tlfld = "";
						for(int p=0; p<tlFlds.length; p++){//遍历统计字段，设置对应的统计字段表单元素
							tlfld +=  tlFlds[p][0]+",";
							String totalValue = tlFlds[p][3];
							if(totalValue.startsWith("1;")){
								out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
							} else{
								out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
							}     
						}
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField  id=totalField value="+tlfld+">';");
						out.print("setTotalValue();");
						*/
				
						String tlfld = "";
						String duiying = "";
						int show = 0;
				
						for(int p=0; p<tlFlds.length; p++){
							String totalValue = tlFlds[p][3];
							if(totalValue.startsWith("1;")){
								show = 1;
								break;
							}
						}
						out.print("addTotalRow('" + tables[i] + "'," + show + ");");
						
						for(int p=0; p<tlFlds.length; p++){
                          	  tlfld += tlFlds[p][0] + ",";
                          	  String totalValue = tlFlds[p][3];
                          	  if(totalValue.endsWith(";yes")){
                          	  		duiying+=tlFlds[p][0]+":";
                          	  		String[] toValue = totalValue.split(";");
                          	  		for(int to=1;to<toValue.length-1;to++){
                          	  			String[] tValue = toValue[to].split("@");
                          	  			duiying+=tValue[0]+",";
                          	  		}
                          	  		while(duiying.endsWith(",")){
                          	  			duiying = duiying.substring(0, duiying.length()-1);
                          	  		}
                          	  		duiying+=";";
                          	  }
                          	  if(totalValue.startsWith("1;")){
                          	  		out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
                          	  }else{
                          	  		out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
                          	  }
                          }
                          out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
                          out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
                          out.print("setTotalValue();");
                          while(duiying.endsWith(";")){
                          	  duiying = duiying.substring(0, duiying.length()-1);
                          }
              }
			}
		}//end
	}
} else{
	//用于保存可编辑字段	
	String rwTempString="";
	//当前表单为编辑表单（表单已有对应的数据）
	String forHideField = "";//字表不可编辑字段
	if(request.getParameter("processId")!=null){
		//表单在流程中调用
		WorkFlowBD workFlowBD = new WorkFlowBD();
		//取读字段
		String writeFieldString = "";//可写字段串 $字段名称$$字段名称$
		if("0".equals(request.getParameter("workStatus"))){
			//是待办文件
			//取当前节点的可写字段List
			List list = (List) request.getAttribute("RWFieldList");
			String[] str = null;
			for(int i = 0; list!=null && i < list.size(); i ++){//遍历可写字段，将可写字段转化为字符串形式
				str = (String[]) list.get(i);
				if(str[0].equals("1")){//可写字段
					writeFieldString += "$" + str[1] + "$";
					rwTempString+=str[1]+"$$";
				}
			}
			//表单中关联的所有子表字段信息
			String[][] forFieldArr = new CustomFormBD().getForeignField(pageId);
			if(forFieldArr!=null){
				for(int i=0; i<forFieldArr.length; i++){
					//遍历所有子表字段，如果字段不在可写字段中，则字段为不可编辑字段
					if(writeFieldString.indexOf("$"+forFieldArr[i][2]+"$")<0){
						forHideField += forFieldArr[i][2]+",";
					}
				}
			}
		}
	}

	if("1".equals(request.getParameter("flag")) || (!"0".equals(request.getParameter("workStatus")) && !"-2".equals(request.getParameter("workStatus")) && !"-1".equals(request.getParameter("workStatus")))){
		hide_Field="ALL";
	}
	//草稿箱或扩展模块中使用表单
	if(request.getAttribute("fromEFormFlag")!=null && "1".equals(request.getAttribute("fromEFormFlag").toString())){
		hide_Field="";
	}
	
	//所有字段不可编辑，该种情况表示在自定义模块中点击链接查看信息
	String[][] fieldArr = cst.getPageField(pageId);//读取表单那关联的所有主表字段信息
	Boolean isLicenses = false;
	if("zhongshefanhua".equals(com.js.util.config.SystemCommon.getCustomerName())&&!hide_Field.equals("ALL")){
		//证书借出记录需要隐藏额字段
		for(int i=0;i<fieldArr.length;i++){
			if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals("")) && fieldArr[i][0].trim().indexOf("zsfh_3021")>=0){
				if(!fieldArr[i][0].equals("zsfh_3021_f3022")&&!fieldArr[i][0].equals("zsfh_3021_f3021")&&!fieldArr[i][0].equals("zsfh_3021_f3361")){
					if(!isLicenses){
						isLicenses = true;
						hide_Field+=fieldArr[i][1];
					}else{
						hide_Field+=","+fieldArr[i][1];
					}
				}
			}
		}
	}
	if(fieldArr!=null){
		for(int i=0;i<fieldArr.length;i++){
			//遍历所有主表字段
			if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
				//获得主表字段的显示脚本
				//2016-12-08 隐藏表单字段
				if(noDisplayFields.indexOf(","+fieldArr[i][0]+",")>=0){
					String noDisplayHTML="if(document.getElementById('" + fieldArr[i][1] + "-" + fieldArr[i][0] + "'))\n{document.getElementById('" +
							fieldArr[i][1] + "-" + fieldArr[i][0] + "').innerHTML='';}";				
					out.println(noDisplayHTML);
				}else{
					out.print(cst.getEditHTML(fieldArr[i][0],request.getAttribute("infoId").toString(),pageId,hide_Field,domainId,fieldArr[i][1],parent_fromDraft,allCoumputFieldStr,request));
				}
			}
		}
	}

	//start
	//获得表单那关联的所有子表
	String[] tables = cst.getForeignTable(pageId);
	if (tables != null && tables.length > 0) {
		for (int i = 0; i < tables.length; i++) {
			//遍历所有子表
			if (tables[i] == null || tables[i].trim().length() < 1)continue;
			//提取字表关联的所有字段
			String[][] forFields = cst.getForeignFieldList(pageId,tables[i],domainId);
			//拼装SQL
			String sql = "";//查询子表关联到表单中的所有字段值的SQL语句
			if(forFields!=null && forFields.length>0){
				boolean hideTable = true;//子表是否有可写字段
				int wrLenTemp=0;//可写字段个数
				for(int k=0; k<forFields.length; k++){
					//遍历所有字段
					sql += forFields[k][5]+",";//将字段添加到数据查询的SQL中
					if(forHideField.indexOf(forFields[k][5])<0){
						//如果该子表中有可编辑字段，则该表可编辑
						hideTable = false;
					}
					if(request.getHeader("USER-AGENT").indexOf("Safari")<=-1){//Safari浏览器不再进行验证（解决苹果电脑，保存的流程再次发起时，子表不能加行）
						if(rwTempString.indexOf(forFields[k][5])>-1 || "111".equals(forFields[k][1]) || "302".equals(forFields[k][1])){
							//当可写或为自动编号、序号时不验证
							wrLenTemp++;
						}
					}
				}
				/*if(request.getHeader("USER-AGENT").indexOf("Safari")<=-1){//Safari浏览器不再进行验证（解决苹果电脑，保存的流程再次发起时，子表不能加行）
					if(wrLenTemp==forFields.length||request.getParameter("processId")==null){//子表字段全部可写时该表可增加删除行或者非流程
						hideTable=false;
					}else{
						hideTable=true;
					}
				}*/
				//如果是重新发起流程默认为可写表单
				if("1".equals(resubmit)){
					hideTable=false;
				}
				//如果是待发流程默认为可写表单
				if("1".equals(parent_fromDraft)){
					hideTable=false;
				}
				//生成子表是否可编辑的HTML元素，用于数据更新、增加删除行的控制
				if(hideTable){
					hideTableHTML += "<input type=hidden name=hideTable id=hideTable value="+tables[i]+">";
				} else{
					showTableHTML += "<input type=hidden name=showTable id=showTable value="+tables[i]+">";
				}
				sql = sql.substring(0,sql.length()-1);
			}
              
			//提取子表数据
			String foreignHideField = "";
			if("0".equals(request.getParameter("workStatus"))||"-1".equals(request.getParameter("workStatus"))||"-2".equals(request.getParameter("workStatus"))){
				foreignHideField=hide_Field+forHideField;
			} else{
				foreignHideField = "ALL";
			}
			if(request.getAttribute("fromEFormFlag")!=null && "1".equals(request.getAttribute("fromEFormFlag").toString())){
				foreignHideField = "";
			}
			//中设泛华修改证照字表全部不可编辑
			if(isLicenses){
				foreignHideField = "ALL";
			}
			String[][] data = null;
			if(sql.length() > 1){
				sql = "select " + sql + "," + tables[i] +"_id from " + tables[i] +" where " + tables[i]+"_FOREIGNKEY="+request.getAttribute("infoId").toString()+ " order by "+ tables[i] +"_id";
				data = cst.loadDataBySQL(sql,String.valueOf(forFields.length + 1));
			} else{
				continue;
			}
			
			//设置页面子表行数
			if(data!=null && data.length>0){
				for(int n=0; n<data.length-1; n++){//遍历所有数据，解析数据行，根据记录数量增加行
					String script = "currentRow = document.getElementById('"+tables[i]+"TR');addRow();";
					out.print(script);
				}
				for(int n=0; n<data.length; n++){//遍历数据，解析数据在表单上的展示
					//解析数据
					for(int m=0; m<forFields.length; m++){//遍历字段，生成该字段及其值展示在表单上的脚本
						//System.out.println("----------------------:"+data[n][m]);
						String valueString = "";
						if(data[n][m]!=null && data[n][m].toString().startsWith(".")){
							valueString = "0" + data[n][m];
						} else if(!"105".equals(forFields[m][1])){
							valueString = data[n][m];
						}else{
							valueString = data[n][m];
						}
						//2016-12-08 隐藏表单字段
						/*if(noDisplayFields.indexOf(","+forFields[m][5]+",")>=0){
							String noDisplayHTML="if(document.getElementsByName('" + forFields[m][0] + "-" + forFields[m][5] + "'))\n{document.getElementsByName('" +
									forFields[m][0] + "-" + forFields[m][5] + "')["+n+"].innerHTML='';}";						
							out.println(noDisplayHTML);
						}else{*/
							out.print(cst.getForeignEditHTML(request,forFields[m][5],valueString,forFields,foreignHideField,m,String.valueOf(n),forFields[m][0],parent_fromDraft,tables[i],request.getAttribute("infoId").toString(),data[n][forFields.length],forFields[m][10],allCoumputFieldStr));
						//}
					}
					String script = "document.getElementsByName('"+forFields[0][0]+"-"+forFields[0][5]+"')["+String.valueOf(n)+"].innerHTML+='<input type=hidden id="+tables[i]+"id name="+tables[i]+"id value="+data[n][forFields.length]+">';";
					out.print(script);
				}
			} else{//该子表没有数据，隐藏模板中初始化的第一个数据行
				for(int m=0; m<forFields.length; m++){
					out.print(cst.getForeignEditHTML(request,forFields[m][5],"",forFields,foreignHideField,m,"0",forFields[m][0],parent_fromDraft,tables[i],request.getAttribute("infoId").toString(),"-100",forFields[m][10],allCoumputFieldStr));
				}
				//	吴凯20130205修改为不隐藏
				//out.print("document.getElementsByName('"+tables[i]+"TR')[0].style.display='none';");
			}
			
			String agent = request.getHeader("USER-AGENT");   
			if (null!=agent && -1!=agent.indexOf("MSIE")) { //判断浏览器
				if(-1 != agent.indexOf("MSIE 10")){
					out.print("document.getElementById('" + tables[i] + "DIV').childNodes[1].onclick=setDelRowsValue;");
				} else{
					out.print("document.getElementById('" + tables[i] + "DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
				}
			} else{
				out.print("document.getElementById('" + tables[i] + "DIV').childNodes[1].onclick=setDelRowsValue;");
			}
			//设置统计字段
			String[][] tlFlds = cst.getTotalFieldByTableName(pageId, tables[i], domainId);
			if(tlFlds!=null && tlFlds.length>0){
				//增加统计字段显示行
				/*
				out.print("addTotalRow('"+tables[i]+"');");
				String tlfld = "";
				for(int p=0;p<tlFlds.length;p++){//遍历统计字段，设置对应的统计字段表单元素
					tlfld +=  tlFlds[p][0]+",";
					String totalValue = tlFlds[p][3];
					if(totalValue.startsWith("1;")){
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					} else{
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}  
				}
				out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
				out.print("setTotalValue();");
				*/
		
				String tlfld = "";
				String duiying = "";
				int show = 0;
		
				for(int p=0; p<tlFlds.length; p++){
					String totalValue = tlFlds[p][3];
					if(totalValue.startsWith("1;")){
						show = 1;
						break;
					}
				}
				out.print("addTotalRow('" + tables[i] + "'," + show + ");");
				for(int p=0; p<tlFlds.length; p++){
					tlfld +=  tlFlds[p][0]+",";
					String totalValue = tlFlds[p][3];
					if(totalValue.endsWith(";yes")){
						duiying += tlFlds[p][0] + ":";
						String[] toValue = totalValue.split(";");
						for(int to=1; to<toValue.length-1; to++){
							String[] tValue = toValue[to].split("@");
							duiying += tValue[0] + ",";
						}
						while(duiying.endsWith(",")){
							duiying = duiying.substring(0, duiying.length()-1);
						}
						duiying += ";";
					}
					if(totalValue.startsWith("1;")){
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					} else{
						out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<span style=display:none;>"+tlFlds[p][1]+":<label id="+tlFlds[p][0]+"totallabel></label></span>';");
					}
				}
				out.print("document.getElementById('"+tables[i]+"TOTALTD').innerHTML+='<input type=hidden name=totalField id=totalField value="+tlfld+">';");
				out.print("document.getElementById('totalValueSet').value+='"+duiying+"';");
				out.print("setTotalValue();");
				while(duiying.endsWith(";")){
					duiying = duiying.substring(0, duiying.length()-1);
				}
			}
		}
	}//end
	
	
	if(com.js.util.config.SystemCommon.getCustomerName().equals("haier") && rwTempString.length()>2){
		rwTempString=rwTempString.substring(0, rwTempString.length()-2);
		String[] rwTempStringArr = rwTempString.split("\\$\\$");
		for(String str:rwTempStringArr){
			//out.print("alert('"+str+"')");
			//out.print("document.getElementsByName('"+str+"')[0].style.backgroundColor='yellow';");
		
			out.print("var inps=document.getElementsByName('"+str+"');");
			out.print("if(inps!=undefined && inps.length>0){");
			out.print("	for(var k=0;k<inps.length;k++){");
			out.print("	 inps[k].style.backgroundColor=\"#FFEC8B\";");
			out.print("	}}");
		
		}
	}
}

      out.write("\r\n\r\n\r\n</script>\r\n");

//子表的计算字段设置
out.print(cst.getForeignComputeFieldHTML(pageId));
out.print(hideTableHTML+showTableHTML);  

      out.write("\r\n<script language=javascript src=\"/jsoa/eform/datetime/time.js\"></script>\r\n<script src=\"/jsoa/js/jquery-1.4.2.min.js\" language=\"javascript\"></script>\r\n<script language=\"javascript\">\r\nif(document.all.wf_ua){\r\n\tif(document.all.wf_ua.length){\r\n\t\t\r\n\t} else{\r\n\t\teval(\"document.all.\" + document.all.wf_ua.value + \".value='");
      out.print(session.getAttribute("userAccount"));
      out.write("'\");\r\n\t}\r\n}\r\n");
 if("1".equals(com.js.util.config.SystemCommon.getSubTableScrollbar())){ 
	String[] tempSubTables = cst.getForeignTable(pageId);
	String tempSubTablesArr="";
	if(tempSubTables!=null&&tempSubTables.length>0){
		for(String tt:tempSubTables){
			tempSubTablesArr+=tt+";";
		}
	}
	if(tempSubTablesArr.length()>1){
		tempSubTablesArr=tempSubTablesArr.substring(0, tempSubTablesArr.length()-1);
	}

      out.write("\r\nvar tempSubTablesArr=\"");
      out.print(tempSubTablesArr);
      out.write("\";\r\nvar tempSubTablesBarBeginCnt=");
      out.print(com.js.util.config.SystemCommon.getSubTableScrollbarBeginCnt());
      out.write(";\r\nvar tempScrollAddHeight=0;\r\nfunction tempSubTableScrollbarFun(){\r\n\tvar tempBodyWidthToSubTableScrollbar=$(document.body).width()-75;\r\n\tvar tempSubTablesArrs=tempSubTablesArr.split(\";\");\r\n\tif(tempSubTablesArr==\"\" || tempSubTablesArrs.length<1){\r\n\t\treturn;\r\n\t}\r\n\tfor(var kk=0;kk<tempSubTablesArrs.length;kk++){\r\n\t\tvar colNum = document.getElementById(\"tab\"+tempSubTablesArrs[kk]).rows.item(0).cells.length;\r\n\t    if(colNum>=tempSubTablesBarBeginCnt){\r\n\t    \tvar tableWidth=0;\r\n\t\t\t$(\"#tab\"+tempSubTablesArrs[kk]).find(\"tr:eq(0) td\").each(function(){\r\n\t\t\t\tvar temptdWidth=$(this)[0].style.width;\r\n\t\t\t\tif(temptdWidth == undefined || temptdWidth == \"\"){\r\n\t\t\t\t\t$(this).width(\"75px\");\r\n\t\t\t\t\ttableWidth+=75;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(this).width(temptdWidth);\r\n\t\t\t\t\ttableWidth+=parseInt(temptdWidth);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$(\"#tab\"+tempSubTablesArrs[kk]).width(tableWidth+\"px\");\r\n\t\t\t$(\"#\"+tempSubTablesArrs[kk]+\"DIV\").width(tempBodyWidthToSubTableScrollbar+\"px\");\r\n\t\t\t$(\"#\"+tempSubTablesArrs[kk]+\"DIV\").css(\"overflow\",\"auto\");\r\n\t\t\t\r\n\t\t\tif(('");
      out.print(session.getAttribute("browserVersion"));
      out.write("'.indexOf(\"IE11360\")>-1 ||'");
      out.print(session.getAttribute("browserVersion"));
      out.write("'.indexOf(\"MSIEx\")>-1 )&& tempScrollAddHeight==0){\r\n\t\t\t\tvar defaultHeight=$(\"#\"+tempSubTablesArrs[kk]+\"DIV\").height()+18;\r\n\t\t\t\t$(\"#\"+tempSubTablesArrs[kk]+\"DIV\").height(defaultHeight+\"px\");\r\n\t\t\t\ttempScrollAddHeight++;\r\n\t\t\t}\r\n\t    }\r\n\t}\r\n}\r\n\r\n$(window).resize(function(){\r\n\ttempSubTableScrollbarFun();\r\n});\r\n$(document).ready(function(){ \r\n\t　tempSubTableScrollbarFun();　\r\n}); \r\n");
}
      out.write("\r\n</script>\r\n\r\n<div id=\"adddelrow_div\" style=\"border: #0a246a 1px solid; visibility: hidden; z-index:1000; width: 30px; position: absolute\">\r\n\t<table height=\"100%\" cellSpacing=0 cellPadding=0 width=\"100%\" border=0>\r\n\t\t<tr>\r\n\t\t\t<td onmouseover=\"this.style.borderRight='1px #0A246A solid'\" onmouseout=\"this.style.borderRight=''\" align=\"middle\">\r\n\t\t\t\t<img title=\"点击删除记录\" style=\"cursor: pointer;width:12;height:12\" src=\"/jsoa/eform/images/delarrow.gif\" onclick=\"delRow()\" align=\"absMiddle\">\r\n\t\t\t</td>\r\n\t\t\t<td onmouseover=\"this.style.borderLeft='1px #0A246A solid'\" onmouseout=\"this.style.borderLeft=''\" align=\"middle\">\r\n\t\t\t\t<img title=\"点击添加记录\" style=\"cursor: pointer;width:12;height:12\" src=\"/jsoa/eform/images/addarrow.gif\" onclick=\"addRow();tempComboBoxCreateFun();\" align=\"absMiddle\">\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n</div>\r\n");

String projectType = session.getServletContext().getInitParameter("projectType");
if(projectType!=null&&"tjgzw".equals(projectType)){//是天津国资委项目 增加 物品管理子表 联想查询 div


      out.write("\t\r\n<!-- 国资委 物品管理 联想查询 -->\r\n<div  id=\"b\" style=\"display:none;border:1px solid #000000;overflow:auto;background-color: #d9ffff\">\r\n\t<table id=\"atable\">\r\n\r\n\t</table>\r\n </div>\r\n ");

}
 
      out.write("\r\n<script language=\"JavaScript\">\r\n//document.body.attachEvent(\"onload\",function(){});\r\n//alert(document.body.readyState);\r\nsetNoWrap();\r\ninitRow();\r\n");

if(projectType!=null&&"tjgzw".equals(projectType)){//是天津国资委项目 增加 物品管理子表 联想查询 只适用与物品检索 且物品单位在可见列的第三列


      out.write("\t\r\nfunction showc1(node){\r\n\t //$(node) 将dom对象转为jquery对象\r\n\t $(\"#b\").width($(node).width()+4);\r\n    $(\"#b\").height($(node).height()*10);\r\n\t $(\"#b\").css(\"position\",\"absolute\"); \r\n\t $(\"#b\").css(\"top\",$(node).offset().top+$(node).height()+6);//设置div的位置在input的下面\r\n\t $(\"#b\").css(\"left\",$(node).offset().left);//设置div的位置在input的左面\r\n\t var table = $(\"#atable\");\r\n\t table.html(\"\");\r\n\t //联想查询并返回json\r\n\t $.ajax({\r\n\t        url: \"/jsoa/TjgzwAction.do?type=goodsquery\",\r\n\t        type: \"POST\",\r\n\t        dataType:\"json\",\r\n\t        async:false,\r\n\t        data:{\"query_str\":encodeURI($(node).val(),'UTF8'),\"type\":\"goodsquery\"},\r\n\t        success: function(data) {\r\n\t             var rs = data.rs;\r\n\t             //构建联想查询 选择项\r\n\t        \t for(var i=0;i<rs.length;i++){\r\n\t\t        \t var temp = rs[i];\r\n\t        \t\t var tr = $(\"<tr></tr>\");//创建一个td的对象\r\n\t\t\t       \t var td = $(\"<td></td>\");//创建一个td的对象\r\n\t\t\t       \t tr.width($(node).width());//设置tr宽度等于input的宽度\r\n\t\t\t       \t tr.height($(node).height()+5);//设置tr高度等于input的高度\r\n\t\t\t       \t table.width($(node).width());//设置table宽度等于input的宽度\t \r\n");
      out.write("\t\t\t       \t td.bind(\"mouseover\",function(){//绑定mouseover事件 触发时将td背景色变为blue\r\n\t\t\t       \t\t$(this).css(\"background\",\"#89cff0\");//$(this)指的是当前td\r\n\t\t\t       \t });\r\n\t\t\t       \t td.bind(\"mouseout\",function(){//绑定mouseout事件 触发时将td背景色变为white\r\n\t\t\t       \t\t$(this).css(\"background\",\"d9ffff\"); \r\n\t\t\t       \t });\r\n\t\t\t       \t td.bind(\"click\",function(){////绑定click事件 完成相应的操作\r\n\t\t\t       \t\t$(node).val($(this).html());\r\n\t\t\t       \t\t//计算当前node的序号\r\n\t\t\t       \t\tvar index_cur=$(\":input[name ='\"+$(node).attr(\"name\")+\"']\").index($(node));\r\n\t\t\t       \t\tvar id_name = $(node).attr(\"name\").substring(0,$(node).attr(\"name\").lastIndexOf(\"_\"));//当前行 第一列元素name\r\n\t\t\t       \t\tvar d_name_temp1 = id_name.substring(id_name.lastIndexOf(\"f\")+1);//当前行 第三列元素name temp\r\n\t\t\t       \t\tvar d_name_temp2 = parseInt(d_name_temp1)+parseInt(2);\r\n\t\t\t       \t\tvar d_name_temp = id_name.substring(0,id_name.lastIndexOf(\"f\")+1)+d_name_temp2;\r\n\t\t\t       \t\tvar td_id = $(this).attr(\"id\");\r\n\t\t\t       \t\tvar td_ids = td_id.split(\"&\");\r\n\t\t\t       \t\t$(\":input[name ='\"+id_name+\"']\").eq(index_cur).val($(this).html());//设置当前行的id\r\n");
      out.write("\t\t\t       \t\t$(\":input[name ='\"+d_name_temp+\"']\").eq(index_cur).val(td_ids[1]);\r\n\t\t\r\n\t\t\t       \t\t$(\"#b\").hide();\r\n\t\t\t       \t });          \r\n\t\t\t           td.html(temp.goods_name);\r\n\t\t\t           td.attr(\"id\",temp.id+\"&\"+temp.goods_unit);//td的id为：\"物品id&单位\"\r\n\t\t\t           tr.append(td);      \r\n\t\t\t           table.append(tr);\r\n\t        \t }\r\n\t           \r\n\t        },\r\n\t        error: function(result, status) { //如果没有上面的捕获出错会执行这里的回调函数\r\n\t            alert(\"访问异常，请关闭浏览器。\");\r\n\t        },\r\n\t        complete: function(XMLHttpRequest, textStatus) {\r\n\t            // var a = textStatus;\r\n\t        }\r\n\t    });\r\n\t \r\n    \r\n    $(\"#b\").show();\r\n    \r\n   \r\n\r\n}\r\n");

	}

      out.write("\r\n\r\n\r\n</script>\r\n<script >\r\n");
//=scriptappend
      out.write('\r');
      out.write('\n');

/*
if(scriptappend.length()>0){
	out.print("document.body.attachEvent('onload',function(){setAbsolute(currentRow);});");
}
*/

      out.write("\r\n//alert(document.body.onload);\r\n</script>\r\n<script src=\"/jsoa/js/util.js\"></script>");
      out.write("\r\n\t</td></tr>\r\n\t<tr><td width=\"100%\">\r\n           ");
      out.write("\r\n\r\n \r\n\r\n\r\n\r\n<style type=\"text/css\">\r\n<!--\r\n#noteDiv {\r\n\tposition:absolute;\r\n\twidth:220px;\r\n\theight:126px;\r\n\tz-index:1;\r\n\toverflow:auto;\r\n\tborder:1px solid #829FBB;\r\n\tdisplay:none;\r\n\tbackground-color:#ffffff;\r\n}\r\n\r\n#noteDiv1 {\r\n\tposition:absolute;\r\n\twidth:220px;\r\n\theight:126px;\r\n\tz-index:1;\r\n\toverflow:auto;\r\n\tborder:1px solid #829FBB;\r\n\tdisplay:none;\r\n}\r\n.divOver{\r\n    background-color:#003399;\r\n\tcolor:#FFFFFF;\r\n\tborder-bottom:1px dashed #cccccc;\r\n    width:100%;\r\n\theight:20px;\r\n\tline-height:20px;\r\n\tcursor:default;\r\n\tpadding-left:5px;\r\n}\r\n.divOut{\r\n    background-color:#ffffff;\r\n\tcolor:#000000;\r\n\tborder-bottom:1px dashed #cccccc;\r\n    width:100%;\r\n\theight:20px;\r\n\tline-height:20px;\r\n\tcursor:default;\r\n\tpadding-left:5px;\r\n}\r\n.table_border { border:1px solid #dce0e1;}\r\n.border_bottom_background{ border-bottom:1px solid #dce0e1; background:#f5f5f5;}\r\n.border_bottom{border-bottom:1px dashed #dce0e1;}\r\n.td_top{padding-top:8px;}\r\n-->\r\n</style>\r\n\r\n<script>\r\n\r\n//获取事件对象\r\n\r\nfunction getEvent()\r\n {\r\n         if(document.all)return window.event;        \r\n");
      out.write("         func=getEvent.caller;            \r\n         while(func!=null){    \r\n             var arg0=func.arguments[0];\r\n              if(arg0){\r\n                  if((arg0.constructor==Event || arg0.constructor ==MouseEvent)\r\n                      || (typeof(arg0)==\"object\" && arg0.preventDefault && arg0.stopPropagation)){   \r\n                      arg0.x = arg0.pageX;\r\n                      arg0.y = arg0.pageY ;\r\n                      arg0.srcElement = arg0.target;\r\n                     return arg0;\r\n                  }\r\n              }\r\n              func=func.caller;\r\n          }\r\n          return null;\r\n\r\n } \r\n \r\nvar noteTimer=null;\r\nfunction getNote(");
if(BrowserJudge.isFirefox(request)){
      out.write("event");
}
      out.write("){\r\n\r\n\tvar event = event || window.event;\r\n\tvar x = event.clientX+document.body.scrollLeft||event.pageX;\r\n\tvar y = event.clientY+document.body.scrollTop||event.pageY;\r\n\tvar d=document.getElementById(\"noteDiv\");\r\n\tvar s_top=0;\r\n\t\t\r\n\tif(document.getElementById(\"showHtmlDiv\")) {\r\n\t   s_top=document.getElementById(\"showHtmlDiv\").scrollTop;\r\n\t}else if(document.getElementById(\"mainFrame\")) {\r\n\t   s_top=document.getElementById(\"mainFrame\").scrollTop;\r\n\t}\r\n\t");
if(BrowserJudge.isMSIE(request)){
      out.write("\r\n\t  d.style.left=x-220;\r\n\t  d.style.top=s_top+y-20;\r\n\t");
}else{
      out.write("\r\n\t d.style.left=x-220;\r\n\t d.style.top=y+15;\r\n\t");
}
      out.write("\r\n\t\r\n\td.style.display=\"inline\";\r\n}\r\nfunction hiddenNote(){\r\n  noteTimer=window.setTimeout(\"closeNote()\",200);\r\n}\r\nfunction closeNote(){\r\n  var d=document.getElementById(\"noteDiv\");\r\n  d.style.display=\"none\";\r\n}\r\nfunction lockedNote(){\r\n  window.clearTimeout(noteTimer);\r\n}\r\nfunction setNote(obj){\r\n\tdocument.getElementById(\"flowNote\").innerText+=obj.innerText;\r\n}\r\n</script>\r\n<input type=\"hidden\" name=\"addDivContent\" value=\"\"> <!-- 在  常用语中用到-->\r\n\r\n");

int handSignInUse = 0;//是否使用了手写签名
int signatureInUse = 0;//是否使用了电子签章
java.util.Map include_sysMap = com.js.system.util.SysSetupReader.getInstance().getSysSetupMap(session.getAttribute("domainId").toString());
if(include_sysMap != null && include_sysMap.get("使用手写意见") != null && "1".equals(include_sysMap.get("使用手写意见").toString())){
    handSignInUse = 1;//手写签名
}
if(include_sysMap != null && include_sysMap.get("电子签章") != null && "1".equals(include_sysMap.get("电子签章").toString())){
	signatureInUse = 1;//电子签章
}

int maxHandSignIndex=-1;
String publicSignHeight=com.js.util.config.SystemCommon.getPublicSignHeight();
String userSignHeight=com.js.util.config.SystemCommon.getUserSignHeight();
String realSignHeight;
//增加字段不显示控制
String noDisplayCommoentFields="";
if(request.getAttribute("initActivity")!=null){
	noDisplayCommoentFields=new NewWorkflowUtil().getNoDisplayField(request.getAttribute("initActivity").toString(),request.getParameter("work"));
}else{
	if(request.getParameter("initActivity")!=null){
		noDisplayCommoentFields=new NewWorkflowUtil().getNoDisplayField(request.getParameter("initActivity").toString(),request.getParameter("work"));
	}else{
		//发起时去掉隐藏的字段
		noDisplayCommoentFields=new NewWorkflowUtil().getFirstActivityNoDisplayField(request.getParameter("processId"));
	}
}
if(session.getAttribute("userId").toString().equals(request.getParameter("submitPersonId")) && "y".equals(request.getParameter("fromDossierData"))){
	
}else{
	noDisplayCommoentFields="";
}

//当前审批人和日期
String writeUser = session.getAttribute("userName").toString();
String writeUserId = session.getAttribute("userId").toString();
if("1".equals(SystemCommon.getIsshowDealwithOrgName())){
      String level=SystemCommon.getIsshowOrgNameLevel();
	  int showlevel=0;
	  if("".equals(level)){
		  showlevel=0;
	  }else{
		  showlevel=Integer.parseInt(level);
	  }
	  writeUser = StaticParam.getOrgByNum(StaticParam.getOrgNameStringByEmpId(writeUserId),showlevel)+"  "+writeUser;	
}

com.js.system.service.usermanager.UserBD ub = new com.js.system.service.usermanager.UserBD();
String writeUserSignature = ub.getSignature(writeUserId);
String src="0000";
if(writeUserSignature!=null && writeUserSignature.length()>6 && writeUserSignature.substring(4,5).equals("_")){
	src=writeUserSignature.substring(0,4);
}else{
	src="0000";
}


if(!"".equals(writeUserSignature)){
	writeUserSignature = "<IMG SRC='/jsoa/upload/"+src+"/peopleinfo/"+writeUserSignature+"'>";
}else{
	writeUserSignature = writeUser;
}
java.text.DateFormat df = new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm");
String nowTime = df.format(new java.util.Date());
//保护字段
com.js.oa.jsflow.service.WorkFlowCommonBD workFlowCommonBD2 = new com.js.oa.jsflow.service.WorkFlowCommonBD();
String protectField = "";
if("".equals(protectField)){
	protectField = "none";
}
//电子签章div的位置
String inc_divId = java.util.Calendar.getInstance().getTimeInMillis() + "";

java.util.List officelist = new com.js.oa.jsflow.service.WorkFlowBD().getOffiDict(session.getAttribute("userId").toString(), session.getAttribute("domainId").toString());

int curIndex = 0;//批示意见对应字段的序号
java.util.List commentList = null;
if(com.js.util.config.SystemCommon.getShowBackComment()==1){
	commentList= new com.js.oa.jsflow.service.WorkFlowBD().getDealWithComment(request.getParameter("table"),request.getParameter("record"),request.getParameter("workType"));
}else{
	commentList = new com.js.oa.jsflow.service.WorkFlowBD().getDealWithCommentNotBack(request.getParameter("table"),request.getParameter("record"),request.getParameter("workType"));
}
com.js.oa.jsflow.service.WorkFlowCommonBD include_comment_wfcBD = new com.js.oa.jsflow.service.WorkFlowCommonBD();
java.util.List draftCommentList=new com.js.oa.jsflow.service.WorkFlowBD().getDraftComment(request.getParameter("work"), request.getParameter("record"), request.getParameter("table"));
String drcomment="",signComment="";
if(draftCommentList.size()>0){
	String[] draftcomment=(String[])draftCommentList.get(0);
	drcomment=draftcomment[1]+"";
	signComment=draftcomment[2]+"";
}

if("0".equals(request.getParameter("workType"))){
    //随机流程 
}else{
	int commentSize=0;
	
    //业务流程
    java.util.List tmpList = new java.util.ArrayList();
    String disActivityId = "";
    String disCurStepCount = "";
    String hasDisplayCommentId="";
    /**
    str2[0]:节点ID
    str2[1]:节点名称
    str2[2]:办理人姓名
    str2[3]:办理人处理意见
    str2[4]:处理意见时间
    str2[5]:当前意见是流程第几步骤
    str2[6]:
    str2[7]:意见查看范围
    str2[8]:意见对应字段
    str2[9]:  批示意见类型
    str2[10]: 阅件意见类型
    str2[11]: commtype
    str2[12]: emp_id
    str2[13]: wf_dealwithcomment_id
    str2[14]: signcomment
    	
    str3[0]:节点ID
    str3[1]:节点名称
    str3[2]:当前意见是流程第几步骤
    str3[3]:意见查看范围
    str3[4]:意见对应字段
    str3[5]:11
    str3[6]:批示意见类型
    str3[7]:阅件意见类型
    str3[8]:13
    
    **/
    
    for(int j = 0; j < commentList.size(); j ++){
        String[] str2 = (String[]) commentList.get(j);
        if(!disActivityId.equals(str2[0]) && !disCurStepCount.equals(str2[5]) && (!"-1".equals(str2[9]) || (!"-1".equals(str2[10]) && "2".equals( str2[11])))){
            String[] str3 = {str2[0],str2[1],str2[5],str2[7],str2[8],str2[11],str2[9],str2[10],str2[13],str2[15]};
            tmpList.add(str3);
            
        }
    }    
    if(tmpList.size()>0){
    
      out.write("   \r\n    \r\n    <table id=\"commentListTableTemp\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\" class=\"table_border\">\r\n    ");

    //开始循环显示意见........
    String[] str2 = null, str3 = null;
    boolean showComment;
    for(int j = 0; j < tmpList.size(); j ++){
        str2 = (String[]) tmpList.get(j);
		//判断是否显示意见，如果是无批示意见字段，则不显示
		String actiCommFieldType = str2[6];
		String passRoundCommFieldType = str2[7];
		showComment=false;
		
		if((str2[4]==null || "-1".equals(str2[4]) || str2[4].trim().length()<1 || str2[4].trim().toUpperCase().equals("NULL"))){
		     showComment=true;
		     commentSize++;
		}
		//无批示意见不显示节点
	 if(!(("2".equals(str2[5]) && "-1".equals(passRoundCommFieldType)) || (!"2".equals(str2[5]) && "-1".equals(actiCommFieldType))  || hasDisplayCommentId.indexOf(","+str2[8]+",")>=0)){

    
      out.write("\r\n   <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n      <td height=\"24\" class=\"border_bottom_background\"><b>");
      out.print(str2[1]);
      out.write("</b></td>\r\n   </tr>\r\n  ");
} 
      out.write("\r\n   <!--显示意见Title结束,开始循环显示意见-->\r\n   ");

    if(request.getParameter("gd") != null || include_comment_wfcBD.inCommentRange(session.getAttribute("userId").toString(), session.getAttribute("orgIdString").toString(), str2[3]).booleanValue()){
    for(int k = 0; k < commentList.size(); k ++){
         str3 = (String[]) commentList.get(k);
         if(noDisplayCommoentFields.indexOf(","+str3[8]+",")>=0){
        	 continue;
         }
         //判断是否显示意见，如果是无批示意见字段，则不显示
		 String commtype = str3[11];
		 if(("2".equals(commtype) && "-1".equals(passRoundCommFieldType)) || (!"2".equals(commtype) && "-1".equals(actiCommFieldType)) || !str2[8].equals(str3[13]) || hasDisplayCommentId.indexOf(","+str3[13]+",")>=0){
			continue;
		 }
		// if("null".equals(str3[16]) || "NULL".equals(str3[16]) ||"".equals(str3[16])){
		//	 continue;
		// }
		 hasDisplayCommentId+=","+str3[13]+",";		
					
		 if(str2[0].equals(str3[0]) && (str2[2]==null?"0":str2[2]).equals((str3[5]==null?"0":str3[5]))){
			//显示意见
			
			//设置时间格式
			if(str3[4].indexOf(".")>0){
				str3[4]=str3[4].substring(0,str3[4].indexOf("."));
			}
			if(str3[4].indexOf(":")>0){
				str3[4]=str3[4].substring(0,str3[4].lastIndexOf(":"));
			}
			 
		    boolean sx = false;
	        try{
	        	String contextLong = (str3[3]!=null&&str3[3].indexOf(":::")>0)?str3[3].split(":::")[0]:str3[3];
	        	if((contextLong.startsWith("1")||contextLong.startsWith("2"))&&contextLong.length()>=13
	        			&&contextLong.length()<=16){
					long longT = Long.parseLong(contextLong);
					sx = true;
	        	}
	        }catch(Exception e){
	        }
	       if(sx){
	           //手写批注
	    	   if("0".equals(str3[15])){
	       		   realSignHeight=userSignHeight;
	       	   }else{
	       		   realSignHeight=publicSignHeight;
	       	   }
	           if(str3[8]==null || "-1".equals(str3[8]) || str3[8].trim().length()<1 || str3[8].trim().toUpperCase().equals("NULL")){
	        	   maxHandSignIndex=k;  
	        	   
	             //手写控件
	        
      out.write("  \r\n\t        <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">    \r\n\t        <td height=\"");
      out.print(realSignHeight);
      out.write("\">\r\n\t            <OBJECT name=\"incSig");
      out.print(k);
      out.write("\" classid=\"clsid:2294689C-9EDF-40BC-86AE-0438112CA439\" codebase=\"/jsoa/iWebRevision.jsp/iWebRevision.cab#version=6,0,0,0\" width=\"100%\" height=\"");
      out.print(realSignHeight);
      out.write("\">\r\n\t                <param name=\"weburl\" value=\"");
      out.print(request.getScheme());
      out.write(':');
      out.write('/');
      out.write('/');
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iWebRevision.jsp/iWebServer.jsp\">\r\n\t                <param name=\"recordid\" value=\"");
      out.print(str3[3]);
      out.write("\">\r\n\t                <param name=\"fieldname\" value=\"incSig");
      out.print(k);
      out.write("\">\r\n\t                <param name=\"username\" value=\"\">\r\n\t                <param name=\"Enabled\" value=\"0\">\r\n\t                <param name=\"PenColor\" value=\"00000000\">\r\n\t                <param name=\"BorderStyle\" value=\"0\">\r\n\t                <param name=\"SignatureType\" value=\"0\">\r\n\t                <param name=\"wmode\" value=\"opaque\">\r\n\t                <param name=\"ShowUserListMenu\" value=\"false\">\r\n\t            </OBJECT>\r\n\t            <script language=\"javascript\">document.all.incSig");
      out.print(k);
      out.write(".LoadSignature();</script>\r\n\t        </td> \r\n\t        </tr>\r\n\t        ");

		       if(str3[14]!=null && str3[14].length()>4){
		       
	        	 //使用了电子签章	         
	        
      out.write("\r\n\t\t    <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n\t          <td height=\"1\"><div id=\"signPosi_");
      out.print(str3[14]);
      out.write("\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:10%;");
}
      out.write("'></div></td>\r\n\t        </tr>\r\n\t\t    ");

		         }
		    
      out.write("\r\n\t        <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n\t            <td>\r\n\t        ");

			   //判断是否转办人
			   if(str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3")){
			       out.print("转办人：");				
			   }
			   String srcLove="0000";
				if(ub.getSignature(str3[12])!=null && ub.getSignature(str3[12]).length()>6 && ub.getSignature(str3[12]).substring(4,5).equals("_")){
					srcLove=ub.getSignature(str3[12]).substring(0,4);
				}else{
					srcLove="0000";
				}
			
      out.write("\r\n\t\t\t");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+srcLove+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("&nbsp;&nbsp;(");
      out.print(str3[4]);
      out.write(")\r\n\t        ");
if(str3[6] != null && !str3[6].toString().equals("")){ 
      out.write("\r\n\t        <font color=\"blue\">(");
      out.print(str3[6]);
      out.write("代办)</font>\r\n\t        ");
 }
      out.write("\r\n\t\t     \t</td>\r\n\t\t\t</tr>\r\n\t\t\t");
 }else{//使用自定义批示意见字段处理手写批示意见 
      out.write("\r\n\t             <script language=\"javascript\">\r\n\t        \t\tvar divArr1 = document.getElementsByTagName(\"div\");\t        \t\t\t\r\n\t        \t\tif(divArr1.length>0){\r\n\t\t\t\t        var commentStr = \"");
      out.print((str3[3]==null?"":str3[3].replaceAll("\"","'")));
      out.write("\";\r\n\t\t\t\t        var commentIndex = 0;\r\n\t\t\t\t        var divID = \"\";\r\n\t\t\t\t\t\tfor(var i=0;i<divArr1.length;i++){\r\n\t\t\t\t\t\t\tif(divArr1[i].id.indexOf(\"-\")>=1 && divArr1[i].id.indexOf(\"-\")!=(divArr1[i].id.length-1) && (\"");
      out.print(str3[8]);
      out.write("\".indexOf(\"$\"+divArr1[i].id.split(\"-\")[1]+\"$\")>=0 || \"");
      out.print(str3[8]);
      out.write("\" == divArr1[i].id.split(\"-\")[1] )){\r\n\t\t\t\t\t\t\t\tif(divArr1[i].innerHTML.indexOf(\"<\")==0 ){\r\n\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML=\"\";\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tdivArr1[i].innerHTML += \"&nbsp;<OBJECT name=\\\"incSig");
      out.print(k);
      out.write("\"+i+\"\\\" classid=\\\"clsid:2294689C-9EDF-40BC-86AE-0438112CA439\\\" codebase=\\\"/jsoa/iWebRevision.jsp/iWebRevision.cab#version=6,0,0,0\\\" width=\\\"95%\\\" height=\\\"");
      out.print(realSignHeight);
      out.write("\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"weburl\\\" value=\\\"");
      out.print(request.getScheme());
      out.write(':');
      out.write('/');
      out.write('/');
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iWebRevision.jsp/iWebServer.jsp\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"recordid\\\" value=\\\"\"+((commentStr!=\"null\" && commentStr!=\"\" && commentStr.indexOf(\":::\")>0)?commentStr.split(\":::\")[commentIndex++]:commentStr)+\"\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"fieldname\\\" value=\\\"SendOut\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"username\\\" value=\\\"\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"Enabled\\\" value=\\\"0\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"PenColor\\\" value=\\\"00000000\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"BorderStyle\\\" value=\\\"0\\\">\"\r\n\t\t\t\t\t\t\t\t+\"<param name=\\\"ShowUserListMenu\\\" value=\\\"false\\\">\"\r\n\t\t\t\t\t\t\t\t+\"</OBJECT>\";\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t        divArr1[i].innerHTML+=\"<div align=right style='font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(';');
      out.write('\'');
      out.write('>');
      out.print(str3[4]);
      out.write("</div>\";\r\n\t\t\t\t\t\t\t\t");

								if(str3[14]!=null && str3[14].length()>4){
									//使用了电子签章	
								
      out.write("\r\n\t\t\t\t\t\t\t\tdivArr1[i].innerHTML+=\"&nbsp;<div id=signPosi_");
      out.print(str3[14]);
      out.write(" style='position:relative;width:100%;height:1px;'></div>\";\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t");

								}
								
      out.write("      \r\n\t\t\t\t\t\t\t\teval(\"document.all.incSig");
      out.print(k);
      out.write("\"+i+\".LoadSignature()\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t        \t\t}\r\n\t        \t</script>\r\n\t        \t\t\r\n\t ");
       }
	      }else{ //end of if(sx) 未使用手写签批的情况 
      out.write("\r\n\t         <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\"><td class=\"td_top\" style=\"line-height: 1.4;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";\">&nbsp;\r\n\t         ");

	         if(str3[8]==null || "-1".equals(str3[8]) || str3[8].trim().length()<1 || str3[8].trim().toUpperCase().equals("NULL")){
	         	   if(str3[3] != null){
                       out.print(str3[3]);
                   }
	         
      out.write("\r\n\t         </td>\r\n\t         </tr>\r\n\t         ");

	         if(str3[14]!=null && str3[14].length()>4){
	        	 //使用了电子签章	         
	         
      out.write("\r\n\t\t    <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\">\r\n\t          <td height=\"1\"><div id=\"signPosi_");
      out.print(str3[14]);
      out.write("\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:1px;");
}
      out.write("'></div></td>\r\n\t        </tr>\r\n\t         ");
 } 
      out.write("\r\n\t         <tr style=\"display:");
      out.print(showComment?"":"none");
      out.write("\"><td height=\"20\" align=\"right\">\r\n\t         ");

                   if(str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3")){
                       out.print("转办人：");
                   }
                   String src_Love="0000";
					if(ub.getSignature(str3[12])!=null && ub.getSignature(str3[12]).length()>6 && ub.getSignature(str3[12]).substring(4,5).equals("_")){
						src_Love=ub.getSignature(str3[12]).substring(0,4);
					}else{
						src_Love="0000";
					}
   
      out.write("<!-- 显示名字和日期 -->\r\n                   \r\n              ");
 if(ub.getSignature(str3[12]).equals("")){
      out.write("\r\n                   (");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+src_Love+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("&nbsp;&nbsp;");
      out.print(str3[4]);
      out.write(")\r\n               ");
}else{
      out.write("\r\n            \t   ");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+src_Love+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("&nbsp;&nbsp;");
      out.print(str3[4]);
      out.write("\r\n               ");
}
   
                   if(str3[6] != null && !str3[6].toString().equals("")){
   
      out.write("\r\n                      <font color=\"blue\">(");
      out.print(str3[6]);
      out.write("代办)</font>\r\n   ");

                   }
              
      out.write("\r\n              </td>\r\n              </tr>\r\n              \r\n   ");
      }else{
		   	  //批示意见对应字段情况
   
      out.write("\r\n                   <script language=\"javascript\">\r\n\t\t\t        \tvar divArr1 = document.getElementsByTagName(\"div\");\r\n\t\t        \t\tif(divArr1.length){\r\n\t\t\t\t\t\t\t\tvar commentStr = \"");
      out.print((str3[3]==null?"":str3[3].replaceAll("\"","'")));
      out.write("\";\r\n\t\t\t\t\t\t\t\tvar commentIndex = 0;\r\n\t\t\t\t\t\t\t\tfor(var i=0;i<divArr1.length;i++){\r\n\t\t\t\t                   if(divArr1[i].id.indexOf(\"-\")>=1 && divArr1[i].id.indexOf(\"-\")!=(divArr1[i].id.length-1) && (\"");
      out.print(str3[8]);
      out.write("\".indexOf(\"$\"+divArr1[i].id.split(\"-\")[1]+\"$\")>=0 || \"");
      out.print(str3[8]);
      out.write("\" == divArr1[i].id.split(\"-\")[1] )){\r\n\t\t\t\t\t\t\t\t\t\t");

										String src_myLove="0000";
										if(ub.getSignature(str3[12])!=null && ub.getSignature(str3[12]).length()>6 && ub.getSignature(str3[12]).substring(4,5).equals("_")){
											src_myLove=ub.getSignature(str3[12]).substring(0,4);
										}else{
											src_myLove="0000";
										}
										
										 
      out.write("\t\r\n\t\t\t\t\t\t\t\t\t\t ");
if("ynnt".equals(com.js.util.config.SystemCommon.getCustomerName())){
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t \t\r\n\t\t\t\t\t\t\t\t\t\t\t\t");
if(ub.getSignature(str3[12]).equals("")){
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML += \"<div><div style='line-height:1.4;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"+((commentStr!=\"null\" && commentStr!=\"\" && commentStr.indexOf(\":::\")>0)?commentStr.split(\":::\")[commentIndex++]:commentStr)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3"))?"转办人：":"");
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+src_myLove+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("\"+\"&nbsp;");
      out.print(str3[4]);
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[6] != null && !str3[6].toString().equals(""))?("("+str3[6]+"代办)"):"");
      out.write("</div></div>\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t");
}else{
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML += \"<div><div style='line-height:1.4;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"+((commentStr!=\"null\" && commentStr!=\"\" && commentStr.indexOf(\":::\")>0)?commentStr.split(\":::\")[commentIndex++]:commentStr)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3"))?"转办人：":"");
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print(ub.getSignature(str3[12]).equals("")?str3[2]:("<IMG SRC='/jsoa/upload/"+src_myLove+"/peopleinfo/"+ub.getSignature(str3[12])+"'>"));
      out.write("\"+\"&nbsp;");
      out.print(str3[4]);
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[6] != null && !str3[6].toString().equals(""))?("("+str3[6]+"代办)"):"");
      out.write("</div></div>\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t");
}
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t ");
}else{
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t\t\t");
if(ub.getSignature(str3[12]).equals("")){
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML += \"<div><div style='line-height:1.4;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"+((commentStr!=\"null\" && commentStr!=\"\" && commentStr.indexOf(\":::\")>0)?commentStr.split(\":::\")[commentIndex++]:commentStr)+\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"</div><div style='TEXT-ALIGN: right;padding-right:20px;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3"))?"转办人：":"");
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print(str3[2]);
      out.write("&nbsp;");
      out.print(str3[4]);
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[6] != null && !str3[6].toString().equals(""))?("("+str3[6]+"代办)"):"");
      out.write("</div></div>\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t");
}else{
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML += \"<div><div style='line-height:1.4;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"+((commentStr!=\"null\" && commentStr!=\"\" && commentStr.indexOf(\":::\")>0)?commentStr.split(\":::\")[commentIndex++]:commentStr)+\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"</div><div style='TEXT-ALIGN: right;padding-right:20px;font-size:");
      out.print(com.js.util.config.SystemCommon.getCommentFontSize());
      out.write(";'>\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[11] != null && !str3[11].toString().equals("") && str3[11].toString().equals("3"))?"转办人：":"");
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"<IMG SRC='/jsoa/upload/");
      out.print(src_myLove);
      out.write("/peopleinfo/");
      out.print(ub.getSignature(str3[12]));
      out.write("'>&nbsp;");
      out.print(str3[4]);
      out.write("\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+\"");
      out.print((str3[6] != null && !str3[6].toString().equals(""))?("("+str3[6]+"代办)"):"");
      out.write("</div></div>\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t");
}
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t ");
}
      out.write("\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t");

										if(str3[14]!=null && str3[14].length()>4){
											//使用了电子签章
											String divIdSet = str3[14].endsWith("id=")?str3[14].substring(0,str3[14].indexOf(" id=")):str3[14];
										
      out.write("\r\n\t\t\t\t\t\t\t\t\t\tdivArr1[i].innerHTML+=\"<div id=\\\"signPosi_");
      out.print(divIdSet);
      out.write("\\\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:1px");
}
      out.write("'></div>\";\r\n\t\t\t\t\t\t\t\t\t\t");
}
      out.write("\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}//end of for()\r\n\t\t        \t\t}//end of if\r\n\t\t\t\t     </script>\r\n\t\t\t\t     \r\n\t ");
       } // end of enf of if(str3[8]==null 批示意见对应字段
           }// end of end of if(sx)
        }//end of if(str2[0].equals(str3[0]) && (str2[2]
     }//end of for(int k=0 
     
     }// end of if(request.getParameter("gd") != null || inc
   
     }// end for(int j = 0; j < tmpList.size(); j ++){
     
      out.write("\r\n     </table>\r\n     ");

   }// end if(tmpList.size()>0){
   if(commentSize>0){
	   
      out.write("\r\n\t   <script>\r\n\t   document.all.commentListTableTemp.style.display='';\r\n\t   </script>\r\n\t   ");

   }else{
	   
      out.write("\r\n\t   <script>\t   \r\n\t   if(document.all.commentListTableTemp)document.all.commentListTableTemp.style.display='none';\r\n\t   </script>\r\n\t   ");

   }
}// end of 业务流程

      out.write("\r\n\r\n<!-- 退回意见 -->\r\n");

	String backCommentStr = new com.js.oa.jsflow.service.WorkFlowButtonBD().getBackComment(request.getParameter("processId"),request.getParameter("table"),request.getParameter("record"));

      out.write("\r\n    <table style=\"display:none;\" width=\"80%\" border=\"0\" cellpadding=\"0\" align=\"center\" cellspacing=\"0\">\r\n    \r\n        <tr style=\"display:");
      out.print("".equals(backCommentStr)?"none":"none");
      out.write("\">\r\n\t\t<td>\r\n\t\t<table border=\"0\" width=\"100%\" style=\"border:1px solid #366AB3;background-color:#F6F6F6;\"><tr>\r\n            <td width=\"120\" nowrap align=\"center\" valign=\"middle\" style=\"border:1px solid #366AB3;background-color:#F6F6F6;border-bottom:1px;border-top:0px;border-left:0px;\">退回意见：</td>\r\n            <td style=\"word-break:break-all;\">\r\n                    <table width=\"100%\" border=\"0\">\r\n\t\t\t\t\t");
      out.print(backCommentStr);
      out.write("                 \r\n                    </table>\r\n                \r\n                &nbsp;\r\n            </td>\r\n\t\t</tr>\r\n\t   </table>\r\n\t\t</td>\r\n        </tr>\r\n    </table>\r\n\r\n");

int _inWorkStatus = new com.js.oa.jsflow.service.WorkFlowBD().getWorkStatusByWorkId(request.getParameter("work"));
if((_inWorkStatus==0 || _inWorkStatus==2) && !"1".equals(request.getParameter("printFlag"))){
    //待批或待阅文件
	//没有设置批示意见对应字段，使用默认批示意见 
	if((request.getAttribute("curCommField")==null || "-1".equals(request.getAttribute("curCommField")) || request.getAttribute("curCommField").toString().trim().length()<1 || request.getAttribute("curCommField").toString().toUpperCase().equals("NULL"))
	&& !"1".equals(request.getParameter("savefirst"))
	&& !"-1".equals(request.getAttribute("commFieldType")+"")
	){
	  String SignatureId = new java.util.Date().getTime() + "";
    
      out.write("\r\n    <table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"table_border\">\r\n    <tr>\r\n\t    <td class=\"border_bottom_background\"><b>办理意见</b></td>\r\n\t    <td height=\"24\" align=\"left\" class=\"border_bottom_background\">\r\n\t      <div align=\"right\"><a href=\"javascript:void(0);\" onClick=\"getNote(");
if(BrowserJudge.isFirefox(request)){
      out.write("event");
}
      out.write(");\" onmouseout=\"hiddenNote();\" onmouseover=\"lockedNote();\" >常用语</a></div>\r\n\t\t\t\t\t\t<div id=\"noteDiv\" value=\"comment\" onmouseout=\"hiddenNote();\" onmouseover=\"lockedNote();\">\r\n\t\t\t\t\t\t\t");

							  if(officelist!=null&&officelist.size()>0){
							   for(int i=0;i<officelist.size();i++){
								 String offContent=""+officelist.get(i);
      out.write("\r\n\t\t\t\t\t\t\t\t  <div class=\"divOut\" onmouseover=\"lockedNote();this.className='divOver'\" onmouseout=\"this.className='divOut'\" onclick=\"include_set_comment(this,'comment')\">");
      out.print(offContent);
      out.write("</div>\t\t\t\t   \r\n\t\t\t\t\t\t\t   ");
}
							}
							
      out.write("\r\n\t\t\t\t\t\t  <div class=\"divOut\"><a href=\"#\"  onclick=\"JSMainWinOpenNew('/jsoa/personal_work/setup/personalwork_mywordsetup_add.jsp?isgov=isgov','','TOP=0,LEFT=0,scrollbars=yes,resizable=yes,width=600,height=300')\">>>添加</a></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t  </td>\r\n\t  </tr>\r\n\t  <!-- 填写意见框 -->\r\n\t\t<!-- 普通 -->\r\n\t  <tr  id=\"signTb1\">\r\n\t    <td colspan=\"2\" align=\"right\" class=\"td_top\">\r\n\t     <textarea name=\"comment\" id=\"comment\" cols=\"50\" Class=\"inputTextarea\" style=\"width:100%\" rows=\"5\" onblur=\"include_checkTextArea(this,'办理意见',2000);\">");
      out.print(drcomment);
      out.write("</textarea>\r\n\t\t</td>\r\n\t  </tr>\r\n\t  ");
if(handSignInUse==1){
		  String curHandSignType=new com.js.oa.jsflow.service.ActivityBD().getActivityHandSignType(request.getParameter("activity"));
		  realSignHeight=("0".equals(curHandSignType))?userSignHeight:publicSignHeight;
	  
      out.write("\r\n\t\t\t\t<tr id=\"signTb2\"  style=\"display:none\">\r\n\t\t\t\t\t    <td width=\"90%\" height=\"150\">\r\n\t\t\t\t\t\t<OBJECT name=\"incSig");
      out.print(maxHandSignIndex+1);
      out.write("\" classid=\"clsid:2294689C-9EDF-40BC-86AE-0438112CA439\" codebase=\"/jsoa/iWebRevision.jsp/iWebRevision.cab#version=6,0,0,0\" width=\"100%\" height=\"");
      out.print(realSignHeight);
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"weburl\" value=\"");
      out.print(request.getScheme());
      out.write(':');
      out.write('/');
      out.write('/');
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iWebRevision.jsp/iWebServer.jsp\">\r\n\t\t\t\t\t\t\t<param name=\"recordid\" value=\"");
      out.print(SignatureId);
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"fieldname\" value=\"incSig");
      out.print(maxHandSignIndex+1);
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"username\" value=\"");
      out.print(session.getAttribute("userName"));
      out.write("\">\r\n\t\t\t\t\t\t\t<param name=\"Enabled\" value=\"1\">\r\n\t\t\t\t\t\t\t<param name=\"PenWidth\" value=\"1\">\r\n\t\t\t\t\t\t\t<param name=\"PenColor\" value=\"00000000\">\r\n\t\t\t\t\t\t\t<param name=\"BorderStyle\" value=\"0\">\r\n\t\t\t\t\t\t\t<param name=\"EditType\" value=\"0\">\r\n\t\t\t\t\t\t    <param name=\"ShowUserListMenu\" value=\"false\">\r\n\t\t\t\t\t\t</OBJECT>\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"comment\" value=\"");
      out.print(SignatureId);
      out.write("\"><br>\r\n\t\t\t\t\t\t<input type=\"hidden\" name=\"SignSendOutObject\" value=\"incSig");
      out.print(maxHandSignIndex+1);
      out.write("\"><br>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t<td valign=\"top\" style=\"padding-top:10px;\">\r\n\t\t\t\t\t\t    <input type=\"button\" class=\"btnButton2font\" onclick=\"if (!document.all.incSig");
      out.print(maxHandSignIndex+1);
      out.write(".OpenSignature()){alert(document.all.incSig");
      out.print(maxHandSignIndex+1);
      out.write(".Status);}\"  value=\"签章\">\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t");
}
      out.write("\r\n\t\t\t");
if(signatureInUse==1){
      out.write("\r\n\t\t\t\t<!-- 电子签章 -->\r\n\t\t\t\t<tr id=\"signTb3\" style=\"display:none\">\r\n\t\t\t\t\t    <td width=\"90%\" height=\"10\">\r\n\t\t\t\t\t\t    <div id=\"signPosi_");
      out.print(inc_divId+"0000");
      out.write("\" style='position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:100%;");
}
      out.write("'></div>\r\n\t\t\t\t\t\t\t<input type=\"hidden\" name=\"include_signcomment\" value=\"");
      out.print(inc_divId+"0000");
      out.write("\">\r\n\t\t\t\t\t\t</td>\t\t\t\t\t\t\r\n\t\t\t\t</tr>\r\n\t\t\t");
}
      out.write("\r\n\t\t\t\r\n\t\t\t<tr>\r\n\t\t   <td height=\"26\" colspan=\"2\" align=\"right\">\r\n\t\t\t<input type=\"hidden\" name=\"commentSignType\" id=\"commentSignType\" value=\"0\"><!-- 用户选择的批示类型 -->\r\n\t\t\t");
if(handSignInUse==1 || signatureInUse==1){
      out.write("\r\n\t\t\t<a href=\"javascript:;\" onClick=\"changeSignType('0');\">普通</a>&nbsp;\r\n\t\t\t");
}
			if(handSignInUse==1){
			
      out.write("<a href=\"javascript:;\" onClick=\"changeSignType('1');\">手写签批</a>&nbsp;\r\n\t\t\t");
}
			if(signatureInUse==1){
			
      out.write("\r\n\t\t\t<!-- <a href=\"javascript:;\" onClick=\"changeSignType('2');\">电子签章</a>&nbsp; -->\r\n\t\t\t<a href=\"javascript:;\" onClick=\"changeSignType('2');include_signature();\">盖章</a>&nbsp;\r\n\t\t\t<a href=\"javascript:;\" onClick=\"changeSignType('2');include_signature2();\">签字</a>&nbsp;\r\n\t\t\t");
}
      out.write("\r\n\t\t\t<div align=\"right\">");
      out.print(writeUserSignature+" "+nowTime);
      out.write("</div>\r\n\t\t\t<input type=\"hidden\" name=\"commentOrg\" id=\"commentOrg\" value=\"");
      out.print(StaticParam.getOrgNameStringByEmpId(writeUserId));
      out.write("\"><!-- 批示用户所在组织 -->\r\n\t\t </td>\r\n\t\t</tr>\t  \r\n    </table>\r\n\r\n    ");

	}
}

      out.write("\r\n\r\n");
if(signatureInUse==1){
      out.write("\r\n<OBJECT id=\"SignatureControl\" classid=\"clsid:D85C89BE-263C-472D-9B6B-5264CD85B36E\" codebase=\"/jsoa/iSignatureHTML.jsp/iSignatureHTML.cab#version=9,0,0,0\" width=\"0\" height=\"0\" VIEWASTEXT>\r\n<param name=\"ServiceUrl\" value=\"");
      out.print(request.getScheme());
      out.write(':');
      out.write('/');
      out.write('/');
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iSignatureHTML.jsp/Service.jsp\"><!--读去数据库相关信息-->\r\n<param name=\"WebAutoSign\" value=\"0\">             <!--是否自动数字签名(0:不启用，1:启用)-->\r\n</OBJECT>\r\n");
}
      out.write("\r\n\r\n<script language=\"javascript\">\r\n//增加批示字段对应意见到指定位置 \r\n");
if(request.getAttribute("curCommField")!=null && !"-1".equals(request.getAttribute("curCommField")) && request.getAttribute("curCommField").toString().trim().length()>0 && !request.getAttribute("curCommField").toString().toUpperCase().equals("NULL") && (_inWorkStatus==0 || _inWorkStatus==2)){
      out.write("\r\nvar divArr = document.getElementsByTagName(\"div\");\r\nvar useDivArr = 0;\r\nif(divArr.length){\r\n    for(var i=0;i<divArr.length;i++){\r\n        if(divArr[i].id.indexOf(\"-\")>=1 && divArr[i].id.indexOf(\"-\")!=(divArr[i].id.length-1) && (\"");
      out.print(request.getAttribute("curCommField").toString());
      out.write("\".indexOf(\"$\"+divArr[i].id.split(\"-\")[1]+\"$\")>=0 || \"");
      out.print(request.getAttribute("curCommField").toString());
      out.write("\" == divArr[i].id.split(\"-\")[1]) ){\r\n\t\t\t");

				String SignatureId1 = new java.util.Date().getTime() + "";
            
      out.write("\r\n\t\t\t\t//复合三种审批方式\r\n\t\t\t\t//普通\r\n\t\t\t\tdivArr[i].innerHTML+=\r\n\t\t\t\t\t\"<div id='signTb1' style='display:'>\"+\r\n\t\t\t\t\t\"<div align='right' style=\\\"width:98%;\\\">&nbsp;&nbsp;&nbsp;<a href=\\\"javascript:;\\\" onClick=\\\"getNote(");
if(BrowserJudge.isFirefox(request)){
      out.write("event");
}
      out.write(");\\\" onmouseout=\\\"hiddenNote();\\\" onmouseover=\\\"lockedNote();\\\">常用语</a></div>\"+\r\n\t\t\t\t\t\"<div id=\\\"noteDiv\\\" value=\"+divArr[i].id.split(\"-\")[1]+\" onmouseout=\\\"hiddenNote();\\\" onmouseover=\\\"lockedNote();\\\">\"+\r\n\t\t\t\t\t");

					  if(officelist!=null&&officelist.size()>0){
					   for(int i=0;i<officelist.size();i++){
						 String offContent=""+officelist.get(i);
      out.write("\r\n\t\t\t\t\t\t  \"<div class=\\\"divOut\\\" onmouseover=\\\"lockedNote();this.className='divOver'\\\" onmouseout=\\\"this.className='divOut'\\\" onclick=\\\"include_set_comment(this,'\"+divArr[i].id.split(\"-\")[1]+\"')\\\">");
      out.print(offContent);
      out.write("</div>\"+\r\n\t\t\t\t\t   \r\n\t\t\t\t\t   ");
}
					}
					
      out.write("\t\t\t\r\n\t\t\t\t\t\"<div class=\\\"divOut\\\"><a href=\\\"#\\\"  onclick=\\\"JSMainWinOpenNew('/jsoa/personal_work/setup/personalwork_mywordsetup_add.jsp?isgov=isgov','','TOP=0,LEFT=0,scrollbars=yes,resizable=yes,width=600,height=300')\\\"  >>>添加</a></div></div>\"+\r\n\t\t\t\t\t\"<div><textarea name=\\\"\"+divArr[i].id.split(\"-\")[1]+\"\\\"  id=\\\"\"+divArr[i].id.split(\"-\")[1]+\"\\\"  Class=\\\"inputTextarea\\\" rows='6' style=\\\"width:98%;\\\" onblur=\\\"include_checkTextArea(this,'办理意见',2000);\\\">");
      out.print(drcomment);
      out.write("</textarea>&nbsp;</div></div>\";\r\n\r\n\t\t\t\t//手写\r\n\t\t\t  ");

			  if(handSignInUse==1){
				  String curHandSignType=new com.js.oa.jsflow.service.ActivityBD().getActivityHandSignType(request.getParameter("activity"));
				  realSignHeight=("0".equals(curHandSignType))?userSignHeight:publicSignHeight;
			  
      out.write("\r\n\t\t\t\tdivArr[i].innerHTML += \r\n\t\t\t\t\t\"<div id='signTb2' style='display:none'>\"+\r\n\t\t\t\t\t\"<div style='text-align:right;'><input type='button' class=btnButton2font onclick=\\\"if (!\"+divArr[i].id.split(\"-\")[1]+\"_SendOut.OpenSignature()){alert(\"+divArr[i].id.split(\"-\")[1]+\"_SendOut.Status);}\\\" value='签章' />&nbsp;</div>\"+\r\n\t\t\t\t\t\"<div>\"+\r\n\t\t\t\t\t\"<OBJECT name=\\\"\"+divArr[i].id.split(\"-\")[1]+\"_SendOut\\\" classid=\\\"clsid:2294689C-9EDF-40BC-86AE-0438112CA439\\\" codebase=\\\"/jsoa/iWebRevision.jsp/iWebRevision.cab#version=6,0,0,0\\\" width=\\\"100%\\\" height=\\\"");
      out.print(realSignHeight);
      out.write("\\\">\"\r\n                \t\t\t+\"<param name=\\\"weburl\\\" value=\\\"");
      out.print(request.getScheme());
      out.write(':');
      out.write('/');
      out.write('/');
      out.print(request.getServerName());
      out.write(':');
      out.print(request.getServerPort());
      out.write("/jsoa/iWebRevision.jsp/iWebServer.jsp\\\">\"\r\n            \t\t\t\t+\"<param name=\\\"recordid\\\" value=\\\"");
      out.print(SignatureId1);
      out.write("\"+i+\"\\\">\"\r\n                \t\t\t+\"<param name=\\\"fieldname\\\" value=\\\"SendOut\\\">\"\r\n                \t\t\t+\"<param name=\\\"username\\\" value=\\\"");
      out.print(session.getAttribute("userName"));
      out.write("\\\">\"\r\n                \t\t\t+\"<param name=\\\"Enabled\\\" value=\\\"1\\\">\"\r\n               \t \t\t\t+\"<param name=\\\"PenColor\\\" value=\\\"00000000\\\">\"\r\n                \t\t\t+\"<param name=\\\"BorderStyle\\\" value=\\\"0\\\">\"\r\n                \t\t\t+\"<param name=\\\"EditType\\\" value=\\\"0\\\"><param name=\\\"PenWidth\\\" value=\\\"1\\\">\"\r\n                            +\"<Param Name=\\\"ShowScale\\\" value=\\\"50\\\">\"\r\n                            +\"<param name=\\\"ShowUserListMenu\\\" value=\\\"false\\\">\"\r\n            \t\t\t\t+\"</OBJECT>\"\r\n            \t\t\t\t+\"<input type=\\\"hidden\\\" name=\\\"\"+divArr[i].id.split(\"-\")[1]+\"\\\" value=\\\"");
      out.print(SignatureId1);
      out.write("\"+i+\"\\\"></div>\"+\r\n\t\t\t\t\t\"</div></div>\";\r\n\t\t\t ");
}
      out.write("\r\n\t\t\t ");
if(signatureInUse==1){
      out.write("\r\n\t\t\t\t//电子签章\r\n\t\t\t\tdivArr[i].innerHTML += \r\n\t\t\t\t\t\"<div id='signTb3' style='position:relative;width:100%;height:1px;' style='display:none'>\"+\r\n\t\t\t\t\t\t\"<div id=\\\"signPosi_");
      out.print(inc_divId+"0000");
      out.write("\\\" style=\\\"position:absolute;width:100%;");
if(!BrowserJudge.isMSIE11(request)){
      out.write("height:100%;");
}
      out.write("\\\"><div valign=bottom align=\\\"right\\\"><input type=\\\"hidden\\\" name=\\\"include_signcomment\\\" id=\\\"include_signcomment\\\" value=\\\"");
      out.print(inc_divId+"0000");
      out.write("\\\"></div>\"+\r\n\t\t\t\t\t\"</div>\";\r\n\t\t\t ");
}
      out.write("\r\n\t\t\t\tdivArr[i].innerHTML += \r\n\t\t\t\t\t\"<div align=\\\"right\\\"><input type=\\\"hidden\\\" name=\\\"commentSignType\\\" id=\\\"commentSignType\\\" value=\\\"0\\\"><input type=\\\"hidden\\\" name=\\\"commentOrg\\\" id=\\\"commentOrg\\\" value=\\\"");
      out.print(StaticParam.getOrgNameStringByEmpId(writeUserId));
      out.write("\\\">\"+\r\n\t\t\t\t\t\"");
if(handSignInUse==1 || signatureInUse==1){
      out.write("<a href=\\\"javascript:;\\\" onClick=\\\"changeSignTypeArr('0',\"+useDivArr+\");\\\">普通</a>&nbsp;");
}
if(handSignInUse==1){
      out.write("<a href=\\\"javascript:;\\\"\"+ \"onClick=\\\"changeSignTypeArr('1',\"+useDivArr+\");\\\">手写签批</a>&nbsp;");
}if(signatureInUse==1){
      out.write("<a href=\\\"javascript:;\\\" onClick=\\\"changeSignTypeArr('2',\"+useDivArr+\");include_signature();\\\">盖章</a>&nbsp;<a href=\\\"javascript:;\\\" onClick=\\\"changeSignTypeArr('2',\"+useDivArr+\");include_signature2();\\\">签字</a>&nbsp;");
}
      out.write("</div>\";\r\n\t\t\t\tdivArr[i].innerHTML += \"<div align=\\\"right\\\">");
      out.print(writeUserSignature+" "+nowTime+"");
      out.write("</div>\";\r\n\t\t\t\tuseDivArr ++;\t\t\t\t\r\n        }\r\n    }\r\n}\r\n");
} 
      out.write("\r\n\r\n\r\nfunction changeSignTypeArr(type, i){\r\n\tif(document.all.commentSignType.length){\r\n\t\tif(type=='0'){\r\n\t\t\tif(document.all.signTb1 && document.all.signTb1[i]){\r\n\t\t\t\tdocument.all.signTb1[i].style.display=\"\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb2 && document.all.signTb2[i]){\r\n\t\t\t\tdocument.all.signTb2[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb3 && document.all.signTb3[i]){\r\n\t\t\t\tdocument.all.signTb3[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t} else if(type=='1'){\r\n\t\t\tif(winZoomSize>1){\r\n\t\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的放大状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\r\n\t\t\t}else if(winZoomSize<1){\r\n\t\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的缩小状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\t\r\n\t\t\t}else{\t\t\r\n\t\t\t\tif(document.all.signTb2 && document.all.signTb2[i]){\r\n\t\t\t\t\tdocument.all.signTb2[i].style.display=\"\";\r\n\t\t\t\t}\r\n\t\t\t\tif(document.all.signTb1 && document.all.signTb1[i]){\r\n\t\t\t\t\tdocument.all.signTb1[i].style.display=\"none\";\r\n\t\t\t\t}\r\n\t\t\t\tif(document.all.signTb3 && document.all.signTb3[i]){\r\n\t\t\t\t\tdocument.all.signTb3[i].style.display=\"none\";\r\n");
      out.write("\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if(type=='2'){\r\n\t\t\tif(document.all.signTb3 && document.all.signTb3[i]){\r\n\t\t\t\tdocument.all.signTb3[i].style.display=\"\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb1 && document.all.signTb1[i]){\r\n\t\t\t\tdocument.all.signTb1[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb2 && document.all.signTb2[i]){\r\n\t\t\t\tdocument.all.signTb2[i].style.display=\"none\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(type!='2'){\r\n\t\t\tdocument.all.commentSignType[i].value = type;\r\n\t\t}\r\n\t} else{\r\n\t\tchangeSignType(type);\r\n\t}\r\n}\r\n\r\nfunction changeSignType(type){\r\n\tif(type=='0'){\r\n\t\tif(document.all.signTb1){\r\n\t\t\tdocument.all.signTb1.style.display=\"\";\r\n\t\t}\r\n\t\tif(document.all.signTb2){\r\n\t\t\tdocument.all.signTb2.style.display=\"none\";\r\n\t\t}\r\n\t\t/*if(document.all.signTb3){\r\n\t\t\tdocument.all.signTb3.style.display=\"none\";\r\n\t\t}*/\r\n\t} else if(type=='1'){\r\n\t\t\r\n\t\tvar winZoomSize=1;\r\n\t\ttry{\r\n\t\t\twinZoomSize=ZoomHint.ZoomValue;\r\n\t\t}catch(e){\r\n\t\t\twinZoomSize=1;\r\n\t\t}\t\t\r\n\t\t\r\n\t\tif(winZoomSize>1){\r\n\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的放大状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\r\n");
      out.write("\t\t}else if(winZoomSize<1){\r\n\t\t\talert(\"您的浏览器目前处于缩放状态比例为\"+winZoomSize+\"的缩小状态，\\n这将导致页面显示不正常！\\n请按键盘“CTRL+数字0”组合键恢复初始状态！\");\t\r\n\t\t}else{\r\n\t\t\tif(document.all.signTb2){\r\n\t\t\t\tdocument.all.signTb2.style.display=\"\";\r\n\t\t\t}\r\n\t\t\tif(document.all.signTb1){\r\n\t\t\t\tdocument.all.signTb1.style.display=\"none\";\r\n\t\t\t}\r\n\t\t}\r\n\t} else if(type=='2'){\r\n\t\tif(document.all.signTb3){\r\n\t\t\tdocument.all.signTb3.style.display=\"\";\r\n\t\t}\r\n\t}\r\n\tif(type!='2'){\r\n\t\tdocument.all.commentSignType.value = type;\r\n\t}\r\n\t\r\n}\r\n\r\n\r\nfunction changeSignature(name,type){\r\n\tif(eval(\"document.all.\"+name+\".EditType\") == 0){\r\n        \t//手写变键盘\r\n        \teval(\"document.all.\"+name).EditType = 1;\r\n            eval(\"document.all.signatureHref\"+name).innerHTML = \"切换手写\";\r\n        }else{\r\n        \t//键盘变手写\r\n               eval(\"document.all.\"+name).EditType = 0;\r\n                eval(\"document.all.signatureHref\"+name).innerHTML = \"切换键盘\";\r\n        }\r\n}\r\n\r\nfunction include_checkTextArea(obj, tmp, len){\r\n    if(obj.value.length > len){\r\n        alert(tmp + \"不能超过\" + len + \"字！\");\r\n        obj.focus();\r\n");
      out.write("    }\r\n}\r\n\r\nfunction include_offiDict(userId, field){\r\n    JSMainWinOpen('/jsoa/jsflow/workflow_offiDict.jsp?userId=' + userId + '&textAreaName=' + field,'','menubar=0,scrollbars=yes,locations=0,width=400,height=200,resizable=yes');\r\n}\r\n\r\nfunction include_set_comment(obj,commentName){\r\n\tvar val=obj.value==null?obj.innerHTML:obj.value;\r\n\tvar cobj=eval(\"document.all.\"+commentName);\r\n\tif(cobj.length){\r\n\t\tcobj[0].value=val;\r\n\t} else{\r\n\t\tcobj.value=val;\r\n\t}\r\n}\r\n\r\nfunction addDivContent(){\r\n\tvar adddivcontent=document.all.addDivContent.value;\r\n\tvar comment=document.getElementById(\"noteDiv\").getAttribute(\"value\");\r\n\tdocument.getElementById(\"noteDiv\").innerHTML= \"\"+\"<div class='divOut' onmouseover='lockedNote();this.className=\\\"divOver\\\"' onmouseout='this.className=\\\"divOut\\\"' onclick=\\\"include_set_comment(this,\\'\"+comment+\"\\');\\\">\"+adddivcontent+\"<\\/div>\"+document.getElementById(\"noteDiv\").innerHTML;\r\n}\r\n\r\n//电子签章\r\nvar wnd;\r\n//作用：进行甲方签章\r\nfunction include_signature() {\r\n\tif( wnd != undefined ){\r\n\t\tvar results = wnd.split(\";\");\r\n");
      out.write("\t\tdocument.all.SignatureControl.CharSetName = results[0];\t\t//多语言集\r\n\t\tdocument.all.SignatureControl.WebAutoSign = results[1];\t\t//自动数字签名\r\n\t\tdocument.all.SignatureControl.WebCancelOrder = results[2];\t\t//撤消顺序\r\n\t\tdocument.all.SignatureControl.PassWord = results[3];\t\t\t//签章密码\r\n\t\tvar tmp = document.all.SignatureControl.WebSetFontOther((results[4]==\"1\"?true:false),results[5],results[6],results[7],results[8],results[9],(results[10]==\"1\"?true:false));\t\t\t\t//设置签章附加文字格式\r\n\t\tdocument.all.SignatureControl.WebIsProtect=results[11];\t\t//保护表单数据， 0不保护  1保护表单数据，可操作  2保存表单数据，并不能操作  默认值1\r\n    }else{\r\n\t\tdocument.all.SignatureControl.WebIsProtect=1;\t\t\t    //保护表单数据， 0不保护  1保护表单数据，可操作  2保存表单数据，并不能操作  默认值1\r\n\t}\r\n\t//document.all.SignatureControl.FieldsList=\"");
      out.print(protectField);
      out.write("\"       //所保护字段\r\n\tdocument.all.SignatureControl.FieldsList=\"submitPerson=\"+document.getElementById(\"submitPerson\");\r\n\tdocument.all.SignatureControl.DivId=\"signPosi_");
      out.print(inc_divId+"0000");
      out.write("\";                     //签章所在的层\r\n\tdocument.all.SignatureControl.Position(100,0);                     //签章位置\r\n\tdocument.all.SignatureControl.SaveHistory=\"False\";                    //是否自动保存历史记录,true保存  false不保存  默认值false\r\n\tdocument.all.SignatureControl.UserName=\"lyj\";                         //文件版签章用户\r\n\tdocument.all.SignatureControl.WebCancelOrder=1;\t\t\t    //签章撤消原则设置, 0无顺序 1先进后出  2先进先出  默认值0\r\n\tdocument.all.SignatureControl.RunSignature();                          //执行签章操作\r\n}\r\n\r\n//作用：进行手写签名\r\nfunction include_signature2() {\r\n\tdocument.all.SignatureControl.FieldsList=\"\"       //所保护字段\r\n\tif( wnd != undefined ){\r\n\t\tvar results = wnd.split(\";\");\r\n\t\tdocument.all.SignatureControl.CharSetName = results[0];\t\t//多语言集\r\n\t\tdocument.all.SignatureControl.WebAutoSign = results[1];\t\t//自动数字签名\r\n\t\tdocument.all.SignatureControl.WebCancelOrder = results[2];\t\t//撤消顺序\r\n\t\tdocument.all.SignatureControl.PassWord = results[3];\t\t\t//签章密码\r\n\t\tdocument.all.SignatureControl.WebIsProtect=results[11];\t\t//保护表单数据， 0不保护  1保护表单数据，可操作  2保存表单数据，并不能操作  默认值1\r\n");
      out.write("\t}else {\r\n        document.all.SignatureControl.WebCancelOrder=0;\t\t\t            //签章撤消原则设置, 0无顺序 1先进后出  2先进先出  默认值0\r\n\t\tdocument.all.SignatureControl.WebIsProtect=1;\t\t\t    //保护表单数据， 0不保护  1保护表单数据，可操作  2保存表单数据，并不能操作  默认值1\r\n\t}\r\n\t//document.all.SignatureControl.FieldsList=\"");
      out.print(protectField);
      out.write("\"       //所保护字段\r\n\tdocument.all.SignatureControl.FieldsList=\"submitPerson=\"+document.getElementById(\"submitPerson\");\r\n\tdocument.all.SignatureControl.DivId=\"signPosi_");
      out.print(inc_divId+"0000");
      out.write("\";                   //签章所在的层\r\n\tdocument.all.SignatureControl.Position(0,0);                       //手写签名位置\r\n\t\r\n\t//document.all.SignatureControl.SaveHistory=\"false\";                   //是否自动保存历史记录,true保存  false不保存  默认值false\r\n\tdocument.all.SignatureControl.RunHandWrite();                          //执行手写签名\r\n}\r\n\r\n");
if(signatureInUse==1){
      out.write("\r\nwindow.attachEvent(\"onload\",function(){\t\r\n\ttry{\r\n\t\tdocument.all.SignatureControl.ShowSignature('");
      out.print(request.getParameter("record"));
      out.write("');\r\n\t}catch(e){\r\n\t}\r\n});\r\n");
}
      out.write("\r\n</script>\r\n");
if(!"1".equals(request.getParameter("printFlag")+"")){
	if("1".equals(new SystemCommon().getKeyboardTip())){

      out.write("\r\n\t\t<script src=\"/jsoa/skin/zoom/ZoomDetect.js\"></script>\r\n");
}
}
      out.write("\r\n<script language=\"javascript\">\r\n//当办理意见为空时隐藏办理意见区域\r\nfunction dualCommentShowOrDisplay(){\r\n   var ishiddentmp=true;\r\n\tvar commentListTableTemp=document.getElementById(\"commentListTableTemp\");\r\n\tfor(var i=0;i<commentListTableTemp.rows.length;i++){\r\n\t\tvar tempTr=commentListTableTemp.rows[i];\r\n\t\tif(tempTr.style.display!=\"none\"){\r\n\t\t\tishiddentmp=false;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    if(ishiddentmp){\r\n    \tcommentListTableTemp.style.display=\"none\";\r\n    }\r\n\t\r\n}\r\ndualCommentShowOrDisplay();\r\n</script>");
      out.write("\r\n\t</td></tr>\r\n\t");
   String showDisplay = "";
  if(0==com.js.util.config.SystemCommon.getIsShowProject()){
  		showDisplay = "none";
  }
	//String relProjectId=StaticParam.getWorkFlowProject(request.getParameter("processId"),request.getParameter("table"),request.getParameter("record"));
	  String relProjectIdAndName=com.js.system.util.StaticParam.getWorkFlowProjectIdAndName(request.getParameter("processId"),
			  request.getParameter("table"),request.getParameter("record"));
	  String relProjectId=relProjectIdAndName;
	  String relProjectName="无";
	  if(relProjectIdAndName.indexOf(";")>0){
	  	relProjectId=relProjectIdAndName.substring(0,relProjectIdAndName.indexOf(";"));
	  	relProjectName=relProjectIdAndName.substring(relProjectIdAndName.indexOf(";")+1);
	  }
	  
      out.write("\r\n\t  <tr style=\"display:");
      out.print(showDisplay );
      out.write(";\">\r\n\t    <td colspan=\"2\" align=\"right\"  >相关项目:&nbsp;");
      out.print(relProjectName );
      out.write("\r\n\t    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\t     \r\n\t    </td>\r\n\t  </tr>\r\n</form>\r\n</table>\r\n<form  name=\"form2\" action=\"\"  method=\"POST\">\r\n    <input type=\"hidden\" name=\"pageContent\" value=\"\">\r\n</form>\r\n<!--pdf按钮功能js实现  -->\r\n<script language=\"javascript\">\r\n\r\nfunction toPDF(){\r\n\tvar x=document.body.innerHTML;\r\n    //alert(x);\r\n    form2.pageContent.value =x;\r\n    form2.action=\"/jsoa/WorkFlowPdfServlet?workId=");
      out.print(work);
      out.write("\";\r\n    form2.submit();\r\n\r\n}\r\n</script>\r\n</body>\r\n</html>\r\n<script src=\"/jsoa/js/util.js\"></script>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
