/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 09:38:36 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.js.oa.info.infomanager.bean.InfoProFileEJBBean;
import javax.servlet.http.HttpSession;
import com.js.util.config.SystemCommon;

public final class onLineShow_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("javax.servlet.http.HttpSession");
    _jspx_imports_classes.add("com.js.util.config.SystemCommon");
    _jspx_imports_classes.add("com.js.oa.info.infomanager.bean.InfoProFileEJBBean");
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;


response.setHeader("Cache-Control","no-store");
response.setHeader("Pragma","no-cache");
response.setDateHeader ("Expires", 0);
String queryString=request.getQueryString();
String[] fileNames = com.js.util.util.BASE64.BASE64DecoderNoBR(queryString).split("&&");
String prefix=fileNames[2];
String realName=fileNames[3];  
String htmlVal="";
int onlineShowStatus=0;
if(",.doc,.docx,.xls,.xlsx,.ppt,.pptx,.pdf,".indexOf(","+prefix+",")>=0){
	onlineShowStatus=1;
}else if(",.html,.htm,".indexOf(","+prefix+",")>=0){//直接预览
	onlineShowStatus=2;
	htmlVal=fileNames[0].substring(fileNames[0].indexOf("webapps")+7)+fileNames[1];
	htmlVal=htmlVal.replaceAll("\\\\", "/");  
}else if(",.txt,".indexOf(","+prefix+",")>=0){//直接预览
	onlineShowStatus=3;
}

      out.write("<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <meta charset=\"utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n<TITLE>在线预览</TITLE>\r\n<style type=\"text/css\">\r\n</style>\r\n<script type=\"text/javascript\" src=\"js/jquery-1.4.2.min.js\"></script>\r\n");
if(onlineShowStatus==1){ 
      out.write("<script language=\"javascript\">\r\n  $(document).ready(function(){\r\n\t  \r\n\t  $.ajax({ \r\n\t\t  url:\"onLineShow/onLineShowAjax.jsp\", \r\n\t\t  type:\"post\", //数据发送方式 \r\n\t\t  dataType:\"json\", //接受数据格式 (这里有很多,常用的有html,xml,js,json) \r\n\t\t  data:{fileData:\"");
      out.print(queryString);
      out.write("\"}, //要传递的数据 \r\n\t\t  error: function(){ //失败 \r\n\t\t\t  window.clearInterval(timer);\r\n\t\t\t  $(\"#showMsg\").html(\"读取文件数据失败，请稍后再试\");\r\n\t\t  }, \r\n\t\t  success: function(res){ \r\n\t\t\t  if(res.status==\"succ\"){\r\n\t\t\t\t  $(\"#showMsg\").hide();\r\n\t\t\t\t  $(\"#iframeShow\").attr(\"src\",res.msg);\r\n\t\t\t\t  changeFrameSize();\r\n\t\t\t\t  $(\"#iframeShow\").show();\r\n\t\t\t\t  setFrameControl();\r\n\t\t\t\t  window.clearInterval(timer);\r\n\t\t\t  }else{\r\n\t\t\t\t  window.clearInterval(timer);\r\n\t\t\t\t  $(\"#showMsg\").html(res.msg);\r\n\t\t\t\t  \r\n\t\t\t  }\r\n\t\t  } \r\n\t}); \r\n\t  \r\n  });\r\n\t \r\n  $(window).resize(function(){\r\n\t  changeFrameSize();\r\n\t});\r\nfunction changeFrameSize(){\r\n\tif($(\"#showMsg\").is(\":hidden\")){\r\n\t\t$(\"#iframeShow\").height($(window).height()-35);\r\n\t\t$(\"#iframeShow\").width($(window).width());\r\n\t}\r\n\t$(\"#toolbar\").width($(window).width());\r\n}\r\nfunction setFrameControl(){\r\n\t\r\n\tvar iframe = $(\"#iframeShow\")[0]; \r\n\tif (iframe.attachEvent){  // for IE \r\n\t    iframe.attachEvent(\"onload\", function(){ \r\n\t    \t$(this.contentDocument.body).bind(\"contextmenu\",function(){return false;});\r\n");
      out.write("\t  \t  $(this.contentDocument.body).bind(\"selectstart\",function(){return false;});\r\n\t  \tiframeLoadComplete(iframe);\r\n\t    }); \r\n\t} else { \r\n\t    iframe.onload = function(){ \r\n\t    \t$(this.contentDocument.body).bind(\"contextmenu\",function(){return false;});\r\n\t    \t  $(this.contentDocument.body).bind(\"selectstart\",function(){return false;});\r\n\t    \t  iframeLoadComplete(iframe);\r\n\t    }; \r\n\t} \r\n\t\r\n}\r\nfunction iframeLoadComplete(iframe){\r\n\t//如果是excel去除overview标记\r\n\tif(\".xls\"=='");
      out.print(prefix);
      out.write("' || \".xlsx\"=='");
      out.print(prefix);
      out.write("'){\r\n\t\t//获取所有的h1标签\r\n\t\t\r\n\t\tvar h1Arr= $(iframe.contentWindow.document).find(\"h1\");\r\n\t\tif(h1Arr.length>0){\r\n\t\t\tfor(var i=h1Arr.length-1;i>=0;i--){\r\n\t\t\t\tif($(h1Arr[i]).html()==\"Overview\"){\r\n\t\t\t\t\t$(h1Arr[i]).remove();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar h1Val=$(h1Arr[i]).html();\r\n\t\t\t\t   var h1mc=h1Val.substring(6,h1Val.indexOf(\":\"));\r\n\t\t\t\t   $(h1Arr[i]).html(\"第\"+h1mc+\"页\"+h1Val.substring(h1Val.indexOf(\":\")));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar hrArr= $(iframe.contentWindow.document).find(\"hr\");\r\n\t\t$(hrArr[0]).remove();\r\n\t}\r\n}\r\nvar cnt=0;\r\nfunction waitTimer(){\r\n\t   if(cnt>5){\r\n\t\t   cnt=1;\r\n\t   }else{\r\n\t\t   cnt++;\r\n\t   }\r\n\t   var str=\"&nbsp;文件转换中，请稍候\";\r\n\t   for(var i=0;i<cnt;i++){\r\n\t\t   str+=\"·\"; \r\n\t   }\r\n\t   $(\"#showMsg\").html(str);\r\n}\r\nvar timer = window.setInterval(\"waitTimer()\",1000);\r\n  </script>\r\n ");
}else if(onlineShowStatus==2){
      out.write("<script type=\"text/javascript\">\r\n $(document).ready(function(){\r\n\t changeFrameSize();\r\n\t setFrameControl();\r\n\t $(\"#iframeHtmlShow\").attr(\"src\",\"");
      out.print(htmlVal);
      out.write("\");\r\n });\r\n $(window).resize(function(){\r\n\t  changeFrameSize();\r\n\t});\r\n function changeFrameSize(){\r\n\t\t$(\"#iframeHtmlShow\").height($(window).height()-35);\r\n\t\t$(\"#iframeHtmlShow\").width($(window).width());\r\n\t\t$(\"#toolbar\").width($(window).width());\r\n\t}\r\n\tfunction setFrameControl(){\r\n\t\t\r\n\t\tvar iframe = $(\"#iframeHtmlShow\")[0]; \r\n\t\tif (iframe.attachEvent){  // for IE \r\n\t\t    iframe.attachEvent(\"onload\", function(){ \r\n\t\t    \t$(this.contentDocument.body).bind(\"contextmenu\",function(){return false;});\r\n\t\t  \t  $(this.contentDocument.body).bind(\"selectstart\",function(){return false;});\r\n\t\t    }); \r\n\t\t} else { \r\n\t\t    iframe.onload = function(){ \r\n\t\t    \t$(this.contentDocument.body).bind(\"contextmenu\",function(){return false;});\r\n\t\t    \t  $(this.contentDocument.body).bind(\"selectstart\",function(){return false;});\r\n\t\t    }; \r\n\t\t} \r\n\t\t\r\n\t}\r\n </script>\r\n ");
 }else if(onlineShowStatus==3){
      out.write("<script language=\"javascript\">\r\n  $(document).ready(function(){\r\n\t  \r\n\t  $.ajax({ \r\n\t\t  url:\"onLineShow/onLineShowToRead.jsp\", \r\n\t\t  type:\"post\", //数据发送方式 \r\n\t\t  dataType:\"html\", //接受数据格式 (这里有很多,常用的有html,xml,js,json) \r\n\t\t  data:{fileData:\"");
      out.print(queryString);
      out.write("\"}, //要传递的数据 \r\n\t\t  error: function(){ //失败 \r\n\t\t\t  alert(\"获取文件数据失败，请稍后再试\");\r\n\t\t\t  window.close();\r\n\t\t  }, \r\n\t\t  success: function(res){ \r\n\t\t\t  $(\"#htmlShow\").html(res);\r\n\t\t  } \r\n\t}); \r\n\t  changeSize();\r\n  });\r\n\t \r\n  $(window).resize(function(){\r\n\t  changeSize();\r\n\t});\r\n   function changeSize(){\r\n\t$(\"#htmlShow\").height($(window).height()-35);\r\n\t$(\"#htmlShow\").width($(window).width());\r\n\t$(\"#toolbar\").width($(window).width());\r\n}\r\n</script>\r\n ");
} 
      out.write("<script type=\"text/javascript\">\r\nfunction download(){\r\n\twindow.open(\"/jsoa/onLineShow/onLineShowToDownload.jsp?");
      out.print(queryString);
      out.write("\");\r\n}\r\n</script>\r\n</HEAD>\r\n<BODY style=\"margin: 0px\" oncontextmenu=\"return false\" onselectstart=\"return false\" oncopy=\"return false\">\r\n<div id=\"toolbar\" style=\"height: 30px;width: 99%;float: left;border-bottom: 1px solid #2F4F4F;\">\r\n  <div style=\"display：inline-block;text-align: left;float: left;font-size: 26px;margin-left: 7px;\"><b>");
      out.print(realName );
      out.write("</b></div>\r\n  <div style=\"display：inline-block;float: right;margin-top: 5px;margin-right: 5px;\">\r\n  ");

  //海尔程序文件控制下载
  	if("haier".equals(SystemCommon.getCustomerName())){
  		String userId = session.getAttribute("userId").toString();
  		InfoProFileEJBBean iffb = new InfoProFileEJBBean();
  		boolean b = iffb.hasRoleId(userId);
  		if(b){
  			
      out.write("<img alt=\"下载\" src=\"images/downloadPng.png\" width=\"24px\" height=\"21px\" border=\"0\" onclick=\"download()\" style=\"cursor: pointer;\">\r\n  \t  \t\t");
	
  		}
  	}else{
  		
      out.write("<img alt=\"下载\" src=\"images/downloadPng.png\" width=\"24px\" height=\"21px\" border=\"0\" onclick=\"download()\" style=\"cursor: pointer;\">\r\n  \t\t");
	
  	}
  
  
      out.write("</div>\r\n</div>\r\n");
if(onlineShowStatus==1){ 
      out.write("<DIV id=\"showMsg\" style=\"font-size: 16px;\">&nbsp;文件转换中，请稍候</DIV>\r\n\t<iframe id=\"iframeShow\" frameborder=\"0\" scrolling=\"yes\" style=\"background-color:transparent;display: none;\"></iframe>\r\n");
}else if(onlineShowStatus==2){

      out.write("<iframe id=\"iframeHtmlShow\" frameborder=\"0\" scrolling=\"yes\" style=\"background-color:transparent;\"></iframe>\r\n");
 
}else if(onlineShowStatus==3){

      out.write("<DIV id=\"htmlShow\" style=\"word-wrap:break-word; word-break:break-all; \"></DIV>\r\n");
 
} else{ 
      out.write("<DIV id=\"showMsg\" style=\"font-size: 16px;\">&nbsp;该文件类型暂不支持预览</DIV>\r\n");
} 
      out.write("</BODY>\r\n</HTML>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
