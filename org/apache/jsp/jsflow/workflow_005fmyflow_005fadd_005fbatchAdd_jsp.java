/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 10:07:22 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.jsflow;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.js.system.util.StaticParam;
import com.js.oa.relproject.bean.RelProjectBean;
import java.util.Set;
import java.util.Map;
import com.js.lang.Resource;
import com.js.util.util.BrowserJudge;

public final class workflow_005fmyflow_005fadd_005fbatchAdd_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(8);
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-nested.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/eform/showform_batchAdd.jsp", Long.valueOf(1499751408000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-tiles.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-logic.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-html.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/jsflow/workflow_include_firstHidden.jsp", Long.valueOf(1499751422000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-template.tld", Long.valueOf(1499751390000L));
    _jspx_dependants.put("/WEB-INF/tag-lib/struts-bean.tld", Long.valueOf(1499751390000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.lang.Resource");
    _jspx_imports_classes.add("com.js.system.util.StaticParam");
    _jspx_imports_classes.add("java.util.Map");
    _jspx_imports_classes.add("java.util.Set");
    _jspx_imports_classes.add("com.js.oa.relproject.bean.RelProjectBean");
    _jspx_imports_classes.add("com.js.util.util.BrowserJudge");
  }

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fhtml_005fhtml;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fhtml_005fhtml = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fhtml_005fhtml.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			"/public/jsp/error.jsp", true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n\r\n\r\n \r\n\r\n\r\n\r\n\r\n");

response.setHeader("Cache-Control","no-store");
response.setHeader("Pragma","no-cache");
response.setDateHeader ("Expires", 0);

String title=request.getParameter("processName");
 
      out.write('\r');
      out.write('\n');
      //  html:html
      org.apache.struts.taglib.html.HtmlTag _jspx_th_html_005fhtml_005f0 = (org.apache.struts.taglib.html.HtmlTag) _005fjspx_005ftagPool_005fhtml_005fhtml.get(org.apache.struts.taglib.html.HtmlTag.class);
      boolean _jspx_th_html_005fhtml_005f0_reused = false;
      try {
        _jspx_th_html_005fhtml_005f0.setPageContext(_jspx_page_context);
        _jspx_th_html_005fhtml_005f0.setParent(null);
        int _jspx_eval_html_005fhtml_005f0 = _jspx_th_html_005fhtml_005f0.doStartTag();
        if (_jspx_eval_html_005fhtml_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
          do {
            out.write("\r\n<head>\r\n<title>");
            out.print(title );
            out.write("</title>\r\n<link href=\"/jsoa/skin/");
            out.print(session.getAttribute("skin"));
            out.write("/style-");
            out.print(session.getAttribute("browserVersion"));
            out.write(".css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<script src=\"/jsoa/js/js.js\" language=\"javascript\"></script>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"public/date_picker/DateObject2.css\">\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/DateObject.js\"></SCRIPT>\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/DatePicker.js\"></SCRIPT>\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/editlib.js\"></SCRIPT>\r\n<SCRIPT language=\"javascript\" src=\"public/date_picker/tree.js\"></SCRIPT>\r\n<script language=\"javascript\" src=\"js/openEndow.js\"></script>\r\n<script language=\"javascript\" src=\"js/checkForm.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/eform/datetime/datetime_check.js\"></script>\r\n<script language=\"javascript\" src=\"/jsoa/eform/datetime/datetime_select.js\"></script>\r\n\r\n<script src=\"/jsoa/js/toolbar/standardAdd.js\" language=\"javascript\"></script>\r\n<script src=\"/jsoa/js/clsPullXMenu.js\" language=\"javascript\"></script>\r\n<script src=\"/jsoa/public/jsp/cmdbutton.jsp?button=Close,SaveToDraft,Send\"></script>\r\n");
            out.write("<!--\r\n工具栏调用方式\r\n/jsoa/public/jsp/cmdbutton.jsp?button=close,send,end,save,toreceive,toselfdept,back,undo,wait,feedback,return,tran,delete,print,writetext,readtext,viewtext,textmanager,imptext,savefile,viewacc,manageracc,printcomm,document,code,selfsend,addperson\r\n-->\r\n\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"><style type=\"text/css\">\r\n<!--\r\nbody {\r\n\tmargin-left: 0px;\r\n\tmargin-top: 0px;\r\n}\r\n-->\r\n</style></head>\r\n");

	if(request.getAttribute("formType")!=null && "1".equals(request.getAttribute("formType").toString().trim())){//使用用户上传JSP文件
		request.setCharacterEncoding("gb2312");
		if(request.getAttribute("jspFile")!=null && !"NULL".equals(request.getAttribute("jspFile").toString().toUpperCase()))
			response.sendRedirect("/jsoa/jsflow/"+request.getAttribute("jspFile").toString()+"?processId="+request.getParameter("processId")+"&processType="+request.getParameter("processType")+"&tableId="+request.getParameter("tableId")+"&processName="+title+"&moduleId="+request.getParameter("moduleId"));
		else{
			out.print("<SCRIPT LANGUAGE=\"JavaScript\">alert(\"请先设置流程使用JSP文件\");window.close();</SCRIPT>");
		}
	}else{//使用自定义表单

            out.write("\r\n\r\n");
if(request.getParameter("close") != null){

            out.write("\r\n<script language=\"javascript\">\r\n");

if(request.getAttribute("submitFailed") != null){
            out.write("\r\nalert(\"没有办理用户！\");\r\n");
}
            out.write("\r\nwindow.close();\r\n</script>\r\n");

}else{
            out.write("\r\n<script language=\"javascript\">\r\nfunction changePanle(flag){\r\n    if(flag == 0) {\r\n        Panle0.style.color = \"red\";\r\n        Panle1.style.color = \"black\";\r\n        Panle2.style.color = \"black\";\r\n        docinfo0.style.display = \"\";\r\n        docinfo1.style.display = \"none\";\r\n    }else if(flag == 1) {\r\n        Panle0.style.color = \"black\";\r\n        Panle1.style.color = \"red\";\r\n        Panle2.style.color = \"black\";\r\n        docinfo0.style.display = \"none\";\r\n        docinfo1.style.display = \"\";\r\n\t\t    document.all.flowviewFrame.src=\"/jsoa/jsflow/jsflow_view.jsp?processId=");
            out.print(request.getParameter("processId"));
            out.write("&table=");
            out.print(request.getParameter("table"));
            out.write("&record=");
            out.print(request.getParameter("record"));
            out.write("&CurActivityID=&ActivityIDStr=\";\r\n    }else if(flag == 2) {\r\n        Panle0.style.color = \"black\";\r\n        Panle1.style.color = \"black\";\r\n        Panle2.style.color = \"red\";\r\n        docinfo0.style.display = \"none\";\r\n        docinfo1.style.display = \"\";\r\n\t\t    document.all.flowviewFrame.src=\"/jsoa/jsflow/workflow_description.jsp?liuzhuan=1&processId=");
            out.print(request.getParameter("processId"));
            out.write("&ndate=\"+new Date();\r\n    }\r\n    \r\n}\r\n\r\nfunction initFullWin(){\r\n  //window.resizeTo(screen.width,screen.height-28);\r\n  //window.moveTo(0,0);\r\n}\r\n</script>\r\n<body onLoad=\"loadToolbar('commandBar');init();initFullWin();\" onResize=\"loadToolbar('commandBar')\" class=\"MainFrameBox PupwinForFlow\" scroll=\"no\">\r\n <form name=\"WorkFlowFormActionForm\" id=\"WorkFlowFormActionForm\" action=\"/jsoa/JsFlowAddAction.do\" method=\"post\">\r\n<table width=\"100%\" height=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n<input type=\"hidden\" id=\"fromFlagFlow\" name=\"fromFlagFlow\" value=\"");
            out.print(request.getAttribute("fromFlagFlow"));
            out.write("\"/>\r\n<input type=\"hidden\" id=\"wfWorkId\" name=\"wfWorkId\" value=\"");
            out.print(request.getAttribute("wfWorkId"));
            out.write("\"/>\r\n<input type=hidden name=\"collectId\" id=\"collectId\" value=\"");
            out.print(request.getParameter("collectId"));
            out.write("\">\r\n  <tr height=\"27\">\r\n\t<td height=\"27\" id=\"popToolbar\"><div id=\"commandBar\"></div>\r\n\t</td>\r\n  </tr>\r\n  \r\n  <tr>\r\n    <td style=\"padidng:1px;padding-top:0px;\">\r\n<table width=\"100%\" height=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n    <tr>\r\n        <td class=\"pannelWin\" valign=\"top\" align=\"center\">\r\n        <div style=\"height:100%;padding:20px;background:#a0a0a0;\" id=\"showHtmlDiv\" class=\"scrollBox\">\r\n");
            out.write("\r\n<table width=\"99%\" height=\"35\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" class=\"docBoxNoPanelForFlow\">\r\n<tr>\r\n  <td>\r\n    <table width=\"95%\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n       <tr>\r\n           <td colspan=\"7\" height=\"25\">\r\n               <span id=\"Panle0\" onClick=\"changePanle(0);\" style=\"color:red;cursor:pointer;padding-left:15px;\">表单信息</span>\r\n\t\t\t   ");

				if(!"0".equals(request.getParameter("processType"))){
			   
            out.write("\r\n                |\r\n\t\t\t\t<span id=\"Panle1\" onClick=\"changePanle(1);\" style=\"color:black;cursor:pointer;\">流程图</span>\r\n\t\t\t   ");
}
            out.write("\r\n\t\t\t    |\r\n\t\t\t\t<span id=\"Panle2\" onClick=\"changePanle(2);\" style=\"color:black;cursor:pointer;display:\">流程描述</span>\r\n           </td>\r\n       </tr>\r\n      \r\n       <tr>\r\n           <td height=\"380\" valign=\"top\">\r\n           <div id=\"docinfo0\">\r\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n           \r\n                <input type=\"hidden\" name=\"myAction\" id=\"myAction\">\r\n                <input type=\"hidden\" name=\"remindField\" id=\"remindField\" value=\"");
            out.print(request.getAttribute("remindField"));
            out.write("\">\r\n                ");
if(request.getAttribute("formContent")!=null && request.getAttribute("formContent").toString().length()>0){
            out.write("\r\n                    <tr><td><table border=0>\r\n                    ");
            out.print(request.getAttribute("formContent"));
            out.write("\r\n                    </table></td></tr>\r\n                ");
}
            out.write("\r\n                ");

                String pageId =request.getAttribute("tableId").toString();//自定义表单ID
                java.util.List noWriteFiledList=(java.util.List)request.getAttribute("noWriteField");
                if(noWriteFiledList!=null && noWriteFiledList.size()>0){
                	StringBuffer fieldBuf=new StringBuffer();
                	for(int i=0;i<noWriteFiledList.size();i++){
                		if(i==0){
                			fieldBuf.append(noWriteFiledList.get(i).toString());
                		}else{
                			fieldBuf.append(",").append(noWriteFiledList.get(i).toString());
                		}
                	}
                	request.setAttribute("hideField",fieldBuf.toString());//发起时不填写字段
                }else{
                	request.setAttribute("hideField","");//发起时不填写字段
                }
                
            out.write("\r\n                <tr><td>\r\n                \t<input type=\"hidden\" id=\"addFlag\" name=\"addFlag\" value=\"");
            out.print(request.getAttribute("addFlag"));
            out.write("\"/>\r\n                    ");
            out.write('\r');
            out.write('\n');

request.setCharacterEncoding("GBK");
com.js.oa.eform.service.CustomFormBD cst = new com.js.oa.eform.service.CustomFormBD();
com.js.oa.userdb.service.CustomDatabaseBD userDB=new com.js.oa.userdb.service.CustomDatabaseBD();
String scriptappend = "";
String domainId = session.getAttribute("domainId")==null?"0":session.getAttribute("domainId").toString();
String parent_fromDraft="draftForm".equals(request.getParameter("action"))?"1":"0";
if("1".equals(request.getParameter("resubmit"))){
	parent_fromDraft="1";
}
String hideTableHTML = "";
String showTableHTML = "";
java.util.List boxFieldList=userDB.getOnchangeMethodInfo(pageId,domainId);

//读取隐藏字段（不可编辑字段）
String hide_Field =request.getAttribute("hideField")==null?"":request.getAttribute("hideField").toString();

            out.write("\r\n\r\n<style type=\"text/css\">\r\n    .flowInput{\r\n    \tbehavior:url(/jsoa/js/validate.htc);\r\n  \t\t/*border:1px solid #E8E8E8;*/\r\n    }\r\n    .flowInputRed{\r\n    \tbehavior:url(/jsoa/js/formvalidate.htc);\r\n  \t\t/*border:1px solid #E8E8E8;*/\r\n    }\r\n\r\n    .flowInputenter{\r\n  \t\tborder:1px solid blue;\r\n    }\r\n\t.mustwrite{\r\n  \t\tborder:1px solid red;\r\n    }\r\n\t.divnowrap\r\n\t{\r\n      meizz:expression(this.noWrap=true);\r\n\t}\r\n</style>\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/jsoa/eform/ext/resources/css/ext-all-jiusi.css\"/>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/adapter/ext/ext-base.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/ext/ext-all.js\"></script>\r\n<script type=\"text/javascript\" src=\"/jsoa/eform/js/ajax.js\"></script>\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\n  var currentRow = null;\r\n  var tblTR = new Array();\r\n  var tblTRHTML = new Array();\r\n  ");

  //取设置了检索的字段信息
  
  //取设置了提取数据的字段信息
  
            out.write("\r\n  \r\n  Ext.onReady(function(){\r\n\t//Ext.QuickTips.init();\r\n\t");

	String[] fieldObj;
	String hide_field_readonly=","+hide_Field+",";
	for(int fi=0;fi<boxFieldList.size();fi++){
		fieldObj=(String[])boxFieldList.get(fi);
		if("1".equals(fieldObj[2])){
			//需要输入检索
			if (hide_field_readonly.indexOf(","+fieldObj[0]+",") >= 0 || hide_field_readonly.indexOf(fieldObj[1]) >= 0) {
				//如果是只读字段则不使用输入样式
				continue;
			}else{
			
	
            out.write("\r\n\ttry{\r\n\t\tvar cb");
            out.print(fi);
            out.write(" = new Ext.form.ComboBox({\r\n\t\t\ttypeAhead: true,\r\n\t\t\ttriggerAction: 'all',\r\n\t\t\ttransform:'");
            out.print(fieldObj[1]);
            out.write("',\r\n\t\t\twidth:'200',\r\n\t\t\tforceSelection:true,\r\n\t\t\t//listClass:'inputText',\r\n\t\t\tminListWidth:205+2+2,\t\t\t\r\n\t\t\tlisteners:{\r\n\t        \tselect:{\r\n\t\t\t\t\tfn:function(combo, record, index){\r\n\t\t\t\t\t\t//判断是否有onchange方法\r\n\t\t\t\t\t\t");
if(!"0".equals(fieldObj[3])){
            out.write("\r\n\t\t\t\t\t\t\t");
            out.print(fieldObj[1]);
            out.write("_onchange(combo);\r\n\t\t\t\t\t\t");
}
            out.write("\r\n\t\t\t\t\t}\r\n\t        \t}\r\n\t\t\t}\r\n\t    });\r\n\t\tcb");
            out.print(fi);
            out.write(".el.setStyle({\r\n\t\t\twidth:'252px',\r\n\t\t\ttop:'0.1px'\r\n\t\t});\r\n\t}catch(ee){\r\n\t}\r\n\t\r\n\t");
    }
	   }
	}
            out.write("\r\n});\r\n\r\n//构造字段onchange事件\r\n");

for(int fi=0;fi<boxFieldList.size();fi++){
	fieldObj=(String[])boxFieldList.get(fi);
	if(!"0".equals(fieldObj[3])){
		//onchange fangfa

            out.write("\r\nfunction ");
            out.print(fieldObj[1]);
            out.write("_onchange(obj){\r\n    var curIndex=0;\r\n    var curObj=document.getElementsByName(obj.name);\r\n    for(var i=0;i<curObj.length;i++){\r\n    \tif(curObj[i]==obj){\r\n    \t\tcurIndex=i;\r\n    \t}\r\n    }\r\n    \r\n\t");

	if("1".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		
            out.write("\r\n\t\t//提取数据\r\n\t\tvar selValue=obj.value;\r\n\t\tvar submitPersonObj=document.getElementsByName(\"submitPersonId\");\r\n\t\tvar submitPersonId=\"\";\r\n\t\tif(submitPersonObj.length>0){\r\n\t\t\tsubmitPersonId=submitPersonObj[0].value;\r\n\t\t}\r\n\t\tJSRequest.sendPOST(\"/jsoa/eform/fetchdata.jsp?curIndex=\"+curIndex+\"&fieldId=");
            out.print(fieldObj[0]);
            out.write("&submitPersonId=\"+submitPersonId+\"&selValue=\"+selValue,\"\",showFormSubData);\r\n\t\t");

	}
	if("2".equals(fieldObj[3])||"3".equals(fieldObj[3])){
		out.print(fieldObj[5]);
	}
	
            out.write("\r\n}\r\n");
  }
	//输入检索的回车触发事件
	if("450".equals(fieldObj[7])){
		
            out.write("\r\nfunction ");
            out.print(fieldObj[1]);
            out.write("_enter(obj){\r\n    \t\r\n\tvar curIndex=0;\r\n    var curObj=document.getElementsByName(obj.name);\r\n    for(var i=0;i<curObj.length;i++){\r\n    \tif(curObj[i]==obj){\r\n    \t\tcurIndex=i;\r\n    \t}\r\n    }\r\n    var inputValueObj=document.getElementsByName(\"");
            out.print(fieldObj[1]);
            out.write("_temp\");\r\n    \r\n\tvar inputValue=inputValueObj[curIndex].value;\t\r\n\t\r\n\tvar submitPersonObj=document.getElementsByName(\"submitPersonId\");\r\n\tvar submitPersonId=\"\";\r\n\tif(submitPersonObj.length>0){\r\n\t\tsubmitPersonId=submitPersonObj[0].value;\r\n\t}\r\n\t\r\n\tJSMainWinOpen2(\"/jsoa/FormDataFilterAction.do?curIndex=\"+curIndex+\"&fieldId=");
            out.print(fieldObj[0]);
            out.write("&fieldName=");
            out.print(fieldObj[1]);
            out.write("&submitPersonId=\"+submitPersonId+\"&inputValue=\"+inputValue,\"\",\"\");\r\n}\r\n\t\t");

	}
}
            out.write("\r\n\r\ndocument.onkeydown=listenKeyDown;\r\n\r\nfunction listenKeyDown(){\r\n\tvar event = arguments[0] ||window.event;\r\n\tif(event.keyCode==13){\r\n\t\t//按下了enter\r\n\t\ttry{\r\n\t\t    var obj=event.srcElement;\r\n\t\t\tvar objname=event.srcElement.name;\t\r\n\t\t\t\r\n\t\t\tvar curIndex=0;\r\n\t\t    var curObj=document.getElementsByName(objname);\r\n\t\t    for(var i=0;i<curObj.length;i++){\r\n\t\t    \tif(curObj[i]==obj){\r\n\t\t    \t\tcurIndex=i;\r\n\t\t    \t}\r\n\t\t    }\r\n    \r\n\t\t\tobjname=objname.substring(0,objname.length-5);\r\n\t\t\tobjname=objname+\"_btn\";\t\t\t\r\n\t\t\t\r\n\t\t\tobj=document.getElementsByName(objname);\r\n\t\t\tobj[curIndex].click();\r\n\t\t\t\r\n\t\t\t//eval(objname+\"_enter(\"+document.getElementsByName(objname)[0]+\")\");\r\n\t\t}catch(e){\r\n\t\t\t//alert(e);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction showFormSubData(response){\r\n\t//将取回的数据显示在正确的表单中\r\n\t//alert(response.responseText);\r\n    //alert(response.responseXML.documentElement);\r\n\tif(response!=null && response.responseText!=\"\" && response.responseXML.documentElement!=null){\r\n    \tvar root=response.responseXML.documentElement;\r\n    \t\r\n    \t//如是字表多行时需确定本行的位置\r\n");
            out.write("    \tvar curIndex=root.getElementsByTagName(\"curIndex\")[0].firstChild.nodeValue;\r\n    \t    \t\r\n    \tvar datas= root.getElementsByTagName(\"data\");\r\n    \tvar formfield,fetchdata,content,fieldTagName;\r\n    \tvar subdatas,datavalue,datatext;\r\n    \tvar oprObj;\r\n    \tfor(var i=0;i<datas.length;i++){\r\n    \t\tformfield=datas[i].getElementsByTagName(\"formfield\")[0].firstChild.nodeValue;\r\n    \t\tfetchdata=datas[i].getElementsByTagName(\"fetchdata\")[0].firstChild.nodeValue;\r\n    \t\t\r\n    \t\t//alert(formfield);\r\n    \t\t//alert(fetchdata);    \t\t\r\n    \t\t\r\n    \t\t\r\n    \t\tif(fetchdata==\"0\"){\r\n    \t\t    oprObj=document.getElementsByName(formfield)[curIndex]; \r\n    \t\t    oprObj.value=\"\";     \t\t   \r\n    \t\t    if(datas[i].getElementsByTagName(\"content\")[0].firstChild!=null){    \t\t       \t\t    \r\n    \t\t\t\tcontent=datas[i].getElementsByTagName(\"content\")[0].firstChild.nodeValue;\r\n    \t\t\t\toprObj.value=content;\r\n    \t\t\t}    \t\t\t    \t\t\t     \t\t\t\t\t\r\n    \t\t\t\r\n    \t\t}else if(fetchdata==\"2\"){\r\n    \t\t\tsubdatas=datas[i].getElementsByTagName(\"content\")[0].getElementsByTagName(\"subdata\");\r\n");
            out.write("    \t\t\t//下拉列表形式    \t\t\t\r\n    \t\t\t//oprObj=eval(\"document.all.\"+formfield);\r\n    \t\t\toprObj=document.getElementsByName(formfield)[curIndex];    \t\t\t\r\n    \t\t\t\r\n    \t\t\tfieldTagName=oprObj.tagName;    \t\t\t\r\n    \t\t\tif(fieldTagName==\"INPUT\" || fieldTagName==\"TEXTAREA\"){\r\n    \t\t\t\t//普通输入 \r\n    \t\t\t\toprObj.value=\"\";   \r\n    \t\t\t\tif(subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild!=null){\t\t\t\t\r\n\t    \t\t\t\tdatavalue=subdatas[0].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue; \r\n\t    \t\t\t\toprObj.value=datavalue;\r\n    \t\t\t\t}\r\n    \t\t\t}else if(fieldTagName==\"SELECT\"){\r\n    \t\t\t\t//删除原来的option    \t\t\t\t\r\n    \t\t\t\tjs_deleteAllOptions(oprObj);    \t\t\t\t\r\n    \t\t\t\t//新增option\r\n    \t\t\t\tfor(var j=0;j<subdatas.length;j++){\r\n    \t\t\t\t    try{\r\n\t    \t\t\t\t\tdatavalue=subdatas[j].getElementsByTagName(\"datavalue\")[0].firstChild.nodeValue;\r\n\t    \t\t\t\t\tdatatext=subdatas[j].getElementsByTagName(\"datatext\")[0].firstChild.nodeValue;\r\n\t    \t\t\t\t\tjs_addOption(oprObj,datavalue,datatext);\r\n    \t\t\t\t\t}catch(e){\r\n    \t\t\t\t\t}\r\n    \t\t\t\t}\r\n    \t\t\t\toprObj.onchange();    \t\t\t\t\r\n");
            out.write("    \t\t\t}\r\n    \t\t}\r\n    \t\t\r\n    \t}\r\n    }\r\n}\r\n\r\nfunction js_deleteAllOptions(obj){\r\n\twhile(length!=0){ \r\n　　 \tvar length=obj.options.length;\r\n　　 \tfor(var i=0;i<length;i++)\r\n　　 \t\tobj.options.remove(i);\r\n　　 \tlength=length/2;\r\n　　 }\r\n}\r\nfunction js_addOption(obj,optionValue,optionText){\r\n\tvar newOption=new Option(optionText,optionValue); \r\n\tobj.options[obj.length]=newOption; \r\n} \r\n\r\n//-->\r\n</SCRIPT>\r\n<script language=javascript src=\"/jsoa/eform/js/form_batchAdd.js\"></script>\r\n<input type=\"hidden\" name=\"user_Id\" id=\"user_Id\" value=\"");
            out.print(session.getAttribute("userId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Name\" id=\"user_Name\" value=\"");
            out.print(session.getAttribute("userName"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"user_Account\" id=\"user_Account\" value=\"");
            out.print(session.getAttribute("userAccount"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"org_Name\" id=\"org_Name\" value=\"");
            out.print(session.getAttribute("orgName"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"org_ID\" id=\"org_ID\" value=\"");
            out.print(session.getAttribute("orgId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"group_ID\" id=\"group_ID\" value=\"");
            out.print(session.getAttribute("groupId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"Hide_Field\" id=\"Hide_Field\" value=\"");
            out.print(request.getAttribute("hideField"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"Page_Id\" id=\"Page_Id\" value=\"");
            out.print(pageId);
            out.write("\"/>\r\n<input type=\"hidden\" name=\"Info_Id\" id=\"Info_Id\" value=\"");
            out.print(request.getAttribute("infoId"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"work_Status\" id=\"work_Status\" value=\"");
            out.print(request.getParameter("workStatus"));
            out.write("\"/>\r\n<input type=\"hidden\" name=\"parent_fromDraft\" id=\"parent_fromDraft\" value=\"");
            out.print(parent_fromDraft);
            out.write("\">\r\n<input type=\"hidden\" name=\"totalValueSet\" id=\"totalValueSet\" value=\"\" />\r\n<!-- 取 -->\r\n");
            out.print(cst.getComputeFieldHTML(pageId));
            out.write("\r\n<div id=\"formHTML\">\r\n<!-- 读取表单设计模板 -->\r\n");
            out.print(cst.getCodeByBatChAdd(pageId));
            out.write("\r\n</div>\r\n\r\n\r\n<script language=\"javascript\">\r\n");

String allCoumputFieldStr=cst.getMainAndForeignComputeFields(pageId);
String tableName=cst.getTable(pageId);
  //判断当前表单是否新增
	if(request.getAttribute("infoId")==null || request.getAttribute("infoId").toString().toUpperCase().equals("NULL") || request.getAttribute("infoId").toString().trim().length()<1){
		//初始化显示界面(新增)
		//System.out.println("新增表单.........................................................");
		
		// 如果是发起子流程则如果子流程中的表单与主表单相同则将数据继承
		String pareFormId=request.getParameter("pareTableId");
		boolean isNewForm=true;
		if(pareFormId!=null || !"null".equals(pareFormId) || !"".equals(pareFormId)){
		  //取得父表单ID则比较父表单ID是否与当前表单ID相同，如果相同的话，则继承主表单数据
		  isNewForm=cst.isNewForm(pareFormId,pageId);
		}
		
		if(isNewForm){
		   //新表单
		
			//out.println("新增空白表单.........................................................");
		    //取得表单关联的所有字段信息的数据(主表)
			String[][] fieldArr =cst.getPageField(pageId);
			if(fieldArr!=null){
	            //遍历所有字段，获得字段的页面显示脚本
				for(int i=0;i<fieldArr.length;i++){
				//System.out.println("a:"+fieldArr[i][0]+"         b:"+fieldArr[i][1]);
					if(fieldArr[i][0]!=null && (!fieldArr[i][0].trim().equals(""))){
						out.print(cst.getHTMLBatchAdd(fieldArr[i][0],hide_Field,domainId,fieldArr[i][1],request,allCoumputFieldStr));
					}
				}
 			//将表设置为增加行、删除行图标所在的焦点
 			 
              scriptappend = "currentRow = document.getElementsByName('"+tableName+"TR')[document.getElementsByName('"+tableName+"TR').length-1];setAbsolute(currentRow);";
              String agent= request.getHeader("USER-AGENT");   
              if (null != agent && -1 != agent.indexOf("MSIE")) { //判断浏览器
                out.print("document.getElementById('"+tableName+"DIV').childNodes[0].onclick=setDelRowsValue;");//给子表的div加单击事件，把要删除的行记录到临时变量里以备删除
              }else{
                out.print("document.getElementById('"+tableName+"DIV').childNodes[1].onclick=setDelRowsValue;");
              }
			}
     }
    
	}

            out.write("\r\n\r\n//alert(WorkFlowFormActionForm.computeField.value);\r\n</script>\r\n\r\n");

	//子表的计算字段设置
  //out.print(cst.getForeignComputeFieldHTML(pageId));
  //out.print(hideTableHTML+showTableHTML);  

            out.write("\r\n\r\n<script language=javascript src=\"/jsoa/eform/datetime/time.js\"></script>\r\n<script language=\"javascript\">\r\n\r\nif(document.all.wf_ua){\r\n    if(document.all.wf_ua.length){\r\n    }else{\r\n        eval(\"document.all.\" + document.all.wf_ua.value + \".value='");
            out.print(session.getAttribute("userAccount"));
            out.write("'\");\r\n    }\r\n}\r\n</script>\r\n\r\n<div id=\"adddelrow_div\" style=\"border: #0a246a 1px solid; visibility: hidden; z-index:1000; width: 30px; position: absolute\">\r\n\t<table height=\"100%\" cellSpacing=0 cellPadding=0 width=\"100%\" border=0>\r\n\t\t<tr>\r\n\t\t\t<td onmouseover=\"this.style.borderRight='1px #0A246A solid'\" onmouseout=\"this.style.borderRight=''\" align=\"middle\">\r\n\t\t\t\t<img title=\"点击删除记录\" style=\"cursor: pointer;width:12;height:12\" src=\"/jsoa/eform/images/delarrow.gif\" onclick=\"delRow()\" align=\"absMiddle\">\r\n\t\t\t</td>\r\n\t\t\t<td onmouseover=\"this.style.borderLeft='1px #0A246A solid'\" onmouseout=\"this.style.borderLeft=''\" align=\"middle\">\r\n\t\t\t\t<img title=\"点击添加记录\" style=\"cursor: pointer;width:12;height:12\" src=\"/jsoa/eform/images/addarrow.gif\" onclick=\"addRow()\" align=\"absMiddle\">\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n</div>\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\n//document.body.attachEvent(\"onload\",function(){});\r\n//alert(document.body.readyState);\r\nsetNoWrap();\r\ninitRow();\r\n//-->\r\n</SCRIPT>\r\n<script >\r\n\t");
//=scriptappend
            out.write("\r\n        ");
/*
        	if(scriptappend.length()>0){
                	out.print("document.body.attachEvent('onload',function(){setAbsolute(currentRow);});");
                }*/
        
            out.write("\r\n        //alert(document.body.onload);\r\n\r\n</script>\r\n<!-- <script src=\"/jsoa/js/util.js\"></script>-->");
            out.write("\r\n                </td></tr>\r\n                <tr>\r\n                    <td height=\"22\" colspan=\"2\">&nbsp;</td>\r\n                </tr>\r\n                ");

                String showDisplay = "";
				  if(0==com.js.util.config.SystemCommon.getIsShowProject()){
				  		showDisplay = "none";
				  }
                String relProjectId="";
                
            out.write("\r\n\t\t\t    <tr style=\"display:");
            out.print(showDisplay );
            out.write(";\">\r\n\t\t\t      <td colspan=\"2\" align=\"right\">相关项目:\r\n\t\t\t      <select name=\"relproject\" id=\"relproject\" style=\"width:200\">\r\n\t\t\t         <option value=\"-1\"></option>\r\n\t\t\t         ");

			         RelProjectBean rpBean=new RelProjectBean();
			         java.util.List projectList=rpBean.getActiveProject(session.getAttribute("userId").toString(),session.getAttribute("orgId").toString(),session.getAttribute("orgIdString").toString());
			         if(projectList!=null && projectList.size()>0){
			        	 Object[] obj;
			        	 for(int i=0;i<projectList.size();i++){
			        		 obj=(Object[])projectList.get(i);
			         
            out.write("\r\n\t\t\t         <option value=\"");
            out.print(obj[0] );
            out.write('"');
            out.write(' ');
if(obj[0].toString().equals(relProjectId)){out.print("selected");} 
            out.write('>');
            out.print(obj[1] );
            out.write("</option>\r\n\t\t\t         ");
}
			         } 
            out.write("\r\n\t\t\t      </select>\r\n\t\t\t      </td>\r\n\t\t\t    </tr>\r\n                <tr><td id=\"newIframeSpan\" colspan=\"10\"></td></tr>\r\n                ");

                String formName="WorkFlowFormActionForm";//表单FORM名称
                String saveCheckFn = "beforeSubmit()";//保存时校验表单的javascript函数名称
                String mainLinkFile = "/jsoa/WorkFlowProcAction.do?flowpara=1";//文件办理时打开的页面链接
				String passLinkFile = "/jsoa/WorkFlowProcAction.do?flowpara=1";//阅件时打开的页面链接
                String titleFieldName = "";//作为显示标题的表单中的元素的名称,如果为""则按工作流程的标题
                String[][] button = null;//包含页面中的附加按钮的名称和触发的javascript函数名称
                String msgFrom = "工作流程";//短信提醒模块名称
                String cancelHref ="JSMainWinOpen('/jsoa/jsflow/workflow_cancelReason.jsp?workStatus=1&workId=workIdValue&tableId=tableIdValue&processName=processNameValue&recordId=recordIdValue&processId=processIdValue&remindValue=remindValueValue&moduleId=1&remindField=" + request.getParameter("remindField") + "','','TOP=0,LEFT=0,scrollbars=no,resizable=no,width=480,height=250')";
                
            out.write("\r\n                <tr>\r\n                    <td height=\"22\" colspan=\"2\">");
            out.write("\r\n\r\n \r\n\r\n\r\n");

String localhi = session.getAttribute("org.apache.struts.action.LOCALE").toString();

            out.write("\r\n<script type='text/javascript' src='/jsoa/workflow/dwr/interface/workflowSync.js'></script>\r\n<script type='text/javascript' src='/jsoa/workflow/dwr/engine.js'></script> \r\n<script src=\"/jsoa/js/util.js\"></script>\r\n\r\n<input type=\"hidden\" name=\"tableId\" id=\"tableId\" value=\"");
            out.print((request.getAttribute("tableId")==null || request.getAttribute("tableId").toString().toUpperCase().equals("NULL"))?request.getParameter("tableId"):request.getAttribute("tableId").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"recordId\" id=\"recordId\" value=\"");
            out.print((request.getAttribute("recordId")==null || request.getAttribute("recordId").toString().toUpperCase().equals("NULL"))?request.getParameter("recordId"):request.getAttribute("recordId").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"editId\" id=\"editId\" value=\"");
            out.print(request.getParameter("editId") != null ? request.getParameter("editId").toString() : "");
            out.write("\">\r\n\r\n<input type=\"hidden\" name=\"processType\" id=\"processType\" value=\"");
            out.print((request.getAttribute("processType")==null || request.getAttribute("processType").toString().toUpperCase().equals("NULL"))?request.getParameter("processType"):request.getAttribute("processType").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"processName\" id=\"processName\" value=\"");
            out.print((request.getAttribute("processName")==null || request.getAttribute("processName").toString().toUpperCase().equals("NULL"))?request.getParameter("processName"):request.getAttribute("processName").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"processId\" id=\"processId\" value=\"");
            out.print((request.getAttribute("processId")==null || request.getAttribute("processId").toString().toUpperCase().equals("NULL"))?request.getParameter("processId"):request.getAttribute("processId").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"remindField\" id=\"remindField\" value=\"");
            out.print((request.getAttribute("remindField")==null || request.getAttribute("remindField").toString().toUpperCase().equals("NULL"))?request.getParameter("remindField"):request.getAttribute("remindField").toString());
            out.write("\">\r\n<input type=\"hidden\" name=\"moduleId\" id=\"moduleId\" value=\"");
            out.print((request.getAttribute("moduleId")==null || request.getAttribute("moduleId").toString().toUpperCase().equals("NULL"))?request.getParameter("moduleId"):request.getAttribute("moduleId").toString());
            out.write("\">\r\n\r\n<input type=\"hidden\" name=\"mainLinkFile\" id=\"mainLinkFile\" value=\"");
            out.print(mainLinkFile);
            out.write("\">\r\n<input type=\"hidden\" name=\"titleFieldName\" id=\"titleFieldName\" value=\"");
            out.print(titleFieldName);
            out.write("\">\r\n<input type=\"hidden\" name=\"msgFrom\" id=\"msgFrom\" value=\"");
            out.print(msgFrom);
            out.write("\">\r\n<input type=\"hidden\" name=\"cancelHref\" id=\"cancelHref\" value=\"");
            out.print(cancelHref);
            out.write("\">\r\n");
if(request.getParameter("isSubProcWork") != null){
            out.write("\r\n<input type=\"hidden\" name=\"isSubProcWork\" id=\"isSubProcWork\" value=\"1\">\r\n<input type=\"hidden\" name=\"pareProcActiId\" id=\"pareProcActiId\" value=\"");
            out.print(request.getParameter("pareProcActiId"));
            out.write("\">\r\n<input type=\"hidden\" name=\"pareStepCount\" id=\"pareStepCount\" value=\"");
            out.print(request.getParameter("pareStepCount"));
            out.write("\">\r\n<input type=\"hidden\" name=\"pareTableId\" id=\"pareTableId\" value=\"");
            out.print(request.getParameter("pareTableId"));
            out.write("\">\r\n<input type=\"hidden\" name=\"pareRecordId\" id=\"pareRecordId\" value=\"");
            out.print(request.getParameter("pareRecordId"));
            out.write("\">\r\n");
}
            out.write("\r\n\r\n<!-- 新增表单域 -->\r\n");



String markField="1";//标记此方法可用：1,不可用：0
//Map map=new  com.js.oa.jsflow.util.InitWorkFlowData().getClassMethod(markField,request);

com.js.oa.jsflow.vo.ActivityVO activityVO = new com.js.oa.jsflow.util.WorkflowCommon().getFirstActivityInfo(request);
if(false){

            out.write("\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\nalert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includenosetupstartactivity"));
            out.write("\");\r\n//-->\r\n</SCRIPT>\r\n<script src=\"/jsoa/public/jsp/cmdbutton.jsp?button=Close\"></script>\r\n");
}else{
            out.write("\r\n<input type=hidden name=userType id=\"userType\" value=100>\r\n<INPUT TYPE=\"hidden\" name=\"operName\" id=\"operName\" value=\"");
            out.print(session.getAttribute("userName").toString());
            out.write("\">\r\n<INPUT TYPE=\"hidden\" name=\"operId\" id=\"operId\" value=\"$");
            out.print(session.getAttribute("userId").toString());
            out.write("$\">\r\n<input type=hidden name=allowStandFor id=\"allowStandFor\" value=\"0\">\r\n<input type=hidden name=allowCancel id=\"allowCancel\" value=\"0\">\r\n<input type=hidden name=activityId id=\"activityId\" value=\"");
            out.print(activityVO==null? 0:activityVO.getId());
            out.write("\">\r\n<input type=hidden name=activityName id=\"activityName\" value=\"");
            out.print(activityVO==null?"":activityVO.getName());
            out.write("\">\r\n<input type=\"hidden\" id=\"branchActInfo\" name=\"branchActInfo\" value=\"\">\r\n\r\n<input type=hidden name=pressType id=\"pressType\" value=\"0\">\r\n<input type=hidden name=deadLineTime id=\"deadLineTime\" value=\"-1\">\r\n<input type=hidden name=pressMotionTime id=\"pressMotionTime\" value=\"-1\">\r\n<input type=hidden name=\"emergence\" id=\"emergence\" value=0><!--缓急程度-->\r\n<input type=hidden name=\"needSendMsg\" id=\"needSendMsg\"><!--短信-->\r\n<input type=hidden name=\"smsContent\" id=\"smsContent\"><!--短信内容-->\r\n<input type=hidden name=\"dealTips\" id=\"dealTips\"><!--tips内容-->\r\n<input type=hidden name=\"processDeadlineDate\" id=\"processDeadlineDate\" value=\"0\"><!--流程办理期限-->\r\n<input type=hidden name=approveMode id=\"approveMode\" value=\"2\"><!--当前节点办理方式--><!--默认为2：单人-->\r\n<input type=hidden name=saveCheckFn id=\"saveCheckFn\" value=\"");
            out.print(saveCheckFn);
            out.write("\">\r\n<input type=hidden name=formName id=\"formName\" value=\"");
            out.print(formName);
            out.write("\">\r\n\r\n<input type=\"hidden\" name=\"sendMsgToInitiator\" id=\"sendMsgToInitiator\" value=\"0\"> <!-- 是否给发起人发送提醒 -->\r\n<input type=\"hidden\" name=\"sendMsgToDealDone\" id=\"sendMsgToDealDone\" value=\"0\"> <!-- 是否给已办人员发送提醒 -->\r\n\r\n<input type=hidden name=sendContinue id=\"sendContinue\" value=\"0\"><!-- 是否发送继续，默认否 -->\r\n<input type=hidden name=sendContinueUrl id=\"sendContinueUrl\" >\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\ndocument.all.sendContinueUrl.value=window.location;\r\n//-->\r\n</SCRIPT>\r\n<input type=\"hidden\" name=\"subProcess\" id=\"subProcess\" value=\"");
            out.print("1".equals(request.getParameter("subProcess"))?"1":"0");
            out.write("\"><!-- 是否是子流程发起页面 -->\r\n\r\n<input type=\"hidden\" name=\"changeDeadLineTime\" id=\"changeDeadLineTime\" value=\"-1\">\r\n");
            out.write("\r\n<!--阅件参数-->\r\n<input type=hidden name=\"mainNeedPassRound\" id=\"mainNeedPassRound\" value=\"1\">\r\n<input type=hidden name=\"mainPassRoundUserType\" id=\"mainPassRoundUserType\" value=100>\r\n<input type=hidden name=\"passRoundId\" id=\"passRoundId\">\r\n<input type=hidden name=\"passRoundName\" id=\"passRoundName\">\r\n\r\n  <table align=\"center\" width=\"100%\" style=\"display:none\">\r\n        <tr>\r\n            <td height=\"40\" colspan=\"2\" id=\"include_td1\">\r\n                <table border=\"0\" align=\"center\" cellpadding=\"1\" cellspacing=\"1\">\r\n                    <tr>\r\n                        <td>\r\n                            <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                <tr>\r\n                                    <td>\r\n                                    <button class=\"btnButton4font\" onclick=\"javascript:");
            out.print("1".equals(request.getParameter("moduleId"))?"if(beforeSubmit()){":"");
            out.write("include_nextStep();");
            out.print("1".equals(request.getParameter("moduleId"))?"}":"");
            out.write("\">下一步骤</button>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                        ");

                        if(button != null && button.length > 0){
                            for(int i = 0; i < button.length; i++){
                            //String btnStyle = "btnButton4font";
                            //if (button[i][0].toString().length <= 4)
                            //btnStyle = "btnButton2font";
                                
            out.write("\r\n                                <td>\r\n                                    <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                        <tr>\r\n                                            <td><button class=\"btnButton4font\" onclick=\"javascript:");
            out.print(button[i][1]);
            out.write(';');
            out.write('"');
            out.write('>');
            out.print(button[i][0]);
            out.write("</button></td>\r\n                                        </tr>\r\n                                    </table>\r\n                                </td>\r\n                                ");

                            }
                        }
            out.write("\r\n                        <td>\r\n                            <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                <tr>\r\n                                    <td>\r\n                                        <button class=\"btnButton2font\" onclick=\"javascript:window.location.reload();\">重置</button>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                        <td>\r\n                            <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\r\n                                <tr>\r\n                                    <td>\r\n                                    <button class=\"btnButton2font\" onclick =\"javascript:window.close();\">退出</button>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        ");
//if(com.js.system.util.SysSetupReader.getInstance().hasEzWorkFlow(session.getAttribute("domainId").toString())){
            out.write("\r\n        <!--\r\n        <tr>\r\n            <td colspan=\"2\" align=\"center\">\r\n                <iframe height=\"500\" width=\"90%\" src=\"/jsoa/jsflow/jsflow_view.jsp?processId=");
            out.print(request.getParameter("processId"));
            out.write("&table=");
            out.print(request.getParameter("table"));
            out.write("&record=");
            out.print(request.getParameter("record"));
            out.write("&CurActivityID=&ActivityIDStr=\"></iframe>\r\n            </td>\r\n        </tr>-->\r\n        ");
//}
            out.write("\r\n    </table>\r\n\r\n<iframe width=\"0\" height=\"0\" id=\"include_iframe\" name=\"include_iframe\" style=\"display:none\"></iframe>\r\n<script language=\"javascript\">\r\n<!--\r\n");
if(!"0".equals(request.getParameter("processType"))){
            out.write("\r\nvar include_td1HTML = document.all.include_td1.innerHTML;\r\n");
}
            out.write("\r\n\r\n//取消显示退回信息\r\nfunction include_backCacnel(){\r\n    document.all.include_td1.innerHTML = include_td1HTML;\r\n}\r\n//国资委 收文保存草稿功能  专用\r\nfunction include_save_receivefile_gzw(){\r\n\tif(");
            out.print(saveCheckFn);
            out.write("){\r\n\t\tvar editId = document.getElementById(\"editId\");\r\n\t\tvar frm=document.getElementsByName(\"");
            out.print(formName);
            out.write("\")[0];\r\n\t\t//frm.target = \"myIframe\";\r\n\t\tfrm.action = \"/jsoa/TjgzwAction.do?type=save_gzw_receivfile&editId=\"+editId.value+\"");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t//alert(frm.action);\r\n\t    //setTimeout(\"window.close();\",2000);\r\n\t\tfrm.submit();\r\n\r\n\t}\r\n\t\r\n}\r\n\r\n//保存\r\nfunction include_save(){\r\n//alert(\"firstHidden:\"+\"include_save\");\r\n    if(include_checkUser()){\r\n        if(");
            out.print(saveCheckFn);
            out.write("){\r\n        \tvar _userType=document.all.userType.value;\r\n        \t//alert(_userType);\r\n        \tif(_userType==\"10\"){\r\n        \t\t//选择方式是部门领导的，已经将领导empId,empName 取出，按照用户处理\r\n        \t\t_userType=\"100\";\r\n        \t}\r\n        \t\r\n            switch (parseInt(_userType)) {\r\n\t\t\t\tcase 100:\r\n                    //新节点\r\n                    var empId = \"\";\r\n                    var orgId = \"\";\r\n                    var groupId = \"\";\r\n                    var idstr = document.all.operId.value;\r\n                    //alert(idstr);\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i,nextPos+1);\r\n                            if(flagCode == \"$\"){\r\n                                empId = empId + str;\r\n                            }else if(flagCode == \"*\"){\r\n                                orgId = orgId + str;\r\n");
            out.write("                            }else{\r\n                                groupId = groupId + str;\r\n                            }\r\n                            i = nextPos;\r\n                        }\r\n                    }\r\n\t\t\t\t\t//alert(empId+ \"\\n\" +orgId+ \"\\n\" +groupId);\r\n\t\t\t\t\t//alert(include_checkUserStatus);\r\n                    workflowSync.getUserStatusByEmpOrgGrp(empId, orgId, groupId, include_checkUserStatus);\r\n                    break;\r\n                case 0:\r\n                    //流程发起人的上级领导\r\n                    var userIds = \"\";\r\n                    if(document.all.candidateUser.length){\r\n                        for(i = 0; i < document.all.candidateUser.length; i ++ ){\r\n                            if(document.all.candidateUser[i].checked){\r\n                                userIds += document.all.candidateUser[i].value + \",\";\r\n                            }\r\n                        }\r\n                    }else{\r\n                        userIds = document.all.candidateUser.value;\r\n                    }\r\n                    workflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n");
            out.write("                    break;\r\n                case 1:\r\n                    //由上一节点参与者从所有用户中选择\r\n                    var empId = \"\";\r\n                    var orgId = \"\";\r\n                    var groupId = \"\";\r\n                    var idstr = document.all.operProcUser.value;\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i,nextPos+1);\r\n                            if(flagCode == \"$\"){\r\n                                empId = empId + str;\r\n                            }else if(flagCode == \"*\"){\r\n                                orgId = orgId + str;\r\n                            }else{\r\n                                groupId = groupId + str;\r\n                            }\r\n                            i = nextPos;\r\n                        }\r\n                    }\r\n                    workflowSync.getUserStatusByEmpOrgGrp(empId, orgId, groupId, include_checkUserStatus);\r\n");
            out.write("                    break;\r\n                case 2:\r\n                    //从候选人员中指定candidateUser\r\n                    var userIds = \"\";\r\n                    if(document.all.candidateUser.length){\r\n                        for(i = 0; i < document.all.candidateUser.length; i ++ ){\r\n                            if(document.all.candidateUser[i].checked){\r\n                                userIds += document.all.candidateUser[i].value + \",\";\r\n                            }\r\n                        }\r\n                    }else{\r\n                        userIds = document.all.candidateUser.value;\r\n                    }\r\n                    workflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n                    break;\r\n                case 3:\r\n                    //指定全部办理人\r\n                    var userIds = \"\";\r\n                    if(document.all.allUser.length){\r\n                        for(i = 0; i < document.all.allUser.length; i ++ ){\r\n                            userIds += document.all.allUser[i].value + \",\";\r\n");
            out.write("                        }\r\n                    }else{\r\n                        userIds = document.all.allUser.value;\r\n                    }\r\n                    workflowSync.getUserStatusByEmpIdStr(userIds, include_checkUserStatus);\r\n                    break;\r\n                case 5:\r\n                    //流程发起人\r\n                    workflowSync.getUserStatus(\"");
            out.print(session.getAttribute("userId"));
            out.write("\", include_checkUserStatus);\r\n                    break;\r\n                case 6:\r\n                    //角色用户\r\n                    workflowSync.getUserStatusByRole(document.all.partRole.value, \"");
            out.print(session.getAttribute("userId"));
            out.write("\", include_checkUserStatus);\r\n                    break;\r\n\t\t\t\t\r\n\t\t\t\tcase 10:\r\n                    //组织领导\r\n                    var orgId = \"\";\r\n                    var idstr = document.all.operId.value;\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i+1,nextPos);\r\n                            if(flagCode == \"*\"){\r\n                                orgId = orgId + str + \",\";\r\n                            }\r\n                            i = nextPos;\r\n                        }\r\n                    }\r\n\t\t\t\t\torgId = orgId.substring(0,orgId.length-1);\r\n\t\t\t\t\tdocument.all.operId.value = orgId;\r\n                    workflowSync.getLeaderByOrgId(orgId, include_checkUserStatus);\r\n                    break;\r\n\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n");
            out.write("\r\nfunction include_branch_save(){    \r\n    if(");
            out.print(saveCheckFn);
            out.write("){\r\n    \tif(confirm(\"您确定提交吗？\")){\r\n    \t\tvar editId =document.getElementById(\"editId\").value;\r\n\t\t\t");
            out.print(formName);
            out.write(".target = \"myIframe\";\r\n\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonAction.do?flag=save");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("&resubmitWorkId=\"+editId;\r\n\t\t\t\r\n\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t");
if(BrowserJudge.isFirefox(request)){
            out.write("\r\n\t\t\tsetTimeout(\"window.close()\",1200);\r\n\t\t\t");
}
            out.write("\r\n\t\t\tpullXMenuDisabledAllMenu();\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t}\r\n    }\r\n    \r\n}\r\n//保存至草稿\r\nfunction include_saveToDraft(){\r\n\tif(include_checkUser()){\r\n        //");
            out.print(saveCheckFn);
            out.write(";\r\n        \t");
            out.print(formName);
            out.write(".target = \"myIframe\";\r\n\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonAction.do?flag=saveToDraft&savefirst=1");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\tpullXMenuDisabledAllMenu();\r\n\t\t\r\n\t}\r\n}\r\n\r\n//保存至草稿\r\nfunction include_saveFirstComp(){\r\n\tif(include_checkUser()){\r\n        ");
            out.print(saveCheckFn);
            out.write(";\r\n        \t");
            out.print(formName);
            out.write(".target = \"myIframe\";\r\n\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonAction.do?flag=saveFirstComp&savefirst=1");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\tpullXMenuDisabledAllMenu();\r\n\t\t\r\n\t}\r\n}\r\n//保存第一步\r\nfunction include_saveFirst(){\r\n    if(include_checkUser()){\r\n        if(");
            out.print(saveCheckFn);
            out.write("){\r\n            switch (parseInt(document.all.userType.value)) {\r\n\t\t\t\tcase 100:\r\n                    //新节点\r\n                    var empId = \"\";\r\n                    var orgId = \"\";\r\n                    var groupId = \"\";\r\n                    var idstr = document.all.operId.value;\r\n                    if(idstr != \"\"){\r\n                        for( var i = 0; i < idstr.length; i ++ ){\r\n                            flagCode = idstr.charAt(i);\r\n                            nextPos = idstr.indexOf(flagCode,i + 1);\r\n                            str = idstr.substring(i,nextPos+1);\r\n                            if(flagCode == \"$\"){\r\n                                empId = empId + str;\r\n                            }else if(flagCode == \"*\"){\r\n                                orgId = orgId + str;\r\n                            }else{\r\n                                groupId = groupId + str;\r\n                            }\r\n                            i = nextPos;\r\n                        }\r\n                    }\r\n\t\t\t\t\t//alert(empId+ \"\\n\" +orgId+ \"\\n\" +groupId);\r\n");
            out.write("                    ");
            out.print(formName);
            out.write(".target = \"_self\";\r\n\t\t\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonAction.do?flag=save&savefirst=1");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("\";\r\n\t\t\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t\t\tpullXMenuDisabledAllMenu();\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    \r\n}\r\n\r\n\r\nfunction include_checkUserStatus(s) {\r\n    var editId =document.getElementById(\"editId\").value;\r\n\tif(s==\"noleader\"){\r\n\t\t//组织领导不存在\r\n\t\talert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includenoleader"));
            out.write("\");\r\n\t\treturn;\r\n\t}\r\n\t");
if("0".equals(request.getParameter("processType"))){
            out.write("\r\n\t\t\r\n\t");
} else{
            out.write("\r\n\t\t//业务流程\r\n\t\tif(s == \"\"){\r\n\t\t\t\r\n\t\t\tvar frm=document.getElementsByName(\"");
            out.print(formName);
            out.write("\")[0];\r\n\t\t\tfrm.target = \"myIframe\";\r\n\t\t\tfrm.action = \"/jsoa/WorkflowButtonAction.do?flag=save");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("&resubmitWorkId=\"+editId;\r\n\t\t\tfrm.submit();\r\n\t\t\tdocument.getElementById(\"sendContinue\").value=\"0\";//继续发送为“否”\r\n\t\t\t//");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t//提示“已提交给XX[XX]”");
if(BrowserJudge.isFirefox(request)){
            out.write("\r\n\t\t\tif(confirm(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
            out.write("\"+document.all.operName.value+\"[\"+document.all.activityName.value+\"]\")){\r\n\t\t\t\twindow.close();}else{window.close();}");
}else{
            out.write("\r\n\t\t\talert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
            out.write("\"+document.all.operName.value+\"[\"+document.all.activityName.value+\"]\");\r\n\t\t\t");
}
            out.write("\r\n\t\t} else {\r\n\t\t//下一办理人：XX ，您确定要提交办理吗？\r\n\t\t\tif(confirm(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includenextuser"));
            out.write("：\" + s + \"，");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmturntodeal"));
            out.write("\")){\r\n\t\t\t\t");
            out.print(formName);
            out.write(".target = \"myIframe\";\r\n\t\t\t\t");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowButtonAction.do?flag=save");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("&resubmitWorkId=\"+editId;\r\n\t\t\t\t\r\n\t\t\t\t");
            out.print(formName);
            out.write(".submit();\r\n\t\t\t\t//提示“已提交给XX[XX]”\r\n\t\t\t\talert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includehassuccessturnto"));
            out.write("\"+document.all.operName.value+\"[\"+document.all.activityName.value+\"]\");\r\n\t\t\t\t");
if(BrowserJudge.isFirefox(request)){
            out.write("\r\n\t\t\t\tsetTimeout(\"window.close()\",1200);\r\n\t\t\t\t");
}
            out.write("\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t//pullXMenuDisabledAllMenu();\r\n\t");
}
            out.write("\r\n}\r\n\r\n\r\n//检验办理用户\r\nfunction include_checkUser(){\r\n    if(document.all.randomProcUser){\r\n        if(document.all.randomProcUser.value == \"\"){\r\n            alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            return false;\r\n        }\r\n    }\r\n    if(document.all.candidateUser){\r\n        var i = 0;\r\n        if(document.all.candidateUser.length){\r\n            for(var j = 0; j < document.all.candidateUser.length; j ++){\r\n                if(document.all.candidateUser[j].checked){\r\n                    i = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }else{\r\n            if(document.all.candidateUser.checked){\r\n                i = 1;\r\n            }\r\n        }\r\n        if(i == 0){\r\n            alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            return false;\r\n        }\r\n    }\r\n\r\n    if(document.all.operProcUserName){\r\n        if(document.all.operProcUserName.value == \"\"){\r\n            alert(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeseldealuser"));
            out.write("\");\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\n\r\n//选择全部办理/阅件用户\r\nfunction selectAll(name,obj){\r\n\tif(eval(\"document.all.\"+name)){\r\n\t\tif(eval(\"document.all.\"+name+\".length\")){\r\n\t\t\tfor(i=0;i<eval(\"document.all.\"+name+\".length\");i++){\r\n\t\t\t\tif(obj.checked){\r\n\t\t\t\t\teval(\"document.all.\"+name)[i].checked = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\teval(\"document.all.\"+name)[i].checked = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(obj.checked){\r\n\t\t\t\teval(\"document.all.\"+name).checked = true;\r\n\t\t\t}else{\r\n\t\t\t\teval(\"document.all.\"+name).checked = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//保存继续\r\nfunction include_continue(){\r\n    if(include_checkUser()){\r\n        if(");
            out.print(saveCheckFn);
            out.write("){\r\n            document.all.include_td1.style.display = \"none\";\r\n            ");
            out.print(formName);
            out.write(".target = \"_self\";\r\n            ");
            out.print(formName);
            out.write(".action = \"/jsoa/WorkflowCommonAction.do?flag=save");
            out.print(request.getParameter("subProc")==null?"":"&subProc=1");
            out.write("&continue=1\";\r\n            ");
            out.print(formName);
            out.write(".submit();\r\n            pullXMenuDisabledAllMenu();\r\n        }\r\n    }\r\n}\r\n\r\n//-->\r\n</script>\r\n");
}
            out.write("\r\n<SCRIPT LANGUAGE=\"JavaScript\">\r\n<!--\r\n//关闭\r\nfunction include_close(){\r\n    if(confirm(\"");
            out.print(Resource.getValue(localhi,"workflow","workflow.includeconfirmclosewindow"));
            out.write("\")){\r\n        window.opener=null;\r\n        window.close();\r\n    }\r\n}\r\nfunction editOffices(field,fileType,template,showSign){\r\n\t//alert(\"开始打开\");\r\n\tvar recordId = eval(\"document.all.\"+field+\".value\");\r\n\tvar userName = document.all.user_Name.value;\r\n\t\r\n\twindow.open(\"/jsoa/iWebOfficeSign/DocumentEdit.jsp?RecordID=\"+recordId+\"&EditType=1&UserName=\"+userName+\r\n\t\t\t\"&ShowSign=\"+showSign+\"&CanSave=1&moduleType=information&saveHtmlImage=0&saveDocFile=0&field=\"+field+\r\n\t\t\t\"&FileType=.\"+fileType+\"&showEditButton=1&showSignButton=1&Template=\"+template, \r\n\t\t\t\"\", \"status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,Height=400,left=0,top=0\");\r\n}\r\nfunction checkYijianBlur(obj){\r\n\tvar yijian = obj.value;\r\n\tif(yijian.indexOf(\"'\")>=0 || yijian.indexOf(\"\\\"\")>=0){\r\n\t\talert(\"意见中不能有英文状态下的单引号或双引号\");\r\n\t\tobj.focus();\r\n\t}\r\n\t\r\n}\r\n//-->\r\n</SCRIPT>");
            out.write("</td>\r\n                </tr>\r\n                \r\n                <tr style=\"display:none\">\r\n                    <td><iframe name=\"myIframe\" ></iframe></td>\r\n                </tr>\r\n            </table>\r\n            </div>\r\n            <div id=\"docinfo1\" style=\"display:none\">\r\n             \r\n                <table width=\"100%\">\r\n                    <tr>\r\n                        <td colspan=\"10\" align=\"center\">\r\n                            <iframe id=\"flowviewFrame\" name=\"flowviewFrame\" frameborder=\"0\" border=\"0\" height=\"500\" width=\"100%\" src=\"\"></iframe>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                \r\n            </div>\r\n           </td>\r\n        </tr>\r\n       \r\n     </table>\r\n       </td>\r\n    </tr>\r\n    \r\n</table>\r\n\r\n</div>\r\n</td>\r\n</tr>\r\n</table>\r\n</td>\r\n</tr>\r\n</table>\r\n</form>\r\n<iframe name=\"newIframe\" id=\"newIframe\" style=\"display:none\"></iframe>\r\n\r\n</body>\r\n");

String[] formJSCode={"",""};
if(com.js.util.config.SystemCommon.getFormProgram()==1){ 
	formJSCode=cst.getJSCode(pageId);
}

            out.write("\r\n<script language=\"javascript\">\r\n<!--\r\nfunction checkNum(obj){\r\n    if(isNaN(obj.value)){\r\n        alert(\"请输入数字！\");\r\n        obj.select();\r\n        //obj.focus(); //focus 将导致死循环 弹出提示框\r\n    }\r\n}\r\n\r\nfunction checkTextAreaLen(obj,len){\r\n    if(obj.value.length >= len){\r\n        alert(\"文本输入长度不能超过\" + len);\r\n        obj.select();\r\n        //obj.focus();//focus 将导致死循环 弹出提示框\r\n    }\r\n}\r\n\r\nfunction nextStep(){\r\n    if(beforeSubmit()){\r\n        WorkFlowFormActionForm.target = \"newIframe\";\r\n        WorkFlowFormActionForm.action = \"/jsoa/WorkFlowNewIframeAction.do\";\r\n        WorkFlowFormActionForm.submit();\r\n    }\r\n}\r\n\r\nfunction save(){\r\n    //setHtmlValue();\r\n    document.all.myAction.value = \"submitForm\";\r\n    if(beforeSubmit()){\r\n        WorkFlowFormActionForm.target = \"_self\";\r\n        WorkFlowFormActionForm.action = \"/jsoa/JsFlowAddAction.do?sendMsg=4\";\r\n        WorkFlowFormActionForm.submit();\r\n    }\r\n}\r\n\r\nfunction setHtmlValue(){\r\n    if(document.all.hasHtml){\r\n        //页面中包含有HTML编辑器\r\n        if(document.all.hasHtml.length){\r\n");
            out.write("            //页面中包含不止一个HTML编辑器\r\n            var len = document.all.hasHtml.length;\r\n            for(var j = 0; j < len; j ++){\r\n            \tvar htmlEditName = document.all.hasHtml[j].value;\r\n            \tvar o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n            \tdocument.getElementById(htmlEditName).value=o_Editor.getHTML();\r\n                //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n            }\r\n        }else{\r\n        \t//alert(document.all.hasHtml.value);\r\n            //页面上仅有一个HTML编辑器\r\n            var htmlEditName = document.all.hasHtml.value;\r\n            var o_Editor = document.getElementById(htmlEditName + \"_html\").contentWindow;\r\n            document.getElementById(htmlEditName).value=o_Editor.getHTML();\r\n            //eval(\"document.all.\" + htmlEditName + \".value = \" + htmlEditName + \"_html.getHTML()\");\r\n        }\r\n    }\r\n}\r\n\r\nfunction addFile(fieldName){\r\n    JSMainWinOpen(\"jsflow/workflow_upload.jsp?fieldName=\" + fieldName ,'上传','menubar=0,scrollbars=0,locations=0,width=400,height=200,resizable=no');\r\n");
            out.write("}\r\n\r\nfunction deleteRow(rowNum,fieldName,saveName){\r\n    var tableObj = eval(\"document.all.\" + fieldName + \"_tab\");\r\n    for(var i = 0; i < tableObj.rows.length; i ++){\r\n    \tvar removeNode = tableObj.rows(i);\r\n        if(removeNode.all.tableRow){\r\n            if(removeNode.all.tableRow.value == rowNum){\r\n                removeNode.removeNode(true);\r\n                document.all.myIframe.src = \"/jsoa/jsflow/workflow_deleteFile.jsp?saveName=\" + saveName;\r\n            }\r\n        }\r\n    }\r\n//    removeNode.removeNode(true);\r\n}\r\n\r\nfunction delGroupRow(fieldName,rowNum){\r\n    var tableObj = eval(\"document.all.\" + fieldName + \"_group\");\r\n    for(var i = 1; i < tableObj.rows.length; i ++){\r\n        var removeNode = tableObj.rows(i);\r\n        if(removeNode.all.tableRow.value == rowNum){\r\n            removeNode.removeNode(true);\r\n        }\r\n    }\r\n}\r\n\r\nfunction beforeSubmit(){\r\n\tsetHtmlValue();\r\n    var canSubmit = true;\r\n    try{\r\n\t\tsetComputeForeignField();\r\n\t}catch(e){\r\n\t}\r\n    if(document.all.mustWrite){\r\n        //如果页面有必填项\r\n");
            out.write("        if(document.all.mustWrite.length){\r\n            //如果页面不止一个必填项\r\n            for(var i =0; i < document.all.mustWrite.length; i ++){\r\n                var obj = eval(\"document.all.\" + document.all.mustWrite[i].value);\r\n                if(obj){\r\n                    var objType = \"\";\r\n                    if(obj.type){\r\n                       objType = obj.type.toUpperCase();                      \r\n                    }else{\r\n                        if(obj.length){\r\n\t\t\t\t\t\t\tfor(var k=0;k<obj.length;k++){\r\n\t\t\t\t\t\t\t\t//i++;\r\n\t\t\t\t\t\t\t\tobjType = obj[k].type.toUpperCase();\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar objTemp = obj[k];\r\n\t\t\t\t\t\t\t\tif(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t   \r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n");
            out.write("\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HIDDEN\"){\r\n\t\t\t\t\t\t\t\t\tif(textIsEmpty(objTemp)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"CHECKBOX\" || objType==\"RADIO\"){\r\n\t\t\t\t\t\t\t\t    \r\n\t\t\t\t\t\t\t\t    //checkbox 为一组,验证obj 而不是objtemp\r\n\t\t\t\t\t\t\t\t\tif(!checkboxIsChecked(obj)){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(objType == \"HTML\"){\r\n\t\t\t\t\t\t\t\t\tif(eval(objTemp.id + \".getHTML()\")==\"\"){\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\talert(\"请填写必填项！\");\r\n\t\t\t\t\t\t\t\t\t\tobjTemp.focus();\r\n\t\t\t\t\t\t\t\t\t\tcanSubmit = false;\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n                        }else{\r\n                            objType = \"HTML\";\r\n                        }\r\n");
            out.write("                    }\r\n                   // alert(objType+\":\"+obj.name);\r\n                    if(objType == \"TEXT\" || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"HIDDEN\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n");
            out.write("                        }\r\n                    }else if(objType == \"CHECKBOX\" || objType == \"RADIO\"){\r\n                        if(!checkboxIsChecked(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                            break;\r\n                        }\r\n                    }else if(objType == \"HTML\"){\r\n                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n                    }\r\n                }\r\n                if(document.all.fieldName && document.all.fieldName.length){\r\n                    for(var j = 0; j < document.all.fieldName.length; j ++){\r\n                        if(document.all.fieldName[j].value == document.all.mustWrite[i].value + \"_file\"){\r\n                            if(!eval(\"document.all.\" + document.all.mustWrite[i].value + \"_fileName\")){\r\n                                alert(\"请填写必填项！\");\r\n");
            out.write("                                canSubmit = false;\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    if(!canSubmit){\r\n                    \tbreak;\r\n                    }\r\n                }\r\n                obj = eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\");\r\n                if(obj){\r\n                   if(eval(\"document.all.\" + document.all.mustWrite[i].value + \"_Id\").value==\"\"){\r\n                        alert(\"请填写必填项！\");\r\n                        canSubmit = false;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }else{\r\n            //页面只有一个必填项\r\n            var obj = eval(\"document.all.\" + document.all.mustWrite.value);\r\n            if(obj){\r\n                var objType = \"\";\r\n                if(obj.type){\r\n                    objType = obj.type.toUpperCase();\r\n                }else{\r\n                    if(obj.length){\r\n                        objType = obj[0].type.toUpperCase();\r\n");
            out.write("                    }else{\r\n                        objType = \"HTML\";\r\n                    }\r\n                }\r\n                if(objType == \"TEXT\"  || objType == \"PASSWORD\" || objType == \"TEXTAREA\" || objType == \"SELECT-ONE\"){\r\n                    if(textIsEmpty(obj)){\r\n                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"TEXT/X-SCRIPTLET\"){\r\n                    if(obj.html.length == 0){\r\n                        alert(\"请填写必填项！\");\r\n                        obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"HIDDEN\"){\r\n                        if(textIsEmpty(obj)){\r\n                            alert(\"请填写必填项！\");\r\n                            //obj.focus();\r\n                            canSubmit = false;\r\n                        }\r\n                    }else if(objType == \"CHECKBOX\"){\r\n                    if(!checkboxIsChecked(obj)){\r\n");
            out.write("                        alert(\"请填写必填项！\");\r\n                        //obj.focus();\r\n                        canSubmit = false;\r\n                    }\r\n                }else if(objType == \"HTML\"){\r\n                        if(eval(obj.id + \".getHTML()\")==\"\"){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if(document.all.fieldName && document.all.fieldName.length){\r\n                for(var j = 0; j < document.all.fieldName.length; j ++){\r\n                    if(document.all.fieldName[j].value == document.all.mustWrite.value + \"_file\"){\r\n                        if(!eval(\"document.all.\" + document.all.mustWrite.value + \"_fileName\")){\r\n                            alert(\"请填写必填项！\");\r\n                            canSubmit = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n\t\t\tobj = eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\");\r\n                if(obj){\r\n");
            out.write("                   if(eval(\"document.all.\" + document.all.mustWrite.value + \"_Id\").value==\"\"){\r\n                        alert(\"请填写必填项！\");\r\n                        canSubmit = false;\r\n                    }\r\n                }\r\n        }\r\n    }\r\n    //检查日期字段是否合法 2010-10-12\r\n    var formDateTimeObj=document.getElementsByName(\"needCheckField\");\r\n    var singleObj,singleObjName;\r\n    for(var i=0;i<formDateTimeObj.length;i++){\r\n    \t\r\n    \t//检查每一个字段\r\n    \tsingleObjName=formDateTimeObj[i].value;    \t\r\n    \tsingleObj=document.getElementsByName(singleObjName);\r\n    \tsingleObjType=document.getElementsByName(singleObjName+\"_type\");\r\n    \tfor(var j=0;j<singleObj.length;j++){    \t\r\n    \t\tif(singleObjType[j].value==\"jsdate\" || singleObjType[j].value==\"datetime\"){\r\n    \t\t\t\r\n    \t\t\tif(!checkSimpleDate(singleObj[j].value)){\r\n    \t\t\t\talert(\"日期格式不正确！\");\r\n    \t\t\t\tsingleObj[j].focus();\r\n    \t\t\t\treturn false;\r\n    \t\t\t}\r\n    \t\t\t     \r\n    \t\t}else if(singleObjType[j].value==\"jstime\"){\r\n    \t\t\t//时间类型\r\n    \t\t\tif(!checkSimpleTime(singleObj[j].value)){\r\n");
            out.write("    \t\t\t\talert(\"时间格式不正确！\");\r\n    \t\t\t\tsingleObj[j].focus();\r\n    \t\t\t\treturn false;\r\n    \t\t\t}\r\n    \t\t}\r\n    \t}\r\n    \t\r\n    }  \r\n    var computeFields=document.getElementsByName(\"computeField\");\r\n    var computeFieldValues=document.getElementsByName(\"computeFieldValue\");\r\n    for(var i=0;i<computeFields.length;i++){   \r\n    \tvar computeField = computeFields[i].value;\r\n        var exp = computeFieldValues[i].value;        \r\n        setMainComputeField(computeField,exp);\r\n    }   \r\n\r\n    if(canSubmit){\r\n        //检查每一个字段的大小\r\n\t    if(checkAllObjectSize()){\r\n\t    \tcanSubmit=true;\r\n\t    }else{\r\n\t    \tcanSubmit=false;\r\n\t    }\r\n\t    //自动添加批示意见\r\n\t    setHtmlValue();\r\n   \r\n   }\r\n   //执行用户定义Javascript代码\r\n   ");
            out.print((formJSCode[1]==null || "null".equals(formJSCode[1]))?"":formJSCode[1]);
            out.write("\r\n   return canSubmit;\r\n}\r\n\r\n");
java.util.List noWriteField = (java.util.List) request.getAttribute("noWriteField");
            out.write("\r\nfunction init(){\r\n    ");
for(int i = 0; i < noWriteField.size(); i ++){
            out.write("\r\n    if(document.all.tr_");
            out.print(noWriteField.get(i));
            out.write("){\r\n    \tdocument.all.tr_");
            out.print(noWriteField.get(i));
            out.write(".style.display = \"none\";\r\n  \t}");
}
            out.write('\r');
            out.write('\n');
            out.write('	');
if(formJSCode[0]==null||formJSCode[0].equals("")||formJSCode[0].equals("null")){
		out.println("");
	}else{
		out.println(formJSCode[0]);
	}
            out.write("\r\n}\r\n\r\nfunction changeText(){\r\n}\r\nfunction clickRadio(obj){\r\n    changeText();\r\n}\r\nfunction clickCheckbox(){\r\n    changeText();\r\n}\r\nfunction changeSelect(){\r\n    changeText();\r\n}\r\nfunction changeTextarea(){\r\n    changeText();\r\n}\r\n\r\n/*处理自定义表单中HTML编辑器延时加载 */\r\nfunction reloadHTMLEditor(){\r\n\tfor(var i=0;i<document.getElementsByTagName(\"iframe\").length;i++){\r\n\t\tif(document.getElementsByTagName(\"iframe\")[i].src.indexOf(\"ewebeditor.htm\")>0){\r\n\t\t\tvar src = document.getElementsByTagName(\"iframe\")[i].src;\r\n\t\t\tdocument.getElementsByTagName(\"iframe\")[i].src = \"\";\r\n\t\t\tdocument.getElementsByTagName(\"iframe\")[i].src=src;\r\n\t\t}\r\n\t}\r\n}\r\n\t/*处理自定义表单中HTML编辑器延时加载 */\r\n\r\n\r\nvar xmlHttp = false;\r\n\ttry {\r\n\t\txmlHttp = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n\t} catch (e) {\r\n\t\ttry {\r\n\t\t\txmlHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t} catch (e2) {\r\n\t\t\txmlHttp = false;\r\n\t\t}\r\n\t}\r\n\tif (!xmlHttp && typeof XMLHttpRequest != 'undefined') {\r\n\t\txmlHttp = new XMLHttpRequest();\r\n\t}\r\nvar fieldName;\r\n\r\nfunction getAutoCode(obj,field){\r\n\tfieldName = field;\r\n");
            out.write("\txmlHttp.open(\"GET\", \"/jsoa/userdb/getAutoCode.jsp?pageId=");
            out.print(request.getParameter("tableId"));
            out.write("&field=\"+field+\"&head=\"+obj.value, true);\r\n\txmlHttp.onreadystatechange = updateAutoCode;\r\n\txmlHttp.send(null);\r\n}\r\n\r\nfunction updateAutoCode(){\r\n\tif (xmlHttp.readyState < 4) {\r\n\t\t//document.all.printNum.innerHTML=\"正在加载\";\r\n\t}\r\n\tif (xmlHttp.readyState == 4) {\r\n\t\tvar response = xmlHttp.responseText;\r\n\t\teval(\"document.all.\"+fieldName).value = response;\r\n\t}\r\n}\r\n\r\n//-->\r\n</script>\r\n\r\n");
}}
            out.write('\r');
            out.write('\n');
            int evalDoAfterBody = _jspx_th_html_005fhtml_005f0.doAfterBody();
            if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
              break;
          } while (true);
        }
        if (_jspx_th_html_005fhtml_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
          return;
        }
        _005fjspx_005ftagPool_005fhtml_005fhtml.reuse(_jspx_th_html_005fhtml_005f0);
        _jspx_th_html_005fhtml_005f0_reused = true;
      } finally {
        org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_html_005fhtml_005f0, _jsp_getInstanceManager(), _jspx_th_html_005fhtml_005f0_reused);
      }
      out.write("\r\n<script src=\"/jsoa/js/util.js\"></script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
