/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: JspC/ApacheTomcat8
 * Generated at: 2023-01-06 09:57:59 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.public_.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.js.util.config.SysConfig;
import java.util.Map;

public final class multiuploadpic_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.js.util.config.SysConfig");
    _jspx_imports_classes.add("java.util.Map");
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=GBK");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n\r\n\r\n\r\n");


Map map = (Map) session.getAttribute("ftpMap");


String mode=(String)request.getParameter("mode");
String path=(String)request.getParameter("path");
String tableName=(String)request.getParameter("tableName");
String fileNames=(String)request.getParameter("fileName");
String saveNames=(String)request.getParameter("saveName");
String fileMaxNum = request.getParameter("fileMaxNum") ;

int fileSize=0;
if(request.getParameter("fileMaxSize")!=null){
    fileSize=Integer.parseInt((String)request.getParameter("fileMaxSize"));
}

String saveName="";
String fileName="";
String myRandom="";
//filePath+="/upload/"+path+"/";



      out.write("\r\n<HTML>\r\n<HEAD><TITLE>上传附件</TITLE></HEAD>\r\n<style type=\"text/css\">\r\n</style>\r\n<BODY  bgcolor=\"E8ECED\" onload=\"only('");
      out.print(tableName);
      out.write("')\">\r\n<br>\r\n<div align=\"center\"><P><font color=\"#3366CC\">请选择要上传的文件</font></p></div>\r\n<TABLE width=\"80%\" align=\"center\" border=0>\r\n<CENTER>\r\n  <TR>\r\n     <TD align=\"center\">\r\n\t <object\r\n\t\t\tclassid=\"clsid:89AF7F33-300E-4AFB-8DEA-D375FCE398B4\"\r\n\t\t\tid=\"ActiveFormX1\" width=\"407\" height=\"52\" codebase=\"P.cab#version=1,0,30,0\">\r\n\t\t\t<param name=\"filecountlimit\" value=\"11\">\r\n\t\t\t<param name=\"filesizelimit\" value=\"12000000\">\r\n\t\t\t<param name=\"filterext\" value=\"1jpg|bmp|jpeg|png|gif\">\r\n\t\t\t<param name=\"Visible\" value=\"0\">\r\n\t\t\t<param name=\"AutoScroll\" value=\"0\">\r\n\t\t\t<param name=\"AutoSize\" value=\"0\">\r\n\t\t\t<param name=\"AxBorderStyle\" value=\"0\">\r\n\t\t\t<param name=\"Caption\" value=\"ActiveFormX\">\r\n\t\t\t<param name=\"Color\" value=\"15592680\">\r\n\t\t\t<param name=\"Font\" value=\"宋体\">\r\n\t\t\t<param name=\"KeyPreview\" value=\"0\">\r\n\t\t\t<param name=\"PixelsPerInch\" value=\"96\">\r\n\t\t\t<param name=\"PrintScale\" value=\"1\">\r\n\t\t\t<param name=\"Scaled\" value=\"0\">\r\n\t\t\t<param name=\"DropTarget\" value=\"0\">\r\n\t\t\t<param name=\"HelpFile\" value>\r\n\t\t\t<param name=\"DoubleBuffered\" value=\"0\">\r\n");
      out.write("\t\t\t<param name=\"Enabled\" value=\"-1\">\r\n\t\t\t<param name=\"Cursor\" value=\"0\">\r\n\t\t\t<param name=\"ftphost\" value=\"");
      out.print(map.get("server"));
      out.write("\">\r\n\t\t\t<param name=\"ftpport\" value=\"");
      out.print(map.get("port"));
      out.write("\">\r\n\t\t\t<param name=\"ftpuser\" value=\"");
      out.print(map.get("user"));
      out.write("\">\r\n\t\t\t<param name=\"ftppwd\" value=\"");
      out.print(map.get("password"));
      out.write("\">\r\n\t\t\t<param name=\"ftpfile\" value=\"\">\r\n\t\t\t<param name=\"ftpupdfile\" value=\"\">\r\n\t\t\t<param name=\"dddd\" value=\"");
      out.print(map.get("ddd"));
      out.write("\">\r\n\t\t\t<param name=\"curpath\" value=\"");
      out.print(path);
      out.write("\">\r\n\t\t</object>\r\n     </TD>\r\n  </TR>\r\n  <tr>\r\n    <td>&nbsp;</td>\r\n  </tr>\r\n  <TR>\r\n     <TD align=\"center\"><INPUT NAME=\"submit\" VALUE=\"上传\" TYPE=\"button\" onclick=\"javascript:upload();\">\r\n\t     &nbsp;&nbsp;<INPUT NAME=\"reset\"  onclick=\"javascript:window.close()\" VALUE=\"关闭\" TYPE=\"button\">\r\n     </TD>\r\n  </TR>\r\n  <tr>\r\n    <td>&nbsp;</td>\r\n  </tr>\r\n  <tr>\r\n    <td align=\"center\">\r\n      <!--<img src=\"/jsoa/images/boder_left.gif\" hspace=\"5\" vspace=\"5\" id=\"preview\" >-->\r\n    </td>\r\n  </tr>\r\n</CENTER>\r\n</TABLE>\r\n</BODY>\r\n</HTML>\r\n<script language=\"javascript\">\r\nfunction check(parentTable){\r\n    if(document.all.photo.value==\"\"){\r\n        alert(\"请选择上传附件!\");\r\n        return false;\r\n    }\r\n    return only(parentTable) ;\r\n}\r\n\r\nfunction only(parentTable) {\r\n    \tvar obj=eval(\"opener.window.document.all.\"+parentTable);\r\n        var fileMaxNum = \"");
      out.print(fileMaxNum);
      out.write("\";\r\n         if( obj.rows.length== fileMaxNum*1+1 &&obj.rows!=\"undefined\") {\r\n           //  alert(\"您已经选择了图片\");\r\n             window.close();\r\n             return false ;\r\n        }\r\n         return true  ;\r\n}\r\n\r\n\r\n\r\nfunction upload(){\r\n    var tmpReturn = document.ActiveFormX1.startupload();\r\n\t//alert(tmpReturn);\r\n\r\n\t/*\r\n\t    tmpReturn的返回值有\r\n\t        LINKFAIL    ：连接失败\r\n\t\t\tNOFILE      :没有待上传文件\r\n\t\t\tOK          :上传完毕\r\n\t*/\r\n\tif(tmpReturn==\"OK\"){\r\n\t\twriteParentPage();\r\n\t\tgetReset();\r\n\t\twindow.close();\r\n\t}else{\r\n\t\talert(\"上传失败\");\r\n\t}\r\n}\r\n//重置\r\nfunction getReset(){\r\n    document.ActiveFormX1.setreset();\r\n}\r\n\r\n//取得原文件组\r\nfunction getOldfile(){\r\n    //document.all.fileRealName.value=document.ActiveFormX1.getoldfile();\r\n}\r\n\r\n//取得目标文件组\r\nfunction getNewfile(){\r\n\t//document.all.fileSaveName.value=document.ActiveFormX1.getnewfile();\r\n}\r\n\r\n//删除文件\r\nfunction delFile(){\r\n\r\n\tvar tmpReturn=document.ActiveFormX1.delfile(document.all.delfileinput.value);\r\n    alert(tmpReturn);\r\n    /*\r\n\t    tmpReturn的返回值有\r\n\t        LINKFAIL    ：连接失败\r\n");
      out.write("\t\t\tNOFILE      :没有待上传文件\r\n\t\t\tFAIL:424234234.gif|4565657.jpg     :表示424234234.gif,4565657.jpg不存在或删除失败\r\n\t\t\tOK          :删除完毕\r\n\t*/\r\n}\r\n\r\nfunction writeParentPage(){\r\n\tvar fileSuffix;\r\n\tvar fileNameTemp;\r\n\tvar tooLong=false;\r\n\tvar fileName=document.ActiveFormX1.getoldfile();\r\n\tvar saveName=document.ActiveFormX1.getnewfile();\r\n\tfileName=fileName.substring(fileName.lastIndexOf(\"\\\\\")+1);\r\n\tif(fileName.length>50){\r\n\t\tfileName=fileName.substring(0,50);\r\n\t\ttooLong=true;\r\n\t}\r\n\tif(fileName!=null) fileSuffix=fileName.substring(fileName.lastIndexOf(\".\")+1);\r\n\talert(\"附件上传成功\");\r\n        //在调用页面的table列表中显示\r\n        opener.reView(saveName);\r\n        var path=\"");
      out.print(path);
      out.write("\";\r\n        var parentTable=\"");
      out.print(tableName);
      out.write("\";\r\n        var fileNames=\"");
      out.print(fileNames);
      out.write("\";\r\n        var saveNames=\"");
      out.print(saveNames);
      out.write("\";\r\n\r\n        var obj=eval(\"opener.window.document.all.\"+parentTable);\r\n\r\n        obj.insertRow();\r\n        var rowNum=obj.rows.length-1;\r\n        var newNode=obj.rows(rowNum);\r\n        newNode.bgColor=\"#FFFFFF\";\r\n        newNode.id=\"newInsertedTrid\";\r\n        for(var i=0;i<2;i++){\r\n            newNode.insertCell();\r\n        }\r\n\r\n\r\n        obj.rows(rowNum).cells(0).innerText=fileName;\r\n        obj.rows(rowNum).cells(0).id=\"A\"+rowNum;\r\n        obj.rows(rowNum).cells(1).innerHTML=\"<input type=\\\"hidden\\\" id=\\\"\"+saveNames+\"\\\" name=\\\"\"+saveNames+\"\\\" value='\"+saveName+\"'><a href='javascript:delaccessory(\\\"\"+rowNum+\"\\\",\\\"\"+parentTable+\"\\\",\\\"\"+path+\"\\\",\\\"\"+fileNames+\"\\\",\\\"\"+saveNames+\"\\\");'>\"\r\n        +\"删除</a>\"\r\n        +\"<input type=\\\"hidden\\\" id=\\\"\"+fileNames+\"\\\" name=\\\"\"+fileNames+\"\\\" value='\"+fileName+\"'>\"\r\n        +\"&nbsp;&nbsp;<a alt='预览' border='0' href='#' onclick='reView(\\\"\"+saveName+\"\\\")' >预览</a>\" ;\r\n        ;\r\n\r\n        obj.rows(rowNum).cells(1).height=\"20\";\r\n        obj.rows(rowNum).cells(1).id=\"B\"+rowNum;\r\n");
      out.write("}\r\n\r\n</script>\r\n<script src=\"/jsoa/js/util.js\"></script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
